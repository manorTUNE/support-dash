'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _desc, _value, _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _unionWith = require('lodash/unionWith');

var _unionWith2 = _interopRequireDefault(_unionWith);

var _isEqual = require('lodash/isEqual');

var _isEqual2 = _interopRequireDefault(_isEqual);

var _some = require('lodash/some');

var _some2 = _interopRequireDefault(_some);

var _Base = require('../base/Base');

var _SelectControl = require('./SelectControl');

var _SelectControl2 = _interopRequireDefault(_SelectControl);

var _MultiSelectItem = require('../_selects/MultiSelectItem');

var _MultiSelectItem2 = _interopRequireDefault(_MultiSelectItem);

var _MultiSelectDropdownHeader = require('../dropdowns/MultiSelectDropdownHeader');

var _MultiSelectDropdownHeader2 = _interopRequireDefault(_MultiSelectDropdownHeader);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

/**
 * isEqual is comparator between two value with given keyMapper funciton
 *
 * comparatee will be sorted than each items are going to be compared using keyMapper.
 * @param  {Array}      value       previous value in array
 * @param  {Array}      nextValue   nextValue in array
 * @param  {Function}   keyMapper   function that maps an item to be unique identifier.
 * @return {Boolean}                returns true if two values are equal
 */
function isEqual(value, nextValue, keyMapper) {
  var sortedValue = (value || []).sort();
  var sortedNextValue = (nextValue || []).sort();
  return sortedValue.length === sortedNextValue.length && sortedValue.every(function (item, idx) {
    return (0, _isEqual2.default)(keyMapper(item), keyMapper(sortedNextValue[idx]));
  });
}

function createIndexMap() {
  var props = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  var value = props.value,
      keyMapper = props.keyMapper;

  var idxMap = {};
  (value || []).forEach(function (item) {
    var key = keyMapper(item);
    idxMap[key] = item;
  });
  return idxMap;
}

var TxlMultiSelectControl = (_class = function (_React$Component) {
  (0, _inherits3.default)(TxlMultiSelectControl, _React$Component);

  function TxlMultiSelectControl(args) {
    (0, _classCallCheck3.default)(this, TxlMultiSelectControl);

    var _this = (0, _possibleConstructorReturn3.default)(this, (TxlMultiSelectControl.__proto__ || (0, _getPrototypeOf2.default)(TxlMultiSelectControl)).call(this, args));

    _this._indexMap = createIndexMap(_this.props);

    _this.state = {
      keySelectedItemIndex: null
    };
    return _this;
  }

  (0, _createClass3.default)(TxlMultiSelectControl, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (!isEqual(this.props.value, nextProps.value, nextProps.keyMapper)) {
        this._indexMap = createIndexMap(nextProps);
      }
    }
  }, {
    key: '_onSelectAll',
    value: function _onSelectAll() {
      var currentlySelectedItems = this.props.value || [];
      var filteredItems = this._selectControl.getFilteredItems().getItems();
      var selectedItems = (0, _unionWith2.default)(currentlySelectedItems, filteredItems, _isEqual2.default);
      this.props.onChange({ value: selectedItems });
    }
  }, {
    key: '_onSelectNone',
    value: function _onSelectNone() {
      var filteredItems = this._selectControl.getFilteredItems().getItems();
      var selectedItems = this.props.value.filter(function (item) {
        return !(0, _some2.default)(filteredItems, item);
      });
      this.props.onChange({ value: selectedItems });
    }
  }, {
    key: '_handleSelectRef',
    value: function _handleSelectRef(ref) {
      this._selectControl = ref;
    }
  }, {
    key: '_handleHeaderRef',
    value: function _handleHeaderRef(ref) {
      this._header = ref;
    }
  }, {
    key: '_checkSelected',
    value: function _checkSelected(item) {
      var keyMapper = this.props.keyMapper;

      var itemKey = keyMapper(item);
      return !!this._indexMap[itemKey];
    }
  }, {
    key: '_onChange',
    value: function _onChange(item) {
      if (!item) {
        this.props.onChange({ value: [] });
      } else {
        var _props = this.props,
            keyMapper = _props.keyMapper,
            onChange = _props.onChange,
            value = _props.value;


        var itemKey = keyMapper(item);
        var containsItem = this._indexMap[itemKey] != null;

        if (value != null) {
          // toggle item selection
          var change = containsItem ? value.filter(function (valueItem) {
            return !(0, _isEqual2.default)(item, valueItem);
          }) : [].concat((0, _toConsumableArray3.default)(value), [item]);
          onChange({ value: change });
        }
      }
    }
  }, {
    key: '_handleKeySelectedItemIndexChange',
    value: function _handleKeySelectedItemIndexChange(_ref) {
      var keySelectedItemIndex = _ref.keySelectedItemIndex;

      this.setState({ keySelectedItemIndex: keySelectedItemIndex });
    }
  }, {
    key: 'keySelectedItemClear',
    value: function keySelectedItemClear() {
      this.setState({ keySelectedItemIndex: null });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props,
          closeDropdown = _props2.closeDropdown,
          container = _props2.container,
          enableLocalFiltering = _props2.enableLocalFiltering,
          grouper = _props2.grouper,
          groupRenderer = _props2.groupRenderer,
          itemHeight = _props2.itemHeight,
          itemRenderer = _props2.itemRenderer,
          items = _props2.items,
          keyMapper = _props2.keyMapper,
          label = _props2.label,
          initialListProps = _props2.listProps,
          loading = _props2.loading,
          noContentView = _props2.noContentView,
          onItemCreate = _props2.onItemCreate,
          open = _props2.open,
          openDropdown = _props2.openDropdown,
          onSearchChange = _props2.onSearchChange,
          placeholder = _props2.placeholder,
          predicateGetter = _props2.predicateGetter,
          secondaryText = _props2.secondaryText,
          showCreateNew = _props2.showCreateNew,
          showSearchToViewMoreMessage = _props2.showSearchToViewMoreMessage,
          target = _props2.target,
          validationState = _props2.validationState,
          value = _props2.value,
          valueMapper = _props2.valueMapper,
          width = _props2.width;


      var listHeader = _react2.default.createElement(
        'div',
        { ref: this._handleHeaderRef },
        initialListProps.header || _react2.default.createElement(_MultiSelectDropdownHeader2.default, {
          onSelectAll: this._onSelectAll,
          onSelectNone: this._onSelectNone
        })
      );

      var listProps = (0, _extends3.default)({}, initialListProps, {
        header: listHeader
      });

      return _react2.default.createElement(_SelectControl2.default, {
        closeDropdown: closeDropdown,
        container: container,
        enableLocalFiltering: enableLocalFiltering,
        grouper: grouper,
        groupRenderer: groupRenderer,
        isItemSelected: this._checkSelected,
        itemHeight: itemHeight,
        itemRenderer: itemRenderer,
        items: items,
        keyMapper: keyMapper,
        keySelectedItemClear: this.keySelectedItemClear,
        keySelectedItemIndex: this.state.keySelectedItemIndex,
        label: label,
        listProps: listProps,
        loading: loading,
        noContentView: noContentView,
        onChange: this._onChange,
        onItemCreate: onItemCreate,
        onKeySelectedItemIndexChange: this._handleKeySelectedItemIndexChange,
        onSearchChange: onSearchChange,
        open: open,
        openDropdown: openDropdown,
        placeholder: placeholder,
        predicateGetter: predicateGetter,
        ref: this._handleSelectRef,
        secondaryText: secondaryText,
        showCreateNew: showCreateNew,
        showSearchToViewMoreMessage: showSearchToViewMoreMessage,
        target: target,
        validationState: validationState,
        value: value,
        valueMapper: valueMapper,
        width: width
      });
    }
  }]);
  return TxlMultiSelectControl;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class.prototype, '_onSelectAll', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_onSelectAll'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_onSelectNone', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_onSelectNone'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleSelectRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleSelectRef'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleHeaderRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleHeaderRef'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_checkSelected', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_checkSelected'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_onChange', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_onChange'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleKeySelectedItemIndexChange', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleKeySelectedItemIndexChange'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, 'keySelectedItemClear', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, 'keySelectedItemClear'), _class.prototype)), _class);


TxlMultiSelectControl.propTypes = {
  closeDropdown: _SelectControl2.default.propTypes.closeDropdown,
  container: _SelectControl2.default.propTypes.container,
  enableLocalFiltering: _SelectControl2.default.propTypes.enableLocalFiltering,
  groupRenderer: _react.PropTypes.func,
  grouper: _SelectControl2.default.propTypes.grouper,
  itemHeight: _SelectControl2.default.propTypes.itemHeight,
  itemRenderer: _SelectControl2.default.propTypes.itemRenderer,
  items: _SelectControl2.default.propTypes.items,
  keyMapper: _SelectControl2.default.propTypes.keyMapper,
  label: _SelectControl2.default.propTypes.label,
  listProps: _SelectControl2.default.propTypes.listProps,
  loading: _SelectControl2.default.propTypes.loading,
  noContentView: _SelectControl2.default.propTypes.noContentView,
  onChange: _react.PropTypes.func.isRequired,
  onItemCreate: _react.PropTypes.func,
  onSearchChange: _SelectControl2.default.propTypes.onSearchChange,
  onSelectAll: _react.PropTypes.func,
  onSelectNone: _react.PropTypes.func,
  open: _SelectControl2.default.propTypes.open,
  openDropdown: _SelectControl2.default.propTypes.openDropdown,
  placeholder: _SelectControl2.default.propTypes.placeholder,
  predicateGetter: _SelectControl2.default.propTypes.predicateGetter,
  secondaryText: _SelectControl2.default.propTypes.secondaryText,
  showCreateNew: _SelectControl2.default.propTypes.showCreateNew,
  showSearchToViewMoreMessage: _SelectControl2.default.propTypes.showSearchToViewMoreMessage,
  target: _SelectControl2.default.propTypes.target,
  validationState: _SelectControl2.default.propTypes.validationState,
  value: _SelectControl2.default.propTypes.value,
  valueMapper: _SelectControl2.default.propTypes.valueMapper,
  width: _SelectControl2.default.propTypes.width
};

TxlMultiSelectControl.displayName = 'TxlMultiSelectControl';

TxlMultiSelectControl.defaultProps = {
  enableLocalFiltering: true,
  itemRenderer: _react2.default.createFactory(_MultiSelectItem2.default),
  items: [],
  keyMapper: function keyMapper(item) {
    return String(item.id);
  },
  loading: false,
  onChange: _Base.NOOP,
  onSearchChange: Function.prototype,
  value: [],
  valueMapper: function valueMapper(item) {
    return item.value;
  }
};

var _default = TxlMultiSelectControl;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(isEqual, 'isEqual', 'src/_selects/MultiSelectControl.jsx');

  __REACT_HOT_LOADER__.register(createIndexMap, 'createIndexMap', 'src/_selects/MultiSelectControl.jsx');

  __REACT_HOT_LOADER__.register(TxlMultiSelectControl, 'TxlMultiSelectControl', 'src/_selects/MultiSelectControl.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/_selects/MultiSelectControl.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9fc2VsZWN0cy9NdWx0aVNlbGVjdENvbnRyb2wuanN4Il0sIm5hbWVzIjpbImlzRXF1YWwiLCJ2YWx1ZSIsIm5leHRWYWx1ZSIsImtleU1hcHBlciIsInNvcnRlZFZhbHVlIiwic29ydCIsInNvcnRlZE5leHRWYWx1ZSIsImxlbmd0aCIsImV2ZXJ5IiwiaXRlbSIsImlkeCIsImNyZWF0ZUluZGV4TWFwIiwicHJvcHMiLCJpZHhNYXAiLCJmb3JFYWNoIiwia2V5IiwiVHhsTXVsdGlTZWxlY3RDb250cm9sIiwiYXJncyIsIl9pbmRleE1hcCIsInN0YXRlIiwia2V5U2VsZWN0ZWRJdGVtSW5kZXgiLCJuZXh0UHJvcHMiLCJjdXJyZW50bHlTZWxlY3RlZEl0ZW1zIiwiZmlsdGVyZWRJdGVtcyIsIl9zZWxlY3RDb250cm9sIiwiZ2V0RmlsdGVyZWRJdGVtcyIsImdldEl0ZW1zIiwic2VsZWN0ZWRJdGVtcyIsIm9uQ2hhbmdlIiwiZmlsdGVyIiwicmVmIiwiX2hlYWRlciIsIml0ZW1LZXkiLCJjb250YWluc0l0ZW0iLCJjaGFuZ2UiLCJ2YWx1ZUl0ZW0iLCJzZXRTdGF0ZSIsImNsb3NlRHJvcGRvd24iLCJjb250YWluZXIiLCJlbmFibGVMb2NhbEZpbHRlcmluZyIsImdyb3VwZXIiLCJncm91cFJlbmRlcmVyIiwiaXRlbUhlaWdodCIsIml0ZW1SZW5kZXJlciIsIml0ZW1zIiwibGFiZWwiLCJpbml0aWFsTGlzdFByb3BzIiwibGlzdFByb3BzIiwibG9hZGluZyIsIm5vQ29udGVudFZpZXciLCJvbkl0ZW1DcmVhdGUiLCJvcGVuIiwib3BlbkRyb3Bkb3duIiwib25TZWFyY2hDaGFuZ2UiLCJwbGFjZWhvbGRlciIsInByZWRpY2F0ZUdldHRlciIsInNlY29uZGFyeVRleHQiLCJzaG93Q3JlYXRlTmV3Iiwic2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlIiwidGFyZ2V0IiwidmFsaWRhdGlvblN0YXRlIiwidmFsdWVNYXBwZXIiLCJ3aWR0aCIsImxpc3RIZWFkZXIiLCJfaGFuZGxlSGVhZGVyUmVmIiwiaGVhZGVyIiwiX29uU2VsZWN0QWxsIiwiX29uU2VsZWN0Tm9uZSIsIl9jaGVja1NlbGVjdGVkIiwia2V5U2VsZWN0ZWRJdGVtQ2xlYXIiLCJfb25DaGFuZ2UiLCJfaGFuZGxlS2V5U2VsZWN0ZWRJdGVtSW5kZXhDaGFuZ2UiLCJfaGFuZGxlU2VsZWN0UmVmIiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJvblNlbGVjdEFsbCIsIm9uU2VsZWN0Tm9uZSIsImRpc3BsYXlOYW1lIiwiZGVmYXVsdFByb3BzIiwiY3JlYXRlRmFjdG9yeSIsIlN0cmluZyIsImlkIiwiRnVuY3Rpb24iLCJwcm90b3R5cGUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFQTs7Ozs7Ozs7O0FBU0EsU0FBU0EsT0FBVCxDQUFpQkMsS0FBakIsRUFBd0JDLFNBQXhCLEVBQW1DQyxTQUFuQyxFQUE4QztBQUM1QyxNQUFNQyxjQUFjLENBQUNILFNBQVMsRUFBVixFQUFjSSxJQUFkLEVBQXBCO0FBQ0EsTUFBTUMsa0JBQWtCLENBQUNKLGFBQWEsRUFBZCxFQUFrQkcsSUFBbEIsRUFBeEI7QUFDQSxTQUNFRCxZQUFZRyxNQUFaLEtBQXVCRCxnQkFBZ0JDLE1BQXZDLElBQ0dILFlBQVlJLEtBQVosQ0FBa0IsVUFBQ0MsSUFBRCxFQUFPQyxHQUFQO0FBQUEsV0FDbkIsdUJBQU1QLFVBQVVNLElBQVYsQ0FBTixFQUF1Qk4sVUFBVUcsZ0JBQWdCSSxHQUFoQixDQUFWLENBQXZCLENBRG1CO0FBQUEsR0FBbEIsQ0FGTDtBQU1EOztBQUVELFNBQVNDLGNBQVQsR0FBb0M7QUFBQSxNQUFaQyxLQUFZLHVFQUFKLEVBQUk7QUFBQSxNQUVo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Qk47QUFxQmhDRSxlQUFhLHdCQUFjb0IsU0FBZCxDQUF3QnBCLFdBckJMO0FBc0JoQ0MsbUJBQWlCLHdCQUFjbUIsU0FBZCxDQUF3Qm5CLGVBdEJUO0FBdUJoQ0MsaUJBQWUsd0JBQWNrQixTQUFkLENBQXdCbEIsYUF2QlA7QUF3QmhDQyxpQkFBZSx3QkFBY2lCLFNBQWQsQ0FBd0JqQixhQXhCUDtBQXlCaENDLCtCQUE2Qix3QkFBY2dCLFNBQWQsQ0FBd0JoQiwyQkF6QnJCO0FBMEJoQ0MsVUFBUSx3QkFBY2UsU0FBZCxDQUF3QmYsTUExQkE7QUEyQmhDQyxtQkFBaUIsd0JBQWNjLFNBQWQsQ0FBd0JkLGVBM0JUO0FBNEJoQzNELFNBQU8sd0JBQWN5RSxTQUFkLENBQXdCekUsS0E1QkM7QUE2QmhDNEQsZUFBYSx3QkFBY2EsU0FBZCxDQUF3QmIsV0E3Qkw7QUE4QmhDQyxTQUFPLHdCQUFjWSxTQUFkLENBQXdCWjtBQTlCQyxDQUFsQzs7QUFpQ0E5QyxzQkFBc0IrRCxXQUF0QixHQUFvQyx1QkFBcEM7O0FBRUEvRCxzQkFBc0JnRSxZQUF0QixHQUFxQztBQUNuQ3pDLHdCQUFzQixJQURhO0FBRW5DSSxnQkFBYyxnQkFBTXNDLGFBQU4sMkJBRnFCO0FBR25DckMsU0FBTyxFQUg0QjtBQUluQ3pDLGFBQVc7QUFBQSxXQUFRK0UsT0FBT3pFLEtBQUswRSxFQUFaLENBQVI7QUFBQSxHQUp3QjtBQUtuQ25DLFdBQVMsS0FMMEI7QUFNbkNwQixzQkFObUM7QUFPbkN5QixrQkFBZ0IrQixTQUFTQyxTQVBVO0FBUW5DcEYsU0FBTyxFQVI0QjtBQVNuQzRELGVBQWE7QUFBQSxXQUFRcEQsS0FBS1IsS0FBYjtBQUFBO0FBVHNCLENBQXJDOztlQVllZSxxQjs7Ozs7Ozs7O2dDQWpQTmhCLE87O2dDQVdBVyxjOztnQ0FhSEsscUIiLCJmaWxlIjoiTXVsdGlTZWxlY3RDb250cm9sLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB1bmlvbldpdGggZnJvbSAnbG9kYXNoL3VuaW9uV2l0aCc7XG5pbXBvcnQgZXF1YWwgZnJvbSAnbG9kYXNoL2lzRXF1YWwnO1xuaW1wb3J0IHNvbWUgZnJvbSAnbG9kYXNoL3NvbWUnO1xuXG5pbXBvcnQgeyBhdXRvYmluZCwgTk9PUCB9IGZyb20gJy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQgU2VsZWN0Q29udHJvbCBmcm9tICcuL1NlbGVjdENvbnRyb2wnO1xuaW1wb3J0IE11bHRpU2VsZWN0SXRlbSBmcm9tICcuLi9fc2VsZWN0cy9NdWx0aVNlbGVjdEl0ZW0nO1xuaW1wb3J0IE11bHRpU2VsZWN0RHJvcGRvd25IZWFkZXIgZnJvbSAnLi4vZHJvcGRvd25zL011bHRpU2VsZWN0RHJvcGRvd25IZWFkZXInO1xuXG4vKipcbiAqIGlzRXF1YWwgaXMgY29tcGFyYXRvciBiZXR3ZWVuIHR3byB2YWx1ZSB3aXRoIGdpdmVuIGtleU1hcHBlciBmdW5jaXRvblxuICpcbiAqIGNvbXBhcmF0ZWUgd2lsbCBiZSBzb3J0ZWQgdGhhbiBlYWNoIGl0ZW1zIGFyZSBnb2luZyB0byBiZSBjb21wYXJlZCB1c2luZyBrZXlNYXBwZXIuXG4gKiBAcGFyYW0gIHtBcnJheX0gICAgICB2YWx1ZSAgICAgICBwcmV2aW91cyB2YWx1ZSBpbiBhcnJheVxuICogQHBhcmFtICB7QXJyYXl9ICAgICAgbmV4dFZhbHVlICAgbmV4dFZhbHVlIGluIGFycmF5XG4gKiBAcGFyYW0gIHtGdW5jdGlvbn0gICBrZXlNYXBwZXIgICBmdW5jdGlvbiB0aGF0IG1hcHMgYW4gaXRlbSB0byBiZSB1bmlxdWUgaWRlbnRpZmllci5cbiAqIEByZXR1cm4ge0Jvb2xlYW59ICAgICAgICAgICAgICAgIHJldHVybnMgdHJ1ZSBpZiB0d28gdmFsdWVzIGFyZSBlcXVhbFxuICovXG5mdW5jdGlvbiBpc0VxdWFsKHZhbHVlLCBuZXh0VmFsdWUsIGtleU1hcHBlcikge1xuICBjb25zdCBzb3J0ZWRWYWx1ZSA9ICh2YWx1ZSB8fCBbXSkuc29ydCgpO1xuICBjb25zdCBzb3J0ZWROZXh0VmFsdWUgPSAobmV4dFZhbHVlIHx8IFtdKS5zb3J0KCk7XG4gIHJldHVybiAoXG4gICAgc29ydGVkVmFsdWUubGVuZ3RoID09PSBzb3J0ZWROZXh0VmFsdWUubGVuZ3RoXG4gICAgJiYgc29ydGVkVmFsdWUuZXZlcnkoKGl0ZW0sIGlkeCkgPT5cbiAgICAgIGVxdWFsKGtleU1hcHBlcihpdGVtKSwga2V5TWFwcGVyKHNvcnRlZE5leHRWYWx1ZVtpZHhdKSlcbiAgICApXG4gICk7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUluZGV4TWFwKHByb3BzID0ge30pIHtcbiAgY29uc3Qge1xuICAgIHZhbHVlLFxuICAgIGtleU1hcHBlcixcbiAgfSA9IHByb3BzO1xuICBjb25zdCBpZHhNYXAgPSB7fTtcbiAgKHZhbHVlIHx8IFtdKS5mb3JFYWNoKChpdGVtKSA9PiB7XG4gICAgY29uc3Qga2V5ID0ga2V5TWFwcGVyKGl0ZW0pO1xuICAgIGlkeE1hcFtrZXldID0gaXRlbTtcbiAgfSk7XG4gIHJldHVybiBpZHhNYXA7XG59XG5cbmNsYXNzIFR4bE11bHRpU2VsZWN0Q29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKGFyZ3MpIHtcbiAgICBzdXBlcihhcmdzKTtcbiAgICB0aGlzLl9pbmRleE1hcCA9IGNyZWF0ZUluZGV4TWFwKHRoaXMucHJvcHMpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGtleVNlbGVjdGVkSXRlbUluZGV4OiBudWxsLFxuICAgIH07XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICghaXNFcXVhbCh0aGlzLnByb3BzLnZhbHVlLCBuZXh0UHJvcHMudmFsdWUsIG5leHRQcm9wcy5rZXlNYXBwZXIpKSB7XG4gICAgICB0aGlzLl9pbmRleE1hcCA9IGNyZWF0ZUluZGV4TWFwKG5leHRQcm9wcyk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9vblNlbGVjdEFsbCgpIHtcbiAgICBjb25zdCBjdXJyZW50bHlTZWxlY3RlZEl0ZW1zID0gdGhpcy5wcm9wcy52YWx1ZSB8fCBbXTtcbiAgICBjb25zdCBmaWx0ZXJlZEl0ZW1zID0gdGhpcy5fc2VsZWN0Q29udHJvbC5nZXRGaWx0ZXJlZEl0ZW1zKCkuZ2V0SXRlbXMoKTtcbiAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gdW5pb25XaXRoKGN1cnJlbnRseVNlbGVjdGVkSXRlbXMsIGZpbHRlcmVkSXRlbXMsIGVxdWFsKTtcbiAgICB0aGlzLnByb3BzLm9uQ2hhbmdlKHsgdmFsdWU6IHNlbGVjdGVkSXRlbXMgfSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX29uU2VsZWN0Tm9uZSgpIHtcbiAgICBjb25zdCBmaWx0ZXJlZEl0ZW1zID0gdGhpcy5fc2VsZWN0Q29udHJvbC5nZXRGaWx0ZXJlZEl0ZW1zKCkuZ2V0SXRlbXMoKTtcbiAgICBjb25zdCBzZWxlY3RlZEl0ZW1zID0gdGhpcy5wcm9wcy52YWx1ZS5maWx0ZXIoaXRlbSA9PiAhc29tZShmaWx0ZXJlZEl0ZW1zLCBpdGVtKSk7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh7IHZhbHVlOiBzZWxlY3RlZEl0ZW1zIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVTZWxlY3RSZWYocmVmKSB7XG4gICAgdGhpcy5fc2VsZWN0Q29udHJvbCA9IHJlZjtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlSGVhZGVyUmVmKHJlZikge1xuICAgIHRoaXMuX2hlYWRlciA9IHJlZjtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfY2hlY2tTZWxlY3RlZChpdGVtKSB7XG4gICAgY29uc3Qge1xuICAgICAga2V5TWFwcGVyLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IGl0ZW1LZXkgPSBrZXlNYXBwZXIoaXRlbSk7XG4gICAgcmV0dXJuICEhdGhpcy5faW5kZXhNYXBbaXRlbUtleV07XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX29uQ2hhbmdlKGl0ZW0pIHtcbiAgICBpZiAoIWl0ZW0pIHtcbiAgICAgIHRoaXMucHJvcHMub25DaGFuZ2UoeyB2YWx1ZTogW10gfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAga2V5TWFwcGVyLFxuICAgICAgICBvbkNoYW5nZSxcbiAgICAgICAgdmFsdWUsXG4gICAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgICAgY29uc3QgaXRlbUtleSA9IGtleU1hcHBlcihpdGVtKTtcbiAgICAgIGNvbnN0IGNvbnRhaW5zSXRlbSA9IHRoaXMuX2luZGV4TWFwW2l0ZW1LZXldICE9IG51bGw7XG5cbiAgICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgIC8vIHRvZ2dsZSBpdGVtIHNlbGVjdGlvblxuICAgICAgICBjb25zdCBjaGFuZ2UgPSBjb250YWluc0l0ZW0gPyB2YWx1ZS5maWx0ZXIodmFsdWVJdGVtID0+ICFlcXVhbChpdGVtLCB2YWx1ZUl0ZW0pKSA6XG4gICAgICAgICAgWy4uLnZhbHVlLCBpdGVtXTtcbiAgICAgICAgb25DaGFuZ2UoeyB2YWx1ZTogY2hhbmdlIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlS2V5U2VsZWN0ZWRJdGVtSW5kZXhDaGFuZ2UoeyBrZXlTZWxlY3RlZEl0ZW1JbmRleCB9KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGtleVNlbGVjdGVkSXRlbUluZGV4IH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGtleVNlbGVjdGVkSXRlbUNsZWFyKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoeyBrZXlTZWxlY3RlZEl0ZW1JbmRleDogbnVsbCB9KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjbG9zZURyb3Bkb3duLFxuICAgICAgY29udGFpbmVyLFxuICAgICAgZW5hYmxlTG9jYWxGaWx0ZXJpbmcsXG4gICAgICBncm91cGVyLFxuICAgICAgZ3JvdXBSZW5kZXJlcixcbiAgICAgIGl0ZW1IZWlnaHQsXG4gICAgICBpdGVtUmVuZGVyZXIsXG4gICAgICBpdGVtcyxcbiAgICAgIGtleU1hcHBlcixcbiAgICAgIGxhYmVsLFxuICAgICAgbGlzdFByb3BzOiBpbml0aWFsTGlzdFByb3BzLFxuICAgICAgbG9hZGluZyxcbiAgICAgIG5vQ29udGVudFZpZXcsXG4gICAgICBvbkl0ZW1DcmVhdGUsXG4gICAgICBvcGVuLFxuICAgICAgb3BlbkRyb3Bkb3duLFxuICAgICAgb25TZWFyY2hDaGFuZ2UsXG4gICAgICBwbGFjZWhvbGRlcixcbiAgICAgIHByZWRpY2F0ZUdldHRlcixcbiAgICAgIHNlY29uZGFyeVRleHQsXG4gICAgICBzaG93Q3JlYXRlTmV3LFxuICAgICAgc2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlLFxuICAgICAgdGFyZ2V0LFxuICAgICAgdmFsaWRhdGlvblN0YXRlLFxuICAgICAgdmFsdWUsXG4gICAgICB2YWx1ZU1hcHBlcixcbiAgICAgIHdpZHRoLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgY29uc3QgbGlzdEhlYWRlciA9IChcbiAgICAgIDxkaXYgcmVmPXt0aGlzLl9oYW5kbGVIZWFkZXJSZWZ9PlxuICAgICAgICB7aW5pdGlhbExpc3RQcm9wcy5oZWFkZXIgfHxcbiAgICAgICAgICA8TXVsdGlTZWxlY3REcm9wZG93bkhlYWRlclxuICAgICAgICAgICAgb25TZWxlY3RBbGw9e3RoaXMuX29uU2VsZWN0QWxsfVxuICAgICAgICAgICAgb25TZWxlY3ROb25lPXt0aGlzLl9vblNlbGVjdE5vbmV9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuICAgICAgPC9kaXY+XG4gICAgKTtcblxuICAgIGNvbnN0IGxpc3RQcm9wcyA9IHtcbiAgICAgIC4uLmluaXRpYWxMaXN0UHJvcHMsXG4gICAgICBoZWFkZXI6IGxpc3RIZWFkZXIsXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8U2VsZWN0Q29udHJvbFxuICAgICAgICBjbG9zZURyb3Bkb3duPXtjbG9zZURyb3Bkb3dufVxuICAgICAgICBjb250YWluZXI9e2NvbnRhaW5lcn1cbiAgICAgICAgZW5hYmxlTG9jYWxGaWx0ZXJpbmc9e2VuYWJsZUxvY2FsRmlsdGVyaW5nfVxuICAgICAgICBncm91cGVyPXtncm91cGVyfVxuICAgICAgICBncm91cFJlbmRlcmVyPXtncm91cFJlbmRlcmVyfVxuICAgICAgICBpc0l0ZW1TZWxlY3RlZD17dGhpcy5fY2hlY2tTZWxlY3RlZH1cbiAgICAgICAgaXRlbUhlaWdodD17aXRlbUhlaWdodH1cbiAgICAgICAgaXRlbVJlbmRlcmVyPXtpdGVtUmVuZGVyZXJ9XG4gICAgICAgIGl0ZW1zPXtpdGVtc31cbiAgICAgICAga2V5TWFwcGVyPXtrZXlNYXBwZXJ9XG4gICAgICAgIGtleVNlbGVjdGVkSXRlbUNsZWFyPXt0aGlzLmtleVNlbGVjdGVkSXRlbUNsZWFyfVxuICAgICAgICBrZXlTZWxlY3RlZEl0ZW1JbmRleD17dGhpcy5zdGF0ZS5rZXlTZWxlY3RlZEl0ZW1JbmRleH1cbiAgICAgICAgbGFiZWw9e2xhYmVsfVxuICAgICAgICBsaXN0UHJvcHM9e2xpc3RQcm9wc31cbiAgICAgICAgbG9hZGluZz17bG9hZGluZ31cbiAgICAgICAgbm9Db250ZW50Vmlldz17bm9Db250ZW50Vmlld31cbiAgICAgICAgb25DaGFuZ2U9e3RoaXMuX29uQ2hhbmdlfVxuICAgICAgICBvbkl0ZW1DcmVhdGU9e29uSXRlbUNyZWF0ZX1cbiAgICAgICAgb25LZXlTZWxlY3RlZEl0ZW1JbmRleENoYW5nZT17dGhpcy5faGFuZGxlS2V5U2VsZWN0ZWRJdGVtSW5kZXhDaGFuZ2V9XG4gICAgICAgIG9uU2VhcmNoQ2hhbmdlPXtvblNlYXJjaENoYW5nZX1cbiAgICAgICAgb3Blbj17b3Blbn1cbiAgICAgICAgb3BlbkRyb3Bkb3duPXtvcGVuRHJvcGRvd259XG4gICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgcHJlZGljYXRlR2V0dGVyPXtwcmVkaWNhdGVHZXR0ZXJ9XG4gICAgICAgIHJlZj17dGhpcy5faGFuZGxlU2VsZWN0UmVmfVxuICAgICAgICBzZWNvbmRhcnlUZXh0PXtzZWNvbmRhcnlUZXh0fVxuICAgICAgICBzaG93Q3JlYXRlTmV3PXtzaG93Q3JlYXRlTmV3fVxuICAgICAgICBzaG93U2VhcmNoVG9WaWV3TW9yZU1lc3NhZ2U9e3Nob3dTZWFyY2hUb1ZpZXdNb3JlTWVzc2FnZX1cbiAgICAgICAgdGFyZ2V0PXt0YXJnZXR9XG4gICAgICAgIHZhbGlkYXRpb25TdGF0ZT17dmFsaWRhdGlvblN0YXRlfVxuICAgICAgICB2YWx1ZT17dmFsdWV9XG4gICAgICAgIHZhbHVlTWFwcGVyPXt2YWx1ZU1hcHBlcn1cbiAgICAgICAgd2lkdGg9e3dpZHRofVxuICAgICAgLz5cbiAgICApO1xuICB9XG59XG5cblR4bE11bHRpU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMgPSB7XG4gIGNsb3NlRHJvcGRvd246IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLmNsb3NlRHJvcGRvd24sXG4gIGNvbnRhaW5lcjogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMuY29udGFpbmVyLFxuICBlbmFibGVMb2NhbEZpbHRlcmluZzogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMuZW5hYmxlTG9jYWxGaWx0ZXJpbmcsXG4gIGdyb3VwUmVuZGVyZXI6IFByb3BUeXBlcy5mdW5jLFxuICBncm91cGVyOiBTZWxlY3RDb250cm9sLnByb3BUeXBlcy5ncm91cGVyLFxuICBpdGVtSGVpZ2h0OiBTZWxlY3RDb250cm9sLnByb3BUeXBlcy5pdGVtSGVpZ2h0LFxuICBpdGVtUmVuZGVyZXI6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLml0ZW1SZW5kZXJlcixcbiAgaXRlbXM6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLml0ZW1zLFxuICBrZXlNYXBwZXI6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLmtleU1hcHBlcixcbiAgbGFiZWw6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLmxhYmVsLFxuICBsaXN0UHJvcHM6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLmxpc3RQcm9wcyxcbiAgbG9hZGluZzogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMubG9hZGluZyxcbiAgbm9Db250ZW50VmlldzogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMubm9Db250ZW50VmlldyxcbiAgb25DaGFuZ2U6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIG9uSXRlbUNyZWF0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uU2VhcmNoQ2hhbmdlOiBTZWxlY3RDb250cm9sLnByb3BUeXBlcy5vblNlYXJjaENoYW5nZSxcbiAgb25TZWxlY3RBbGw6IFByb3BUeXBlcy5mdW5jLFxuICBvblNlbGVjdE5vbmU6IFByb3BUeXBlcy5mdW5jLFxuICBvcGVuOiBTZWxlY3RDb250cm9sLnByb3BUeXBlcy5vcGVuLFxuICBvcGVuRHJvcGRvd246IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLm9wZW5Ecm9wZG93bixcbiAgcGxhY2Vob2xkZXI6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLnBsYWNlaG9sZGVyLFxuICBwcmVkaWNhdGVHZXR0ZXI6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLnByZWRpY2F0ZUdldHRlcixcbiAgc2Vjb25kYXJ5VGV4dDogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMuc2Vjb25kYXJ5VGV4dCxcbiAgc2hvd0NyZWF0ZU5ldzogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMuc2hvd0NyZWF0ZU5ldyxcbiAgc2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlOiBTZWxlY3RDb250cm9sLnByb3BUeXBlcy5zaG93U2VhcmNoVG9WaWV3TW9yZU1lc3NhZ2UsXG4gIHRhcmdldDogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMudGFyZ2V0LFxuICB2YWxpZGF0aW9uU3RhdGU6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLnZhbGlkYXRpb25TdGF0ZSxcbiAgdmFsdWU6IFNlbGVjdENvbnRyb2wucHJvcFR5cGVzLnZhbHVlLFxuICB2YWx1ZU1hcHBlcjogU2VsZWN0Q29udHJvbC5wcm9wVHlwZXMudmFsdWVNYXBwZXIsXG4gIHdpZHRoOiBTZWxlY3RDb250cm9sLnByb3BUeXBlcy53aWR0aCxcbn07XG5cblR4bE11bHRpU2VsZWN0Q29udHJvbC5kaXNwbGF5TmFtZSA9ICdUeGxNdWx0aVNlbGVjdENvbnRyb2wnO1xuXG5UeGxNdWx0aVNlbGVjdENvbnRyb2wuZGVmYXVsdFByb3BzID0ge1xuICBlbmFibGVMb2NhbEZpbHRlcmluZzogdHJ1ZSxcbiAgaXRlbVJlbmRlcmVyOiBSZWFjdC5jcmVhdGVGYWN0b3J5KE11bHRpU2VsZWN0SXRlbSksXG4gIGl0ZW1zOiBbXSxcbiAga2V5TWFwcGVyOiBpdGVtID0+IFN0cmluZyhpdGVtLmlkKSxcbiAgbG9hZGluZzogZmFsc2UsXG4gIG9uQ2hhbmdlOiBOT09QLFxuICBvblNlYXJjaENoYW5nZTogRnVuY3Rpb24ucHJvdG90eXBlLFxuICB2YWx1ZTogW10sXG4gIHZhbHVlTWFwcGVyOiBpdGVtID0+IGl0ZW0udmFsdWUsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBUeGxNdWx0aVNlbGVjdENvbnRyb2w7XG4iXX0=