'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _Base = require('../base/Base');

var _TruncatedText = require('./TruncatedText.style');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var measurementTextStyles = (0, _extends3.default)({}, _TruncatedText.ABSOLUTE_TEXT_STYLES, _TruncatedText.INVISIBLE_TEXT_STYLES);

var CHARS_IN_ELLIPSES = 3;

var TxlMiddleTruncatedText = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlMiddleTruncatedText, _React$Component);

  function TxlMiddleTruncatedText() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlMiddleTruncatedText);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlMiddleTruncatedText.__proto__ || (0, _getPrototypeOf2.default)(TxlMiddleTruncatedText)).call.apply(_ref, [this].concat(args)));

    _this.state = {
      truncatedText: undefined
    };
    return _this;
  }

  (0, _createClass3.default)(TxlMiddleTruncatedText, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps() {
      this.setState({ truncatedText: undefined });
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      if (this._isTruncationRequired()) {
        this._truncateText();
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      if (this._isTruncationRequired()) {
        this._truncateText();
      }
    }
  }, {
    key: '_getExcessLengthInPixels',
    value: function _getExcessLengthInPixels() {
      var containerWidth = this._container.offsetWidth;
      var textWidth = this._measurementText.offsetWidth;
      var maxLength = containerWidth * this.props.numberOfLines - 1; // Give 1px of wiggle room

      return textWidth - maxLength;
    }
  }, {
    key: '_isTruncationRequired',
    value: function _isTruncationRequired() {
      return this._getExcessLengthInPixels() > 0;
    }
  }, {
    key: '_getInitialTruncation',
    value: function _getInitialTruncation() {
      var toTruncate = this.props.text;

      var pixelsTooLong = this._getExcessLengthInPixels();
      var textWidth = this._measurementText.offsetWidth;
      var percentTooLong = pixelsTooLong / textWidth;

      var numberOfCharsToTruncate = Math.ceil(percentTooLong * toTruncate.length);
      var middleCharacterIndex = toTruncate.length / 2;
      var firstHalfTruncated = toTruncate.substring(0, middleCharacterIndex - numberOfCharsToTruncate / 2);
      var secondHalfTruncated = toTruncate.substring(middleCharacterIndex + numberOfCharsToTruncate / 2);

      return firstHalfTruncated + '...' + secondHalfTruncated;
    }
  }, {
    key: '_getSubsequentTruncation',
    value: function _getSubsequentTruncation() {
      var toTruncate = this.state.truncatedText;
      var firstPeriodInEllipses = toTruncate.indexOf('.');
      var firstHalfTruncated = toTruncate.substring(0, firstPeriodInEllipses + CHARS_IN_ELLIPSES);
      var secondHalfTruncated = toTruncate.substring(firstPeriodInEllipses + CHARS_IN_ELLIPSES + 1);

      return firstHalfTruncated.concat(secondHalfTruncated);
    }
  }, {
    key: '_truncateText',
    value: function _truncateText() {
      var truncatedText = this.state.truncatedText ? this._getSubsequentTruncation() : this._getInitialTruncation();

      this.setState({ truncatedText: truncatedText });
    }
  }, {
    key: 'render',
    value: function render() {
      var _this2 = this;

      var text = this.state.truncatedText || this.props.text;

      return _react2.default.createElement(
        'div',
        {
          'data-component': 'TxlMiddleTruncatedText',
          style: _TruncatedText.CONTAINER_STYLES,
          ref: function ref(_ref3) {
            _this2._container = _ref3;
          }
        },
        _react2.default.createElement(
          'span',
          {
            ref: function ref(_ref2) {
              _this2._measurementText = _ref2;
            },
            style: measurementTextStyles
          },
          text
        ),
        _react2.default.createElement(
          'span',
          null,
          text
        )
      );
    }
  }]);
  return TxlMiddleTruncatedText;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_getExcessLengthInPixels', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_getExcessLengthInPixels'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_isTruncationRequired', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_isTruncationRequired'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_getInitialTruncation', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_getInitialTruncation'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_getSubsequentTruncation', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_getSubsequentTruncation'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_truncateText', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_truncateText'), _class2.prototype)), _class2)) || _class;

exports.default = TxlMiddleTruncatedText;


TxlMiddleTruncatedText.propTypes = {
  numberOfLines: _react.PropTypes.number,
  text: _react.PropTypes.string.isRequired
};

TxlMiddleTruncatedText.defaultProps = {
  numberOfLines: 1
};
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(measurementTextStyles, 'measurementTextStyles', 'src/text/MiddleTruncatedText.jsx');

  __REACT_HOT_LOADER__.register(CHARS_IN_ELLIPSES, 'CHARS_IN_ELLIPSES', 'src/text/MiddleTruncatedText.jsx');

  __REACT_HOT_LOADER__.register(TxlMiddleTruncatedText, 'TxlMiddleTruncatedText', 'src/text/MiddleTruncatedText.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy90ZXh0L01pZGRsZVRydW5jYXRlZFRleHQuanN4Il0sIm5hbWVzIjpbIm1lYXN1cmVtZW50VGV4dFN0eWxlcyIsIkNIQVJTX0lOX0VMTElQU0VTIiwiVHhsTWlkZGxlVHJ1bmNhdGVkVGV4dCIsImFyZ3MiLCJzdGF0ZSIsInRydW5jYXRlZFRleHQiLCJ1bmRlZmluZWQiLCJzZXRTdGF0ZSIsIl9pc1RydW5jYXRpb25SZXF1aXJlZCIsIl90cnVuY2F0ZVRleHQiLCJjb250YWluZXJXaWR0aCIsIl9jb250YWluZXIiLCJvZmZzZXRXaWR0aCIsInRleHRXaWR0aCIsIl9tZWFzdXJlbWVudFRleHQiLCJtYXhMZW5ndGgiLCJwcm9wcyIsIm51bWJlck9mTGluZXMiLCJfZ2V0RXhjZXNzTGVuZ3RoSW5QaXhlbHMiLCJ0b1RydW5jYXRlIiwidGV4dCIsInBpeGVsc1Rvb0xvbmciLCJwZXJjZW50VG9vTG9uZyIsIm51bWJlck9mQ2hhcnNUb1RydW5jYXRlIiwiTWF0aCIsImNlaWwiLCJsZW5ndGgiLCJtaWRkbGVDaGFyYWN0ZXJJbmRleCIsImZpcnN0SGFsZlRydW5jYXRlZCIsInN1YnN0cmluZyIsInNlY29uZEhhbGZUcnVuY2F0ZWQiLCJmaXJzdFBlcmlvZEluRWxsaXBzZXMiLCJpbmRleE9mIiwiY29uY2F0IiwiX2dldFN1YnNlcXVlbnRUcnVuY2F0aW9uIiwiX2dldEluaXRpYWxUcnVuY2F0aW9uIiwicmVmIiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwibnVtYmVyIiwic3RyaW5nIiwiaXNSZXF1aXJlZCIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFFQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTUEsSUFBTUEsNkhBQU47O0FBS0EsSUFBTUMsb0JBQW9CLENBQTFCOztJQUdxQkMsc0I7OztBQUNuQixvQ0FB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QURGO0FBZUQ7OztFQWhHaUQsZ0JBQU1pQixTOztrQkFBckNuQyxzQjs7O0FBbUdyQkEsdUJBQXVCb0MsU0FBdkIsR0FBbUM7QUFDakNyQixpQkFBZSxpQkFBVXNCLE1BRFE7QUFFakNuQixRQUFNLGlCQUFVb0IsTUFBVixDQUFpQkM7QUFGVSxDQUFuQzs7QUFLQXZDLHVCQUF1QndDLFlBQXZCLEdBQXNDO0FBQ3BDekIsaUJBQWU7QUFEcUIsQ0FBdEM7Ozs7Ozs7O2dDQWhITWpCLHFCOztnQ0FLQUMsaUI7O2dDQUdlQyxzQiIsImZpbGUiOiJNaWRkbGVUcnVuY2F0ZWRUZXh0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcblxuaW1wb3J0IHsgYXV0b2JpbmQgfSBmcm9tICcuLi9iYXNlL0Jhc2UnO1xuaW1wb3J0IHtcbiAgQUJTT0xVVEVfVEVYVF9TVFlMRVMsXG4gIElOVklTSUJMRV9URVhUX1NUWUxFUyxcbiAgQ09OVEFJTkVSX1NUWUxFUyxcbn0gZnJvbSAnLi9UcnVuY2F0ZWRUZXh0LnN0eWxlJztcblxuY29uc3QgbWVhc3VyZW1lbnRUZXh0U3R5bGVzID0ge1xuICAuLi5BQlNPTFVURV9URVhUX1NUWUxFUyxcbiAgLi4uSU5WSVNJQkxFX1RFWFRfU1RZTEVTLFxufTtcblxuY29uc3QgQ0hBUlNfSU5fRUxMSVBTRVMgPSAzO1xuXG5AUmFkaXVtXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUeGxNaWRkbGVUcnVuY2F0ZWRUZXh0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuXG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHRydW5jYXRlZFRleHQ6IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcygpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgdHJ1bmNhdGVkVGV4dDogdW5kZWZpbmVkIH0pO1xuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgaWYgKHRoaXMuX2lzVHJ1bmNhdGlvblJlcXVpcmVkKCkpIHtcbiAgICAgIHRoaXMuX3RydW5jYXRlVGV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICBpZiAodGhpcy5faXNUcnVuY2F0aW9uUmVxdWlyZWQoKSkge1xuICAgICAgdGhpcy5fdHJ1bmNhdGVUZXh0KCk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9nZXRFeGNlc3NMZW5ndGhJblBpeGVscygpIHtcbiAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IHRoaXMuX2NvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgICBjb25zdCB0ZXh0V2lkdGggPSB0aGlzLl9tZWFzdXJlbWVudFRleHQub2Zmc2V0V2lkdGg7XG4gICAgY29uc3QgbWF4TGVuZ3RoID0gKGNvbnRhaW5lcldpZHRoICogdGhpcy5wcm9wcy5udW1iZXJPZkxpbmVzKSAtIDE7IC8vIEdpdmUgMXB4IG9mIHdpZ2dsZSByb29tXG5cbiAgICByZXR1cm4gdGV4dFdpZHRoIC0gbWF4TGVuZ3RoO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9pc1RydW5jYXRpb25SZXF1aXJlZCgpIHtcbiAgICByZXR1cm4gdGhpcy5fZ2V0RXhjZXNzTGVuZ3RoSW5QaXhlbHMoKSA+IDA7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2dldEluaXRpYWxUcnVuY2F0aW9uKCkge1xuICAgIGNvbnN0IHRvVHJ1bmNhdGUgPSB0aGlzLnByb3BzLnRleHQ7XG5cbiAgICBjb25zdCBwaXhlbHNUb29Mb25nID0gdGhpcy5fZ2V0RXhjZXNzTGVuZ3RoSW5QaXhlbHMoKTtcbiAgICBjb25zdCB0ZXh0V2lkdGggPSB0aGlzLl9tZWFzdXJlbWVudFRleHQub2Zmc2V0V2lkdGg7XG4gICAgY29uc3QgcGVyY2VudFRvb0xvbmcgPSAocGl4ZWxzVG9vTG9uZyAvIHRleHRXaWR0aCk7XG5cbiAgICBjb25zdCBudW1iZXJPZkNoYXJzVG9UcnVuY2F0ZSA9IE1hdGguY2VpbChwZXJjZW50VG9vTG9uZyAqIHRvVHJ1bmNhdGUubGVuZ3RoKTtcbiAgICBjb25zdCBtaWRkbGVDaGFyYWN0ZXJJbmRleCA9IHRvVHJ1bmNhdGUubGVuZ3RoIC8gMjtcbiAgICBjb25zdCBmaXJzdEhhbGZUcnVuY2F0ZWQgPSB0b1RydW5jYXRlLnN1YnN0cmluZyhcbiAgICAgIDAsIG1pZGRsZUNoYXJhY3RlckluZGV4IC0gKG51bWJlck9mQ2hhcnNUb1RydW5jYXRlIC8gMilcbiAgICApO1xuICAgIGNvbnN0IHNlY29uZEhhbGZUcnVuY2F0ZWQgPSB0b1RydW5jYXRlLnN1YnN0cmluZyhcbiAgICAgIG1pZGRsZUNoYXJhY3RlckluZGV4ICsgKG51bWJlck9mQ2hhcnNUb1RydW5jYXRlIC8gMilcbiAgICApO1xuXG4gICAgcmV0dXJuIGAke2ZpcnN0SGFsZlRydW5jYXRlZH0uLi4ke3NlY29uZEhhbGZUcnVuY2F0ZWR9YDtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfZ2V0U3Vic2VxdWVudFRydW5jYXRpb24oKSB7XG4gICAgY29uc3QgdG9UcnVuY2F0ZSA9IHRoaXMuc3RhdGUudHJ1bmNhdGVkVGV4dDtcbiAgICBjb25zdCBmaXJzdFBlcmlvZEluRWxsaXBzZXMgPSB0b1RydW5jYXRlLmluZGV4T2YoJy4nKTtcbiAgICBjb25zdCBmaXJzdEhhbGZUcnVuY2F0ZWQgPSB0b1RydW5jYXRlLnN1YnN0cmluZygwLCBmaXJzdFBlcmlvZEluRWxsaXBzZXMgKyBDSEFSU19JTl9FTExJUFNFUyk7XG4gICAgY29uc3Qgc2Vjb25kSGFsZlRydW5jYXRlZCA9IHRvVHJ1bmNhdGUuc3Vic3RyaW5nKGZpcnN0UGVyaW9kSW5FbGxpcHNlcyArIENIQVJTX0lOX0VMTElQU0VTICsgMSk7XG5cbiAgICByZXR1cm4gZmlyc3RIYWxmVHJ1bmNhdGVkLmNvbmNhdChzZWNvbmRIYWxmVHJ1bmNhdGVkKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfdHJ1bmNhdGVUZXh0KCkge1xuICAgIGNvbnN0IHRydW5jYXRlZFRleHQgPSB0aGlzLnN0YXRlLnRydW5jYXRlZFRleHRcbiAgICAgID8gdGhpcy5fZ2V0U3Vic2VxdWVudFRydW5jYXRpb24oKVxuICAgICAgOiB0aGlzLl9nZXRJbml0aWFsVHJ1bmNhdGlvbigpO1xuXG4gICAgdGhpcy5zZXRTdGF0ZSh7IHRydW5jYXRlZFRleHQgfSk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgdGV4dCA9IHRoaXMuc3RhdGUudHJ1bmNhdGVkVGV4dCB8fCB0aGlzLnByb3BzLnRleHQ7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBkYXRhLWNvbXBvbmVudD1cIlR4bE1pZGRsZVRydW5jYXRlZFRleHRcIlxuICAgICAgICBzdHlsZT17Q09OVEFJTkVSX1NUWUxFU31cbiAgICAgICAgcmVmPXsocmVmKSA9PiB7IHRoaXMuX2NvbnRhaW5lciA9IHJlZjsgfX1cbiAgICAgID5cbiAgICAgICAgPHNwYW5cbiAgICAgICAgICByZWY9eyhyZWYpID0+IHsgdGhpcy5fbWVhc3VyZW1lbnRUZXh0ID0gcmVmOyB9fVxuICAgICAgICAgIHN0eWxlPXttZWFzdXJlbWVudFRleHRTdHlsZXN9XG4gICAgICAgID5cbiAgICAgICAgICB7dGV4dH1cbiAgICAgICAgPC9zcGFuPlxuICAgICAgICA8c3Bhbj57dGV4dH08L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cblR4bE1pZGRsZVRydW5jYXRlZFRleHQucHJvcFR5cGVzID0ge1xuICBudW1iZXJPZkxpbmVzOiBQcm9wVHlwZXMubnVtYmVyLFxuICB0ZXh0OiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG59O1xuXG5UeGxNaWRkbGVUcnVuY2F0ZWRUZXh0LmRlZmF1bHRQcm9wcyA9IHtcbiAgbnVtYmVyT2ZMaW5lczogMSxcbn07XG4iXX0=