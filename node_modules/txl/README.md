# [TXL Components](http://txl.tune.com) [![build status](https://gitlab.corp.tune.com/engineering/TXL_components/badges/master/build.svg)](https://gitlab.corp.tune.com/engineering/TXL_components/commits/master) [![coverage report](https://gitlab.corp.tune.com/engineering/TXL_components/badges/master/coverage.svg)](https://gitlab.corp.tune.com/engineering/TXL_components/commits/master)

[`Design Specifications`](https://confluence.corp.tune.com/pages/viewpage.action?pageId=7408926)

[`Development Specifications & Documentation`](https://confluence.corp.tune.com/display/PAT/Proposed+Implementations)

[`TXL Engineering JIRA Project`](https://jira.corp.tune.com/secure/RapidBoard.jspa?rapidView=527&view=planning)

*Use the JIRA project for reporting bugs or tracking TXL related work. You can add TXLENG tickets directly to your respective project's sprint in order to properly track effort.*

> *Dev work must be done NodeJS v4.0 or higher, and with yarn 0.20.4 or higher.*
> *Published package will run on NodeJS v0.10 or higher with NPM v1.0 or higher.*

## Installation

```Shell
yarn add txl
```

> make sure your project `.npmrc` contains
> `registry = "http://sea1-sinopia01.sea1.office.priv:4873"`

## Quick Dev setup

```Shell
git clone git@gitlab.corp.tune.com:engineering/TXL_components.git
cd TXL_components
yarn
yarn start
```

Browse to [http://0.0.0.0:8282/](http://0.0.0.0:8282/) to see the demo docs

----

Contributing to and consuming TXL Components requires an understanding of the following technologies:

* [`React`](http://facebook.github.io/react/): JavaScript UI Library
* [`Babel`](https://babeljs.io/): JavaScript compiler
* [`Webpack`](http://webpack.github.io/): JavaScript module bundler
* [`Radium`](http://projects.formidablelabs.com/radium/): Styling in JavaScript
* [`Jest`][jest]: Testing JavaScript
  * [`Enzyme`](http://airbnb.io/enzyme/) React testing framework
  * [`Jasmine`](https://jasmine.github.io/edge/introduction) Assertions library
  * [`Enzyme-matchers`](https://github.com/blainekasten/enzyme-matchers) additional assertion matchers for enzyme objects.

### Dev Commands

| Command | Description |
| --- | --- |
| `yarn dev:sandbox` | Create a sandbox environment without docs |
| `yarn start` | generates docs and vendor dll if not yet created and runs `webpack-dev-server` |
| `yarn generate` | creates vendor dll and docs |
| `yarn generate:dll` | creates vendor dll and docs |
| `yarn flowTypedInstall` | Installs flow types for all of our third-party libraries |
| `yarn generatePalettes` | Generates the palettes.js file in `src/styles` |

# Testing / Linting

Tests and linting will automatically run when making commits in this project. [`Jest`][jest] is used to run tests, and [`ESLint`](http://eslint.org/) is used to run the linting. Test files are included with components and are registered with Jest by matching the pattern `*.test.js`.

| Command | Description |
| --- | --- |
| `yarn test` | Run all tests |
| `yarn test [pattern]` | Run tests matching the pattern or filename |
| `yarn test:watch` | Run tests on file change |
| `yarn lint` | Run eslint for all changed files |
| `yarn lint:all` | Run eslint for all files |
| `yarn lint:fix` | Attempt to auto fix errors |

> **Warning** currently many of files have eslint rules turned off in comments at the top of the file. Do not disable linting rules for new files. These overrides were added to expediate integration with older files that did not follow the established conventions.

### Creating demos
Stick with the name convention `{Component_NAME}.demo.jsx` - these files will be parsed by the DocGen plugin and served automatically by the dev server.

### Testing With React@0.13

Although `txl@3.x` are actively developed on `react@0.14.x`, most of components should be able to run on `react@0.13.x` as well, until TMC dashboard is upgraded with new react version. To ensure your component runs on `react@0.13.x`, make sure you run tests against `react@0.13.x`. To do that, follow below instructions.

Create react.13 folder
`npm run prepare:react.13`

`txl-react.13` folder must be available under `packages` folder. Go to the folder, then:

```Shell
npm install
npm run test
```

### Publishing a TXL release

1. Determine version number according to [semver rules](http://semver.org/). This usually involves digging through commit messages and skimming diffs.  You may need to consult with code authors to sort out any complicated code edits particularly whether or not they introduce any breaking changes.  In order to view the delta since last release, you'll need to diff the `HEAD` of `master` branch with last release tag.  This can be done in the CLI or on Gitlab:
 * CLI: check out your `master` branch.  Make sure you `git pull upstream master --tags` into your local `master` so you have all the latest code and tags. To see only the commit messages `git log <version tag>..HEAD` (<version tag>, e.g., 'v3.4.1').  To see the full file diff, use  `git diff <version tag>..HEAD`.
 * Gitlab: In the repo, go to [Repository > Compare](https://gitlab.corp.tune.com/engineering/TXL_components/compare?from=master&to=master) and select the last tag in the `from` field.
2. Bump the version up locally with `npm version <major | minor | patch>` in the project root.  This will bump the 'version' prop up in the root 'package.json' file, create a new tag matching that version, and commit the changes.  Note: verify that the current version matches the released version before you start since `npm` uses the current version as a starting point.
3. Push the new tag/commit up to master: `git push upstream master --tags`
4. Gitlab: Go to [Repository > Tags](https://gitlab.corp.tune.com/engineering/TXL_components/tags).  Your new version tag should show up at the top of the list.  Click the tag link.  Fill out title and release notes using commit messages, etc., gleaned during step #1.  Click 'Save changes'.  This concludes the Gitlab portion of the release, now to _actually_ publish the package...
5. In your local TXL project root, run `yarn publish:txl`  
Note: be sure you're already set your npm registry as described in [Consuming TXL Components](#consuming-txl-components).
6. Verify that your latest version has been published to our [Sinopia](http://sea1-sinopia01.sea1.office.priv:4873/) npm registry.

| Command | Description |
| --- | --- |
| `yarn transpile` | Creates a lib folder with the transpiled code |
| `yarn prepare:txl` | Copies the output of `yarn transpile` to prepare for publishing |
| `yarn publish:txl` | Runs `yarn transpile`, then `yarn prepare:txl`, then changes to the packages/txl directory and runs `npm publish` |

### Wrapping your project or nested components in StyleRoot

Some components require traditionally defined CSS in order to function correctly. Specifically, it's not feasible to insert keyframes and media queries into inline styles. The inline style helper library that TXL uses, Radium, requires that the application be wrapped in an exported <StyleRoot> component that acts as a container to house these types of style rules.

TXL Re-exports a version of StyleRoot that you *must* wrap your application in for certain components to function correctly. If your app is not completely written in React, that's okay, but you must wrap each rendered container in StyleRoot for the same reasons.

```javascript
import StyleRoot from 'txl/styles/StyleRoot';

render(
  <StyleRoot>
    <MyComponent />
  </StyleRoot>,
  document.getElementById('mountNode')
);
```

### Configuring TXL Theme for your Project

---
The palette you wish to use as your primary theme can be passed as a prop to the StyleRoot component. This will then be set in context and passed down to all of StyleRoot's children, taking effect in all components that use COLOR_APP_THEME in their styles. This theme object must have the same shape as the generated palettes in [styles/palettes](https://gitlab.corp.tune.com/engineering/TXL_components/blob/master/src/styles/palettes.js), but can contain any color value for each key.

```javascript
import StyleRoot from 'txl/styles/StyleRoot';
import { BAJA_TEAL } from 'txl/styles/palettes'; 

render(
  <StyleRoot theme={BAJA_TEAL}>
    <MyComponent />
  </StyleRoot>,
  document.getElementById('mountNode')
);
```

Alternatively, you can define a webpack plugin to use one of the already generated TXL color palettes. Using a webpack plugin will take priority over any custom theme passed to the StyleRoot component.

Require webpack

```javascript
var webpack = require('webpack');
```

Define a new plugin

You will need to define a new plugin with `__APP_THEME__` and your app color. Refer to [styles/palettes](https://gitlab.corp.tune.com/engineering/TXL_components/blob/master/src/styles/palettes.js) for the name of the supported colors (TXL colors). Make sure to keep your color name in single quotes within the double quotes because when webpack injects `__APP_THEME__ ` it needs to be a string.

```javascript
var definePlugin = new webpack.DefinePlugin({
  __APP_THEME__ : "'BAJA_TEAL'" // needs single and double quotes
});
```
Add new plugin to the plugins section

```javascript
plugins : [definePlugin]
```

Now when webpack builds you should see colors have changed in these components:
* Buttons (accent only)
* Navigation (selected color)

[jest]: https://facebook.github.io/jest/
