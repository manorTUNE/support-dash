'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _InputFieldsPropTypes = require('./_InputFieldsPropTypes');

var _TruncatedText = require('../text/TruncatedText');

var _TruncatedText2 = _interopRequireDefault(_TruncatedText);

var _InputStyleHelpers = require('./_InputStyleHelpers');

var _type = require('../styles/mixins/type');

var _helpers = require('../styles/helpers');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var DEFAULT_PADDING = (0, _helpers.gridUnits)(1);
var DEFAULT_WIDTH = (0, _helpers.gridUnits)(5);

var LABEL_CONTAINER_STYLES = {
  left: {
    order: 0
  },
  right: {
    order: 1
  }
};

var LABEL_STYLES = {
  base: (0, _extends3.default)({}, _InputStyleHelpers.INPUT_ITEM_LABEL_STYLES),
  clickable: {
    cursor: 'pointer'
  },
  top: (0, _extends3.default)({}, _InputStyleHelpers.INPUT_GROUP_LABEL_STYLES)
};

var CONTAINER_STYLES = {
  base: {
    alignItems: 'flex-start',
    display: 'flex',
    width: '100%'
  },
  disabled: {
    cursor: 'not-allowed'
  },
  enabled: {
    cursor: 'pointer'
  },
  left: {
    justifyContent: 'space-between'
  },
  right: {
    justifyContent: 'flex-start'
  },
  top: {
    flexDirection: 'column'
  }
};

var idCache = -1;

function uniqueId() {
  return 'generated-input-id-' + ++idCache;
}

function parsePadding(padding) {
  switch (typeof padding === 'undefined' ? 'undefined' : (0, _typeof3.default)(padding)) {
    case 'string':
      return {
        left: padding,
        right: padding,
        top: padding
      };
    case 'object':
      return {
        left: padding.left || DEFAULT_PADDING,
        right: padding.right || DEFAULT_PADDING,
        top: padding.top || DEFAULT_PADDING
      };
    default:
      return {
        left: DEFAULT_PADDING,
        right: DEFAULT_PADDING,
        top: DEFAULT_PADDING
      };
  }
}

// Staic stopPropagation function for static assignment.
function stopPropagation(e) {
  e.stopPropagation();
}

var _default = function _default(options, Component) {
  var _class;

  var padding = parsePadding(options.padding);
  var componentContainerStyles = {
    left: {
      marginLeft: padding.left
    },
    right: {
      marginRight: padding.right,
      minWidth: options.itemWidth || DEFAULT_WIDTH
    },
    top: {
      marginTop: padding.top
    }
  };

  var LabeledComponent = (0, _radium2.default)(_class = function (_React$Component) {
    (0, _inherits3.default)(LabeledComponent, _React$Component);

    function LabeledComponent() {
      var _ref;

      (0, _classCallCheck3.default)(this, LabeledComponent);

      for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
        args[_key] = arguments[_key];
      }

      var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = LabeledComponent.__proto__ || (0, _getPrototypeOf2.default)(LabeledComponent)).call.apply(_ref, [this].concat(args)));

      _this.uniqueId = options.clickable ? _this.props.id || uniqueId() : undefined;
      return _this;
    }

    (0, _createClass3.default)(LabeledComponent, [{
      key: 'render',
      value: function render() {
        var _props = this.props,
            labelPosition = _props.labelPosition,
            labelText = _props.labelText,
            secondaryText = _props.secondaryText,
            validationState = _props.validationState,
            clickable = _props.clickable,
            truncateLabel = _props.truncateLabel,
            restProps = (0, _objectWithoutProperties3.default)(_props, ['labelPosition', 'labelText', 'secondaryText', 'validationState', 'clickable', 'truncateLabel']);


        var composedContent = void 0;
        if (labelText) {
          var secondaryTextContent = void 0;
          if (secondaryText) {
            var secondaryTextStyles = (0, _InputStyleHelpers.getSecondaryTextStyle)(validationState);

            secondaryTextContent = _react2.default.createElement(
              'div',
              {
                style: secondaryTextStyles,
                'data-test-secondary-text': true
              },
              secondaryText
            );
          }

          var labelStyles = (0, _helpers.combineStyles)(labelPosition === 'top' ? LABEL_STYLES.top : LABEL_STYLES.base, clickable && !this.props.disabled ? LABEL_STYLES.clickable : undefined, this.props.disabled ? _InputStyleHelpers.DISABLED_INPUT_ITEM_LABEL_STYLES : undefined);

          var labelContainerStyles = (0, _helpers.combineStyles)(LABEL_CONTAINER_STYLES[labelPosition], _type.DEFAULT_FONT_FAMILY, truncateLabel && { overflow: 'hidden' });

          var labelComponent = truncateLabel ? _react2.default.createElement(_TruncatedText2.default, { text: labelText }) : labelText;

          var labelContent = _react2.default.createElement(
            'div',
            {
              'data-test-label-container': true,
              style: labelContainerStyles,
              'data-position': labelPosition
            },
            _react2.default.createElement(
              'label',
              {
                'data-test-label': true,
                htmlFor: this.uniqueId,
                onClick: stopPropagation,
                style: labelStyles
              },
              labelComponent
            ),
            secondaryTextContent
          );

          var component = _react2.default.createElement(
            'div',
            {
              'data-test-component': true,
              style: componentContainerStyles[labelPosition]
            },
            _react2.default.createElement(Component, (0, _extends3.default)({}, restProps, {
              id: this.uniqueId
            }))
          );

          var containerStyles = (0, _helpers.combineStyles)(CONTAINER_STYLES.base, CONTAINER_STYLES[labelPosition]);

          composedContent = _react2.default.createElement(
            'div',
            { style: containerStyles },
            labelContent,
            component
          );
        } else {
          composedContent = _react2.default.createElement(Component, restProps);
        }

        return composedContent;
      }
    }]);
    return LabeledComponent;
  }(_react2.default.Component)) || _class;

  LabeledComponent.propTypes = (0, _extends3.default)({}, Component.propTypes, {
    clickable: _react2.default.PropTypes.bool,
    disabled: _react2.default.PropTypes.bool,
    labelPosition: _react2.default.PropTypes.oneOf(['left', 'right', 'top']),
    labelText: _react2.default.PropTypes.node,
    secondaryText: _react2.default.PropTypes.node,
    truncateLabel: _react2.default.PropTypes.bool,
    validationState: _InputFieldsPropTypes.validationStateType
  });

  LabeledComponent.defaultProps = (0, _extends3.default)({}, Component.defaultProps, {
    clickable: options.clickable || false,
    disabled: false,
    labelPosition: options.defaultPosition || 'right',
    labelText: '',
    secondaryText: '',
    truncateLabel: false,
    validationState: 'base'
  });

  return LabeledComponent;
};

exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(DEFAULT_PADDING, 'DEFAULT_PADDING', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(DEFAULT_WIDTH, 'DEFAULT_WIDTH', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(LABEL_CONTAINER_STYLES, 'LABEL_CONTAINER_STYLES', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(LABEL_STYLES, 'LABEL_STYLES', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(CONTAINER_STYLES, 'CONTAINER_STYLES', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(idCache, 'idCache', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(uniqueId, 'uniqueId', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(parsePadding, 'parsePadding', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(stopPropagation, 'stopPropagation', 'src/input-fields/_WithLabel.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/input-fields/_WithLabel.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnB1dC1maWVsZHMvX1dpdGhMYWJlbC5qc3giXSwibmFtZXMiOlsiREVGQVVMVF9QQURESU5HIiwiREVGQVVMVF9XSURUSCIsIkxBQkVMX0NPTlRBSU5FUl9TVFlMRVMiLCJsZWZ0Iiwib3JkZXIiLCJyaWdodCIsIkxBQkVMX1NUWUxFUyIsImJhc2UiLCJjbGlja2FibGUiLCJjdXJzb3IiLCJ0b3AiLCJDT05UQUlORVJfU1RZTEVTIiwiYWxpZ25JdGVtcyIsImRpc3BsYXkiLCJ3aWR0aCIsImRpc2FibGVkIiwiZW5hYmxlZCIsImp1c3RpZnlDb250ZW50IiwiZmxleERpcmVjdGlvbiIsImlkQ2FjaGUiLCJ1bmlxdWVJZCIsInBhcnNlUGFkZGluZyIsInBhZGRpbmciLCJzdG9wUHJvcGFnYXRpb24iLCJlIiwib3B0aW9ucyIsIkNvbXBvbmVudCIsImNvbXBvbmVudENvbnRhaW5lclN0eWxlcyIsIm1hcmdpbkxlZnQiLCJtYXJnaW5SaWdodCIsIm1pbldpZHRoIiwiaXRlbVdpZHRoIiwibWFyZ2luVG9wIiwiTGFiZWxlZENvbXBvbmVudCIsImFyZ3MiLCJwcm9wcyIsImlkIiwidW5kZWZpbmVkIiwibGFiZWxQb3NpdGlvbiIsImxhYmVsVGV4dCIsInNlY29uZGFyeVRleHQiLCJ2YWxpZGF0aW9uU3RhdGUiLCJ0cnVuY2F0ZUxhYmVsIiwicmVzdFByb3BzIiwiY29tcG9zZWRDb250ZW50Iiwic2Vjb25kYXJ5VGV4dENvbnRlbnQiLCJzZWNvbmRhcnlUZXh0U3R5bGVzIiwibGFiZWxTdHlsZXMiLCJsYWJlbENvbnRhaW5lclN0eWxlcyIsIm92ZXJmbG93IiwibGFiZWxDb21wb25lbnQiLCJsYWJlbENvbnRlbnQiLCJjb21wb25lbnQiLCJjb250YWluZXJTdHlsZXMiLCJwcm9wVHlwZXMiLCJQcm9wVHlwZXMiLCJib29sIiwib25lT2YiLCJub2RlIiwiZGVmYXVsdFByb3BzIiwiZGVmYXVsdFBvc2l0aW9uIl0sIm1hcHBpbmdzIjoiOzs7Ozs7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Qjs7Z0NBdUJGUSxPOztnQ0FFS0MsUTs7Z0NBSUFDLFk7O2dDQXdCQUUsZSIsImZpbGUiOiJfV2l0aExhYmVsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJhZGl1bSBmcm9tICdyYWRpdW0nO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgdmFsaWRhdGlvblN0YXRlVHlwZSB9IGZyb20gJy4vX0lucHV0RmllbGRzUHJvcFR5cGVzJztcbmltcG9ydCBUcnVuY2F0ZWRUZXh0IGZyb20gJy4uL3RleHQvVHJ1bmNhdGVkVGV4dCc7XG5pbXBvcnQge1xuICBnZXRTZWNvbmRhcnlUZXh0U3R5bGUsXG4gIERJU0FCTEVEX0lOUFVUX0lURU1fTEFCRUxfU1RZTEVTLFxuICBJTlBVVF9JVEVNX0xBQkVMX1NUWUxFUyxcbiAgSU5QVVRfR1JPVVBfTEFCRUxfU1RZTEVTLFxufSBmcm9tICcuL19JbnB1dFN0eWxlSGVscGVycyc7XG5pbXBvcnQge1xuICBERUZBVUxUX0ZPTlRfRkFNSUxZLFxufSBmcm9tICcuLi9zdHlsZXMvbWl4aW5zL3R5cGUnO1xuaW1wb3J0IHtcbiAgZ3JpZFVuaXRzIGFzIGd1LFxuICBjb21iaW5lU3R5bGVzLFxufSBmcm9tICcuLi9zdHlsZXMvaGVscGVycyc7XG5cbmNvbnN0IERFRkFVTFRfUEFERElORyA9IGd1KDEpO1xuY29uc3QgREVGQVVMVF9XSURUSCA9IGd1KDUpO1xuXG5jb25zdCBMQUJFTF9DT05UQUlORVJfU1RZTEVTID0ge1xuICBsZWZ0OiB7XG4gICAgb3JkZXI6IDAsXG4gIH0sXG4gIHJpZ2h0OiB7XG4gICAgb3JkZXI6IDEsXG4gIH0sXG59O1xuXG5jb25zdCBMQUJFTF9TVFlMRVMgPSB7XG4gIGJhc2U6IHtcbiAgICAuLi5JTlBVVF9JVEVNX0xBQkVMX1NUWUxFUyxcbiAgfSxcbiAgY2xpY2thYmxlOiB7XG4gICAgY3Vyc29yOiAncG9pbnRlcicsXG4gIH0sXG4gIHRvcDoge1xuICAgIC4uLklOUFVUX0dST1VQX0xBQkVMX1NUWUxFUyxcbiAgfSxcbn07XG5cbmNvbnN0IENPTlRBSU5FUl9TVFlMRVMgPSB7XG4gIGJhc2U6IHtcbiAgICBhbGlnbkl0ZW1zOiAnZmxleC1zdGFydCcsXG4gICAgZGlzcGxheTogJ2ZsZXgnLFxuICAgIHdpZHRoOiAnMTAwJScsXG4gIH0sXG4gIGRpc2FibGVkOiB7XG4gICAgY3Vyc29yOiAnbm90LWFsbG93ZWQnLFxuICB9LFxuICBlbmFibGVkOiB7XG4gICAgY3Vyc29yOiAncG9pbnRlcicsXG4gIH0sXG4gIGxlZnQ6IHtcbiAgICBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nLFxuICB9LFxuICByaWdodDoge1xuICAgIGp1c3RpZnlDb250ZW50OiAnZmxleC1zdGFydCcsXG4gIH0sXG4gIHRvcDoge1xuICAgIGZsZXhEaXJlY3Rpb246ICdjb2x1bW4nLFxuICB9LFxufTtcblxubGV0IGlkQ2FjaGUgPSAtMTtcblxuZnVuY3Rpb24gdW5pcXVlSWQoKSB7XG4gIHJldHVybiBgZ2VuZXJhdGVkLWlucHV0LWlkLSR7KytpZENhY2hlfWA7XG59XG5cbmZ1bmN0aW9uIHBhcnNlUGFkZGluZyhwYWRkaW5nKSB7XG4gIHN3aXRjaCAodHlwZW9mIHBhZGRpbmcpIHtcbiAgICBjYXNlICdzdHJpbmcnOlxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbGVmdDogcGFkZGluZyxcbiAgICAgICAgcmlnaHQ6IHBhZGRpbmcsXG4gICAgICAgIHRvcDogcGFkZGluZyxcbiAgICAgIH07XG4gICAgY2FzZSAnb2JqZWN0JzpcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGxlZnQ6IHBhZGRpbmcubGVmdCB8fCBERUZBVUxUX1BBRERJTkcsXG4gICAgICAgIHJpZ2h0OiBwYWRkaW5nLnJpZ2h0IHx8IERFRkFVTFRfUEFERElORyxcbiAgICAgICAgdG9wOiBwYWRkaW5nLnRvcCB8fCBERUZBVUxUX1BBRERJTkcsXG4gICAgICB9O1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4ge1xuICAgICAgICBsZWZ0OiBERUZBVUxUX1BBRERJTkcsXG4gICAgICAgIHJpZ2h0OiBERUZBVUxUX1BBRERJTkcsXG4gICAgICAgIHRvcDogREVGQVVMVF9QQURESU5HLFxuICAgICAgfTtcbiAgfVxufVxuXG4vLyBTdGFpYyBzdG9wUHJvcGFnYXRpb24gZnVuY3Rpb24gZm9yIHN0YXRpYyBhc3NpZ25tZW50LlxuZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKGUpIHtcbiAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gKG9wdGlvbnMsIENvbXBvbmVudCkge1xuICBjb25zdCBwYWRkaW5nID0gcGFyc2VQYWRkaW5nKG9wdGlvbnMucGFkZGluZyk7XG4gIGNvbnN0IGNvbXBvbmVudENvbnRhaW5lclN0eWxlcyA9IHtcbiAgICBsZWZ0OiB7XG4gICAgICBtYXJnaW5MZWZ0OiBwYWRkaW5nLmxlZnQsXG4gICAgfSxcbiAgICByaWdodDoge1xuICAgICAgbWFyZ2luUmlnaHQ6IHBhZGRpbmcucmlnaHQsXG4gICAgICBtaW5XaWR0aDogb3B0aW9ucy5pdGVtV2lkdGggfHwgREVGQVVMVF9XSURUSCxcbiAgICB9LFxuICAgIHRvcDoge1xuICAgICAgbWFyZ2luVG9wOiBwYWRkaW5nLnRvcCxcbiAgICB9LFxuICB9O1xuXG4gIEBSYWRpdW1cbiAgY2xhc3MgTGFiZWxlZENvbXBvbmVudCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgICAgc3VwZXIoLi4uYXJncyk7XG5cbiAgICAgIHRoaXMudW5pcXVlSWQgPSBvcHRpb25zLmNsaWNrYWJsZSA/IHRoaXMucHJvcHMuaWQgfHwgdW5pcXVlSWQoKSA6IHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGxhYmVsUG9zaXRpb24sXG4gICAgICAgIGxhYmVsVGV4dCxcbiAgICAgICAgc2Vjb25kYXJ5VGV4dCxcbiAgICAgICAgdmFsaWRhdGlvblN0YXRlLFxuICAgICAgICBjbGlja2FibGUsXG4gICAgICAgIHRydW5jYXRlTGFiZWwsXG4gICAgICAgIC4uLnJlc3RQcm9wc1xuICAgICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAgIGxldCBjb21wb3NlZENvbnRlbnQ7XG4gICAgICBpZiAobGFiZWxUZXh0KSB7XG4gICAgICAgIGxldCBzZWNvbmRhcnlUZXh0Q29udGVudDtcbiAgICAgICAgaWYgKHNlY29uZGFyeVRleHQpIHtcbiAgICAgICAgICBjb25zdCBzZWNvbmRhcnlUZXh0U3R5bGVzID0gZ2V0U2Vjb25kYXJ5VGV4dFN0eWxlKHZhbGlkYXRpb25TdGF0ZSk7XG5cbiAgICAgICAgICBzZWNvbmRhcnlUZXh0Q29udGVudCA9IChcbiAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgc3R5bGU9e3NlY29uZGFyeVRleHRTdHlsZXN9XG4gICAgICAgICAgICAgIGRhdGEtdGVzdC1zZWNvbmRhcnktdGV4dFxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7c2Vjb25kYXJ5VGV4dH1cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBsYWJlbFN0eWxlcyA9IGNvbWJpbmVTdHlsZXMoXG4gICAgICAgICAgbGFiZWxQb3NpdGlvbiA9PT0gJ3RvcCcgPyBMQUJFTF9TVFlMRVMudG9wIDogTEFCRUxfU1RZTEVTLmJhc2UsXG4gICAgICAgICAgY2xpY2thYmxlICYmICF0aGlzLnByb3BzLmRpc2FibGVkID8gTEFCRUxfU1RZTEVTLmNsaWNrYWJsZSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICB0aGlzLnByb3BzLmRpc2FibGVkID8gRElTQUJMRURfSU5QVVRfSVRFTV9MQUJFTF9TVFlMRVMgOiB1bmRlZmluZWRcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBsYWJlbENvbnRhaW5lclN0eWxlcyA9IGNvbWJpbmVTdHlsZXMoXG4gICAgICAgICAgTEFCRUxfQ09OVEFJTkVSX1NUWUxFU1tsYWJlbFBvc2l0aW9uXSxcbiAgICAgICAgICBERUZBVUxUX0ZPTlRfRkFNSUxZLFxuICAgICAgICAgIHRydW5jYXRlTGFiZWwgJiYgeyBvdmVyZmxvdzogJ2hpZGRlbicgfVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGxhYmVsQ29tcG9uZW50ID0gdHJ1bmNhdGVMYWJlbCA/IDxUcnVuY2F0ZWRUZXh0IHRleHQ9e2xhYmVsVGV4dH0gLz4gOiBsYWJlbFRleHQ7XG5cbiAgICAgICAgY29uc3QgbGFiZWxDb250ZW50ID0gKFxuICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgIGRhdGEtdGVzdC1sYWJlbC1jb250YWluZXJcbiAgICAgICAgICAgIHN0eWxlPXtsYWJlbENvbnRhaW5lclN0eWxlc31cbiAgICAgICAgICAgIGRhdGEtcG9zaXRpb249e2xhYmVsUG9zaXRpb259XG4gICAgICAgICAgPlxuICAgICAgICAgICAgPGxhYmVsXG4gICAgICAgICAgICAgIGRhdGEtdGVzdC1sYWJlbFxuICAgICAgICAgICAgICBodG1sRm9yPXt0aGlzLnVuaXF1ZUlkfVxuICAgICAgICAgICAgICBvbkNsaWNrPXtzdG9wUHJvcGFnYXRpb259XG4gICAgICAgICAgICAgIHN0eWxlPXtsYWJlbFN0eWxlc31cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2xhYmVsQ29tcG9uZW50fVxuICAgICAgICAgICAgPC9sYWJlbD5cbiAgICAgICAgICAgIHtzZWNvbmRhcnlUZXh0Q29udGVudH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBjb21wb25lbnQgPSAoXG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgZGF0YS10ZXN0LWNvbXBvbmVudFxuICAgICAgICAgICAgc3R5bGU9e2NvbXBvbmVudENvbnRhaW5lclN0eWxlc1tsYWJlbFBvc2l0aW9uXX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8Q29tcG9uZW50XG4gICAgICAgICAgICAgIHsuLi5yZXN0UHJvcHN9XG4gICAgICAgICAgICAgIGlkPXt0aGlzLnVuaXF1ZUlkfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBjb250YWluZXJTdHlsZXMgPSBjb21iaW5lU3R5bGVzKFxuICAgICAgICAgIENPTlRBSU5FUl9TVFlMRVMuYmFzZSxcbiAgICAgICAgICBDT05UQUlORVJfU1RZTEVTW2xhYmVsUG9zaXRpb25dXG4gICAgICAgICk7XG5cbiAgICAgICAgY29tcG9zZWRDb250ZW50ID0gKFxuICAgICAgICAgIDxkaXYgc3R5bGU9e2NvbnRhaW5lclN0eWxlc30+XG4gICAgICAgICAgICB7bGFiZWxDb250ZW50fVxuICAgICAgICAgICAge2NvbXBvbmVudH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbXBvc2VkQ29udGVudCA9ICg8Q29tcG9uZW50IHsuLi5yZXN0UHJvcHN9IC8+KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGNvbXBvc2VkQ29udGVudDtcbiAgICB9XG4gIH1cblxuICBMYWJlbGVkQ29tcG9uZW50LnByb3BUeXBlcyA9IHtcbiAgICAuLi5Db21wb25lbnQucHJvcFR5cGVzLFxuICAgIGNsaWNrYWJsZTogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgZGlzYWJsZWQ6IFJlYWN0LlByb3BUeXBlcy5ib29sLFxuICAgIGxhYmVsUG9zaXRpb246IFJlYWN0LlByb3BUeXBlcy5vbmVPZihbJ2xlZnQnLCAncmlnaHQnLCAndG9wJ10pLFxuICAgIGxhYmVsVGV4dDogUmVhY3QuUHJvcFR5cGVzLm5vZGUsXG4gICAgc2Vjb25kYXJ5VGV4dDogUmVhY3QuUHJvcFR5cGVzLm5vZGUsXG4gICAgdHJ1bmNhdGVMYWJlbDogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgdmFsaWRhdGlvblN0YXRlOiB2YWxpZGF0aW9uU3RhdGVUeXBlLFxuICB9O1xuXG4gIExhYmVsZWRDb21wb25lbnQuZGVmYXVsdFByb3BzID0ge1xuICAgIC4uLkNvbXBvbmVudC5kZWZhdWx0UHJvcHMsXG4gICAgY2xpY2thYmxlOiBvcHRpb25zLmNsaWNrYWJsZSB8fCBmYWxzZSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgbGFiZWxQb3NpdGlvbjogb3B0aW9ucy5kZWZhdWx0UG9zaXRpb24gfHwgJ3JpZ2h0JyxcbiAgICBsYWJlbFRleHQ6ICcnLFxuICAgIHNlY29uZGFyeVRleHQ6ICcnLFxuICAgIHRydW5jYXRlTGFiZWw6IGZhbHNlLFxuICAgIHZhbGlkYXRpb25TdGF0ZTogJ2Jhc2UnLFxuICB9O1xuXG4gIHJldHVybiBMYWJlbGVkQ29tcG9uZW50O1xufVxuIl19