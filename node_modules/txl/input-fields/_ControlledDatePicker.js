'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _Dropdown = require('../dropdowns/_Dropdown.style');

var _DatePicker = require('./DatePicker.style');

var _Base = require('../base/Base');

var _SingleCalendarPicker = require('../calendar-picker/_SingleCalendarPicker');

var _SingleCalendarPicker2 = _interopRequireDefault(_SingleCalendarPicker);

var _DropdownContentWithArrow = require('../dropdowns/_DropdownContentWithArrow');

var _DropdownContentWithArrow2 = _interopRequireDefault(_DropdownContentWithArrow);

var _IconButton = require('../buttons/IconButton');

var _IconButton2 = _interopRequireDefault(_IconButton);

var _CalendarOutline = require('../icons/CalendarOutline');

var _CalendarOutline2 = _interopRequireDefault(_CalendarOutline);

var _TextField = require('./TextField');

var _TextField2 = _interopRequireDefault(_TextField);

var _CalendarUtils = require('../calendar-picker/_CalendarUtils');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var DEFAULT_DATE_PATTERN = 'MM/DD/YYYY';
var DEFAULT_ERROR_TEXT_PREFIX = 'Invalid date:';
var NOT_WITHIN_RANGE_ERROR_TEXT = 'Date is not within valid range';

var TxlDatePicker = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlDatePicker, _React$Component);

  function TxlDatePicker() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlDatePicker);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlDatePicker.__proto__ || (0, _getPrototypeOf2.default)(TxlDatePicker)).call.apply(_ref, [this].concat(args)));

    _this._isBlurDisabled = false;
    return _this;
  }

  (0, _createClass3.default)(TxlDatePicker, [{
    key: '_handleBlur',
    value: function _handleBlur() {
      if (!this._isBlurDisabled) {
        this.props.updateDropdown({ open: false });
      }
      this.props.onBlur({});
      this._isBlurDisabled = false;
    }
  }, {
    key: '_handleFocus',
    value: function _handleFocus() {
      this.props.updateDropdown({ open: true });
      this.props.onFocus({});
    }
  }, {
    key: '_handleCalendarClick',
    value: function _handleCalendarClick() {
      this.props.updateDropdown({ open: !this.props.open });
      this.props.onFocus({});
    }
  }, {
    key: '_handleDateClick',
    value: function _handleDateClick(_ref2) {
      var date = _ref2.date;
      var pattern = this.props.pattern;

      this.props.updateDropdown({ open: false });
      this.props.onChange({ value: date.format(pattern) });
      this._isBlurDisabled = false;
    }
  }, {
    key: '_disableBlur',
    value: function _disableBlur() {
      this._isBlurDisabled = true;
    }
  }, {
    key: '_getValidationText',
    value: function _getValidationText(isWithinValidRange) {
      var _props = this.props,
          pattern = _props.pattern,
          validationText = _props.validationText;


      if (validationText) {
        return validationText;
      }
      // TODO Make this component no longer control its own validation text
      if (!isWithinValidRange) {
        return NOT_WITHIN_RANGE_ERROR_TEXT;
      }

      return DEFAULT_ERROR_TEXT_PREFIX + ' ' + pattern;
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props,
          isValid = _props2.isValid,
          label = _props2.label,
          onChange = _props2.onChange,
          open = _props2.open,
          pattern = _props2.pattern,
          rangeEndBoundary = _props2.rangeEndBoundary,
          rangeStartBoundary = _props2.rangeStartBoundary,
          secondaryText = _props2.secondaryText,
          value = _props2.value;

      var date = (0, _moment2.default)(value, pattern, true);
      var isValidDate = isValid !== undefined ? isValid : date.isValid();

      var rangeIsDefined = rangeEndBoundary || rangeStartBoundary;
      var isWithinValidRange = rangeIsDefined ? (0, _CalendarUtils.isDateWithinRange)(date, rangeStartBoundary, rangeEndBoundary) : true;

      var validationState = isValidDate && isWithinValidRange ? 'base' : 'error';
      // TODO Make this component not control its own validation text
      var secondaryTextVal = isValidDate && isWithinValidRange ? secondaryText : this._getValidationText(isWithinValidRange);

      var dropdownIcon = _react2.default.createElement(_IconButton2.default, {
        icon: _CalendarOutline2.default,
        onClick: this._handleCalendarClick,
        size: 'large',
        variant: 'plain'
      });

      return _react2.default.createElement(
        'div',
        {
          'data-component': 'TxlDatePicker',
          style: _Dropdown.WRAPPER_STYLE
        },
        _react2.default.createElement(_TextField2.default, {
          _afterContent: dropdownIcon,
          label: label,
          onBlur: this._handleBlur,
          onChange: onChange,
          onFocus: this._handleFocus,
          ref: 'dateTextField',
          secondaryText: secondaryTextVal,
          type: 'text',
          validationState: validationState,
          value: value
        }),
        _react2.default.createElement(
          _DropdownContentWithArrow2.default,
          {
            style: _DatePicker.DROPDOWN_CONTAINER_STYLE,
            contentStyle: _DatePicker.DROPDOWN_CONTENT_STYLE,
            onMouseEnter: this._disableBlur,
            open: open
          },
          _react2.default.createElement(_SingleCalendarPicker2.default, {
            date: isValidDate ? date : (0, _moment2.default)(),
            rangeEndBoundary: rangeEndBoundary,
            rangeStartBoundary: rangeStartBoundary,
            onDateClick: this._handleDateClick
          })
        )
      );
    }
  }]);
  return TxlDatePicker;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_handleBlur', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleBlur'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleFocus', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleFocus'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleCalendarClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleCalendarClick'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleDateClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleDateClick'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_disableBlur', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_disableBlur'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_getValidationText', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_getValidationText'), _class2.prototype)), _class2)) || _class;

exports.default = TxlDatePicker;


TxlDatePicker.propTypes = {
  isValid: _react.PropTypes.bool,
  label: _react.PropTypes.string,
  onBlur: _react.PropTypes.func,
  onChange: _react.PropTypes.func,
  onFocus: _react.PropTypes.func,
  open: _react.PropTypes.bool,
  pattern: _react.PropTypes.string,
  rangeEndBoundary: _SingleCalendarPicker2.default.propTypes.rangeEndBoundary,
  rangeStartBoundary: _SingleCalendarPicker2.default.propTypes.rangeStartBoundary,
  secondaryText: _react.PropTypes.node,
  updateDropdown: _react.PropTypes.func,
  validationText: _react.PropTypes.string,
  value: _react.PropTypes.string
};

TxlDatePicker.defaultProps = {
  onBlur: _Base.NOOP,
  onChange: _Base.NOOP,
  onFocus: _Base.NOOP,
  open: false,
  pattern: DEFAULT_DATE_PATTERN,
  updateDropdown: _Base.NOOP,
  value: (0, _moment2.default)().format(DEFAULT_DATE_PATTERN)
};
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(DEFAULT_DATE_PATTERN, 'DEFAULT_DATE_PATTERN', 'src/input-fields/_ControlledDatePicker.jsx');

  __REACT_HOT_LOADER__.register(DEFAULT_ERROR_TEXT_PREFIX, 'DEFAULT_ERROR_TEXT_PREFIX', 'src/input-fields/_ControlledDatePicker.jsx');

  __REACT_HOT_LOADER__.register(NOT_WITHIN_RANGE_ERROR_TEXT, 'NOT_WITHIN_RANGE_ERROR_TEXT', 'src/input-fields/_ControlledDatePicker.jsx');

  __REACT_HOT_LOADER__.register(TxlDatePicker, 'TxlDatePicker', 'src/input-fields/_ControlledDatePicker.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnB1dC1maWVsZHMvX0NvbnRyb2xsZWREYXRlUGlja2VyLmpzeCJdLCJuYW1lcyI6WyJERUZBVUxUX0RBVEVfUEFUVEVSTiIsIkRFRkFVTFRfRVJST1JfVEVYVF9QUkVGSVgiLCJOT1RfV0lUSElOX1JBTkdFX0VSUk9SX1RFWFQiLCJUeGxEYXRlUGlja2VyIiwiYXJncyIsIl9pc0JsdXJEaXNhYmxlZCIsInByb3BzIiwidXBkYXRlRHJvcGRvd24iLCJvcGVuIiwib25CbHVyIiwib25Gb2N1cyIsImRhdGUiLCJwYXR0ZXJuIiwib25DaGFuZ2UiLCJ2YWx1ZSIsImZvcm1hdCIsImlzV2l0aGluVmFsaWRSYW5nZSIsInZhbGlkYXRpb25UZXh0IiwiaXNWYWxpZCIsImxhYmVsIiwicmFuZ2VFbmRCb3VuZGFyeSIsInJhbmdlU3RhcnRCb3VuZGFyeSIsInNlY29uZGFyeVRleHQiLCJpc1ZhbGlkRGF0ZSIsInVuZGVmaW5lZCIsInJhbmdlSXNEZWZpbmVkIiwidmFsaWRhdGlvblN0YXRlIiwic2Vjb25kYXJ5VGV4dFZhbCIsIl9nZXRWYWxpZGF0aW9uVGV4dCIsImRyb3Bkb3duSWNvbiIsIl9oYW5kbGVDYWxlbmRhckNsaWNrIiwiX2hhbmRsZUJsdXIiLCJfaGFuZGxlRm9jdXMiLCJfZGlzYWJsZUJsdXIiLCJfaGFuZGxlRGF0ZUNsaWNrIiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwiYm9vbCIsInN0cmluZyIsImZ1bmMiLCJub2RlIiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7QUFDQTs7QUFJQTs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLHVCQUF1QixZQUE3QjtBQUNBLElBQU1DLDRCQUE0QixlQUFsQztB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cUIsTUFaRjtBQWF4QnhCLFNBQU8saUJBQVV3QjtBQWJPLENBQTFCOztBQWdCQW5DLGNBQWNzQyxZQUFkLEdBQTZCO0FBQzNCaEMsb0JBRDJCO0FBRTNCSSxzQkFGMkI7QUFHM0JILHFCQUgyQjtBQUkzQkYsUUFBTSxLQUpxQjtBQUszQkksV0FBU1osb0JBTGtCO0FBTTNCTyw0QkFOMkI7QUFPM0JPLFNBQU8sd0JBQVNDLE1BQVQsQ0FBZ0JmLG9CQUFoQjtBQVBvQixDQUE3Qjs7Ozs7Ozs7Z0NBakpNQSxvQjs7Z0NBQ0FDLHlCOztnQ0FDQUMsMkI7O2dDQUdlQyxhIiwiZmlsZSI6Il9Db250cm9sbGVkRGF0ZVBpY2tlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyBQcm9wVHlwZXMgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmFkaXVtIGZyb20gJ3JhZGl1bSc7XG5pbXBvcnQgbW9tZW50IGZyb20gJ21vbWVudCc7XG5cbmltcG9ydCB7IFdSQVBQRVJfU1RZTEUgfSBmcm9tICcuLi9kcm9wZG93bnMvX0Ryb3Bkb3duLnN0eWxlJztcbmltcG9ydCB7XG4gIERST1BET1dOX0NPTlRBSU5FUl9TVFlMRSxcbiAgRFJPUERPV05fQ09OVEVOVF9TVFlMRSxcbn0gZnJvbSAnLi9EYXRlUGlja2VyLnN0eWxlJztcbmltcG9ydCB7IGF1dG9iaW5kLCBOT09QIH0gZnJvbSAnLi4vYmFzZS9CYXNlJztcbmltcG9ydCBDYWxlbmRhciBmcm9tICcuLi9jYWxlbmRhci1waWNrZXIvX1NpbmdsZUNhbGVuZGFyUGlja2VyJztcbmltcG9ydCBEcm9wZG93bkNvbnRlbnQgZnJvbSAnLi4vZHJvcGRvd25zL19Ecm9wZG93bkNvbnRlbnRXaXRoQXJyb3cnO1xuaW1wb3J0IEljb25CdXR0b24gZnJvbSAnLi4vYnV0dG9ucy9JY29uQnV0dG9uJztcbmltcG9ydCBJY29uQ2FsZW5kYXJPdXRsaW5lIGZyb20gJy4uL2ljb25zL0NhbGVuZGFyT3V0bGluZSc7XG5pbXBvcnQgVGV4dEZpZWxkIGZyb20gJy4vVGV4dEZpZWxkJztcbmltcG9ydCB7IGlzRGF0ZVdpdGhpblJhbmdlIH0gZnJvbSAnLi4vY2FsZW5kYXItcGlja2VyL19DYWxlbmRhclV0aWxzJztcblxuY29uc3QgREVGQVVMVF9EQVRFX1BBVFRFUk4gPSAnTU0vREQvWVlZWSc7XG5jb25zdCBERUZBVUxUX0VSUk9SX1RFWFRfUFJFRklYID0gJ0ludmFsaWQgZGF0ZTonO1xuY29uc3QgTk9UX1dJVEhJTl9SQU5HRV9FUlJPUl9URVhUID0gJ0RhdGUgaXMgbm90IHdpdGhpbiB2YWxpZCByYW5nZSc7XG5cbkBSYWRpdW1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFR4bERhdGVQaWNrZXIgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5faXNCbHVyRGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlQmx1cigpIHtcbiAgICBpZiAoIXRoaXMuX2lzQmx1ckRpc2FibGVkKSB7XG4gICAgICB0aGlzLnByb3BzLnVwZGF0ZURyb3Bkb3duKHsgb3BlbjogZmFsc2UgfSk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25CbHVyKHt9KTtcbiAgICB0aGlzLl9pc0JsdXJEaXNhYmxlZCA9IGZhbHNlO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVGb2N1cygpIHtcbiAgICB0aGlzLnByb3BzLnVwZGF0ZURyb3Bkb3duKHsgb3BlbjogdHJ1ZSB9KTtcbiAgICB0aGlzLnByb3BzLm9uRm9jdXMoe30pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVDYWxlbmRhckNsaWNrKCkge1xuICAgIHRoaXMucHJvcHMudXBkYXRlRHJvcGRvd24oeyBvcGVuOiAhdGhpcy5wcm9wcy5vcGVuIH0pO1xuICAgIHRoaXMucHJvcHMub25Gb2N1cyh7fSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZURhdGVDbGljayh7IGRhdGUgfSkge1xuICAgIGNvbnN0IHsgcGF0dGVybiB9ID0gdGhpcy5wcm9wcztcbiAgICB0aGlzLnByb3BzLnVwZGF0ZURyb3Bkb3duKHsgb3BlbjogZmFsc2UgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh7IHZhbHVlOiBkYXRlLmZvcm1hdChwYXR0ZXJuKSB9KTtcbiAgICB0aGlzLl9pc0JsdXJEaXNhYmxlZCA9IGZhbHNlO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9kaXNhYmxlQmx1cigpIHtcbiAgICB0aGlzLl9pc0JsdXJEaXNhYmxlZCA9IHRydWU7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2dldFZhbGlkYXRpb25UZXh0KGlzV2l0aGluVmFsaWRSYW5nZSkge1xuICAgIGNvbnN0IHtcbiAgICAgIHBhdHRlcm4sXG4gICAgICB2YWxpZGF0aW9uVGV4dCxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmICh2YWxpZGF0aW9uVGV4dCkgeyByZXR1cm4gdmFsaWRhdGlvblRleHQ7IH1cbiAgICAvLyBUT0RPIE1ha2UgdGhpcyBjb21wb25lbnQgbm8gbG9uZ2VyIGNvbnRyb2wgaXRzIG93biB2YWxpZGF0aW9uIHRleHRcbiAgICBpZiAoIWlzV2l0aGluVmFsaWRSYW5nZSkgeyByZXR1cm4gTk9UX1dJVEhJTl9SQU5HRV9FUlJPUl9URVhUOyB9XG5cbiAgICByZXR1cm4gYCR7REVGQVVMVF9FUlJPUl9URVhUX1BSRUZJWH0gJHtwYXR0ZXJufWA7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgaXNWYWxpZCxcbiAgICAgIGxhYmVsLFxuICAgICAgb25DaGFuZ2UsXG4gICAgICBvcGVuLFxuICAgICAgcGF0dGVybixcbiAgICAgIHJhbmdlRW5kQm91bmRhcnksXG4gICAgICByYW5nZVN0YXJ0Qm91bmRhcnksXG4gICAgICBzZWNvbmRhcnlUZXh0LFxuICAgICAgdmFsdWUsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgZGF0ZSA9IG1vbWVudCh2YWx1ZSwgcGF0dGVybiwgdHJ1ZSk7XG4gICAgY29uc3QgaXNWYWxpZERhdGUgPSBpc1ZhbGlkICE9PSB1bmRlZmluZWQgPyBpc1ZhbGlkIDogZGF0ZS5pc1ZhbGlkKCk7XG5cbiAgICBjb25zdCByYW5nZUlzRGVmaW5lZCA9IHJhbmdlRW5kQm91bmRhcnkgfHwgcmFuZ2VTdGFydEJvdW5kYXJ5O1xuICAgIGNvbnN0IGlzV2l0aGluVmFsaWRSYW5nZSA9IHJhbmdlSXNEZWZpbmVkID9cbiAgICAgIGlzRGF0ZVdpdGhpblJhbmdlKGRhdGUsIHJhbmdlU3RhcnRCb3VuZGFyeSwgcmFuZ2VFbmRCb3VuZGFyeSkgOlxuICAgICAgdHJ1ZTtcblxuICAgIGNvbnN0IHZhbGlkYXRpb25TdGF0ZSA9IChpc1ZhbGlkRGF0ZSAmJiBpc1dpdGhpblZhbGlkUmFuZ2UpID8gJ2Jhc2UnIDogJ2Vycm9yJztcbiAgICAvLyBUT0RPIE1ha2UgdGhpcyBjb21wb25lbnQgbm90IGNvbnRyb2wgaXRzIG93biB2YWxpZGF0aW9uIHRleHRcbiAgICBjb25zdCBzZWNvbmRhcnlUZXh0VmFsID0gKGlzVmFsaWREYXRlICYmIGlzV2l0aGluVmFsaWRSYW5nZSkgP1xuICAgICAgc2Vjb25kYXJ5VGV4dCA6XG4gICAgICB0aGlzLl9nZXRWYWxpZGF0aW9uVGV4dChpc1dpdGhpblZhbGlkUmFuZ2UpO1xuXG4gICAgY29uc3QgZHJvcGRvd25JY29uID0gKFxuICAgICAgPEljb25CdXR0b25cbiAgICAgICAgaWNvbj17SWNvbkNhbGVuZGFyT3V0bGluZX1cbiAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlQ2FsZW5kYXJDbGlja31cbiAgICAgICAgc2l6ZT1cImxhcmdlXCJcbiAgICAgICAgdmFyaWFudD1cInBsYWluXCJcbiAgICAgIC8+XG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIGRhdGEtY29tcG9uZW50PVwiVHhsRGF0ZVBpY2tlclwiXG4gICAgICAgIHN0eWxlPXtXUkFQUEVSX1NUWUxFfVxuICAgICAgPlxuICAgICAgICA8VGV4dEZpZWxkXG4gICAgICAgICAgX2FmdGVyQ29udGVudD17ZHJvcGRvd25JY29ufVxuICAgICAgICAgIGxhYmVsPXtsYWJlbH1cbiAgICAgICAgICBvbkJsdXI9e3RoaXMuX2hhbmRsZUJsdXJ9XG4gICAgICAgICAgb25DaGFuZ2U9e29uQ2hhbmdlfVxuICAgICAgICAgIG9uRm9jdXM9e3RoaXMuX2hhbmRsZUZvY3VzfVxuICAgICAgICAgIHJlZj1cImRhdGVUZXh0RmllbGRcIlxuICAgICAgICAgIHNlY29uZGFyeVRleHQ9e3NlY29uZGFyeVRleHRWYWx9XG4gICAgICAgICAgdHlwZT1cInRleHRcIlxuICAgICAgICAgIHZhbGlkYXRpb25TdGF0ZT17dmFsaWRhdGlvblN0YXRlfVxuICAgICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgLz5cbiAgICAgICAgPERyb3Bkb3duQ29udGVudFxuICAgICAgICAgIHN0eWxlPXtEUk9QRE9XTl9DT05UQUlORVJfU1RZTEV9XG4gICAgICAgICAgY29udGVudFN0eWxlPXtEUk9QRE9XTl9DT05URU5UX1NUWUxFfVxuICAgICAgICAgIG9uTW91c2VFbnRlcj17dGhpcy5fZGlzYWJsZUJsdXJ9XG4gICAgICAgICAgb3Blbj17b3Blbn1cbiAgICAgICAgPlxuICAgICAgICAgIDxDYWxlbmRhclxuICAgICAgICAgICAgZGF0ZT17aXNWYWxpZERhdGUgPyBkYXRlIDogbW9tZW50KCl9XG4gICAgICAgICAgICByYW5nZUVuZEJvdW5kYXJ5PXtyYW5nZUVuZEJvdW5kYXJ5fVxuICAgICAgICAgICAgcmFuZ2VTdGFydEJvdW5kYXJ5PXtyYW5nZVN0YXJ0Qm91bmRhcnl9XG4gICAgICAgICAgICBvbkRhdGVDbGljaz17dGhpcy5faGFuZGxlRGF0ZUNsaWNrfVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvRHJvcGRvd25Db250ZW50PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5UeGxEYXRlUGlja2VyLnByb3BUeXBlcyA9IHtcbiAgaXNWYWxpZDogUHJvcFR5cGVzLmJvb2wsXG4gIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBvbkJsdXI6IFByb3BUeXBlcy5mdW5jLFxuICBvbkNoYW5nZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uRm9jdXM6IFByb3BUeXBlcy5mdW5jLFxuICBvcGVuOiBQcm9wVHlwZXMuYm9vbCxcbiAgcGF0dGVybjogUHJvcFR5cGVzLnN0cmluZyxcbiAgcmFuZ2VFbmRCb3VuZGFyeTogQ2FsZW5kYXIucHJvcFR5cGVzLnJhbmdlRW5kQm91bmRhcnksXG4gIHJhbmdlU3RhcnRCb3VuZGFyeTogQ2FsZW5kYXIucHJvcFR5cGVzLnJhbmdlU3RhcnRCb3VuZGFyeSxcbiAgc2Vjb25kYXJ5VGV4dDogUHJvcFR5cGVzLm5vZGUsXG4gIHVwZGF0ZURyb3Bkb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgdmFsaWRhdGlvblRleHQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZhbHVlOiBQcm9wVHlwZXMuc3RyaW5nLFxufTtcblxuVHhsRGF0ZVBpY2tlci5kZWZhdWx0UHJvcHMgPSB7XG4gIG9uQmx1cjogTk9PUCxcbiAgb25DaGFuZ2U6IE5PT1AsXG4gIG9uRm9jdXM6IE5PT1AsXG4gIG9wZW46IGZhbHNlLFxuICBwYXR0ZXJuOiBERUZBVUxUX0RBVEVfUEFUVEVSTixcbiAgdXBkYXRlRHJvcGRvd246IE5PT1AsXG4gIHZhbHVlOiBtb21lbnQoKS5mb3JtYXQoREVGQVVMVF9EQVRFX1BBVFRFUk4pLFxufTtcbiJdfQ==