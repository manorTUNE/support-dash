'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _isEmpty = require('lodash/isEmpty');

var _isEmpty2 = _interopRequireDefault(_isEmpty);

var _Base = require('../base/Base');

var _theme = require('../styles/theme');

var _type = require('../styles/mixins/type');

var _helpers = require('../styles/helpers');

var _KeyCodes = require('../constants/KeyCodes');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var INPUT_CONTAINER_STYLE = {
  alignItems: 'flex-start',
  display: 'flex'
};

var INPUT_STYLE = {
  backgroundColor: 'transparent',
  border: 'none',
  color: _theme.COLOR_NEUTRAL['800'],
  flexGrow: 0,
  height: (0, _helpers.gridUnits)(7),
  lineHeight: (0, _helpers.gridUnits)(7),
  minWidth: (0, _helpers.gridUnits)(0.2),
  outline: 'none',
  overflow: 'hidden',
  paddingBottom: 0,
  paddingRight: 0,
  paddingTop: 0,
  textIndent: 0
};

var PLACE_HOLDER_STYLE = (0, _extends3.default)({}, _type.TYPE_BASE, _type.DEFAULT_FONT_FAMILY, INPUT_STYLE, {
  color: _theme.COLOR_NEUTRAL['200']
});

var ENTITY_MAP = {
  '"': '&quot;',
  '&': '&amp;',
  '\'': '&#39;',
  '/': '&#x2F;',
  '<': '&lt;',
  '>': '&gt;'
};

function getInitialState(props) {
  return {
    focus: false,
    value: props.defaultValue || props.value || ''
  };
}

function canShowPlaceholder(props) {
  return !(0, _isEmpty2.default)(props.placeholder) && (0, _isEmpty2.default)(props.value);
}

// TODO:: make this generic util function or object
function escapeHtml(string) {
  return String(string).replace(/[&<>"'/]/g, function (s) {
    return ENTITY_MAP[s];
  });
}

// TODO:: make this a generic util function or object
function hasStyledElement() {
  var children = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];

  var childrenArray = Array.prototype.slice.call(children, 0);
  // FireFox inserts <br> for "space" Input
  // Following will filter through such children
  return childrenArray.filter(function (child) {
    return child && child.tagName !== 'BR';
  }).length !== 0;
}

// DO NOT USE purerendering with this component

var TxlContentEditable = (0, _radium2.default)(_class = function (_Component) {
  (0, _inherits3.default)(TxlContentEditable, _Component);

  function TxlContentEditable() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlContentEditable);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlContentEditable.__proto__ || (0, _getPrototypeOf2.default)(TxlContentEditable)).call.apply(_ref, [this].concat(args)));

    _this.moveCursorToEnd = function () {
      return _this.__moveCursorToEnd__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.didChange = function () {
      return _this.__didChange__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.focus = function () {
      return _this.__focus__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.blur = function () {
      return _this.__blur__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.handlePaste = function () {
      return _this.__handlePaste__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.handleClick = function () {
      return _this.__handleClick__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.handleOnInput = function () {
      return _this.__handleOnInput__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.handleKeyDown = function () {
      return _this.__handleKeyDown__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.handleFocus = function () {
      return _this.__handleFocus__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.handleBlur = function () {
      return _this.__handleBlur__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._handleInputRef = function () {
      return _this.___handleInputRef__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.state = getInitialState.apply(undefined, args);
    return _this;
  }

  (0, _createClass3.default)(TxlContentEditable, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (this.props.value !== nextProps.value) {
        var value = this.state.value;

        if (value !== nextProps.value) {
          this.setState({
            value: nextProps.value
          });
        }
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      var node = this._inputRef;
      if (node) {
        var escapedValue = escapeHtml(this.state.value);
        if (escapedValue !== node.textContent || hasStyledElement(node.children)) {
          node.innerHTML = escapedValue;
        }
      }
    }
  }, {
    key: '__moveCursorToEnd__REACT_HOT_LOADER__',
    value: function __moveCursorToEnd__REACT_HOT_LOADER__() {
      return this.__moveCursorToEnd__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__moveCursorToEnd__REACT_HOT_LOADER__',
    value: function __moveCursorToEnd__REACT_HOT_LOADER__() {
      return this.__moveCursorToEnd__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__moveCursorToEnd__REACT_HOT_LOADER__',
    value: function __moveCursorToEnd__REACT_HOT_LOADER__() {
      var range = document.createRange();
      range.selectNodeContents(this._inputRef);
      range.collapse(false);
      var selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
    }
  }, {
    key: '__didChange__REACT_HOT_LOADER__',
    value: function __didChange__REACT_HOT_LOADER__() {
      return this.__didChange__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__didChange__REACT_HOT_LOADER__',
    value: function __didChange__REACT_HOT_LOADER__() {
      return this.__didChange__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__didChange__REACT_HOT_LOADER__',
    value: function __didChange__REACT_HOT_LOADER__() {
      var value = this.state.value;

      this.props.onChange({ value: value });
    }
  }, {
    key: '__focus__REACT_HOT_LOADER__',
    value: function __focus__REACT_HOT_LOADER__() {
      return this.__focus__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__focus__REACT_HOT_LOADER__',
    value: function __focus__REACT_HOT_LOADER__() {
      return this.__focus__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__focus__REACT_HOT_LOADER__',
    value: function __focus__REACT_HOT_LOADER__() {
      this._inputRef && this._inputRef.focus();
    }
  }, {
    key: '__blur__REACT_HOT_LOADER__',
    value: function __blur__REACT_HOT_LOADER__() {
      return this.__blur__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__blur__REACT_HOT_LOADER__',
    value: function __blur__REACT_HOT_LOADER__() {
      return this.__blur__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__blur__REACT_HOT_LOADER__',
    value: function __blur__REACT_HOT_LOADER__() {
      this._inputRef && this._inputRef.blur();
    }
  }, {
    key: '__handlePaste__REACT_HOT_LOADER__',
    value: function __handlePaste__REACT_HOT_LOADER__() {
      return this.__handlePaste__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handlePaste__REACT_HOT_LOADER__',
    value: function __handlePaste__REACT_HOT_LOADER__() {
      return this.__handlePaste__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handlePaste__REACT_HOT_LOADER__',
    value: function __handlePaste__REACT_HOT_LOADER__() {
      var node = this._inputRef;
      if (node) {
        var value = node.textContent;
        this.setState({ value: value }, this.didChange);
      }
    }
  }, {
    key: '__handleClick__REACT_HOT_LOADER__',
    value: function __handleClick__REACT_HOT_LOADER__() {
      return this.__handleClick__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleClick__REACT_HOT_LOADER__',
    value: function __handleClick__REACT_HOT_LOADER__() {
      return this.__handleClick__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleClick__REACT_HOT_LOADER__',
    value: function __handleClick__REACT_HOT_LOADER__(e) {
      this.focus();
      this.props.onClick(e);
    }
  }, {
    key: '__handleOnInput__REACT_HOT_LOADER__',
    value: function __handleOnInput__REACT_HOT_LOADER__() {
      return this.__handleOnInput__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleOnInput__REACT_HOT_LOADER__',
    value: function __handleOnInput__REACT_HOT_LOADER__() {
      return this.__handleOnInput__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleOnInput__REACT_HOT_LOADER__',
    value: function __handleOnInput__REACT_HOT_LOADER__(e) {
      var value = e.target.textContent;
      this.setState({ value: value }, this.didChange);
    }
  }, {
    key: '__handleKeyDown__REACT_HOT_LOADER__',
    value: function __handleKeyDown__REACT_HOT_LOADER__() {
      return this.__handleKeyDown__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleKeyDown__REACT_HOT_LOADER__',
    value: function __handleKeyDown__REACT_HOT_LOADER__() {
      return this.__handleKeyDown__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleKeyDown__REACT_HOT_LOADER__',
    value: function __handleKeyDown__REACT_HOT_LOADER__(e) {
      var keyCode = e.keyCode;

      switch (keyCode) {
        case _KeyCodes.ENTER:
        case _KeyCodes.ESCAPE:
        case _KeyCodes.TAB:
          e.preventDefault();
          this.blur();
          break;
        default:
      }
      this.props.onKeyDown && this.props.onKeyDown(e);
    }
  }, {
    key: '__handleFocus__REACT_HOT_LOADER__',
    value: function __handleFocus__REACT_HOT_LOADER__() {
      return this.__handleFocus__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleFocus__REACT_HOT_LOADER__',
    value: function __handleFocus__REACT_HOT_LOADER__() {
      return this.__handleFocus__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleFocus__REACT_HOT_LOADER__',
    value: function __handleFocus__REACT_HOT_LOADER__(e) {
      var _this2 = this;

      this.setState({ focus: true }, function () {
        return _this2.props.onFocus(e);
      });
    }
  }, {
    key: '__handleBlur__REACT_HOT_LOADER__',
    value: function __handleBlur__REACT_HOT_LOADER__() {
      return this.__handleBlur__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleBlur__REACT_HOT_LOADER__',
    value: function __handleBlur__REACT_HOT_LOADER__() {
      return this.__handleBlur__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__handleBlur__REACT_HOT_LOADER__',
    value: function __handleBlur__REACT_HOT_LOADER__(e) {
      var _this3 = this;

      this.setState({ focus: false }, function () {
        return _this3.props.onBlur(e);
      });
    }
  }, {
    key: '___handleInputRef__REACT_HOT_LOADER__',
    value: function ___handleInputRef__REACT_HOT_LOADER__() {
      return this.___handleInputRef__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleInputRef__REACT_HOT_LOADER__',
    value: function ___handleInputRef__REACT_HOT_LOADER__() {
      return this.___handleInputRef__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleInputRef__REACT_HOT_LOADER__',
    value: function ___handleInputRef__REACT_HOT_LOADER__(ref) {
      this._inputRef = ref;
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          disabled = _props.disabled,
          id = _props.id,
          spellCheck = _props.spellCheck,
          style = _props.style,
          tagName = _props.tagName,
          placeholder = _props.placeholder,
          tabIndex = _props.tabIndex;
      var value = this.state.value;


      var handlers = {
        onBlur: !disabled ? this.handleBlur : _Base.NOOP,
        onFocus: !disabled ? this.handleFocus : _Base.NOOP
      };

      var showPlaceholder = canShowPlaceholder({ placeholder: placeholder, value: value });

      var elemStyle = (0, _extends3.default)({}, INPUT_STYLE, {
        paddingLeft: showPlaceholder ? 0 : (0, _helpers.gridUnits)(0.2)
      });

      return _react2.default.createElement(
        'div',
        {
          'data-component': 'TxlContentEditable',
          onClick: this.handleClick,
          style: style
        },
        _react2.default.createElement(
          'div',
          { style: INPUT_CONTAINER_STYLE },
          _react2.default.DOM[tagName]((0, _extends3.default)({}, handlers, {
            contentEditable: !disabled,
            id: id,
            onInput: this.handleOnInput,
            onKeyDown: this.handleKeyDown,
            onPaste: this.handlePaste,
            ref: this._handleInputRef,
            spellCheck: spellCheck,
            style: elemStyle,
            tabIndex: tabIndex
          })),
          _react2.default.DOM[tagName]({
            style: PLACE_HOLDER_STYLE
          }, showPlaceholder ? placeholder : undefined)
        )
      );
    }
  }]);
  return TxlContentEditable;
}(_react.Component)) || _class;

TxlContentEditable.propTypes = {
  defaultValue: _react.PropTypes.string,
  disabled: _react.PropTypes.bool,
  id: _react.PropTypes.string,
  onBlur: _react.PropTypes.func,
  onChange: _react.PropTypes.func,
  onClick: _react.PropTypes.func,
  onFocus: _react.PropTypes.func,
  onKeyDown: _react.PropTypes.func,
  placeholder: _react.PropTypes.string,
  spellCheck: _react.PropTypes.bool,
  style: _react.PropTypes.object,
  tabIndex: _react.PropTypes.number,
  tagName: _react.PropTypes.string,
  value: _react.PropTypes.string
};

TxlContentEditable.defaultProps = {
  onBlur: _Base.NOOP,
  onChange: _Base.NOOP,
  onClick: _Base.NOOP,
  onFocus: _Base.NOOP,
  spellCheck: true,
  tabIndex: 0,
  tagName: 'div',
  value: ''
};

var _default = TxlContentEditable;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(INPUT_CONTAINER_STYLE, 'INPUT_CONTAINER_STYLE', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(INPUT_STYLE, 'INPUT_STYLE', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(PLACE_HOLDER_STYLE, 'PLACE_HOLDER_STYLE', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(ENTITY_MAP, 'ENTITY_MAP', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(getInitialState, 'getInitialState', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(canShowPlaceholder, 'canShowPlaceholder', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(escapeHtml, 'escapeHtml', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(hasStyledElement, 'hasStyledElement', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(TxlContentEditable, 'TxlContentEditable', 'src/input-fields/ContentEditable.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/input-fields/ContentEditable.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnB1dC1maWVsZHMvQ29udGVudEVkaXRhYmxlLmpzeCJdLCJuYW1lcyI6WyJJTlBVVF9DT05UQUlORVJfU1RZTEUiLCJhbGlnbkl0ZW1zIiwiZGlzcGxheSIsIklOUFVUX1NUWUxFIiwiYmFja2dyb3VuZENvbG9yIiwiYm9yZGVyIiwiY29sb3IiLCJmbGV4R3JvdyIsImhlaWdodCIsImxpbmVIZWlnaHQiLCJtaW5XaWR0aCIsIm91dGxpbmUiLCJvdmVyZmxvdyIsInBhZGRpbmdCb3R0b20iLCJwYWRkaW5nUmlnaHQiLCJwYWRkaW5nVG9wIiwidGV4dEluZGVudCIsIlBMQUNFX0hPTERFUl9TVFlMRSIsIkVOVElUWV9NQVAiLCJnZXRJbml0aWFsU3RhdGUiLCJwcm9wcyIsImZvY3VzIiwidmFsdWUiLCJkZWZhdWx0VmFsdWUiLCJjYW5TaG93UGxhY2Vob2xkZXIiLCJwbGFjZWhvbGRlciIsImVzY2FwZUh0bWwiLCJzdHJpbmciLCJTdHJpbmciLCJyZXBsYWNlIiwicyIsImhhc1N0eWxlZEVsZW1lbnQiLCJjaGlsZHJlbiIsImNoaWxkcmVuQXJyYXkiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsImZpbHRlciIsImNoaWxkIiwidGFnTmFtZSIsImxlbmd0aCIsIlR4bENvbnRlbnRFZGl0YWJsZSIsImFyZ3MiLCJtb3ZlQ3Vyc29yVG9FbmQiLCJkaWRDaGFuZ2UiLCJibHVyIiwiaGFuZGxlUGFzdGUiLCJoYW5kbGVDbGljayIsImhhbmRsZU9uSW5wdXQiLCJoYW5kbGVLZXlEb3duIiwiaGFuZGxlRm9jdXMiLCJoYW5kbGVCbHVyIiwiX2hhbmRsZUlucHV0UmVmIiwic3RhdGUiLCJuZXh0UHJvcHMiLCJzZXRTdGF0ZSIsIm5vZGUiLCJfaW5wdXRSZWYiLCJlc2NhcGVkVmFsdWUiLCJ0ZXh0Q29udGVudCIsImlubmVySFRNTCIsInJhbmdlIiwiZG9jdW1lbnQiLCJjcmVhdGVSYW5nZSIsInNlbGVjdE5vZGVDb250ZW50cyIsImNvbGxhcHNlIiwic2VsZWN0aW9uIiwid2luZG93IiwiZ2V0U2VsZWN0aW9uIiwicmVtb3ZlQWxsUmFuZ2VzIiwiYWRkUmFuZ2UiLCJvbkNoYW5nZSIsImUiLCJvbkNsaWNrIiwidGFyZ2V0Iiwia2V5Q29kZSIsInByZXZlbnREZWZhdWx0Iiwib25LZXlEb3duIiwib25Gb2N1cyIsIm9uQmx1ciIsInJlZiIsImRpc2FibGVkIiwiaWQiLCJzcGVsbENoZWNrIiwic3R5bGUiLCJ0YWJJbmRleCIsImhhbmRsZXJzIiwic2hvd1BsYWNlaG9sZGVyIiwiZWxlbVN0eWxlIiwicGFkZGluZ0xlZnQiLCJET00iLCJjb250ZW50RWRpdGFibGUiLCJvbklucHV0Iiwib25QYXN0ZSIsInVuZGVmaW5lZCIsInByb3BUeXBlcyIsImJvb2wiLCJmdW5jIiwib2JqZWN0IiwibnVtYmVyIiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOztBQUNBOztBQUNBOztBQUlBOztBQUNBOzs7O0FBT0EsSUFBTUEsd0JBQXdCO0FBQzVCQyxjQUFZLFlBRGdCO0FBRTVCQyxXQUFTO0FBRm1CLENBQTlCOztBQUtBLElBQU1DLGNBQWM7QUFDbEJDLG1CQUFpQixhQURDO0FBRWxCQyxVQUFRLE1BRlU7QUFHbEJDLFNBQU8scUJBQWMsS0FBZCxDQUhXO0FBSWxCQyxZQUFVLENBSlE7QUFLbEJDLFVBQVEsd0JBQUcsQ0FBSCxDQUxVO0FBTWxCQyxjQUFZLHdCQUFHLENBQUgsQ0FOTTtBQU9sQkMsWUFBVSx3QkFBRyxHQUFILENBUFE7QUFRbEJDLFdBQVMsTUFSUztBQVNsQkMsWUFBVSxRQVRRO0FBVWxCQyxpQkFBZSxDQVZHO0FBV2xCQyxnQkFBYyxDQVhJO0FBWWxCQyxjQUFZLENBWk07QUFhbEJDLGNBQVk7QUFiTSxDQUFwQjs7QUFnQkEsSUFBTUMsNEZBR0RkLFdBSEM7QUFJSkcsU0FBTyxxQkFBYyxLQUFkO0FBSkgsRUFB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WTtBQVk3QmIsWUFBVSxpQkFBVWMsTUFaUztBQWE3QjVELFdBQVMsaUJBQVViLE1BYlU7QUFjN0JMLFNBQU8saUJBQVVLO0FBZFksQ0FBL0I7O0FBaUJBZSxtQkFBbUIyRCxZQUFuQixHQUFrQztBQUNoQ3JCLG9CQURnQztBQUVoQ1Isc0JBRmdDO0FBR2hDRSxxQkFIZ0M7QUFJaENLLHFCQUpnQztBQUtoQ0ssY0FBWSxJQUxvQjtBQU1oQ0UsWUFBVSxDQU5zQjtBQU9oQzlDLFdBQVMsS0FQdUI7QUFRaENsQixTQUFPO0FBUnlCLENBQWxDOztlQVdlb0Isa0I7Ozs7Ozs7OztnQ0FqUFQxQyxxQjs7Z0NBS0FHLFc7O2dDQWdCQWMsa0I7O2dDQU9BQyxVOztnQ0FTR0MsZTs7Z0NBT0FLLGtCOztnQ0FLQUUsVTs7Z0NBS0FLLGdCOztnQ0FVSFcsa0IiLCJmaWxlIjoiQ29udGVudEVkaXRhYmxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUHJvcFR5cGVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJhZGl1bSBmcm9tICdyYWRpdW0nO1xuaW1wb3J0IGlzRW1wdHkgZnJvbSAnbG9kYXNoL2lzRW1wdHknO1xuXG5pbXBvcnQgeyBOT09QIH0gZnJvbSAnLi4vYmFzZS9CYXNlJztcbmltcG9ydCB7IENPTE9SX05FVVRSQUwgfSBmcm9tICcuLi9zdHlsZXMvdGhlbWUnO1xuaW1wb3J0IHtcbiAgREVGQVVMVF9GT05UX0ZBTUlMWSxcbiAgVFlQRV9CQVNFLFxufSBmcm9tICcuLi9zdHlsZXMvbWl4aW5zL3R5cGUnO1xuaW1wb3J0IHsgZ3JpZFVuaXRzIGFzIGd1IH0gZnJvbSAnLi4vc3R5bGVzL2hlbHBlcnMnO1xuaW1wb3J0IHtcbiAgRU5URVIsXG4gIEVTQ0FQRSxcbiAgVEFCLFxufSBmcm9tICcuLi9jb25zdGFudHMvS2V5Q29kZXMnO1xuXG5cbmNvbnN0IElOUFVUX0NPTlRBSU5FUl9TVFlMRSA9IHtcbiAgYWxpZ25JdGVtczogJ2ZsZXgtc3RhcnQnLFxuICBkaXNwbGF5OiAnZmxleCcsXG59O1xuXG5jb25zdCBJTlBVVF9TVFlMRSA9IHtcbiAgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnLFxuICBib3JkZXI6ICdub25lJyxcbiAgY29sb3I6IENPTE9SX05FVVRSQUxbJzgwMCddLFxuICBmbGV4R3JvdzogMCxcbiAgaGVpZ2h0OiBndSg3KSxcbiAgbGluZUhlaWdodDogZ3UoNyksXG4gIG1pbldpZHRoOiBndSgwLjIpLFxuICBvdXRsaW5lOiAnbm9uZScsXG4gIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgcGFkZGluZ0JvdHRvbTogMCxcbiAgcGFkZGluZ1JpZ2h0OiAwLFxuICBwYWRkaW5nVG9wOiAwLFxuICB0ZXh0SW5kZW50OiAwLFxufTtcblxuY29uc3QgUExBQ0VfSE9MREVSX1NUWUxFID0ge1xuICAuLi5UWVBFX0JBU0UsXG4gIC4uLkRFRkFVTFRfRk9OVF9GQU1JTFksXG4gIC4uLklOUFVUX1NUWUxFLFxuICBjb2xvcjogQ09MT1JfTkVVVFJBTFsnMjAwJ10sXG59O1xuXG5jb25zdCBFTlRJVFlfTUFQID0ge1xuICAnXCInOiAnJnF1b3Q7JyxcbiAgJyYnOiAnJmFtcDsnLFxuICAnXFwnJzogJyYjMzk7JyxcbiAgJy8nOiAnJiN4MkY7JyxcbiAgJzwnOiAnJmx0OycsXG4gICc+JzogJyZndDsnLFxufTtcblxuZnVuY3Rpb24gZ2V0SW5pdGlhbFN0YXRlKHByb3BzKSB7XG4gIHJldHVybiB7XG4gICAgZm9jdXM6IGZhbHNlLFxuICAgIHZhbHVlOiBwcm9wcy5kZWZhdWx0VmFsdWUgfHwgcHJvcHMudmFsdWUgfHwgJycsXG4gIH07XG59XG5cbmZ1bmN0aW9uIGNhblNob3dQbGFjZWhvbGRlcihwcm9wcykge1xuICByZXR1cm4gIWlzRW1wdHkocHJvcHMucGxhY2Vob2xkZXIpICYmIGlzRW1wdHkocHJvcHMudmFsdWUpO1xufVxuXG4vLyBUT0RPOjogbWFrZSB0aGlzIGdlbmVyaWMgdXRpbCBmdW5jdGlvbiBvciBvYmplY3RcbmZ1bmN0aW9uIGVzY2FwZUh0bWwoc3RyaW5nKSB7XG4gIHJldHVybiBTdHJpbmcoc3RyaW5nKS5yZXBsYWNlKC9bJjw+XCInL10vZywgcyA9PiBFTlRJVFlfTUFQW3NdKTtcbn1cblxuLy8gVE9ETzo6IG1ha2UgdGhpcyBhIGdlbmVyaWMgdXRpbCBmdW5jdGlvbiBvciBvYmplY3RcbmZ1bmN0aW9uIGhhc1N0eWxlZEVsZW1lbnQoY2hpbGRyZW4gPSBbXSkge1xuICBjb25zdCBjaGlsZHJlbkFycmF5ID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoY2hpbGRyZW4sIDApO1xuICAvLyBGaXJlRm94IGluc2VydHMgPGJyPiBmb3IgXCJzcGFjZVwiIElucHV0XG4gIC8vIEZvbGxvd2luZyB3aWxsIGZpbHRlciB0aHJvdWdoIHN1Y2ggY2hpbGRyZW5cbiAgcmV0dXJuIGNoaWxkcmVuQXJyYXkuZmlsdGVyKGNoaWxkID0+XG4gICAgY2hpbGQgJiYgY2hpbGQudGFnTmFtZSAhPT0gJ0JSJykubGVuZ3RoICE9PSAwO1xufVxuXG4vLyBETyBOT1QgVVNFIHB1cmVyZW5kZXJpbmcgd2l0aCB0aGlzIGNvbXBvbmVudFxuQFJhZGl1bVxuY2xhc3MgVHhsQ29udGVudEVkaXRhYmxlIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgIHRoaXMuc3RhdGUgPSBnZXRJbml0aWFsU3RhdGUoLi4uYXJncyk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzLnZhbHVlICE9PSBuZXh0UHJvcHMudmFsdWUpIHtcbiAgICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgICBpZiAodmFsdWUgIT09IG5leHRQcm9wcy52YWx1ZSkge1xuICAgICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgICB2YWx1ZTogbmV4dFByb3BzLnZhbHVlLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuX2lucHV0UmVmO1xuICAgIGlmIChub2RlKSB7XG4gICAgICBjb25zdCBlc2NhcGVkVmFsdWUgPSBlc2NhcGVIdG1sKHRoaXMuc3RhdGUudmFsdWUpO1xuICAgICAgaWYgKGVzY2FwZWRWYWx1ZSAhPT0gbm9kZS50ZXh0Q29udGVudCB8fCBoYXNTdHlsZWRFbGVtZW50KG5vZGUuY2hpbGRyZW4pKSB7XG4gICAgICAgIG5vZGUuaW5uZXJIVE1MID0gZXNjYXBlZFZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIG1vdmVDdXJzb3JUb0VuZCA9ICgpID0+IHtcbiAgICBjb25zdCByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7XG4gICAgcmFuZ2Uuc2VsZWN0Tm9kZUNvbnRlbnRzKHRoaXMuX2lucHV0UmVmKTtcbiAgICByYW5nZS5jb2xsYXBzZShmYWxzZSk7XG4gICAgY29uc3Qgc2VsZWN0aW9uID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgIHNlbGVjdGlvbi5yZW1vdmVBbGxSYW5nZXMoKTtcbiAgICBzZWxlY3Rpb24uYWRkUmFuZ2UocmFuZ2UpO1xuICB9XG5cbiAgZGlkQ2hhbmdlID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgdmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh7IHZhbHVlIH0pO1xuICB9XG5cbiAgZm9jdXMgPSAoKSA9PiB7XG4gICAgdGhpcy5faW5wdXRSZWYgJiYgdGhpcy5faW5wdXRSZWYuZm9jdXMoKTtcbiAgfVxuXG4gIGJsdXIgPSAoKSA9PiB7XG4gICAgdGhpcy5faW5wdXRSZWYgJiYgdGhpcy5faW5wdXRSZWYuYmx1cigpO1xuICB9XG5cbiAgaGFuZGxlUGFzdGUgPSAoKSA9PiB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMuX2lucHV0UmVmO1xuICAgIGlmIChub2RlKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IG5vZGUudGV4dENvbnRlbnQ7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSwgdGhpcy5kaWRDaGFuZ2UpO1xuICAgIH1cbiAgfVxuXG4gIGhhbmRsZUNsaWNrID0gKGUpID0+IHtcbiAgICB0aGlzLmZvY3VzKCk7XG4gICAgdGhpcy5wcm9wcy5vbkNsaWNrKGUpO1xuICB9XG5cbiAgaGFuZGxlT25JbnB1dCA9IChlKSA9PiB7XG4gICAgY29uc3QgdmFsdWUgPSBlLnRhcmdldC50ZXh0Q29udGVudDtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSwgdGhpcy5kaWRDaGFuZ2UpO1xuICB9XG5cbiAgaGFuZGxlS2V5RG93biA9IChlKSA9PiB7XG4gICAgY29uc3QgeyBrZXlDb2RlIH0gPSBlO1xuICAgIHN3aXRjaCAoa2V5Q29kZSkge1xuICAgICAgY2FzZSBFTlRFUjpcbiAgICAgIGNhc2UgRVNDQVBFOlxuICAgICAgY2FzZSBUQUI6XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdGhpcy5ibHVyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vbktleURvd24gJiYgdGhpcy5wcm9wcy5vbktleURvd24oZSk7XG4gIH1cblxuICBoYW5kbGVGb2N1cyA9IChlKSA9PiB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzOiB0cnVlIH0sICgpID0+IHRoaXMucHJvcHMub25Gb2N1cyhlKSk7XG4gIH1cblxuICBoYW5kbGVCbHVyID0gKGUpID0+IHtcbiAgICB0aGlzLnNldFN0YXRlKHsgZm9jdXM6IGZhbHNlIH0sICgpID0+IHRoaXMucHJvcHMub25CbHVyKGUpKTtcbiAgfVxuXG4gIF9oYW5kbGVJbnB1dFJlZiA9IChyZWYpID0+IHtcbiAgICB0aGlzLl9pbnB1dFJlZiA9IHJlZjtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBkaXNhYmxlZCxcbiAgICAgIGlkLFxuICAgICAgc3BlbGxDaGVjayxcbiAgICAgIHN0eWxlLFxuICAgICAgdGFnTmFtZSxcbiAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgdGFiSW5kZXgsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyB2YWx1ZSB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGNvbnN0IGhhbmRsZXJzID0ge1xuICAgICAgb25CbHVyOiAhZGlzYWJsZWQgPyB0aGlzLmhhbmRsZUJsdXIgOiBOT09QLFxuICAgICAgb25Gb2N1czogIWRpc2FibGVkID8gdGhpcy5oYW5kbGVGb2N1cyA6IE5PT1AsXG4gICAgfTtcblxuICAgIGNvbnN0IHNob3dQbGFjZWhvbGRlciA9IGNhblNob3dQbGFjZWhvbGRlcih7IHBsYWNlaG9sZGVyLCB2YWx1ZSB9KTtcblxuICAgIGNvbnN0IGVsZW1TdHlsZSA9IHtcbiAgICAgIC4uLklOUFVUX1NUWUxFLFxuICAgICAgcGFkZGluZ0xlZnQ6IHNob3dQbGFjZWhvbGRlciA/IDAgOiBndSgwLjIpLFxuICAgIH07XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBkYXRhLWNvbXBvbmVudD1cIlR4bENvbnRlbnRFZGl0YWJsZVwiXG4gICAgICAgIG9uQ2xpY2s9e3RoaXMuaGFuZGxlQ2xpY2t9XG4gICAgICAgIHN0eWxlPXtzdHlsZX1cbiAgICAgID5cbiAgICAgICAgPGRpdiBzdHlsZT17SU5QVVRfQ09OVEFJTkVSX1NUWUxFfT5cbiAgICAgICAgICB7XG4gICAgICAgICAgICBSZWFjdC5ET01bdGFnTmFtZV0oe1xuICAgICAgICAgICAgICAuLi5oYW5kbGVycyxcbiAgICAgICAgICAgICAgY29udGVudEVkaXRhYmxlOiAhZGlzYWJsZWQsXG4gICAgICAgICAgICAgIGlkLFxuICAgICAgICAgICAgICBvbklucHV0OiB0aGlzLmhhbmRsZU9uSW5wdXQsXG4gICAgICAgICAgICAgIG9uS2V5RG93bjogdGhpcy5oYW5kbGVLZXlEb3duLFxuICAgICAgICAgICAgICBvblBhc3RlOiB0aGlzLmhhbmRsZVBhc3RlLFxuICAgICAgICAgICAgICByZWY6IHRoaXMuX2hhbmRsZUlucHV0UmVmLFxuICAgICAgICAgICAgICBzcGVsbENoZWNrLFxuICAgICAgICAgICAgICBzdHlsZTogZWxlbVN0eWxlLFxuICAgICAgICAgICAgICB0YWJJbmRleCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgfVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIFJlYWN0LkRPTVt0YWdOYW1lXSh7XG4gICAgICAgICAgICAgIHN0eWxlOiBQTEFDRV9IT0xERVJfU1RZTEUsXG4gICAgICAgICAgICB9LCBzaG93UGxhY2Vob2xkZXIgPyBwbGFjZWhvbGRlciA6IHVuZGVmaW5lZClcbiAgICAgICAgICB9XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5UeGxDb250ZW50RWRpdGFibGUucHJvcFR5cGVzID0ge1xuICBkZWZhdWx0VmFsdWU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGRpc2FibGVkOiBQcm9wVHlwZXMuYm9vbCxcbiAgaWQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIG9uQmx1cjogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25DbGljazogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uRm9jdXM6IFByb3BUeXBlcy5mdW5jLFxuICBvbktleURvd246IFByb3BUeXBlcy5mdW5jLFxuICBwbGFjZWhvbGRlcjogUHJvcFR5cGVzLnN0cmluZyxcbiAgc3BlbGxDaGVjazogUHJvcFR5cGVzLmJvb2wsXG4gIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxuICB0YWJJbmRleDogUHJvcFR5cGVzLm51bWJlcixcbiAgdGFnTmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgdmFsdWU6IFByb3BUeXBlcy5zdHJpbmcsXG59O1xuXG5UeGxDb250ZW50RWRpdGFibGUuZGVmYXVsdFByb3BzID0ge1xuICBvbkJsdXI6IE5PT1AsXG4gIG9uQ2hhbmdlOiBOT09QLFxuICBvbkNsaWNrOiBOT09QLFxuICBvbkZvY3VzOiBOT09QLFxuICBzcGVsbENoZWNrOiB0cnVlLFxuICB0YWJJbmRleDogMCxcbiAgdGFnTmFtZTogJ2RpdicsXG4gIHZhbHVlOiAnJyxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFR4bENvbnRlbnRFZGl0YWJsZTtcbiJdfQ==