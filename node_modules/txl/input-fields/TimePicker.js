'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _Base = require('../base/Base');

var _CalendarUtils = require('../calendar-picker/_CalendarUtils');

var _TimePickerControlled = require('./TimePickerControlled');

var _TimePickerControlled2 = _interopRequireDefault(_TimePickerControlled);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var OUT_OF_RANGE_INVALID_TEXT = 'Time is out of accepted range';

function getValidationState(_ref) {
  var time = _ref.time,
      boundaryEnd = _ref.boundaryEnd,
      boundaryStart = _ref.boundaryStart;

  var state = {
    validationState: 'base',
    validationText: null
  };

  // Don't validate empty field
  // note: this would be an issue if this field is required
  if (time === undefined) return state;

  // time falls outside of boundaries
  if (!(0, _CalendarUtils.isTimeWithinRange)(time, boundaryStart, boundaryEnd)) {
    state.validationState = 'error';
    state.validationText = OUT_OF_RANGE_INVALID_TEXT;
  }
  return state;
}

function buildState(_ref2) {
  var boundaryStart = _ref2.boundaryStart,
      boundaryEnd = _ref2.boundaryEnd,
      time = _ref2.time;

  return (0, _extends3.default)({}, getValidationState({ boundaryEnd: boundaryEnd, boundaryStart: boundaryStart, time: time }), {
    time: time
  });
}

var TxlTimePicker = (0, _radium2.default)(_class = function (_React$Component) {
  (0, _inherits3.default)(TxlTimePicker, _React$Component);

  function TxlTimePicker() {
    var _ref3;

    (0, _classCallCheck3.default)(this, TxlTimePicker);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref3 = TxlTimePicker.__proto__ || (0, _getPrototypeOf2.default)(TxlTimePicker)).call.apply(_ref3, [this].concat(args)));

    _this.setTime = function () {
      return _this.__setTime__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._update = function () {
      return _this.___update__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._handleChildTimePickerRef = function () {
      return _this.___handleChildTimePickerRef__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._handleCloseDropdown = function () {
      return _this.___handleCloseDropdown__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._handleItemSelect = function () {
      return _this.___handleItemSelect__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._handleOpenDropdown = function () {
      return _this.___handleOpenDropdown__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    var defaultTime = _this.props.defaultTime;

    _this.state = (0, _extends3.default)({}, buildState((0, _extends3.default)({ time: defaultTime }, _this.props)), {
      open: false
    });
    return _this;
  }

  (0, _createClass3.default)(TxlTimePicker, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      // if boundaries or time change, we need to revalidate
      var boundaryEnd = nextProps.boundaryEnd,
          boundaryStart = nextProps.boundaryStart;
      var time = this.state.time;

      this.setState(buildState((0, _extends3.default)({}, this.props, {
        boundaryEnd: boundaryEnd,
        boundaryStart: boundaryStart,
        time: time
      })));
    }
  }, {
    key: '__setTime__REACT_HOT_LOADER__',
    value: function __setTime__REACT_HOT_LOADER__() {
      return this.__setTime__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__setTime__REACT_HOT_LOADER__',
    value: function __setTime__REACT_HOT_LOADER__() {
      return this.__setTime__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '__setTime__REACT_HOT_LOADER__',
    value: function __setTime__REACT_HOT_LOADER__(_ref4) {
      var hour = _ref4.hour,
          minute = _ref4.minute,
          second = _ref4.second;
      return this.setState({ time: { hour: hour, minute: minute, second: second } });
    }
  }, {
    key: '___update__REACT_HOT_LOADER__',
    value: function ___update__REACT_HOT_LOADER__() {
      return this.___update__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___update__REACT_HOT_LOADER__',
    value: function ___update__REACT_HOT_LOADER__() {
      return this.___update__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___update__REACT_HOT_LOADER__',
    value: function ___update__REACT_HOT_LOADER__(time) {
      var _this2 = this;

      this.setState((0, _extends3.default)({}, buildState((0, _extends3.default)({}, this.props, { time: time })), {
        open: false
      }), function () {
        if (_this2.state.validationState !== 'error') {
          _this2.props.onItemSelect(time);
        }
      });
    }
  }, {
    key: '___handleChildTimePickerRef__REACT_HOT_LOADER__',
    value: function ___handleChildTimePickerRef__REACT_HOT_LOADER__() {
      return this.___handleChildTimePickerRef__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleChildTimePickerRef__REACT_HOT_LOADER__',
    value: function ___handleChildTimePickerRef__REACT_HOT_LOADER__() {
      return this.___handleChildTimePickerRef__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleChildTimePickerRef__REACT_HOT_LOADER__',
    value: function ___handleChildTimePickerRef__REACT_HOT_LOADER__(ref) {
      this._childTimePicker = ref;
    }
  }, {
    key: '___handleCloseDropdown__REACT_HOT_LOADER__',
    value: function ___handleCloseDropdown__REACT_HOT_LOADER__() {
      return this.___handleCloseDropdown__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleCloseDropdown__REACT_HOT_LOADER__',
    value: function ___handleCloseDropdown__REACT_HOT_LOADER__() {
      return this.___handleCloseDropdown__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleCloseDropdown__REACT_HOT_LOADER__',
    value: function ___handleCloseDropdown__REACT_HOT_LOADER__() {
      return this.setState({ open: false });
    }
  }, {
    key: '___handleItemSelect__REACT_HOT_LOADER__',
    value: function ___handleItemSelect__REACT_HOT_LOADER__() {
      return this.___handleItemSelect__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleItemSelect__REACT_HOT_LOADER__',
    value: function ___handleItemSelect__REACT_HOT_LOADER__() {
      return this.___handleItemSelect__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleItemSelect__REACT_HOT_LOADER__',
    value: function ___handleItemSelect__REACT_HOT_LOADER__(_ref5) {
      var value = _ref5.value;

      // validate string from user or selected item
      var time = (0, _moment2.default)(value, this.props.pattern, true);
      if (time.isValid()) {
        this._update({
          hour: time.hours(),
          minute: time.minutes(),
          second: time.seconds()
        });
      }
    }
  }, {
    key: '___handleOpenDropdown__REACT_HOT_LOADER__',
    value: function ___handleOpenDropdown__REACT_HOT_LOADER__() {
      return this.___handleOpenDropdown__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleOpenDropdown__REACT_HOT_LOADER__',
    value: function ___handleOpenDropdown__REACT_HOT_LOADER__() {
      return this.___handleOpenDropdown__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___handleOpenDropdown__REACT_HOT_LOADER__',
    value: function ___handleOpenDropdown__REACT_HOT_LOADER__() {
      return this.setState({ open: true });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          boundaryEnd = _props.boundaryEnd,
          boundaryStart = _props.boundaryStart,
          label = _props.label,
          pattern = _props.pattern,
          placeholder = _props.placeholder,
          secondaryText = _props.secondaryText;
      var _state = this.state,
          open = _state.open,
          time = _state.time,
          validationState = _state.validationState,
          validationText = _state.validationText;


      var textValue = time ? (0, _moment2.default)(time).format(pattern) : '';

      return _react2.default.createElement(
        'div',
        { 'data-component': 'TxlTimePicker' },
        _react2.default.createElement(_TimePickerControlled2.default, {
          boundaryEnd: boundaryEnd,
          boundaryStart: boundaryStart,
          closeDropdown: this._handleCloseDropdown,
          label: label,
          onItemSelect: this._handleItemSelect,
          open: open,
          openDropdown: this._handleOpenDropdown,
          pattern: pattern,
          placeholder: placeholder,
          secondaryText: validationText || secondaryText,
          validationState: validationState,
          textValue: textValue,
          time: time
        })
      );
    }
  }]);
  return TxlTimePicker;
}(_react2.default.Component)) || _class;

exports.default = TxlTimePicker;


TxlTimePicker.propTypes = {
  boundaryEnd: _TimePickerControlled2.default.propTypes.boundaryEnd,
  boundaryStart: _TimePickerControlled2.default.propTypes.boundaryStart,
  defaultTime: _TimePickerControlled2.default.propTypes.time,
  label: _TimePickerControlled2.default.propTypes.label,
  onItemSelect: _react.PropTypes.func,
  pattern: _TimePickerControlled2.default.propTypes.pattern,
  placeholder: _TimePickerControlled2.default.propTypes.placeholder,
  secondaryText: _TimePickerControlled2.default.propTypes.secondaryText
};

TxlTimePicker.defaultProps = {
  boundaryEnd: _TimePickerControlled2.default.defaultProps.boundaryEnd,
  boundaryStart: _TimePickerControlled2.default.defaultProps.boundaryStart,
  onItemSelect: _Base.NOOP,
  pattern: _TimePickerControlled2.default.defaultProps.pattern,
  placeholder: 'Select a time'
};
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(OUT_OF_RANGE_INVALID_TEXT, 'OUT_OF_RANGE_INVALID_TEXT', 'src/input-fields/TimePicker.jsx');

  __REACT_HOT_LOADER__.register(getValidationState, 'getValidationState', 'src/input-fields/TimePicker.jsx');

  __REACT_HOT_LOADER__.register(buildState, 'buildState', 'src/input-fields/TimePicker.jsx');

  __REACT_HOT_LOADER__.register(TxlTimePicker, 'TxlTimePicker', 'src/input-fields/TimePicker.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9pbnB1dC1maWVsZHMvVGltZVBpY2tlci5qc3giXSwibmFtZXMiOlsiT1VUX09GX1JBTkdFX0lOVkFMSURfVEVYVCIsImdldFZhbGlkYXRpb25TdGF0ZSIsInRpbWUiLCJib3VuZGFyeUVuZCIsImJvdW5kYXJ5U3RhcnQiLCJzdGF0ZSIsInZhbGlkYXRpb25TdGF0ZSIsInZhbGlkYXRpb25UZXh0IiwidW5kZWZpbmVkIiwiYnVpbGRTdGF0ZSIsIlR4bFRpbWVQaWNrZXIiLCJhcmdzIiwic2V0VGltZSIsIl91cGRhdGUiLCJfaGFuZGxlQ2hpbGRUaW1lUGlja2VyUmVmIiwiX2hhbmRsZUNsb3NlRHJvcGRvd24iLCJfaGFuZGxlSXRlbVNlbGVjdCIsIl9oYW5kbGVPcGVuRHJvcGRvd24iLCJkZWZhdWx0VGltZSIsInByb3BzIiwib3BlbiIsIm5leHRQcm9wcyIsInNldFN0YXRlIiwiaG91ciIsIm1pbnV0ZSIsInNlY29uZCIsIm9uSXRlbVNlbGVjdCIsInJlZiIsIl9jaGlsZFRpbWVQaWNrZXIiLCJ2YWx1ZSIsInBhdHRlcm4iLCJpc1ZhbGlkIiwiaG91cnMiLCJtaW51dGVzIiwic2Vjb25kcyIsImxhYmVsIiwicGxhY2Vob2xkZXIiLCJzZWNvbmRhcnlUZXh0IiwidGV4dFZhbHVlIiwiZm9ybWF0IiwiQ29tcG9uZW50IiwicHJvcFR5cGVzIiwiZnVuYyIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7O0FBQ0E7O0FBQ0E7Ozs7OztBQUVBLElBQU1BLDRCQUE0QiwrQkFBbEM7O0FBRUEsU0FBU0Msa0JBQVQsT0FBa0U7QUFBQSxNQUFwQ0MsSUFBb0MsUUFBcENBLElBQW9DO0FBQUEsTUFBOUJDLFdBQThCLFFBQTlCQSxXQUE4QjtBQUFBLE1BQWpCQyxhQUFpQixRQUFqQkEsYUFBaUI7O0FBQ2hFLE1BQU1DLFFBQVE7QUFDWkMs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Z0JBQU1zQyxTOztrQkFBNUI5QixhOzs7QUFpR3JCQSxjQUFjK0IsU0FBZCxHQUEwQjtBQUN4QnRDLGVBQWEsK0JBQXFCc0MsU0FBckIsQ0FBK0J0QyxXQURwQjtBQUV4QkMsaUJBQWUsK0JBQXFCcUMsU0FBckIsQ0FBK0JyQyxhQUZ0QjtBQUd4QmMsZUFBYSwrQkFBcUJ1QixTQUFyQixDQUErQnZDLElBSHBCO0FBSXhCaUMsU0FBTywrQkFBcUJNLFNBQXJCLENBQStCTixLQUpkO0FBS3hCVCxnQkFBYyxpQkFBVWdCLElBTEE7QUFNeEJaLFdBQVMsK0JBQXFCVyxTQUFyQixDQUErQlgsT0FOaEI7QUFPeEJNLGVBQWEsK0JBQXFCSyxTQUFyQixDQUErQkwsV0FQcEI7QUFReEJDLGlCQUFlLCtCQUFxQkksU0FBckIsQ0FBK0JKO0FBUnRCLENBQTFCOztBQVdBM0IsY0FBY2lDLFlBQWQsR0FBNkI7QUFDM0J4QyxlQUFhLCtCQUFxQndDLFlBQXJCLENBQWtDeEMsV0FEcEI7QUFFM0JDLGlCQUFlLCtCQUFxQnVDLFlBQXJCLENBQWtDdkMsYUFGdEI7QUFHM0JzQiwwQkFIMkI7QUFJM0JJLFdBQVMsK0JBQXFCYSxZQUFyQixDQUFrQ2IsT0FKaEI7QUFLM0JNLGVBQWE7QUFMYyxDQUE3Qjs7Ozs7Ozs7Z0NBeElNcEMseUI7O2dDQUVHQyxrQjs7Z0NBa0JBUSxVOztnQ0FRWUMsYSIsImZpbGUiOiJUaW1lUGlja2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcblxuaW1wb3J0IHsgTk9PUCB9IGZyb20gJy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQgeyBpc1RpbWVXaXRoaW5SYW5nZSB9IGZyb20gJy4uL2NhbGVuZGFyLXBpY2tlci9fQ2FsZW5kYXJVdGlscyc7XG5pbXBvcnQgVGltZVBpY2tlckNvbnRyb2xsZWQgZnJvbSAnLi9UaW1lUGlja2VyQ29udHJvbGxlZCc7XG5cbmNvbnN0IE9VVF9PRl9SQU5HRV9JTlZBTElEX1RFWFQgPSAnVGltZSBpcyBvdXQgb2YgYWNjZXB0ZWQgcmFuZ2UnO1xuXG5mdW5jdGlvbiBnZXRWYWxpZGF0aW9uU3RhdGUoeyB0aW1lLCBib3VuZGFyeUVuZCwgYm91bmRhcnlTdGFydCB9KSB7XG4gIGNvbnN0IHN0YXRlID0ge1xuICAgIHZhbGlkYXRpb25TdGF0ZTogJ2Jhc2UnLFxuICAgIHZhbGlkYXRpb25UZXh0OiBudWxsLFxuICB9O1xuXG4gIC8vIERvbid0IHZhbGlkYXRlIGVtcHR5IGZpZWxkXG4gIC8vIG5vdGU6IHRoaXMgd291bGQgYmUgYW4gaXNzdWUgaWYgdGhpcyBmaWVsZCBpcyByZXF1aXJlZFxuICBpZiAodGltZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gc3RhdGU7XG5cbiAgLy8gdGltZSBmYWxscyBvdXRzaWRlIG9mIGJvdW5kYXJpZXNcbiAgaWYgKCFpc1RpbWVXaXRoaW5SYW5nZSh0aW1lLCBib3VuZGFyeVN0YXJ0LCBib3VuZGFyeUVuZCkpIHtcbiAgICBzdGF0ZS52YWxpZGF0aW9uU3RhdGUgPSAnZXJyb3InO1xuICAgIHN0YXRlLnZhbGlkYXRpb25UZXh0ID0gT1VUX09GX1JBTkdFX0lOVkFMSURfVEVYVDtcbiAgfVxuICByZXR1cm4gc3RhdGU7XG59XG5cbmZ1bmN0aW9uIGJ1aWxkU3RhdGUoeyBib3VuZGFyeVN0YXJ0LCBib3VuZGFyeUVuZCwgdGltZSB9KSB7XG4gIHJldHVybiB7XG4gICAgLi4uZ2V0VmFsaWRhdGlvblN0YXRlKHsgYm91bmRhcnlFbmQsIGJvdW5kYXJ5U3RhcnQsIHRpbWUgfSksXG4gICAgdGltZSxcbiAgfTtcbn1cblxuQFJhZGl1bVxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHhsVGltZVBpY2tlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICBzdXBlciguLi5hcmdzKTtcbiAgICBjb25zdCB7IGRlZmF1bHRUaW1lIH0gPSB0aGlzLnByb3BzO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAuLi5idWlsZFN0YXRlKHsgdGltZTogZGVmYXVsdFRpbWUsIC4uLnRoaXMucHJvcHMgfSksXG4gICAgICBvcGVuOiBmYWxzZSxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICAvLyBpZiBib3VuZGFyaWVzIG9yIHRpbWUgY2hhbmdlLCB3ZSBuZWVkIHRvIHJldmFsaWRhdGVcbiAgICBjb25zdCB7IGJvdW5kYXJ5RW5kLCBib3VuZGFyeVN0YXJ0IH0gPSBuZXh0UHJvcHM7XG4gICAgY29uc3QgeyB0aW1lIH0gPSB0aGlzLnN0YXRlO1xuICAgIHRoaXMuc2V0U3RhdGUoYnVpbGRTdGF0ZSh7XG4gICAgICAuLi50aGlzLnByb3BzLFxuICAgICAgYm91bmRhcnlFbmQsXG4gICAgICBib3VuZGFyeVN0YXJ0LFxuICAgICAgdGltZSxcbiAgICB9KSk7XG4gIH1cblxuICBzZXRUaW1lID0gKHsgaG91ciwgbWludXRlLCBzZWNvbmQgfSkgPT4gdGhpcy5zZXRTdGF0ZSh7IHRpbWU6IHsgaG91ciwgbWludXRlLCBzZWNvbmQgfSB9KVxuXG4gIF91cGRhdGUgPSAodGltZSkgPT4ge1xuICAgIHRoaXMuc2V0U3RhdGUoXG4gICAgICB7XG4gICAgICAgIC4uLmJ1aWxkU3RhdGUoeyAuLi50aGlzLnByb3BzLCB0aW1lIH0pLFxuICAgICAgICBvcGVuOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICAoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnN0YXRlLnZhbGlkYXRpb25TdGF0ZSAhPT0gJ2Vycm9yJykge1xuICAgICAgICAgIHRoaXMucHJvcHMub25JdGVtU2VsZWN0KHRpbWUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIF9oYW5kbGVDaGlsZFRpbWVQaWNrZXJSZWYgPSAocmVmKSA9PiB7IHRoaXMuX2NoaWxkVGltZVBpY2tlciA9IHJlZjsgfVxuXG4gIF9oYW5kbGVDbG9zZURyb3Bkb3duID0gKCkgPT4gdGhpcy5zZXRTdGF0ZSh7IG9wZW46IGZhbHNlIH0pXG5cbiAgX2hhbmRsZUl0ZW1TZWxlY3QgPSAoeyB2YWx1ZSB9KSA9PiB7XG4gICAgLy8gdmFsaWRhdGUgc3RyaW5nIGZyb20gdXNlciBvciBzZWxlY3RlZCBpdGVtXG4gICAgY29uc3QgdGltZSA9IG1vbWVudCh2YWx1ZSwgdGhpcy5wcm9wcy5wYXR0ZXJuLCB0cnVlKTtcbiAgICBpZiAodGltZS5pc1ZhbGlkKCkpIHtcbiAgICAgIHRoaXMuX3VwZGF0ZSh7XG4gICAgICAgIGhvdXI6IHRpbWUuaG91cnMoKSxcbiAgICAgICAgbWludXRlOiB0aW1lLm1pbnV0ZXMoKSxcbiAgICAgICAgc2Vjb25kOiB0aW1lLnNlY29uZHMoKSxcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9oYW5kbGVPcGVuRHJvcGRvd24gPSAoKSA9PiB0aGlzLnNldFN0YXRlKHsgb3BlbjogdHJ1ZSB9KVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7XG4gICAgICBib3VuZGFyeUVuZCxcbiAgICAgIGJvdW5kYXJ5U3RhcnQsXG4gICAgICBsYWJlbCxcbiAgICAgIHBhdHRlcm4sXG4gICAgICBwbGFjZWhvbGRlcixcbiAgICAgIHNlY29uZGFyeVRleHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7XG4gICAgICBvcGVuLFxuICAgICAgdGltZSxcbiAgICAgIHZhbGlkYXRpb25TdGF0ZSxcbiAgICAgIHZhbGlkYXRpb25UZXh0LFxuICAgIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgY29uc3QgdGV4dFZhbHVlID0gdGltZSA/IG1vbWVudCh0aW1lKS5mb3JtYXQocGF0dGVybikgOiAnJztcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGRhdGEtY29tcG9uZW50PVwiVHhsVGltZVBpY2tlclwiPlxuICAgICAgICA8VGltZVBpY2tlckNvbnRyb2xsZWRcbiAgICAgICAgICBib3VuZGFyeUVuZD17Ym91bmRhcnlFbmR9XG4gICAgICAgICAgYm91bmRhcnlTdGFydD17Ym91bmRhcnlTdGFydH1cbiAgICAgICAgICBjbG9zZURyb3Bkb3duPXt0aGlzLl9oYW5kbGVDbG9zZURyb3Bkb3dufVxuICAgICAgICAgIGxhYmVsPXtsYWJlbH1cbiAgICAgICAgICBvbkl0ZW1TZWxlY3Q9e3RoaXMuX2hhbmRsZUl0ZW1TZWxlY3R9XG4gICAgICAgICAgb3Blbj17b3Blbn1cbiAgICAgICAgICBvcGVuRHJvcGRvd249e3RoaXMuX2hhbmRsZU9wZW5Ecm9wZG93bn1cbiAgICAgICAgICBwYXR0ZXJuPXtwYXR0ZXJufVxuICAgICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgICBzZWNvbmRhcnlUZXh0PXt2YWxpZGF0aW9uVGV4dCB8fCBzZWNvbmRhcnlUZXh0fVxuICAgICAgICAgIHZhbGlkYXRpb25TdGF0ZT17dmFsaWRhdGlvblN0YXRlfVxuICAgICAgICAgIHRleHRWYWx1ZT17dGV4dFZhbHVlfVxuICAgICAgICAgIHRpbWU9e3RpbWV9XG4gICAgICAgIC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cblR4bFRpbWVQaWNrZXIucHJvcFR5cGVzID0ge1xuICBib3VuZGFyeUVuZDogVGltZVBpY2tlckNvbnRyb2xsZWQucHJvcFR5cGVzLmJvdW5kYXJ5RW5kLFxuICBib3VuZGFyeVN0YXJ0OiBUaW1lUGlja2VyQ29udHJvbGxlZC5wcm9wVHlwZXMuYm91bmRhcnlTdGFydCxcbiAgZGVmYXVsdFRpbWU6IFRpbWVQaWNrZXJDb250cm9sbGVkLnByb3BUeXBlcy50aW1lLFxuICBsYWJlbDogVGltZVBpY2tlckNvbnRyb2xsZWQucHJvcFR5cGVzLmxhYmVsLFxuICBvbkl0ZW1TZWxlY3Q6IFByb3BUeXBlcy5mdW5jLFxuICBwYXR0ZXJuOiBUaW1lUGlja2VyQ29udHJvbGxlZC5wcm9wVHlwZXMucGF0dGVybixcbiAgcGxhY2Vob2xkZXI6IFRpbWVQaWNrZXJDb250cm9sbGVkLnByb3BUeXBlcy5wbGFjZWhvbGRlcixcbiAgc2Vjb25kYXJ5VGV4dDogVGltZVBpY2tlckNvbnRyb2xsZWQucHJvcFR5cGVzLnNlY29uZGFyeVRleHQsXG59O1xuXG5UeGxUaW1lUGlja2VyLmRlZmF1bHRQcm9wcyA9IHtcbiAgYm91bmRhcnlFbmQ6IFRpbWVQaWNrZXJDb250cm9sbGVkLmRlZmF1bHRQcm9wcy5ib3VuZGFyeUVuZCxcbiAgYm91bmRhcnlTdGFydDogVGltZVBpY2tlckNvbnRyb2xsZWQuZGVmYXVsdFByb3BzLmJvdW5kYXJ5U3RhcnQsXG4gIG9uSXRlbVNlbGVjdDogTk9PUCxcbiAgcGF0dGVybjogVGltZVBpY2tlckNvbnRyb2xsZWQuZGVmYXVsdFByb3BzLnBhdHRlcm4sXG4gIHBsYWNlaG9sZGVyOiAnU2VsZWN0IGEgdGltZScsXG59O1xuIl19