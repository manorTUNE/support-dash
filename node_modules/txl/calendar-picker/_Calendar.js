'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _memoize = require('lodash/memoize');

var _memoize2 = _interopRequireDefault(_memoize);

var _range = require('lodash/range');

var _range2 = _interopRequireDefault(_range);

var _propTypes = require('../utils/propTypes');

var _propTypes2 = _interopRequireDefault(_propTypes);

var _helpers = require('../styles/helpers');

var _Base = require('../base/Base');

var _CalendarUtils = require('./_CalendarUtils');

var _Calendar = require('./_Calendar.style');

var _Calendar2 = _interopRequireDefault(_Calendar);

var _CursorTooltipTarget = require('../_tooltips/CursorTooltipTarget');

var _CursorTooltipTarget2 = _interopRequireDefault(_CursorTooltipTarget);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var COMPARE_FORMAT = 'MM-DD-YYYY';
var WEEK_ROWS = 6;

function getNumberOfWeekRows(date) {
  var firstDay = date.day();
  var datesInMonth = date.daysInMonth();
  var numberOfTotalCell = firstDay + datesInMonth;
  return Math.ceil(numberOfTotalCell / 7);
}

function daysForMonth(date) {
  var startDayIndex = date.day(); // zero-based
  var endDayIndex = date.daysInMonth() + (startDayIndex - 1); // -1 to make zero-based

  return (0, _range2.default)(0, 7 * WEEK_ROWS).map(function (val) {
    if (val >= startDayIndex && val <= endDayIndex) {
      return (0, _moment2.default)(date).add(val - startDayIndex, 'day');
    }
    return '';
  });
}

function memoizeKey(date) {
  return date.format(COMPARE_FORMAT);
}

// returns array of days displayed for calendar month including trailing
// and leading empty days as empty strings e.g ['', ... Moment, Moment , '']
var getDays = (0, _memoize2.default)(daysForMonth, memoizeKey);

function getCellStyles(date, hoveredDate) {
  if (!date) {
    // needed to keep the empty cells padding-less and border-boxed
    return _Calendar2.default.cell.base;
  }
  var isCurrentDay = date.isSame((0, _moment2.default)(), 'day');
  var isHoverDay = !!hoveredDate && hoveredDate.isSame(date, 'day');
  return (0, _helpers.combineStyles)(_Calendar2.default.cell.base, isCurrentDay && _Calendar2.default.cell.current, isHoverDay && _Calendar2.default.cell.hover);
}

function getDayStyles(date, props) {
  if (!date) {
    return null;
  }
  var rangeEnd = props.rangeEnd,
      rangeEndBoundary = props.rangeEndBoundary,
      rangeStart = props.rangeStart,
      rangeStartBoundary = props.rangeStartBoundary;


  var boundariesProvided = rangeEndBoundary || rangeStartBoundary;
  // these just default to 'today' if rangeStart/End are undefined
  var rangeStartVal = (0, _moment2.default)(rangeStart).startOf('day');
  var rangeEndVal = (0, _moment2.default)(rangeEnd).startOf('day');
  var isRangeStart = rangeStartVal.isSame(date, 'day');
  var isRangeEnd = rangeEndVal.isSame(date, 'day');
  var inRange = date.isBetween(rangeStartVal, rangeEndVal, null, '[]');
  // Disable if outside of provided boundaries
  var isDisabled = boundariesProvided && !(0, _CalendarUtils.isDateWithinRange)(date, rangeStartBoundary, rangeEndBoundary);

  return (0, _helpers.combineStyles)({ cursor: 'pointer' }, _Calendar2.default.date.base, inRange && _Calendar2.default.date.inRange, isRangeStart && _Calendar2.default.date.rangeStart, isRangeEnd && _Calendar2.default.date.rangeEnd, isDisabled && _Calendar2.default.date.disabled);
}

var TxlCalendar = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlCalendar, _React$Component);

  // @TODO add drag functionality
  function TxlCalendar() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlCalendar);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlCalendar.__proto__ || (0, _getPrototypeOf2.default)(TxlCalendar)).call.apply(_ref, [this].concat(args)));

    _this.state = { hoveredDate: '' };
    return _this;
  }

  (0, _createClass3.default)(TxlCalendar, [{
    key: '_onHoverUpdate',
    value: function _onHoverUpdate(date) {
      this.setState({ hoveredDate: date });
      this.props.onHoverUpdate({ date: date });
    }
  }, {
    key: '_onDateClick',
    value: function _onDateClick(date) {
      this.props.onDateClick({ date: date });
    }
  }, {
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _props = this.props,
          date = _props.date,
          outOfRangeTooltip = _props.outOfRangeTooltip,
          rangeEndBoundary = _props.rangeEndBoundary,
          rangeStartBoundary = _props.rangeStartBoundary;

      var boundariesProvided = rangeEndBoundary && rangeStartBoundary;
      var monthStart = (0, _moment2.default)(date).startOf('month');
      var daysArr = getDays(monthStart);
      var hoveredDate = this.state.hoveredDate;


      return _react2.default.createElement(
        'div',
        {
          'data-component': 'TxlCalendar',
          style: _Calendar2.default.calendar
        },
        _react2.default.createElement(
          'table',
          {
            style: _Calendar2.default.table
          },
          _react2.default.createElement(
            'thead',
            null,
            _react2.default.createElement(
              'tr',
              null,
              _react2.default.createElement(
                'th',
                {
                  style: _Calendar2.default.monthHeader,
                  colSpan: '7'
                },
                monthStart.format('MMMM YYYY')
              )
            ),
            _react2.default.createElement(
              'tr',
              null,
              _moment2.default.weekdaysMin().map(function (day, index) {
                return _react2.default.createElement(
                  'th',
                  {
                    style: _Calendar2.default.dayHeader,
                    key: index
                  },
                  day
                );
              })
            )
          ),
          _react2.default.createElement(
            'tbody',
            { onMouseLeave: function onMouseLeave() {
                return _this2._onHoverUpdate('');
              } },
            (0, _range2.default)(getNumberOfWeekRows(monthStart)).map(function (week) {
              var weekStartIndex = 7 * week;
              var currentWeek = daysArr.slice(weekStartIndex, weekStartIndex + 7);
              return _react2.default.createElement(
                'tr',
                { key: week },
                currentWeek.map(function (day, index) {
                  /**
                   * @TODO pull this logic out of render() method, probably into its
                   * own component, e.g., 'DataCell'
                   * https://jira.corp.tune.com/browse/TXLENG-153
                   */
                  var dayIsInBounds = !!day && (
                  // no boundaries provided is same as 'in bounds' for these purposes
                  // boundaries provided, check range
                  !boundariesProvided || (0, _CalendarUtils.isDateWithinRange)(day, rangeStartBoundary, rangeEndBoundary));
                  var dateClickHandler = dayIsInBounds ? function () {
                    return _this2._onDateClick(day);
                  } : _Base.NOOP;

                  // init empty/placeholder cell
                  var dayEl = _react2.default.createElement('span', { style: _Calendar2.default.date.base });
                  if (day) {
                    // Active or disabled day
                    dayEl = _react2.default.createElement(
                      'span',
                      {
                        onClick: dateClickHandler,
                        style: getDayStyles(day, _this2.props)
                      },
                      day.format('D')
                    );
                    // wrap disabled day in tooltip, if applicable
                    if (!dayIsInBounds && outOfRangeTooltip) {
                      dayEl = _react2.default.createElement(
                        _CursorTooltipTarget2.default,
                        {
                          message: outOfRangeTooltip
                        },
                        dayEl
                      );
                    }
                  }

                  return _react2.default.createElement(
                    'td',
                    {
                      'data-day': day || 0,
                      key: index,
                      onMouseEnter: function onMouseEnter() {
                        return _this2._onHoverUpdate(dayIsInBounds ? day : '');
                      },
                      style: getCellStyles(day, hoveredDate)
                    },
                    dayEl
                  );
                })
              );
            })
          )
        )
      );
    }
  }]);
  return TxlCalendar;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_onHoverUpdate', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_onHoverUpdate'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_onDateClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_onDateClick'), _class2.prototype)), _class2)) || _class;

exports.default = TxlCalendar;


TxlCalendar.propTypes = {
  date: _propTypes2.default.date.isRequired,
  onDateClick: _react.PropTypes.func,
  onHoverUpdate: _react.PropTypes.func,
  outOfRangeTooltip: _react.PropTypes.node,
  rangeEnd: _propTypes2.default.date,
  rangeEndBoundary: _propTypes2.default.date,
  rangeStart: _propTypes2.default.date,
  rangeStartBoundary: _propTypes2.default.date
};

TxlCalendar.defaultProps = {
  onDateClick: _Base.NOOP,
  onHoverUpdate: _Base.NOOP
};
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(COMPARE_FORMAT, 'COMPARE_FORMAT', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(WEEK_ROWS, 'WEEK_ROWS', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(getNumberOfWeekRows, 'getNumberOfWeekRows', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(daysForMonth, 'daysForMonth', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(memoizeKey, 'memoizeKey', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(getDays, 'getDays', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(getCellStyles, 'getCellStyles', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(getDayStyles, 'getDayStyles', 'src/calendar-picker/_Calendar.jsx');

  __REACT_HOT_LOADER__.register(TxlCalendar, 'TxlCalendar', 'src/calendar-picker/_Calendar.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jYWxlbmRhci1waWNrZXIvX0NhbGVuZGFyLmpzeCJdLCJuYW1lcyI6WyJDT01QQVJFX0ZPUk1BVCIsIldFRUtfUk9XUyIsImdldE51bWJlck9mV2Vla1Jvd3MiLCJkYXRlIiwiZmlyc3REYXkiLCJkYXkiLCJkYXRlc0luTW9udGgiLCJkYXlzSW5Nb250aCIsIm51bWJlck9mVG90YWxDZWxsIiwiTWF0aCIsImNlaWwiLCJkYXlzRm9yTW9udGgiLCJzdGFydERheUluZGV4IiwiZW5kRGF5SW5kZXgiLCJtYXAiLCJ2YWwiLCJhZGQiLCJtZW1vaXplS2V5IiwiZm9ybWF0IiwiZ2V0RGF5cyIsImdldENlbGxTdHlsZXMiLCJob3ZlcmVkRGF0ZSIsImNlbGwiLCJiYXNlIiwiaXNDdXJyZW50RGF5IiwiaXNTYW1lIiwiaXNIb3ZlckRheSIsImN1cnJlbnQiLCJob3ZlciIsImdldERheVN0eWxlcyIsInByb3BzIiwicmFuZ2VFbmQiLCJyYW5nZUVuZEJvdW5kYXJ5IiwicmFuZ2VTdGFydCIsInJhbmdlU3RhcnRCb3VuZGFyeSIsImJvdW5kYXJpZXNQcm92aWRlZCIsInJhbmdlU3RhcnRWYWwiLCJzdGFydE9mIiwicmFuZ2VFbmRWYWwiLCJpc1JhbmdlU3RhcnQiLCJpc1JhbmdlRW5kIiwiaW5SYW5nZSIsImlzQmV0d2VlbiIsImlzRGlzYWJsZWQiLCJjdXJzb3IiLCJkaXNhYmxlZCIsIlR4bENhbGVuZGFyIiwiYXJncyIsInN0YXRlIiwic2V0U3RhdGUiLCJvbkhvdmVyVXBkYXRlIiwib25EYXRlQ2xpY2siLCJvdXRPZlJhbmdlVG9vbHRpcCIsIm1vbnRoU3RhcnQiLCJkYXlzQXJyIiwiY2FsZW5kYXIiLCJ0YWJsZSIsIm1vbnRoSGVhZGVyIiwid2Vla2RheXNNaW4iLCJpbmRleCIsImRheUhlYWRlciIsIl9vbkhvdmVyVXBkYXRlIiwid2VlayIsIndlZWtTdGFydEluZGV4IiwiY3VycmVudFdlZWsiLCJzbGljZSIsImRheUlzSW5Cb3VuZHMiLCJkYXRlQ2xpY2tIYW5kbGVyIiwiX29uRGF0ZUNsaWNrIiwiZGF5RWwiLCJDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJpc1JlcXVpcmVkIiwiZnVuYyIsIm5vZGUiLCJkZWZhdWx0UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7OztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsaUJBQWlCLFlBQXZCO0FBQ0EsSUFBTUMsWUFBWSxDQUFsQjs7QUFFQSxTQUFTQyxtQkFBVCxDQUE2QkMsSUFBN0IsRUFBbUM7QUFDakMsTUFBTUMsV0FBV0QsS0FBS0UsR0FBTCxFQUFqQjtBQUNBLE1BQU1DLGVBQWVILEtBQUtJLFdBQUwsRUFBckI7QUFDQSxNQUFNQyxvQkFBb0JKLFdBQVdFLFlBQXJDO0FBQ0EsU0FBT0csS0FBS0MsSUFBTCxDQUFVRixvQkFBb0IsQ0FBOUIsQ0FBUDtBQUNEOztBQUVELFNBQVNHLFlBQVQsQ0FBc0JSLElBQXRCLEVBQTRCO0FBQzFCLE1BQU1TLGdCQUFnQlQsS0FBS0UsR0FBTCxFQUF0QixDQUQwQixDQUNRO0FBQ2xDLE1BQU1RLGNBQWNWLEtBQUtJLFdBQUwsTUFBc0JLLGdCQUFnQixDQUF0QyxDQUFwQixDQUYwQixDQUVvQzs7QUFFOUQsU0FBTyxxQkFBTSxDQUFOLEVBQVMsSUFBSVgsU0FBYixFQUF3QmEsR0FBeEIsQ0FBNEIsVUFBQ0MsR0FBRCxFQUFTO0FBQzFDLFFBQUlBLE9BQU9ILGFBQVAsSUFBd0JHLE9BQU9GLFdBQW5DLEVBQWdEO0FBQzlDLGFBQU8sc0JBQU9WLElBQVAsRUFBYWEsR0FBYixDQUFpQkQsTUFBTUgsYUFBdkIsRUFBc0MsS0FBdEMsQ0FBUDtBQUNEO0FBQ0QsV0FBTyxFQUFQO0FBQ0QsR0FMTSxDQUFQO0FBTUQ7O0FBRUQsU0FBU0ssVUFBVCxD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QTFDLENBQU47QUFBQSx1QkFIaEI7QUFJRSw2QkFBT2UsY0FBY2YsR0FBZCxFQUFtQmdCLFdBQW5CO0FBSlQ7QUFNR2dEO0FBTkgsbUJBREY7QUFVRCxpQkFuREE7QUFESCxlQURGO0FBd0RELGFBM0RBO0FBREg7QUF2QkY7QUFKRixPQURGO0FBNkZEOzs7RUEzSHNDLGdCQUFNQyxTOztrQkFBMUJ4QixXOzs7QUE4SHJCQSxZQUFZeUIsU0FBWixHQUF3QjtBQUN0QnBFLFFBQU0sb0JBQWFBLElBQWIsQ0FBa0JxRSxVQURGO0FBRXRCckIsZUFBYSxpQkFBVXNCLElBRkQ7QUFHdEJ2QixpQkFBZSxpQkFBVXVCLElBSEg7QUFJdEJyQixxQkFBbUIsaUJBQVVzQixJQUpQO0FBS3RCM0MsWUFBVSxvQkFBYTVCLElBTEQ7QUFNdEI2QixvQkFBa0Isb0JBQWE3QixJQU5UO0FBT3RCOEIsY0FBWSxvQkFBYTlCLElBUEg7QUFRdEIrQixzQkFBb0Isb0JBQWEvQjtBQVJYLENBQXhCOztBQVdBMkMsWUFBWTZCLFlBQVosR0FBMkI7QUFDekJ4Qix5QkFEeUI7QUFFekJEO0FBRnlCLENBQTNCOzs7Ozs7OztnQ0F2Tk1sRCxjOztnQ0FDQUMsUzs7Z0NBRUdDLG1COztnQ0FPQVMsWTs7Z0NBWUFNLFU7O2dDQU1IRSxPOztnQ0FFR0MsYTs7Z0NBY0FTLFk7O2dDQWtDWWlCLFciLCJmaWxlIjoiX0NhbGVuZGFyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcbmltcG9ydCBtZW1vaXplIGZyb20gJ2xvZGFzaC9tZW1vaXplJztcbmltcG9ydCByYW5nZSBmcm9tICdsb2Rhc2gvcmFuZ2UnO1xuXG5pbXBvcnQgVHhsUHJvcFR5cGVzIGZyb20gJy4uL3V0aWxzL3Byb3BUeXBlcyc7XG5pbXBvcnQgeyBjb21iaW5lU3R5bGVzIH0gZnJvbSAnLi4vc3R5bGVzL2hlbHBlcnMnO1xuaW1wb3J0IHsgYXV0b2JpbmQsIE5PT1AgfSBmcm9tICcuLi9iYXNlL0Jhc2UnO1xuaW1wb3J0IHsgaXNEYXRlV2l0aGluUmFuZ2UgfSBmcm9tICcuL19DYWxlbmRhclV0aWxzJztcbmltcG9ydCBTVFlMRVMgZnJvbSAnLi9fQ2FsZW5kYXIuc3R5bGUnO1xuaW1wb3J0IEN1cnNvclRvb2x0aXBUYXJnZXQgZnJvbSAnLi4vX3Rvb2x0aXBzL0N1cnNvclRvb2x0aXBUYXJnZXQnO1xuXG5jb25zdCBDT01QQVJFX0ZPUk1BVCA9ICdNTS1ERC1ZWVlZJztcbmNvbnN0IFdFRUtfUk9XUyA9IDY7XG5cbmZ1bmN0aW9uIGdldE51bWJlck9mV2Vla1Jvd3MoZGF0ZSkge1xuICBjb25zdCBmaXJzdERheSA9IGRhdGUuZGF5KCk7XG4gIGNvbnN0IGRhdGVzSW5Nb250aCA9IGRhdGUuZGF5c0luTW9udGgoKTtcbiAgY29uc3QgbnVtYmVyT2ZUb3RhbENlbGwgPSBmaXJzdERheSArIGRhdGVzSW5Nb250aDtcbiAgcmV0dXJuIE1hdGguY2VpbChudW1iZXJPZlRvdGFsQ2VsbCAvIDcpO1xufVxuXG5mdW5jdGlvbiBkYXlzRm9yTW9udGgoZGF0ZSkge1xuICBjb25zdCBzdGFydERheUluZGV4ID0gZGF0ZS5kYXkoKTsgLy8gemVyby1iYXNlZFxuICBjb25zdCBlbmREYXlJbmRleCA9IGRhdGUuZGF5c0luTW9udGgoKSArIChzdGFydERheUluZGV4IC0gMSk7IC8vIC0xIHRvIG1ha2UgemVyby1iYXNlZFxuXG4gIHJldHVybiByYW5nZSgwLCA3ICogV0VFS19ST1dTKS5tYXAoKHZhbCkgPT4ge1xuICAgIGlmICh2YWwgPj0gc3RhcnREYXlJbmRleCAmJiB2YWwgPD0gZW5kRGF5SW5kZXgpIHtcbiAgICAgIHJldHVybiBtb21lbnQoZGF0ZSkuYWRkKHZhbCAtIHN0YXJ0RGF5SW5kZXgsICdkYXknKTtcbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gbWVtb2l6ZUtleShkYXRlKSB7XG4gIHJldHVybiBkYXRlLmZvcm1hdChDT01QQVJFX0ZPUk1BVCk7XG59XG5cbi8vIHJldHVybnMgYXJyYXkgb2YgZGF5cyBkaXNwbGF5ZWQgZm9yIGNhbGVuZGFyIG1vbnRoIGluY2x1ZGluZyB0cmFpbGluZ1xuLy8gYW5kIGxlYWRpbmcgZW1wdHkgZGF5cyBhcyBlbXB0eSBzdHJpbmdzIGUuZyBbJycsIC4uLiBNb21lbnQsIE1vbWVudCAsICcnXVxuY29uc3QgZ2V0RGF5cyA9IG1lbW9pemUoZGF5c0Zvck1vbnRoLCBtZW1vaXplS2V5KTtcblxuZnVuY3Rpb24gZ2V0Q2VsbFN0eWxlcyhkYXRlLCBob3ZlcmVkRGF0ZSkge1xuICBpZiAoIWRhdGUpIHtcbiAgICAvLyBuZWVkZWQgdG8ga2VlcCB0aGUgZW1wdHkgY2VsbHMgcGFkZGluZy1sZXNzIGFuZCBib3JkZXItYm94ZWRcbiAgICByZXR1cm4gU1RZTEVTLmNlbGwuYmFzZTtcbiAgfVxuICBjb25zdCBpc0N1cnJlbnREYXkgPSBkYXRlLmlzU2FtZShtb21lbnQoKSwgJ2RheScpO1xuICBjb25zdCBpc0hvdmVyRGF5ID0gISFob3ZlcmVkRGF0ZSAmJiBob3ZlcmVkRGF0ZS5pc1NhbWUoZGF0ZSwgJ2RheScpO1xuICByZXR1cm4gY29tYmluZVN0eWxlcyhcbiAgICBTVFlMRVMuY2VsbC5iYXNlLFxuICAgIGlzQ3VycmVudERheSAmJiBTVFlMRVMuY2VsbC5jdXJyZW50LFxuICAgIGlzSG92ZXJEYXkgJiYgU1RZTEVTLmNlbGwuaG92ZXJcbiAgKTtcbn1cblxuZnVuY3Rpb24gZ2V0RGF5U3R5bGVzKGRhdGUsIHByb3BzKSB7XG4gIGlmICghZGF0ZSkgeyByZXR1cm4gbnVsbDsgfVxuICBjb25zdCB7XG4gICAgcmFuZ2VFbmQsXG4gICAgcmFuZ2VFbmRCb3VuZGFyeSxcbiAgICByYW5nZVN0YXJ0LFxuICAgIHJhbmdlU3RhcnRCb3VuZGFyeSxcbiAgfSA9IHByb3BzO1xuXG4gIGNvbnN0IGJvdW5kYXJpZXNQcm92aWRlZCA9IHJhbmdlRW5kQm91bmRhcnkgfHwgcmFuZ2VTdGFydEJvdW5kYXJ5O1xuICAvLyB0aGVzZSBqdXN0IGRlZmF1bHQgdG8gJ3RvZGF5JyBpZiByYW5nZVN0YXJ0L0VuZCBhcmUgdW5kZWZpbmVkXG4gIGNvbnN0IHJhbmdlU3RhcnRWYWwgPSBtb21lbnQocmFuZ2VTdGFydCkuc3RhcnRPZignZGF5Jyk7XG4gIGNvbnN0IHJhbmdlRW5kVmFsID0gbW9tZW50KHJhbmdlRW5kKS5zdGFydE9mKCdkYXknKTtcbiAgY29uc3QgaXNSYW5nZVN0YXJ0ID0gcmFuZ2VTdGFydFZhbC5pc1NhbWUoZGF0ZSwgJ2RheScpO1xuICBjb25zdCBpc1JhbmdlRW5kID0gcmFuZ2VFbmRWYWwuaXNTYW1lKGRhdGUsICdkYXknKTtcbiAgY29uc3QgaW5SYW5nZSA9IGRhdGUuaXNCZXR3ZWVuKHJhbmdlU3RhcnRWYWwsIHJhbmdlRW5kVmFsLCBudWxsLCAnW10nKTtcbiAgLy8gRGlzYWJsZSBpZiBvdXRzaWRlIG9mIHByb3ZpZGVkIGJvdW5kYXJpZXNcbiAgY29uc3QgaXNEaXNhYmxlZCA9IGJvdW5kYXJpZXNQcm92aWRlZCAmJiAhaXNEYXRlV2l0aGluUmFuZ2UoXG4gICAgICBkYXRlLFxuICAgICAgcmFuZ2VTdGFydEJvdW5kYXJ5LFxuICAgICAgcmFuZ2VFbmRCb3VuZGFyeVxuICAgICk7XG5cbiAgcmV0dXJuIGNvbWJpbmVTdHlsZXMoXG4gICAgeyBjdXJzb3I6ICdwb2ludGVyJyB9LFxuICAgIFNUWUxFUy5kYXRlLmJhc2UsXG4gICAgaW5SYW5nZSAmJiBTVFlMRVMuZGF0ZS5pblJhbmdlLFxuICAgIGlzUmFuZ2VTdGFydCAmJiBTVFlMRVMuZGF0ZS5yYW5nZVN0YXJ0LFxuICAgIGlzUmFuZ2VFbmQgJiYgU1RZTEVTLmRhdGUucmFuZ2VFbmQsXG4gICAgaXNEaXNhYmxlZCAmJiBTVFlMRVMuZGF0ZS5kaXNhYmxlZFxuICApO1xufVxuXG5AUmFkaXVtXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBUeGxDYWxlbmRhciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIC8vIEBUT0RPIGFkZCBkcmFnIGZ1bmN0aW9uYWxpdHlcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgIHRoaXMuc3RhdGUgPSB7IGhvdmVyZWREYXRlOiAnJyB9O1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9vbkhvdmVyVXBkYXRlKGRhdGUpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgaG92ZXJlZERhdGU6IGRhdGUgfSk7XG4gICAgdGhpcy5wcm9wcy5vbkhvdmVyVXBkYXRlKHsgZGF0ZSB9KTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfb25EYXRlQ2xpY2soZGF0ZSkge1xuICAgIHRoaXMucHJvcHMub25EYXRlQ2xpY2soeyBkYXRlIH0pO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGRhdGUsXG4gICAgICBvdXRPZlJhbmdlVG9vbHRpcCxcbiAgICAgIHJhbmdlRW5kQm91bmRhcnksXG4gICAgICByYW5nZVN0YXJ0Qm91bmRhcnksXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgYm91bmRhcmllc1Byb3ZpZGVkID0gcmFuZ2VFbmRCb3VuZGFyeSAmJiByYW5nZVN0YXJ0Qm91bmRhcnk7XG4gICAgY29uc3QgbW9udGhTdGFydCA9IG1vbWVudChkYXRlKS5zdGFydE9mKCdtb250aCcpO1xuICAgIGNvbnN0IGRheXNBcnIgPSBnZXREYXlzKG1vbnRoU3RhcnQpO1xuICAgIGNvbnN0IHsgaG92ZXJlZERhdGUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBkYXRhLWNvbXBvbmVudD1cIlR4bENhbGVuZGFyXCJcbiAgICAgICAgc3R5bGU9e1NUWUxFUy5jYWxlbmRhcn1cbiAgICAgID5cbiAgICAgICAgPHRhYmxlXG4gICAgICAgICAgc3R5bGU9e1NUWUxFUy50YWJsZX1cbiAgICAgICAgPlxuICAgICAgICAgIDx0aGVhZD5cbiAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAgPHRoXG4gICAgICAgICAgICAgICAgc3R5bGU9e1NUWUxFUy5tb250aEhlYWRlcn1cbiAgICAgICAgICAgICAgICBjb2xTcGFuPVwiN1wiXG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7bW9udGhTdGFydC5mb3JtYXQoJ01NTU0gWVlZWScpfVxuICAgICAgICAgICAgICA8L3RoPlxuICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICAgIDx0cj5cbiAgICAgICAgICAgICAge21vbWVudC53ZWVrZGF5c01pbigpLm1hcCgoZGF5LCBpbmRleCkgPT4gKFxuICAgICAgICAgICAgICAgIDx0aFxuICAgICAgICAgICAgICAgICAgc3R5bGU9e1NUWUxFUy5kYXlIZWFkZXJ9XG4gICAgICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIHtkYXl9XG4gICAgICAgICAgICAgICAgPC90aD5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgICAgPC90cj5cbiAgICAgICAgICA8L3RoZWFkPlxuICAgICAgICAgIDx0Ym9keSBvbk1vdXNlTGVhdmU9eygpID0+IHRoaXMuX29uSG92ZXJVcGRhdGUoJycpfT5cbiAgICAgICAgICAgIHtyYW5nZShnZXROdW1iZXJPZldlZWtSb3dzKG1vbnRoU3RhcnQpKS5tYXAoKHdlZWspID0+IHtcbiAgICAgICAgICAgICAgY29uc3Qgd2Vla1N0YXJ0SW5kZXggPSA3ICogd2VlaztcbiAgICAgICAgICAgICAgY29uc3QgY3VycmVudFdlZWsgPSBkYXlzQXJyLnNsaWNlKHdlZWtTdGFydEluZGV4LCB3ZWVrU3RhcnRJbmRleCArIDcpO1xuICAgICAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgICAgIDx0ciBrZXk9e3dlZWt9PlxuICAgICAgICAgICAgICAgICAge2N1cnJlbnRXZWVrLm1hcCgoZGF5LCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgKiBAVE9ETyBwdWxsIHRoaXMgbG9naWMgb3V0IG9mIHJlbmRlcigpIG1ldGhvZCwgcHJvYmFibHkgaW50byBpdHNcbiAgICAgICAgICAgICAgICAgICAqIG93biBjb21wb25lbnQsIGUuZy4sICdEYXRhQ2VsbCdcbiAgICAgICAgICAgICAgICAgICAqIGh0dHBzOi8vamlyYS5jb3JwLnR1bmUuY29tL2Jyb3dzZS9UWExFTkctMTUzXG4gICAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGF5SXNJbkJvdW5kcyA9ICEhZGF5ICYmIChcbiAgICAgICAgICAgICAgICAgICAgICAvLyBubyBib3VuZGFyaWVzIHByb3ZpZGVkIGlzIHNhbWUgYXMgJ2luIGJvdW5kcycgZm9yIHRoZXNlIHB1cnBvc2VzXG4gICAgICAgICAgICAgICAgICAgICAgKC8vIGJvdW5kYXJpZXMgcHJvdmlkZWQsIGNoZWNrIHJhbmdlXG4gICAgICAgICAgICAgICAgICAgICAgKCFib3VuZGFyaWVzUHJvdmlkZWQgfHwgaXNEYXRlV2l0aGluUmFuZ2UoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGRheSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmFuZ2VTdGFydEJvdW5kYXJ5LFxuICAgICAgICAgICAgICAgICAgICAgICAgICByYW5nZUVuZEJvdW5kYXJ5XG4gICAgICAgICAgICAgICAgICAgICAgICApKSlcbiAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlQ2xpY2tIYW5kbGVyID0gZGF5SXNJbkJvdW5kcyA/ICgpID0+IHRoaXMuX29uRGF0ZUNsaWNrKGRheSkgOiBOT09QO1xuXG4gICAgICAgICAgICAgICAgICAvLyBpbml0IGVtcHR5L3BsYWNlaG9sZGVyIGNlbGxcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRheUVsID0gPHNwYW4gc3R5bGU9e1NUWUxFUy5kYXRlLmJhc2V9IC8+O1xuICAgICAgICAgICAgICAgICAgICBpZiAoZGF5KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEFjdGl2ZSBvciBkaXNhYmxlZCBkYXlcbiAgICAgICAgICAgICAgICAgICAgICBkYXlFbCA9IChcbiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2RhdGVDbGlja0hhbmRsZXJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXtnZXREYXlTdHlsZXMoZGF5LCB0aGlzLnByb3BzKX1cbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge2RheS5mb3JtYXQoJ0QnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gd3JhcCBkaXNhYmxlZCBkYXkgaW4gdG9vbHRpcCwgaWYgYXBwbGljYWJsZVxuICAgICAgICAgICAgICAgICAgICAgIGlmICghZGF5SXNJbkJvdW5kcyAmJiBvdXRPZlJhbmdlVG9vbHRpcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF5RWwgPSAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxDdXJzb3JUb29sdGlwVGFyZ2V0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZT17b3V0T2ZSYW5nZVRvb2x0aXB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7ZGF5RWx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvQ3Vyc29yVG9vbHRpcFRhcmdldD5cbiAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgPHRkXG4gICAgICAgICAgICAgICAgICAgICAgICBkYXRhLWRheT17ZGF5IHx8IDB9XG4gICAgICAgICAgICAgICAgICAgICAgICBrZXk9e2luZGV4fVxuICAgICAgICAgICAgICAgICAgICAgICAgb25Nb3VzZUVudGVyPXsoKSA9PiB0aGlzLl9vbkhvdmVyVXBkYXRlKGRheUlzSW5Cb3VuZHMgPyBkYXkgOiAnJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT17Z2V0Q2VsbFN0eWxlcyhkYXksIGhvdmVyZWREYXRlKX1cbiAgICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAgICB7ZGF5RWx9XG4gICAgICAgICAgICAgICAgICAgICAgPC90ZD5cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgIDwvdHI+XG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KX1cbiAgICAgICAgICA8L3Rib2R5PlxuICAgICAgICA8L3RhYmxlPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5UeGxDYWxlbmRhci5wcm9wVHlwZXMgPSB7XG4gIGRhdGU6IFR4bFByb3BUeXBlcy5kYXRlLmlzUmVxdWlyZWQsXG4gIG9uRGF0ZUNsaWNrOiBQcm9wVHlwZXMuZnVuYyxcbiAgb25Ib3ZlclVwZGF0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gIG91dE9mUmFuZ2VUb29sdGlwOiBQcm9wVHlwZXMubm9kZSxcbiAgcmFuZ2VFbmQ6IFR4bFByb3BUeXBlcy5kYXRlLFxuICByYW5nZUVuZEJvdW5kYXJ5OiBUeGxQcm9wVHlwZXMuZGF0ZSxcbiAgcmFuZ2VTdGFydDogVHhsUHJvcFR5cGVzLmRhdGUsXG4gIHJhbmdlU3RhcnRCb3VuZGFyeTogVHhsUHJvcFR5cGVzLmRhdGUsXG59O1xuXG5UeGxDYWxlbmRhci5kZWZhdWx0UHJvcHMgPSB7XG4gIG9uRGF0ZUNsaWNrOiBOT09QLFxuICBvbkhvdmVyVXBkYXRlOiBOT09QLFxufTtcbiJdfQ==