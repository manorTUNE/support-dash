'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _ReactUtils = require('../ReactUtils');

var _Base = require('../base/Base');

var _StyleRoot = require('../styles/StyleRoot');

var _StyleRoot2 = _interopRequireDefault(_StyleRoot);

var _TooltipContent = require('./_TooltipContent');

var _TooltipContent2 = _interopRequireDefault(_TooltipContent);

var _Positioner = require('./_Positioner');

var _Positioner2 = _interopRequireDefault(_Positioner);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

// @TODO: Import window.requestAnimationFrame instead of referencing it inline

// @TODO Maybe:
// If you happen to scroll the window while still hovering over a thing
// it will maintain the older incorrect positioning since this wont fire
// a second time, consider adding resize/scroll handlers to recalculate

// @TODO: Animate in and out of existence

var TxlCursorTooltipTarget = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlCursorTooltipTarget, _React$Component);

  function TxlCursorTooltipTarget() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlCursorTooltipTarget);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlCursorTooltipTarget.__proto__ || (0, _getPrototypeOf2.default)(TxlCursorTooltipTarget)).call.apply(_ref, [this].concat(args)));

    _this._yCoordMargin = 15;
    _this._yCoordCache = null;
    _this._xCoordCache = null;
    _this._positionableTooltip = null;
    _this._tooltip = null;
    _this._bootstrapped = false;
    _this._renderRequired = false;
    return _this;
  }

  (0, _createClass3.default)(TxlCursorTooltipTarget, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (this.props.message !== nextProps.message) {
        this._renderRequired = true;
      }
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      if (!this._renderRequired || !this._bootstrapped) {
        return;
      }

      this._renderTooltip();
      window.requestAnimationFrame(this._handleTooltipContentUpdate);
      this._positionToCoordinates(this._yCoordCache, this._xCoordCache);
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      this._teardownTooltip();
    }
  }, {
    key: '_bootstrapTooltip',
    value: function _bootstrapTooltip() {
      this._bootstrapped = true;
      this._createTooltip();
      this._renderTooltip();
      this._positionableTooltip = new _Positioner2.default(this._tooltip);
    }
  }, {
    key: '_teardownTooltip',
    value: function _teardownTooltip() {
      if (this._bootstrapped) {
        (0, _ReactUtils.unmountComponentAtNode)(this._tooltip);
        document.querySelector('body').removeChild(this._tooltip);
      }

      this._bootstrapped = false;
    }
  }, {
    key: '_createTooltip',
    value: function _createTooltip() {
      var tooltipContainer = document.createElement('div');
      tooltipContainer.setAttribute('data-component', 'TxlCursorTooltip');

      if (this.props.id) {
        tooltipContainer.id = this.props.id;
      }

      this._tooltip = tooltipContainer;
      // @NOTE: Body could be cached as an optimization
      document.querySelector('body').appendChild(this._tooltip);
    }
  }, {
    key: '_renderTooltip',
    value: function _renderTooltip() {
      var tooltipContents = _react2.default.createElement(
        _StyleRoot2.default,
        null,
        _react2.default.createElement(_TooltipContent2.default, { message: this.props.message })
      );

      (0, _ReactUtils.render)(tooltipContents, this._tooltip);
    }
  }, {
    key: '_handleTooltipContentUpdate',
    value: function _handleTooltipContentUpdate() {
      this._positionableTooltip.updatePositioningData();
    }
  }, {
    key: '_handleMouseEnter',
    value: function _handleMouseEnter() {
      if (this._bootstrapped) {
        return;
      }

      this._bootstrapTooltip();
    }
  }, {
    key: '_handleMouseLeave',
    value: function _handleMouseLeave() {
      this._teardownTooltip();
    }
  }, {
    key: '_handleMouseMove',
    value: function _handleMouseMove(e) {
      if (!this._bootstrapped) {
        this._bootstrapTooltip();
      }

      this._yCoordCache = e.clientY - this._yCoordMargin;
      this._xCoordCache = e.clientX;

      this._positionToCoordinates(this._yCoordCache, this._xCoordCache);
    }
  }, {
    key: '_positionToCoordinates',
    value: function _positionToCoordinates(y, x) {
      var _this2 = this;

      window.requestAnimationFrame(function () {
        _this2._positionableTooltip.positionOverlayToCoords(x, y);
      });
    }
  }, {
    key: 'render',
    value: function render() {
      return _react2.default.createElement(
        'div',
        {
          'data-component': 'TxlCursorTooltipTarget',
          style: this.props.style,
          onMouseMoveCapture: this._handleMouseMove,
          onMouseEnter: this._handleMouseEnter,
          onMouseLeave: this._handleMouseLeave
        },
        this.props.children
      );
    }
  }]);
  return TxlCursorTooltipTarget;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_bootstrapTooltip', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_bootstrapTooltip'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_teardownTooltip', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_teardownTooltip'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_createTooltip', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_createTooltip'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderTooltip', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderTooltip'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleTooltipContentUpdate', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleTooltipContentUpdate'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleMouseEnter', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleMouseEnter'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleMouseLeave', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleMouseLeave'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleMouseMove', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleMouseMove'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_positionToCoordinates', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_positionToCoordinates'), _class2.prototype)), _class2)) || _class;

exports.default = TxlCursorTooltipTarget;


TxlCursorTooltipTarget.propTypes = {
  children: _react.PropTypes.node,
  id: _react.PropTypes.string,
  message: _react.PropTypes.node.isRequired,
  style: _react.PropTypes.object
};
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(TxlCursorTooltipTarget, 'TxlCursorTooltipTarget', 'src/_tooltips/CursorTooltipTarget.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9fdG9vbHRpcHMvQ3Vyc29yVG9vbHRpcFRhcmdldC5qc3giXSwibmFtZXMiOlsiVHhsQ3Vyc29yVG9vbHRpcFRhcmdldCIsImFyZ3MiLCJfeUNvb3JkTWFyZ2luIiwiX3lDb29yZENhY2hlIiwiX3hDb29yZENhY2hlIiwiX3Bvc2l0aW9uYWJsZVRvb2x0aXAiLCJfdG9vbHRpcCIsIl9ib290c3RyYXBwZWQiLCJfcmVuZGVyUmVxdWlyZWQiLCJuZXh0UHJvcHMiLCJwcm9wcyIsIm1lc3NhZ2UiLCJfcmVuZGVyVG9vbHRpcCIsIndpbmRvdyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIl9oYW5kbGVUb29sdGlwQ29udGVudFVwZGF0ZSIsIl9wb3NpdGlvblRvQ29vcmRpbmF0ZXMiLCJfdGVhcmRvd25Ub29sdGlwIiwiX2NyZWF0ZVRvb2x0aXAiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJyZW1vdmVDaGlsZCIsInRvb2x0aXBDb250YWluZXIiLCJjcmVhdGVFbGVtZW50Iiwic2V0QXR0cmlidXRlIiwiaWQiLCJhcHBlbmRDaGlsZCIsInRvb2x0aXBDb250ZW50cyIsInVwZGF0ZVBvc2l0aW9uaW5nRGF0YSIsIl9ib290c3RyYXBUb29sdGlwIiwiZSIsImNsaWVudFkiLCJjbGllbnRYIiwieSIsIngiLCJwb3NpdGlvbk92ZXJsYXlUb0Nvb3JkcyIsInN0eWxlIiwiX2hhbmRsZU1vdXNlTW92ZSIsIl9oYW5kbGVNb3VzZUVudGVyIiwiX2hhbmRsZU1vdXNlTGVhdmUiLCJjaGlsZHJlbiIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIm5vZGUiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwib2JqZWN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUNBOzs7O0FBRUE7O0FBSUE7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVB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T0MscUJBQVAsQ0FBNkIsWUFBTTtBQUNqQyxlQUFLVCxvQkFBTCxDQUEwQjhCLHVCQUExQixDQUFrREQsQ0FBbEQsRUFBcURELENBQXJEO0FBQ0QsT0FGRDtBQUdEOzs7NkJBRVE7QUFDUCxhQUNFO0FBQUE7QUFBQTtBQUNFLDRCQUFlLHdCQURqQjtBQUVFLGlCQUFPLEtBQUt2QixLQUFMLENBQVcwQixLQUZwQjtBQUdFLDhCQUFvQixLQUFLQyxnQkFIM0I7QUFJRSx3QkFBYyxLQUFLQyxpQkFKckI7QUFLRSx3QkFBYyxLQUFLQztBQUxyQjtBQU9HLGFBQUs3QixLQUFMLENBQVc4QjtBQVBkLE9BREY7QUFXRDs7O0VBMUhpRCxnQkFBTUMsUzs7a0JBQXJDekMsc0I7OztBQTZIckJBLHVCQUF1QjBDLFNBQXZCLEdBQW1DO0FBQ2pDRixZQUFVLGlCQUFVRyxJQURhO0FBRWpDbEIsTUFBSSxpQkFBVW1CLE1BRm1CO0FBR2pDakMsV0FBUyxpQkFBVWdDLElBQVYsQ0FBZUUsVUFIUztBQUlqQ1QsU0FBTyxpQkFBVVU7QUFKZ0IsQ0FBbkM7Ozs7Ozs7O2dDQTdIcUI5QyxzQiIsImZpbGUiOiJDdXJzb3JUb29sdGlwVGFyZ2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcblxuaW1wb3J0IHtcbiAgcmVuZGVyIGFzIHJlYWN0UmVuZGVyLFxuICB1bm1vdW50Q29tcG9uZW50QXROb2RlLFxufSBmcm9tICcuLi9SZWFjdFV0aWxzJztcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vYmFzZS9CYXNlJztcbmltcG9ydCBTdHlsZVJvb3QgZnJvbSAnLi4vc3R5bGVzL1N0eWxlUm9vdCc7XG5pbXBvcnQgVG9vbHRpcENvbnRlbnQgZnJvbSAnLi9fVG9vbHRpcENvbnRlbnQnO1xuaW1wb3J0IFBvc2l0aW9uZXIgZnJvbSAnLi9fUG9zaXRpb25lcic7XG5cbi8vIEBUT0RPOiBJbXBvcnQgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSBpbnN0ZWFkIG9mIHJlZmVyZW5jaW5nIGl0IGlubGluZVxuXG4vLyBAVE9ETyBNYXliZTpcbi8vIElmIHlvdSBoYXBwZW4gdG8gc2Nyb2xsIHRoZSB3aW5kb3cgd2hpbGUgc3RpbGwgaG92ZXJpbmcgb3ZlciBhIHRoaW5nXG4vLyBpdCB3aWxsIG1haW50YWluIHRoZSBvbGRlciBpbmNvcnJlY3QgcG9zaXRpb25pbmcgc2luY2UgdGhpcyB3b250IGZpcmVcbi8vIGEgc2Vjb25kIHRpbWUsIGNvbnNpZGVyIGFkZGluZyByZXNpemUvc2Nyb2xsIGhhbmRsZXJzIHRvIHJlY2FsY3VsYXRlXG5cbi8vIEBUT0RPOiBBbmltYXRlIGluIGFuZCBvdXQgb2YgZXhpc3RlbmNlXG5cbkBSYWRpdW1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFR4bEN1cnNvclRvb2x0aXBUYXJnZXQgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG5cbiAgICB0aGlzLl95Q29vcmRNYXJnaW4gPSAxNTtcbiAgICB0aGlzLl95Q29vcmRDYWNoZSA9IG51bGw7XG4gICAgdGhpcy5feENvb3JkQ2FjaGUgPSBudWxsO1xuICAgIHRoaXMuX3Bvc2l0aW9uYWJsZVRvb2x0aXAgPSBudWxsO1xuICAgIHRoaXMuX3Rvb2x0aXAgPSBudWxsO1xuICAgIHRoaXMuX2Jvb3RzdHJhcHBlZCA9IGZhbHNlO1xuICAgIHRoaXMuX3JlbmRlclJlcXVpcmVkID0gZmFsc2U7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzLm1lc3NhZ2UgIT09IG5leHRQcm9wcy5tZXNzYWdlKSB7XG4gICAgICB0aGlzLl9yZW5kZXJSZXF1aXJlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIGlmICghdGhpcy5fcmVuZGVyUmVxdWlyZWQgfHwgIXRoaXMuX2Jvb3RzdHJhcHBlZCkgeyByZXR1cm47IH1cblxuICAgIHRoaXMuX3JlbmRlclRvb2x0aXAoKTtcbiAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMuX2hhbmRsZVRvb2x0aXBDb250ZW50VXBkYXRlKTtcbiAgICB0aGlzLl9wb3NpdGlvblRvQ29vcmRpbmF0ZXModGhpcy5feUNvb3JkQ2FjaGUsIHRoaXMuX3hDb29yZENhY2hlKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHRoaXMuX3RlYXJkb3duVG9vbHRpcCgpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9ib290c3RyYXBUb29sdGlwKCkge1xuICAgIHRoaXMuX2Jvb3RzdHJhcHBlZCA9IHRydWU7XG4gICAgdGhpcy5fY3JlYXRlVG9vbHRpcCgpO1xuICAgIHRoaXMuX3JlbmRlclRvb2x0aXAoKTtcbiAgICB0aGlzLl9wb3NpdGlvbmFibGVUb29sdGlwID0gbmV3IFBvc2l0aW9uZXIodGhpcy5fdG9vbHRpcCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3RlYXJkb3duVG9vbHRpcCgpIHtcbiAgICBpZiAodGhpcy5fYm9vdHN0cmFwcGVkKSB7XG4gICAgICB1bm1vdW50Q29tcG9uZW50QXROb2RlKHRoaXMuX3Rvb2x0aXApO1xuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpLnJlbW92ZUNoaWxkKHRoaXMuX3Rvb2x0aXApO1xuICAgIH1cblxuICAgIHRoaXMuX2Jvb3RzdHJhcHBlZCA9IGZhbHNlO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9jcmVhdGVUb29sdGlwKCkge1xuICAgIGNvbnN0IHRvb2x0aXBDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0b29sdGlwQ29udGFpbmVyLnNldEF0dHJpYnV0ZSgnZGF0YS1jb21wb25lbnQnLCAnVHhsQ3Vyc29yVG9vbHRpcCcpO1xuXG4gICAgaWYgKHRoaXMucHJvcHMuaWQpIHtcbiAgICAgIHRvb2x0aXBDb250YWluZXIuaWQgPSB0aGlzLnByb3BzLmlkO1xuICAgIH1cblxuICAgIHRoaXMuX3Rvb2x0aXAgPSB0b29sdGlwQ29udGFpbmVyO1xuICAgIC8vIEBOT1RFOiBCb2R5IGNvdWxkIGJlIGNhY2hlZCBhcyBhbiBvcHRpbWl6YXRpb25cbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5JykuYXBwZW5kQ2hpbGQodGhpcy5fdG9vbHRpcCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlclRvb2x0aXAoKSB7XG4gICAgY29uc3QgdG9vbHRpcENvbnRlbnRzID0gKFxuICAgICAgPFN0eWxlUm9vdD5cbiAgICAgICAgPFRvb2x0aXBDb250ZW50IG1lc3NhZ2U9e3RoaXMucHJvcHMubWVzc2FnZX0gLz5cbiAgICAgIDwvU3R5bGVSb290PlxuICAgICk7XG5cbiAgICByZWFjdFJlbmRlcih0b29sdGlwQ29udGVudHMsIHRoaXMuX3Rvb2x0aXApO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVUb29sdGlwQ29udGVudFVwZGF0ZSgpIHtcbiAgICB0aGlzLl9wb3NpdGlvbmFibGVUb29sdGlwLnVwZGF0ZVBvc2l0aW9uaW5nRGF0YSgpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVNb3VzZUVudGVyKCkge1xuICAgIGlmICh0aGlzLl9ib290c3RyYXBwZWQpIHsgcmV0dXJuOyB9XG5cbiAgICB0aGlzLl9ib290c3RyYXBUb29sdGlwKCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZU1vdXNlTGVhdmUoKSB7XG4gICAgdGhpcy5fdGVhcmRvd25Ub29sdGlwKCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZU1vdXNlTW92ZShlKSB7XG4gICAgaWYgKCF0aGlzLl9ib290c3RyYXBwZWQpIHtcbiAgICAgIHRoaXMuX2Jvb3RzdHJhcFRvb2x0aXAoKTtcbiAgICB9XG5cbiAgICB0aGlzLl95Q29vcmRDYWNoZSA9IGUuY2xpZW50WSAtIHRoaXMuX3lDb29yZE1hcmdpbjtcbiAgICB0aGlzLl94Q29vcmRDYWNoZSA9IGUuY2xpZW50WDtcblxuICAgIHRoaXMuX3Bvc2l0aW9uVG9Db29yZGluYXRlcyh0aGlzLl95Q29vcmRDYWNoZSwgdGhpcy5feENvb3JkQ2FjaGUpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9wb3NpdGlvblRvQ29vcmRpbmF0ZXMoeSwgeCkge1xuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgdGhpcy5fcG9zaXRpb25hYmxlVG9vbHRpcC5wb3NpdGlvbk92ZXJsYXlUb0Nvb3Jkcyh4LCB5KTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBkYXRhLWNvbXBvbmVudD1cIlR4bEN1cnNvclRvb2x0aXBUYXJnZXRcIlxuICAgICAgICBzdHlsZT17dGhpcy5wcm9wcy5zdHlsZX1cbiAgICAgICAgb25Nb3VzZU1vdmVDYXB0dXJlPXt0aGlzLl9oYW5kbGVNb3VzZU1vdmV9XG4gICAgICAgIG9uTW91c2VFbnRlcj17dGhpcy5faGFuZGxlTW91c2VFbnRlcn1cbiAgICAgICAgb25Nb3VzZUxlYXZlPXt0aGlzLl9oYW5kbGVNb3VzZUxlYXZlfVxuICAgICAgPlxuICAgICAgICB7dGhpcy5wcm9wcy5jaGlsZHJlbn1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuVHhsQ3Vyc29yVG9vbHRpcFRhcmdldC5wcm9wVHlwZXMgPSB7XG4gIGNoaWxkcmVuOiBQcm9wVHlwZXMubm9kZSxcbiAgaWQ6IFByb3BUeXBlcy5zdHJpbmcsXG4gIG1lc3NhZ2U6IFByb3BUeXBlcy5ub2RlLmlzUmVxdWlyZWQsXG4gIHN0eWxlOiBQcm9wVHlwZXMub2JqZWN0LFxufTtcbiJdfQ==