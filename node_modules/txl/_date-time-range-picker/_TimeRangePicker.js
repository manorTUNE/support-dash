'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.DATE_QUERY_FORMAT = exports.TIME_QUERY_FORMAT = exports.TIME_DISPLAY_FORMAT = exports.TIME_RANGE_FORMAT = exports.TIME_DISPLAY_FORMAT_SIMPLIFIED = exports.TIME_RANGE_FORMAT_SIMPLIFIED = undefined;

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _Base = require('../base/Base');

var _DateTimeRangePicker = require('./DateTimeRangePicker.style');

var _theme = require('../styles/theme');

var _EditOutline = require('../icons/EditOutline');

var _EditOutline2 = _interopRequireDefault(_EditOutline);

var _Modal = require('../modals/Modal');

var _Modal2 = _interopRequireDefault(_Modal);

var _Button = require('../buttons/Button');

var _Button2 = _interopRequireDefault(_Button);

var _SingleSelect = require('../dropdowns/_SingleSelect');

var _SingleSelect2 = _interopRequireDefault(_SingleSelect);

var _Checkbox = require('../input-fields/Checkbox');

var _Checkbox2 = _interopRequireDefault(_Checkbox);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var TIME_RANGE_FORMAT_SIMPLIFIED = 'h:mma';
var TIME_DISPLAY_FORMAT_SIMPLIFIED = 'h:mma (MMM D)';
var TIME_RANGE_FORMAT = 'h:mm:ssa';
var TIME_DISPLAY_FORMAT = 'h:mm:ssa (MMM D)';
var TIME_QUERY_FORMAT = 'HH:mm:ss';
var DATE_QUERY_FORMAT = 'YYYY-MM-DD';

exports.TIME_RANGE_FORMAT_SIMPLIFIED = TIME_RANGE_FORMAT_SIMPLIFIED;
exports.TIME_DISPLAY_FORMAT_SIMPLIFIED = TIME_DISPLAY_FORMAT_SIMPLIFIED;
exports.TIME_RANGE_FORMAT = TIME_RANGE_FORMAT;
exports.TIME_DISPLAY_FORMAT = TIME_DISPLAY_FORMAT;
exports.TIME_QUERY_FORMAT = TIME_QUERY_FORMAT;
exports.DATE_QUERY_FORMAT = DATE_QUERY_FORMAT;

var TxlTimeRangePicker = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlTimeRangePicker, _React$Component);

  function TxlTimeRangePicker() {
    var _ref;

    var _temp, _this, _ret;

    (0, _classCallCheck3.default)(this, TxlTimeRangePicker);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return _ret = (_temp = (_this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlTimeRangePicker.__proto__ || (0, _getPrototypeOf2.default)(TxlTimeRangePicker)).call.apply(_ref, [this].concat(args))), _this), _this.state = {
      includeSeconds: false,
      openEndTime: false,
      openStartTime: false,
      showSeconds: false,
      timeRange: {
        endTime: {
          key: (0, _moment2.default)(_this.props.items.endDateTime).format(TIME_QUERY_FORMAT),
          value: (0, _moment2.default)(_this.props.items.endDateTime).format(TIME_RANGE_FORMAT_SIMPLIFIED)
        },
        startTime: {
          key: (0, _moment2.default)(_this.props.items.startDateTime).format(TIME_QUERY_FORMAT),
          value: (0, _moment2.default)(_this.props.items.startDateTime).format(TIME_RANGE_FORMAT_SIMPLIFIED)
        }
      }
    }, _temp), (0, _possibleConstructorReturn3.default)(_this, _ret);
  }

  (0, _createClass3.default)(TxlTimeRangePicker, [{
    key: '_toggleModal',
    value: function _toggleModal() {
      this.props.updateDropdown({ open: !this.props.open });
    }
  }, {
    key: '_handleSaveModal',
    value: function _handleSaveModal() {
      var _state = this.state,
          includeSeconds = _state.includeSeconds,
          timeRange = _state.timeRange;
      var _props = this.props,
          items = _props.items,
          onChange = _props.onChange;

      var startDate = (0, _moment2.default)(items.startDateTime).format(DATE_QUERY_FORMAT);
      var endDate = (0, _moment2.default)(items.endDateTime).format(DATE_QUERY_FORMAT);
      items.startDateTime = startDate + ' ' + timeRange.startTime.key;
      items.endDateTime = endDate + ' ' + timeRange.endTime.key;
      onChange(items);
      this._toggleModal();
      this.setState({ showSeconds: includeSeconds });
    }
  }, {
    key: '_handleCancelModal',
    value: function _handleCancelModal() {
      var items = this.props.items;
      var showSeconds = this.state.showSeconds;

      var rangeFormat = showSeconds ? TIME_RANGE_FORMAT : TIME_RANGE_FORMAT_SIMPLIFIED;

      var timeRange = {
        endTime: {
          key: (0, _moment2.default)(items.endDateTime).format(TIME_QUERY_FORMAT),
          value: (0, _moment2.default)(items.endDateTime).format(rangeFormat)
        },
        startTime: {
          key: (0, _moment2.default)(items.startDateTime).format(TIME_QUERY_FORMAT),
          value: (0, _moment2.default)(items.startDateTime).format(rangeFormat)
        }
      };
      this.setState({ timeRange: timeRange });
      this._toggleModal();
    }
  }, {
    key: '_handleTimeRangeChange',
    value: function _handleTimeRangeChange(type) {
      var _this2 = this;

      var timeRange = this.state.timeRange;


      return function (e) {
        _this2.setState({
          timeRange: {
            endTime: type === 'end' ? e.value : timeRange.endTime,
            startTime: type === 'start' ? e.value : timeRange.startTime
          }
        });
      };
    }
  }, {
    key: '_handleCustomTimeChange',
    value: function _handleCustomTimeChange(type) {
      var _this3 = this;

      var _state2 = this.state,
          includeSeconds = _state2.includeSeconds,
          timeRange = _state2.timeRange;

      var rangeFormat = includeSeconds ? TIME_RANGE_FORMAT : TIME_RANGE_FORMAT_SIMPLIFIED;

      return function (e) {
        var timeObj = {
          key: (0, _moment2.default)(e.value, rangeFormat).format(TIME_QUERY_FORMAT),
          value: (0, _moment2.default)(e.value, rangeFormat).format(rangeFormat)
        };
        _this3.setState({
          timeRange: {
            endTime: type === 'end' ? timeObj : timeRange.endTime,
            startTime: type === 'start' ? timeObj : timeRange.startTime
          }
        });
      };
    }
  }, {
    key: '_generateTimes',
    value: function _generateTimes() {
      var timeArray = [];
      var includeSeconds = this.state.includeSeconds;

      var startTime = (0, _moment2.default)().startOf('day');
      var endTime = (0, _moment2.default)().endOf('day');
      var rangeFormat = includeSeconds ? TIME_RANGE_FORMAT : TIME_RANGE_FORMAT_SIMPLIFIED;

      while ((0, _moment2.default)(startTime).isSameOrBefore(endTime)) {
        timeArray.push({
          key: (0, _moment2.default)(startTime).format(TIME_QUERY_FORMAT),
          value: (0, _moment2.default)(startTime).format(rangeFormat)
        });
        startTime = (0, _moment2.default)(startTime).add(30, 'minutes');
      }

      return timeArray;
    }
  }, {
    key: '_openDropdown',
    value: function _openDropdown(type) {
      var _this4 = this;

      return function () {
        _this4.setState({
          openEndTime: type === 'end',
          openStartTime: type === 'start'
        });
      };
    }
  }, {
    key: '_closeDropdown',
    value: function _closeDropdown(type) {
      var _this5 = this;

      return function () {
        _this5.setState({
          openEndTime: !type === 'end',
          openStartTime: !type === 'start'
        });
      };
    }
  }, {
    key: '_getTimeDisplayFormat',
    value: function _getTimeDisplayFormat() {
      var items = this.props.items;
      var showSeconds = this.state.showSeconds;

      var isSameDate = (0, _moment2.default)(items.startDateTime).isSame(items.endDateTime, 'date');
      var timeFormat = void 0;
      if (showSeconds) {
        timeFormat = isSameDate ? TIME_RANGE_FORMAT : TIME_DISPLAY_FORMAT;
      } else {
        timeFormat = isSameDate ? TIME_RANGE_FORMAT_SIMPLIFIED : TIME_DISPLAY_FORMAT_SIMPLIFIED;
      }

      return timeFormat;
    }
  }, {
    key: '_getTimeDisplay',
    value: function _getTimeDisplay() {
      var items = this.props.items;

      var timeFormat = this._getTimeDisplayFormat();
      var startTime = (0, _moment2.default)(items.startDateTime).format(timeFormat);
      var endTime = (0, _moment2.default)(items.endDateTime).format(timeFormat);
      var timeDisplay = startTime + ' to ' + endTime;
      return timeDisplay;
    }
  }, {
    key: '_handleSecondsCheck',
    value: function _handleSecondsCheck(obj) {
      this.setState({ includeSeconds: obj.checked });
    }
  }, {
    key: 'renderModal',
    value: function renderModal() {
      var _props2 = this.props,
          items = _props2.items,
          title = _props2.title;
      var _state3 = this.state,
          openEndTime = _state3.openEndTime,
          openStartTime = _state3.openStartTime,
          includeSeconds = _state3.includeSeconds,
          timeRange = _state3.timeRange;


      var modalContent = _react2.default.createElement(
        'div',
        null,
        _react2.default.createElement(
          'div',
          { style: _DateTimeRangePicker.CHECKBOX_STYLE },
          _react2.default.createElement(_Checkbox2.default, {
            checked: includeSeconds,
            labelText: 'Include seconds',
            name: 'includeSeconds',
            onChange: this._handleSecondsCheck,
            value: 'includeSeconds'
          })
        ),
        _react2.default.createElement(
          'div',
          { style: _DateTimeRangePicker.TIME_WRAPPER_STYLE },
          _react2.default.createElement(
            'div',
            { style: _DateTimeRangePicker.PICKER_WRAPPER_STYLE },
            _react2.default.createElement(_SingleSelect2.default, {
              closeDropdown: this._closeDropdown('start'),
              items: this._generateTimes(),
              label: 'Time range',
              onChange: this._handleTimeRangeChange('start'),
              onItemCreate: this._handleCustomTimeChange('start'),
              open: openStartTime,
              openDropdown: this._openDropdown('start'),
              secondaryText: (0, _moment2.default)(items.startDateTime).format('ll'),
              showCreateNew: true,
              value: timeRange.startTime
            })
          ),
          _react2.default.createElement(
            'div',
            { style: _DateTimeRangePicker.INPUT_SEPARATOR_STYLE },
            'to'
          ),
          _react2.default.createElement(
            'div',
            { style: _DateTimeRangePicker.PICKER_WRAPPER_STYLE },
            _react2.default.createElement(_SingleSelect2.default, {
              closeDropdown: this._closeDropdown('end'),
              items: this._generateTimes(),
              label: ' ',
              onChange: this._handleTimeRangeChange('end'),
              onItemCreate: this._handleCustomTimeChange('end'),
              open: openEndTime,
              openDropdown: this._openDropdown('end'),
              secondaryText: (0, _moment2.default)(items.endDateTime).format('ll'),
              showCreateNew: true,
              value: timeRange.endTime
            })
          )
        )
      );

      var modalFooter = _react2.default.createElement(
        'div',
        null,
        _react2.default.createElement(
          _Button2.default,
          {
            size: 'large',
            variant: 'accent',
            onClick: this._handleSaveModal
          },
          'Apply'
        ),
        _react2.default.createElement(
          _Button2.default,
          {
            size: 'large',
            variant: 'muted',
            onClick: this._handleCancelModal,
            _style: _DateTimeRangePicker.BUTTON
          },
          'Cancel'
        )
      );

      return _react2.default.createElement(
        _Modal2.default,
        {
          header: title,
          onDismiss: this._toggleModal,
          footer: modalFooter
        },
        modalContent
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var open = this.props.open;


      return _react2.default.createElement(
        'div',
        { 'data-component': 'TxlTimeRangePicker' },
        _react2.default.createElement(
          'div',
          { style: _DateTimeRangePicker.BUTTON_STYLE },
          _react2.default.createElement(
            'div',
            {
              id: 'timeRangeToggle',
              onClick: this._toggleModal,
              style: _DateTimeRangePicker.RANGE
            },
            this._getTimeDisplay(),
            _react2.default.createElement(
              'span',
              { style: _DateTimeRangePicker.BUTTON },
              _react2.default.createElement(_EditOutline2.default, { color: _theme.COLOR_NEUTRAL[400] })
            )
          )
        ),
        open && this.renderModal()
      );
    }
  }]);
  return TxlTimeRangePicker;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_toggleModal', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_toggleModal'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleSaveModal', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleSaveModal'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleCancelModal', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleCancelModal'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleTimeRangeChange', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleTimeRangeChange'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleCustomTimeChange', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleCustomTimeChange'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_generateTimes', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_generateTimes'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_openDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_openDropdown'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_closeDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_closeDropdown'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_getTimeDisplayFormat', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_getTimeDisplayFormat'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_getTimeDisplay', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_getTimeDisplay'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleSecondsCheck', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleSecondsCheck'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, 'renderModal', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, 'renderModal'), _class2.prototype)), _class2)) || _class;

TxlTimeRangePicker.propTypes = {
  items: require('react').PropTypes.object.isRequired,
  onChange: require('react').PropTypes.func.isRequired,
  open: require('react').PropTypes.bool,
  title: require('react').PropTypes.any,
  updateDropdown: require('react').PropTypes.func.isRequired
};
exports.default = TxlTimeRangePicker;


TxlTimeRangePicker.defaultProps = {
  items: {},
  onChange: _Base.NOOP,
  open: false,
  title: 'Time range',
  updateDropdown: _Base.NOOP
};
;

var _temp2 = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(TIME_RANGE_FORMAT_SIMPLIFIED, 'TIME_RANGE_FORMAT_SIMPLIFIED', 'src/_date-time-range-picker/_TimeRangePicker.jsx');

  __REACT_HOT_LOADER__.register(TIME_DISPLAY_FORMAT_SIMPLIFIED, 'TIME_DISPLAY_FORMAT_SIMPLIFIED', 'src/_date-time-range-picker/_TimeRangePicker.jsx');

  __REACT_HOT_LOADER__.register(TIME_RANGE_FORMAT, 'TIME_RANGE_FORMAT', 'src/_date-time-range-picker/_TimeRangePicker.jsx');

  __REACT_HOT_LOADER__.register(TIME_DISPLAY_FORMAT, 'TIME_DISPLAY_FORMAT', 'src/_date-time-range-picker/_TimeRangePicker.jsx');

  __REACT_HOT_LOADER__.register(TIME_QUERY_FORMAT, 'TIME_QUERY_FORMAT', 'src/_date-time-range-picker/_TimeRangePicker.jsx');

  __REACT_HOT_LOADER__.register(DATE_QUERY_FORMAT, 'DATE_QUERY_FORMAT', 'src/_date-time-range-picker/_TimeRangePicker.jsx');

  __REACT_HOT_LOADER__.register(TxlTimeRangePicker, 'TxlTimeRangePicker', 'src/_date-time-range-picker/_TimeRangePicker.jsx');
}();

;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9fZGF0ZS10aW1lLXJhbmdlLXBpY2tlci9fVGltZVJhbmdlUGlja2VyLmpzeCJdLCJuYW1lcyI6WyJUSU1FX1JBTkdFX0ZPUk1BVF9TSU1QTElGSUVEIiwiVElNRV9ESVNQTEFZX0ZPUk1BVF9TSU1QTElGSUVEIiwiVElNRV9SQU5HRV9GT1JNQVQiLCJUSU1FX0RJU1BMQVlfRk9STUFUIiwiVElNRV9RVUVSWV9GT1JNQVQiLCJEQVRFX1FVRVJZX0ZPUk1BVCIsIlR4bFRpbWVSYW5nZVBpY2tlciIsInN0YXRlIiwiaW5jbHVkZVNlY29uZHMiLCJvcGVuRW5kVGltZSIsIm9wZW5TdGFydFRpbWUiLCJzaG93U2Vjb25kcyIsInRpbWVSYW5nZSIsImVuZFRpbWUiLCJrZXkiLCJwcm9wcyIsIml0ZW1zIiwiZW5kRGF0ZVRpbWUiLCJmb3JtYXQiLCJ2YWx1ZSIsInN0YXJ0VGltZSIsInN0YXJ0RGF0ZVRpbWUiLCJ1cGRhdGVEcm9wZG93biIsIm9wZW4iLCJvbkNoYW5nZSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJfdG9nZ2xlTW9kYWwiLCJzZXRTdGF0ZSIsInJhbmdlRm9ybWF0IiwidHlwZSIsImUiLCJ0aW1lT2JqIiwidGltZUFycmF5Iiwic3RhcnRPZiIsImVuZE9mIiwiaXNTYW1lT3JCZWZvcmUiLCJwdXNoIiwiYWRkIiwiaXNTYW1lRGF0ZSIsImlzU2FtZSIsInRpbWVGb3JtYXQiLCJfZ2V0VGltZURpc3BsYXlGb3JtYXQiLCJ0aW1lRGlzcGxheSIsIm9iaiIsImNoZWNrZWQiLCJ0aXRsZSIsIm1vZGFsQ29udGVudCIsIl9oYW5kbGVTZWNvbmRzQ2hlY2siLCJfY2xvc2VEcm9wZG93biIsIl9nZW5lcmF0ZVRpbWVzIiwiX2hhbmRsZVRpbWVSYW5nZUNoYW5nZSIsIl9oYW5kbGVDdXN0b21UaW1lQ2hhbmdlIiwiX29wZW5Ecm9wZG93biIsIm1vZGFsRm9vdGVyIiwiX2hhbmRsZVNhdmVNb2RhbCIsIl9oYW5kbGVDYW5jZWxNb2RhbCIsIl9nZXRUaW1lRGlzcGxheSIsInJlbmRlck1vZGFsIiwiQ29tcG9uZW50IiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7QUFJQTs7QUFTQTs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLCtCQUErQixPQUFyQztBQUNBLElBQU1DLGlDQUFpQyxlQUF2QztBQUNBLElBQU1DLG9CQUFvQixVQUExQjtBQUNBLElBQU1DLHNCQUFzQixrQkFBNUI7QUFDQSxJQUFNQyxvQkFBb0IsVUFBMUI7QUFDQSxJQUFNQyxvQkFBb0IsWUFBMUI7O1FBR0VMLDRCLEdBQUFBLDRCO1FBQ0FDLDhCLEdBQUFBLDhCO1FBQ0FDLGlCLEdBQUFBLGlCO1FBQ0FDLG1CLEdBQUFBLG1CO1FBQ0FDLGlCLEdBQUFBLGlCO1FBQ0FDLGlCLEdBQUFBLGlCOztJQW9CbUJDLGtCOzs7Ozs7Ozs7Ozs7OztvT0FFbkJDLEssR0FBZTtBQUNiQyxzQkFBZ0IsS0FESDtBQUViQyxtQkFBYSxLQUZBO0FBR2JDLHFCQUFlLEtBSEY7QUFJYkMsbUJBQWEsS0FKQTtBQUtiQyxpQkFBVztBQUNUQyxpQkFBUztBQUNQQyxlQUFLLHNCQUFPLE1BQUtDLEtBQUwsQ0FBV0MsS0FBWCxDQUFpQkMsV0FBeEIsRUFBcUNDLE1BQXJDLENBQTRDZCxpQkFBNUMsQ0FERTtBQUVQZSxpQkFBTyxzQkFBTyxNQUFLSixLQUFMLENBQVdDLEtBQVgsQ0FBaUJDLFdBQXhCLEVBQXFDQyxNQUFyQyxDQUE0Q2xCLDRCQUE1QztBQUZBLFNBREE7QUFLVG9CLG1CQUFXO0FBQ1ROLGVBQUssc0JBQU8sTUFBS0MsS0FBTCxDQUFXQyxLQUFYLENBQWlCSyxhQUF4QixFQUF1Q0gsTUFBdkMsQ0FBOENkLGlCQUE5QyxDQURJO0FBRVRlLGlCQUFPLHNCQUFPLE1BQUtKLEtB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LFNBQU8sRUFEeUI7QUFFaENRLHNCQUZnQztBQUdoQ0QsUUFBTSxLQUgwQjtBQUloQ3VCLFNBQU8sWUFKeUI7QUFLaEN4QjtBQUxnQyxDQUFsQzs7Ozs7Ozs7Z0NBM1RNdEIsNEI7O2dDQUNBQyw4Qjs7Z0NBQ0FDLGlCOztnQ0FDQUMsbUI7O2dDQUNBQyxpQjs7Z0NBQ0FDLGlCOztnQ0E0QmVDLGtCIiwiZmlsZSI6Il9UaW1lUmFuZ2VQaWNrZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcbmltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcblxuaW1wb3J0IHtcbiAgYXV0b2JpbmQsXG4gIE5PT1AsXG59IGZyb20gJy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQge1xuICBCVVRUT04sXG4gIEJVVFRPTl9TVFlMRSxcbiAgQ0hFQ0tCT1hfU1RZTEUsXG4gIElOUFVUX1NFUEFSQVRPUl9TVFlMRSxcbiAgUElDS0VSX1dSQVBQRVJfU1RZTEUsXG4gIFJBTkdFLFxuICBUSU1FX1dSQVBQRVJfU1RZTEUsXG59IGZyb20gJy4vRGF0ZVRpbWVSYW5nZVBpY2tlci5zdHlsZSc7XG5pbXBvcnQgeyBDT0xPUl9ORVVUUkFMIH0gZnJvbSAnLi4vc3R5bGVzL3RoZW1lJztcbmltcG9ydCBFZGl0T3V0bGluZSBmcm9tICcuLi9pY29ucy9FZGl0T3V0bGluZSc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi4vbW9kYWxzL01vZGFsJztcbmltcG9ydCBCdXR0b24gZnJvbSAnLi4vYnV0dG9ucy9CdXR0b24nO1xuaW1wb3J0IFNpbmdsZVNlbGVjdCBmcm9tICcuLi9kcm9wZG93bnMvX1NpbmdsZVNlbGVjdCc7XG5pbXBvcnQgQ2hlY2tib3ggZnJvbSAnLi4vaW5wdXQtZmllbGRzL0NoZWNrYm94JztcblxuY29uc3QgVElNRV9SQU5HRV9GT1JNQVRfU0lNUExJRklFRCA9ICdoOm1tYSc7XG5jb25zdCBUSU1FX0RJU1BMQVlfRk9STUFUX1NJTVBMSUZJRUQgPSAnaDptbWEgKE1NTSBEKSc7XG5jb25zdCBUSU1FX1JBTkdFX0ZPUk1BVCA9ICdoOm1tOnNzYSc7XG5jb25zdCBUSU1FX0RJU1BMQVlfRk9STUFUID0gJ2g6bW06c3NhIChNTU0gRCknO1xuY29uc3QgVElNRV9RVUVSWV9GT1JNQVQgPSAnSEg6bW06c3MnO1xuY29uc3QgREFURV9RVUVSWV9GT1JNQVQgPSAnWVlZWS1NTS1ERCc7XG5cbmV4cG9ydCB7XG4gIFRJTUVfUkFOR0VfRk9STUFUX1NJTVBMSUZJRUQsXG4gIFRJTUVfRElTUExBWV9GT1JNQVRfU0lNUExJRklFRCxcbiAgVElNRV9SQU5HRV9GT1JNQVQsXG4gIFRJTUVfRElTUExBWV9GT1JNQVQsXG4gIFRJTUVfUVVFUllfRk9STUFULFxuICBEQVRFX1FVRVJZX0ZPUk1BVCxcbn07XG5cbnR5cGUgUHJvcHMgPSB7XG4gIGl0ZW1zOiBPYmplY3QsXG4gIG9uQ2hhbmdlOiAoc3RhdHVzOiBPYmplY3QpID0+IHZvaWQsXG4gIG9wZW4/OiBib29sZWFuLFxuICB0aXRsZT86IFN0cmluZyxcbiAgdXBkYXRlRHJvcGRvd246IChzdGF0dXM6IE9iamVjdCkgPT4gdm9pZCxcbn07XG5cbnR5cGUgU3RhdGUgPSB7XG4gIGluY2x1ZGVTZWNvbmRzOiBib29sZWFuLCAgLy8gZm9yIHRpbWUgcmFuZ2Ugb3B0aW9uc1xuICBvcGVuU3RhcnRUaW1lOiBib29sZWFuLFxuICBvcGVuRW5kVGltZTogYm9vbGVhbixcbiAgc2hvd1NlY29uZHM6IGJvb2xlYW4sIC8vIGZvciB0aW1lIHJhbmdlIGRpc3BsYXkgdGV4dFxuICB0aW1lUmFuZ2U6IE9iamVjdCxcbn07XG5cbkBSYWRpdW1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFR4bFRpbWVSYW5nZVBpY2tlciBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIHByb3BzOiBQcm9wcztcbiAgc3RhdGU6IFN0YXRlID0ge1xuICAgIGluY2x1ZGVTZWNvbmRzOiBmYWxzZSxcbiAgICBvcGVuRW5kVGltZTogZmFsc2UsXG4gICAgb3BlblN0YXJ0VGltZTogZmFsc2UsXG4gICAgc2hvd1NlY29uZHM6IGZhbHNlLFxuICAgIHRpbWVSYW5nZToge1xuICAgICAgZW5kVGltZToge1xuICAgICAgICBrZXk6IG1vbWVudCh0aGlzLnByb3BzLml0ZW1zLmVuZERhdGVUaW1lKS5mb3JtYXQoVElNRV9RVUVSWV9GT1JNQVQpLFxuICAgICAgICB2YWx1ZTogbW9tZW50KHRoaXMucHJvcHMuaXRlbXMuZW5kRGF0ZVRpbWUpLmZvcm1hdChUSU1FX1JBTkdFX0ZPUk1BVF9TSU1QTElGSUVEKSxcbiAgICAgIH0sXG4gICAgICBzdGFydFRpbWU6IHtcbiAgICAgICAga2V5OiBtb21lbnQodGhpcy5wcm9wcy5pdGVtcy5zdGFydERhdGVUaW1lKS5mb3JtYXQoVElNRV9RVUVSWV9GT1JNQVQpLFxuICAgICAgICB2YWx1ZTogbW9tZW50KHRoaXMucHJvcHMuaXRlbXMuc3RhcnREYXRlVGltZSkuZm9ybWF0KFRJTUVfUkFOR0VfRk9STUFUX1NJTVBMSUZJRUQpLFxuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIEBhdXRvYmluZFxuICBfdG9nZ2xlTW9kYWwoKSB7XG4gICAgdGhpcy5wcm9wcy51cGRhdGVEcm9wZG93bih7IG9wZW46ICF0aGlzLnByb3BzLm9wZW4gfSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZVNhdmVNb2RhbCgpIHtcbiAgICBjb25zdCB7XG4gICAgICBpbmNsdWRlU2Vjb25kcyxcbiAgICAgIHRpbWVSYW5nZSxcbiAgICB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCB7XG4gICAgICBpdGVtcyxcbiAgICAgIG9uQ2hhbmdlLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IG1vbWVudChpdGVtcy5zdGFydERhdGVUaW1lKS5mb3JtYXQoREFURV9RVUVSWV9GT1JNQVQpO1xuICAgIGNvbnN0IGVuZERhdGUgPSBtb21lbnQoaXRlbXMuZW5kRGF0ZVRpbWUpLmZvcm1hdChEQVRFX1FVRVJZX0ZPUk1BVCk7XG4gICAgaXRlbXMuc3RhcnREYXRlVGltZSA9IGAke3N0YXJ0RGF0ZX0gJHt0aW1lUmFuZ2Uuc3RhcnRUaW1lLmtleX1gO1xuICAgIGl0ZW1zLmVuZERhdGVUaW1lID0gYCR7ZW5kRGF0ZX0gJHt0aW1lUmFuZ2UuZW5kVGltZS5rZXl9YDtcbiAgICBvbkNoYW5nZShpdGVtcyk7XG4gICAgdGhpcy5fdG9nZ2xlTW9kYWwoKTtcbiAgICB0aGlzLnNldFN0YXRlKHsgc2hvd1NlY29uZHM6IGluY2x1ZGVTZWNvbmRzIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVDYW5jZWxNb2RhbCgpIHtcbiAgICBjb25zdCB7IGl0ZW1zIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHsgc2hvd1NlY29uZHMgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgcmFuZ2VGb3JtYXQgPSBzaG93U2Vjb25kcyA/IFRJTUVfUkFOR0VfRk9STUFUIDogVElNRV9SQU5HRV9GT1JNQVRfU0lNUExJRklFRDtcblxuICAgIGNvbnN0IHRpbWVSYW5nZSA9IHtcbiAgICAgIGVuZFRpbWU6IHtcbiAgICAgICAga2V5OiBtb21lbnQoaXRlbXMuZW5kRGF0ZVRpbWUpLmZvcm1hdChUSU1FX1FVRVJZX0ZPUk1BVCksXG4gICAgICAgIHZhbHVlOiBtb21lbnQoaXRlbXMuZW5kRGF0ZVRpbWUpLmZvcm1hdChyYW5nZUZvcm1hdCksXG4gICAgICB9LFxuICAgICAgc3RhcnRUaW1lOiB7XG4gICAgICAgIGtleTogbW9tZW50KGl0ZW1zLnN0YXJ0RGF0ZVRpbWUpLmZvcm1hdChUSU1FX1FVRVJZX0ZPUk1BVCksXG4gICAgICAgIHZhbHVlOiBtb21lbnQoaXRlbXMuc3RhcnREYXRlVGltZSkuZm9ybWF0KHJhbmdlRm9ybWF0KSxcbiAgICAgIH0sXG4gICAgfTtcbiAgICB0aGlzLnNldFN0YXRlKHsgdGltZVJhbmdlIH0pO1xuICAgIHRoaXMuX3RvZ2dsZU1vZGFsKCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZVRpbWVSYW5nZUNoYW5nZSh0eXBlOiBTdHJpbmcpIHtcbiAgICBjb25zdCB7IHRpbWVSYW5nZSB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIHJldHVybiAoZTogT2JqZWN0KSA9PiB7XG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgdGltZVJhbmdlOiB7XG4gICAgICAgICAgZW5kVGltZTogdHlwZSA9PT0gJ2VuZCcgPyBlLnZhbHVlIDogdGltZVJhbmdlLmVuZFRpbWUsXG4gICAgICAgICAgc3RhcnRUaW1lOiB0eXBlID09PSAnc3RhcnQnID8gZS52YWx1ZSA6IHRpbWVSYW5nZS5zdGFydFRpbWUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9O1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVDdXN0b21UaW1lQ2hhbmdlKHR5cGU6IFN0cmluZykge1xuICAgIGNvbnN0IHtcbiAgICAgIGluY2x1ZGVTZWNvbmRzLFxuICAgICAgdGltZVJhbmdlLFxuICAgIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IHJhbmdlRm9ybWF0ID0gaW5jbHVkZVNlY29uZHMgPyBUSU1FX1JBTkdFX0ZPUk1BVCA6IFRJTUVfUkFOR0VfRk9STUFUX1NJTVBMSUZJRUQ7XG5cbiAgICByZXR1cm4gKGU6IE9iamVjdCkgPT4ge1xuICAgICAgY29uc3QgdGltZU9iaiA9IHtcbiAgICAgICAga2V5OiBtb21lbnQoZS52YWx1ZSwgcmFuZ2VGb3JtYXQpLmZvcm1hdChUSU1FX1FVRVJZX0ZPUk1BVCksXG4gICAgICAgIHZhbHVlOiBtb21lbnQoZS52YWx1ZSwgcmFuZ2VGb3JtYXQpLmZvcm1hdChyYW5nZUZvcm1hdCksXG4gICAgICB9O1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIHRpbWVSYW5nZToge1xuICAgICAgICAgIGVuZFRpbWU6IHR5cGUgPT09ICdlbmQnID8gdGltZU9iaiA6IHRpbWVSYW5nZS5lbmRUaW1lLFxuICAgICAgICAgIHN0YXJ0VGltZTogdHlwZSA9PT0gJ3N0YXJ0JyA/IHRpbWVPYmogOiB0aW1lUmFuZ2Uuc3RhcnRUaW1lLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfZ2VuZXJhdGVUaW1lcygpIHtcbiAgICBjb25zdCB0aW1lQXJyYXkgPSBbXTtcbiAgICBjb25zdCB7IGluY2x1ZGVTZWNvbmRzIH0gPSB0aGlzLnN0YXRlO1xuICAgIGxldCBzdGFydFRpbWUgPSBtb21lbnQoKS5zdGFydE9mKCdkYXknKTtcbiAgICBjb25zdCBlbmRUaW1lID0gbW9tZW50KCkuZW5kT2YoJ2RheScpO1xuICAgIGNvbnN0IHJhbmdlRm9ybWF0ID0gaW5jbHVkZVNlY29uZHMgPyBUSU1FX1JBTkdFX0ZPUk1BVCA6IFRJTUVfUkFOR0VfRk9STUFUX1NJTVBMSUZJRUQ7XG5cbiAgICB3aGlsZSAobW9tZW50KHN0YXJ0VGltZSkuaXNTYW1lT3JCZWZvcmUoZW5kVGltZSkpIHtcbiAgICAgIHRpbWVBcnJheS5wdXNoKHtcbiAgICAgICAga2V5OiBtb21lbnQoc3RhcnRUaW1lKS5mb3JtYXQoVElNRV9RVUVSWV9GT1JNQVQpLFxuICAgICAgICB2YWx1ZTogbW9tZW50KHN0YXJ0VGltZSkuZm9ybWF0KHJhbmdlRm9ybWF0KSxcbiAgICAgIH0pO1xuICAgICAgc3RhcnRUaW1lID0gbW9tZW50KHN0YXJ0VGltZSkuYWRkKDMwLCAnbWludXRlcycpO1xuICAgIH1cblxuICAgIHJldHVybiB0aW1lQXJyYXk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX29wZW5Ecm9wZG93bih0eXBlOiBTdHJpbmcpIHtcbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgIG9wZW5FbmRUaW1lOiB0eXBlID09PSAnZW5kJyxcbiAgICAgICAgb3BlblN0YXJ0VGltZTogdHlwZSA9PT0gJ3N0YXJ0JyxcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2Nsb3NlRHJvcGRvd24odHlwZTogU3RyaW5nKSB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICBvcGVuRW5kVGltZTogIXR5cGUgPT09ICdlbmQnLFxuICAgICAgICBvcGVuU3RhcnRUaW1lOiAhdHlwZSA9PT0gJ3N0YXJ0JyxcbiAgICAgIH0pO1xuICAgIH07XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2dldFRpbWVEaXNwbGF5Rm9ybWF0KCkge1xuICAgIGNvbnN0IHsgaXRlbXMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgeyBzaG93U2Vjb25kcyB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBpc1NhbWVEYXRlID0gbW9tZW50KGl0ZW1zLnN0YXJ0RGF0ZVRpbWUpLmlzU2FtZShpdGVtcy5lbmREYXRlVGltZSwgJ2RhdGUnKTtcbiAgICBsZXQgdGltZUZvcm1hdDtcbiAgICBpZiAoc2hvd1NlY29uZHMpIHtcbiAgICAgIHRpbWVGb3JtYXQgPSBpc1NhbWVEYXRlID8gVElNRV9SQU5HRV9GT1JNQVQgOiBUSU1FX0RJU1BMQVlfRk9STUFUO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aW1lRm9ybWF0ID0gaXNTYW1lRGF0ZSA/IFRJTUVfUkFOR0VfRk9STUFUX1NJTVBMSUZJRUQgOiBUSU1FX0RJU1BMQVlfRk9STUFUX1NJTVBMSUZJRUQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRpbWVGb3JtYXQ7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2dldFRpbWVEaXNwbGF5KCkge1xuICAgIGNvbnN0IHsgaXRlbXMgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgdGltZUZvcm1hdCA9IHRoaXMuX2dldFRpbWVEaXNwbGF5Rm9ybWF0KCk7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gbW9tZW50KGl0ZW1zLnN0YXJ0RGF0ZVRpbWUpLmZvcm1hdCh0aW1lRm9ybWF0KTtcbiAgICBjb25zdCBlbmRUaW1lID0gbW9tZW50KGl0ZW1zLmVuZERhdGVUaW1lKS5mb3JtYXQodGltZUZvcm1hdCk7XG4gICAgY29uc3QgdGltZURpc3BsYXkgPSBgJHtzdGFydFRpbWV9IHRvICR7ZW5kVGltZX1gO1xuICAgIHJldHVybiB0aW1lRGlzcGxheTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlU2Vjb25kc0NoZWNrKG9iajogT2JqZWN0KSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGluY2x1ZGVTZWNvbmRzOiBvYmouY2hlY2tlZCB9KTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICByZW5kZXJNb2RhbCgpIHtcbiAgICBjb25zdCB7XG4gICAgICBpdGVtcyxcbiAgICAgIHRpdGxlLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IHtcbiAgICAgIG9wZW5FbmRUaW1lLFxuICAgICAgb3BlblN0YXJ0VGltZSxcbiAgICAgIGluY2x1ZGVTZWNvbmRzLFxuICAgICAgdGltZVJhbmdlLFxuICAgIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgY29uc3QgbW9kYWxDb250ZW50ID0gKFxuICAgICAgPGRpdj5cbiAgICAgICAgPGRpdiBzdHlsZT17Q0hFQ0tCT1hfU1RZTEV9PlxuICAgICAgICAgIDxDaGVja2JveFxuICAgICAgICAgICAgY2hlY2tlZD17aW5jbHVkZVNlY29uZHN9XG4gICAgICAgICAgICBsYWJlbFRleHQ9XCJJbmNsdWRlIHNlY29uZHNcIlxuICAgICAgICAgICAgbmFtZT1cImluY2x1ZGVTZWNvbmRzXCJcbiAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLl9oYW5kbGVTZWNvbmRzQ2hlY2t9XG4gICAgICAgICAgICB2YWx1ZT1cImluY2x1ZGVTZWNvbmRzXCJcbiAgICAgICAgICAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT17VElNRV9XUkFQUEVSX1NUWUxFfT5cbiAgICAgICAgICA8ZGl2IHN0eWxlPXtQSUNLRVJfV1JBUFBFUl9TVFlMRX0+XG4gICAgICAgICAgICA8U2luZ2xlU2VsZWN0XG4gICAgICAgICAgICAgIGNsb3NlRHJvcGRvd249e3RoaXMuX2Nsb3NlRHJvcGRvd24oJ3N0YXJ0Jyl9XG4gICAgICAgICAgICAgIGl0ZW1zPXt0aGlzLl9nZW5lcmF0ZVRpbWVzKCl9XG4gICAgICAgICAgICAgIGxhYmVsPVwiVGltZSByYW5nZVwiXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLl9oYW5kbGVUaW1lUmFuZ2VDaGFuZ2UoJ3N0YXJ0Jyl9XG4gICAgICAgICAgICAgIG9uSXRlbUNyZWF0ZT17dGhpcy5faGFuZGxlQ3VzdG9tVGltZUNoYW5nZSgnc3RhcnQnKX1cbiAgICAgICAgICAgICAgb3Blbj17b3BlblN0YXJ0VGltZX1cbiAgICAgICAgICAgICAgb3BlbkRyb3Bkb3duPXt0aGlzLl9vcGVuRHJvcGRvd24oJ3N0YXJ0Jyl9XG4gICAgICAgICAgICAgIHNlY29uZGFyeVRleHQ9e21vbWVudChpdGVtcy5zdGFydERhdGVUaW1lKS5mb3JtYXQoJ2xsJyl9XG4gICAgICAgICAgICAgIHNob3dDcmVhdGVOZXdcbiAgICAgICAgICAgICAgdmFsdWU9e3RpbWVSYW5nZS5zdGFydFRpbWV9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgPGRpdiBzdHlsZT17SU5QVVRfU0VQQVJBVE9SX1NUWUxFfT50bzwvZGl2PlxuXG4gICAgICAgICAgPGRpdiBzdHlsZT17UElDS0VSX1dSQVBQRVJfU1RZTEV9PlxuICAgICAgICAgICAgPFNpbmdsZVNlbGVjdFxuICAgICAgICAgICAgICBjbG9zZURyb3Bkb3duPXt0aGlzLl9jbG9zZURyb3Bkb3duKCdlbmQnKX1cbiAgICAgICAgICAgICAgaXRlbXM9e3RoaXMuX2dlbmVyYXRlVGltZXMoKX1cbiAgICAgICAgICAgICAgbGFiZWw9XCIgXCJcbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMuX2hhbmRsZVRpbWVSYW5nZUNoYW5nZSgnZW5kJyl9XG4gICAgICAgICAgICAgIG9uSXRlbUNyZWF0ZT17dGhpcy5faGFuZGxlQ3VzdG9tVGltZUNoYW5nZSgnZW5kJyl9XG4gICAgICAgICAgICAgIG9wZW49e29wZW5FbmRUaW1lfVxuICAgICAgICAgICAgICBvcGVuRHJvcGRvd249e3RoaXMuX29wZW5Ecm9wZG93bignZW5kJyl9XG4gICAgICAgICAgICAgIHNlY29uZGFyeVRleHQ9e21vbWVudChpdGVtcy5lbmREYXRlVGltZSkuZm9ybWF0KCdsbCcpfVxuICAgICAgICAgICAgICBzaG93Q3JlYXRlTmV3XG4gICAgICAgICAgICAgIHZhbHVlPXt0aW1lUmFuZ2UuZW5kVGltZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcblxuICAgIGNvbnN0IG1vZGFsRm9vdGVyID0gKFxuICAgICAgPGRpdj5cbiAgICAgICAgPEJ1dHRvblxuICAgICAgICAgIHNpemU9XCJsYXJnZVwiXG4gICAgICAgICAgdmFyaWFudD1cImFjY2VudFwiXG4gICAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlU2F2ZU1vZGFsfVxuICAgICAgICA+XG4gICAgICAgICAgQXBwbHlcbiAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDxCdXR0b25cbiAgICAgICAgICBzaXplPVwibGFyZ2VcIlxuICAgICAgICAgIHZhcmlhbnQ9XCJtdXRlZFwiXG4gICAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlQ2FuY2VsTW9kYWx9XG4gICAgICAgICAgX3N0eWxlPXtCVVRUT059XG4gICAgICAgID5cbiAgICAgICAgICBDYW5jZWxcbiAgICAgICAgPC9CdXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxNb2RhbFxuICAgICAgICBoZWFkZXI9e3RpdGxlfVxuICAgICAgICBvbkRpc21pc3M9e3RoaXMuX3RvZ2dsZU1vZGFsfVxuICAgICAgICBmb290ZXI9e21vZGFsRm9vdGVyfVxuICAgICAgPlxuICAgICAgICB7bW9kYWxDb250ZW50fVxuICAgICAgPC9Nb2RhbD5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgb3BlbiB9ID0gdGhpcy5wcm9wcztcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGRhdGEtY29tcG9uZW50PVwiVHhsVGltZVJhbmdlUGlja2VyXCI+XG4gICAgICAgIDxkaXYgc3R5bGU9e0JVVFRPTl9TVFlMRX0+XG4gICAgICAgICAgPGRpdlxuICAgICAgICAgICAgaWQ9XCJ0aW1lUmFuZ2VUb2dnbGVcIlxuICAgICAgICAgICAgb25DbGljaz17dGhpcy5fdG9nZ2xlTW9kYWx9XG4gICAgICAgICAgICBzdHlsZT17UkFOR0V9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3RoaXMuX2dldFRpbWVEaXNwbGF5KCl9XG4gICAgICAgICAgICA8c3BhbiBzdHlsZT17QlVUVE9OfT5cbiAgICAgICAgICAgICAgPEVkaXRPdXRsaW5lIGNvbG9yPXtDT0xPUl9ORVVUUkFMWzQwMF19IC8+XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICB7b3BlbiAmJiB0aGlzLnJlbmRlck1vZGFsKCl9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cblR4bFRpbWVSYW5nZVBpY2tlci5kZWZhdWx0UHJvcHMgPSB7XG4gIGl0ZW1zOiB7fSxcbiAgb25DaGFuZ2U6IE5PT1AsXG4gIG9wZW46IGZhbHNlLFxuICB0aXRsZTogJ1RpbWUgcmFuZ2UnLFxuICB1cGRhdGVEcm9wZG93bjogTk9PUCxcbn07XG4iXX0=