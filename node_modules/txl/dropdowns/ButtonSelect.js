'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _Base = require('../base/Base');

var _helpers = require('../styles/helpers');

var _ArrowDown = require('../icons/ArrowDown');

var _ArrowDown2 = _interopRequireDefault(_ArrowDown);

var _Button = require('../buttons/Button');

var _Button2 = _interopRequireDefault(_Button);

var _Container = require('../containers/Container');

var _Container2 = _interopRequireDefault(_Container);

var _DropdownTargetBase = require('./_DropdownTargetBase');

var _DropdownTargetBase2 = _interopRequireDefault(_DropdownTargetBase);

var _SelectableItemList = require('../lists/_SelectableItemList');

var _SelectableItemList2 = _interopRequireDefault(_SelectableItemList);

var _SearchBox = require('../input-fields/SearchBox');

var _SearchBox2 = _interopRequireDefault(_SearchBox);

var _TruncatedText = require('../text/TruncatedText');

var _TruncatedText2 = _interopRequireDefault(_TruncatedText);

var _lists = require('../lists/lists.style');

var _ButtonSelect = require('./ButtonSelect.style');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

// @TODO-TRANSLATE
var babelPluginFlowReactPropTypes_proptype_ButtonSize = require('../buttons/Button').babelPluginFlowReactPropTypes_proptype_ButtonSize || require('react').PropTypes.any;

var NO_MATCHING_ITEMS_TEXT = 'No matches found';

Object.defineProperty(module.exports, 'babelPluginFlowReactPropTypes_proptype_Props', require('react').PropTypes.shape({
  anchorComponent: require('react').PropTypes.any,
  buttonText: require('react').PropTypes.string.isRequired,
  dropdownWidth: require('react').PropTypes.any,
  dropdownAttachmentLocation: require('react').PropTypes.any,
  id: require('react').PropTypes.string,
  itemHeight: require('react').PropTypes.string,
  items: require('react').PropTypes.arrayOf(require('react').PropTypes.object).isRequired,
  onButtonClick: require('react').PropTypes.func.isRequired,
  onItemSelect: require('react').PropTypes.func.isRequired,
  onSearchChange: require('react').PropTypes.func.isRequired,
  open: require('react').PropTypes.bool.isRequired,
  popoverZIndex: require('react').PropTypes.string,
  searchPlaceholder: require('react').PropTypes.string,
  searchValue: require('react').PropTypes.string,
  showSearch: require('react').PropTypes.bool.isRequired,
  size: babelPluginFlowReactPropTypes_proptype_ButtonSize,
  value: require('react').PropTypes.string,
  visibleItemCount: require('react').PropTypes.number
}));

var TxlButtonSelect = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlButtonSelect, _React$Component);

  function TxlButtonSelect() {
    (0, _classCallCheck3.default)(this, TxlButtonSelect);
    return (0, _possibleConstructorReturn3.default)(this, (TxlButtonSelect.__proto__ || (0, _getPrototypeOf2.default)(TxlButtonSelect)).apply(this, arguments));
  }

  (0, _createClass3.default)(TxlButtonSelect, [{
    key: 'componentDidUpdate',
    value: function componentDidUpdate(prevProps) {
      var searchBox = this.refs.searchBox;
      // only focus text field if we're transitioning to open state otherwise each render, e.g.,
      // user typing in search box, will "re-focus" text field

      if (!prevProps.open && this.props.open && searchBox) {
        searchBox.focus();
      }
    }
  }, {
    key: '_handleSearchClear',
    value: function _handleSearchClear() {
      this.props.onSearchChange({ value: '' });
      // put cursor back in text field after user clears search term
      if (this.refs.searchBox) {
        this.refs.searchBox.focus();
      }
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          anchorComponent = _props.anchorComponent,
          buttonText = _props.buttonText,
          dropdownAttachmentLocation = _props.dropdownAttachmentLocation,
          dropdownWidth = _props.dropdownWidth,
          id = _props.id,
          itemHeight = _props.itemHeight,
          items = _props.items,
          onButtonClick = _props.onButtonClick,
          onItemSelect = _props.onItemSelect,
          onSearchChange = _props.onSearchChange,
          open = _props.open,
          popoverZIndex = _props.popoverZIndex,
          searchPlaceholder = _props.searchPlaceholder,
          searchValue = _props.searchValue,
          showSearch = _props.showSearch,
          size = _props.size,
          value = _props.value,
          visibleItemCount = _props.visibleItemCount;


      var buttonArrowStyle = open ? _ButtonSelect.BUTTON_ARROW_OPEN : _ButtonSelect.BUTTON_ARROW;
      var hasItems = !!(items && items.length);
      var noItemsMatching = !hasItems && searchValue;

      var dropdownContent = _react2.default.createElement(
        _Container2.default,
        null,
        showSearch && _react2.default.createElement(_SearchBox2.default, {
          onClear: this._handleSearchClear,
          onChange: onSearchChange,
          placeholder: searchPlaceholder,
          ref: 'searchBox',
          value: searchValue
        }),
        hasItems && _react2.default.createElement(_SelectableItemList2.default, {
          itemHeight: itemHeight,
          items: items,
          onClick: onItemSelect,
          ref: 'itemList',
          selectedValues: [value],
          visibleItemCount: visibleItemCount
        }),
        noItemsMatching && _react2.default.createElement(
          'div',
          {
            ref: 'noMatchingItemsContent',
            style: _ButtonSelect.NO_MATCHING_ITEMS_STYLE
          },
          NO_MATCHING_ITEMS_TEXT
        ),
        !!anchorComponent && _react2.default.createElement(
          'div',
          { style: _lists.ANCHOR_COMPONENT_STYLE },
          anchorComponent
        )
      );

      return _react2.default.createElement(
        _DropdownTargetBase2.default,
        {
          attachmentLocation: dropdownAttachmentLocation,
          componentName: 'TxlButtonSelect',
          content: dropdownContent,
          id: id,
          popoverZIndex: popoverZIndex,
          ref: 'dropdownTargetBase',
          visible: open,
          width: dropdownWidth,
          yOffset: (0, _helpers.gridUnitsRaw)(-1)
        },
        _react2.default.createElement(
          _Button2.default,
          {
            _style: _ButtonSelect.BUTTON_EXTRA,
            onClick: onButtonClick,
            ref: 'button',
            size: size,
            variant: 'muted'
          },
          _react2.default.createElement(
            'span',
            {
              'data-test-button-content': true,
              style: _ButtonSelect.BUTTON_CONTENT_WRAPPER
            },
            _react2.default.createElement(_TruncatedText2.default, { text: buttonText }),
            _react2.default.createElement(
              'span',
              { style: buttonArrowStyle },
              _react2.default.createElement(_ArrowDown2.default, null)
            )
          )
        )
      );
    }
  }]);
  return TxlButtonSelect;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_handleSearchClear', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleSearchClear'), _class2.prototype)), _class2)) || _class;

TxlButtonSelect.propTypes = {
  anchorComponent: require('react').PropTypes.any,
  buttonText: require('react').PropTypes.string.isRequired,
  dropdownWidth: require('react').PropTypes.any,
  dropdownAttachmentLocation: require('react').PropTypes.any,
  id: require('react').PropTypes.string,
  itemHeight: require('react').PropTypes.string,
  items: require('react').PropTypes.arrayOf(require('react').PropTypes.object).isRequired,
  onButtonClick: require('react').PropTypes.func.isRequired,
  onItemSelect: require('react').PropTypes.func.isRequired,
  onSearchChange: require('react').PropTypes.func.isRequired,
  open: require('react').PropTypes.bool.isRequired,
  popoverZIndex: require('react').PropTypes.string,
  searchPlaceholder: require('react').PropTypes.string,
  searchValue: require('react').PropTypes.string,
  showSearch: require('react').PropTypes.bool.isRequired,
  size: babelPluginFlowReactPropTypes_proptype_ButtonSize,
  value: require('react').PropTypes.string,
  visibleItemCount: require('react').PropTypes.number
};


TxlButtonSelect.defaultProps = {
  buttonText: '',
  onButtonClick: _Base.NOOP,
  onItemSelect: _Base.NOOP,
  onSearchChange: _Base.NOOP,
  open: false,
  searchPlaceholder: _SearchBox2.default.defaultProps.placeholder,
  showSearch: false,
  size: _Button2.default.defaultProps.size
};

var _default = TxlButtonSelect;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(NO_MATCHING_ITEMS_TEXT, 'NO_MATCHING_ITEMS_TEXT', 'src/dropdowns/ButtonSelect.jsx');

  __REACT_HOT_LOADER__.register(TxlButtonSelect, 'TxlButtonSelect', 'src/dropdowns/ButtonSelect.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/dropdowns/ButtonSelect.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kcm9wZG93bnMvQnV0dG9uU2VsZWN0LmpzeCJdLCJuYW1lcyI6WyJOT19NQVRDSElOR19JVEVNU19URVhUIiwiVHhsQnV0dG9uU2VsZWN0IiwicHJldlByb3BzIiwic2VhcmNoQm94IiwicmVmcyIsIm9wZW4iLCJwcm9wcyIsImZvY3VzIiwib25TZWFyY2hDaGFuZ2UiLCJ2YWx1ZSIsImFuY2hvckNvbXBvbmVudCIsImJ1dHRvblRleHQiLCJkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbiIsImRyb3Bkb3duV2lkdGgiLCJpZCIsIml0ZW1IZWlnaHQiLCJpdGVtcyIsIm9uQnV0dG9uQ2xpY2siLCJvbkl0ZW1TZWxlY3QiLCJwb3BvdmVyWkluZGV4Iiwic2VhcmNoUGxhY2Vob2xkZXIiLCJzZWFyY2hWYWx1ZSIsInNob3dTZWFyY2giLCJzaXplIiwidmlzaWJsZUl0ZW1Db3VudCIsImJ1dHRvbkFycm93U3R5bGUiLCJoYXNJdGVtcyIsImxlbmd0aCIsIm5vSXRlbXNNYXRjaGluZyIsImRyb3Bkb3duQ29udGVudCIsIl9oYW5kbGVTZWFyY2hDbGVhciIsIkNvbXBvbmVudCIsImRlZmF1bHRQcm9wcyIsInBsYWNlaG9sZGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFFQTs7QUFJQTs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOztBQUdBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFTQTs7O0FBQ0EsSUFBTUEseUJBQXlCLGtCQUEvQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUE2Qk1DLGU7Ozs7Ozs7Ozs7dUNBR2VDLFMsRUFBa0I7QUFBQSxVQUMzQkMsU0FEMkIsR0FDYixLQUFLQyxJQURRLENBQzNCRCxTQUQyQjtBQUVuQztBQUNBOztBQUNBLFVBQUksQ0FBQ0QsVUFBVUcsSUFBWCxJ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O0VBdEgyQixnQkFBTU0sUzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBeUhwQzlCLGdCQUFnQitCLFlBQWhCLEdBQStCO0FBQzdCckIsY0FBWSxFQURpQjtBQUU3Qk0sMkJBRjZCO0FBRzdCQywwQkFINkI7QUFJN0JWLDRCQUo2QjtBQUs3QkgsUUFBTSxLQUx1QjtBQU03QmUscUJBQW1CLG9CQUFVWSxZQUFWLENBQXVCQyxXQU5iO0FBTzdCWCxjQUFZLEtBUGlCO0FBUTdCQyxRQUFNLGlCQUFPUyxZQUFQLENBQW9CVDtBQVJHLENBQS9COztlQVdldEIsZTs7Ozs7Ozs7O2dDQWpLVEQsc0I7O2dDQTZCQUMsZSIsImZpbGUiOiJCdXR0b25TZWxlY3QuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcblxuaW1wb3J0IHtcbiAgYXV0b2JpbmQsXG4gIE5PT1AsXG59IGZyb20gJy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQgeyBncmlkVW5pdHNSYXcgYXMgZ3VSYXcgfSBmcm9tICcuLi9zdHlsZXMvaGVscGVycyc7XG5pbXBvcnQgQXJyb3dEb3duIGZyb20gJy4uL2ljb25zL0Fycm93RG93bic7XG5pbXBvcnQgQnV0dG9uIGZyb20gJy4uL2J1dHRvbnMvQnV0dG9uJztcbmltcG9ydCBDb250YWluZXIgZnJvbSAnLi4vY29udGFpbmVycy9Db250YWluZXInO1xuaW1wb3J0IERyb3Bkb3duVGFyZ2V0QmFzZSBmcm9tICcuL19Ecm9wZG93blRhcmdldEJhc2UnO1xuaW1wb3J0IFNlbGVjdGFibGVJdGVtTGlzdCBmcm9tICcuLi9saXN0cy9fU2VsZWN0YWJsZUl0ZW1MaXN0JztcbmltcG9ydCBTZWFyY2hCb3ggZnJvbSAnLi4vaW5wdXQtZmllbGRzL1NlYXJjaEJveCc7XG5pbXBvcnQgVHJ1bmNhdGVkVGV4dCBmcm9tICcuLi90ZXh0L1RydW5jYXRlZFRleHQnO1xuaW1wb3J0IHtcbiAgQU5DSE9SX0NPTVBPTkVOVF9TVFlMRSxcbn0gZnJvbSAnLi4vbGlzdHMvbGlzdHMuc3R5bGUnO1xuaW1wb3J0IHtcbiAgQlVUVE9OX0FSUk9XLFxuICBCVVRUT05fQVJST1dfT1BFTixcbiAgQlVUVE9OX0NPTlRFTlRfV1JBUFBFUixcbiAgQlVUVE9OX0VYVFJBLFxuICBOT19NQVRDSElOR19JVEVNU19TVFlMRSxcbn0gZnJvbSAnLi9CdXR0b25TZWxlY3Quc3R5bGUnO1xuaW1wb3J0IHR5cGUgeyBCdXR0b25TaXplIH0gZnJvbSAnLi4vYnV0dG9ucy9CdXR0b24nO1xuXG4vLyBAVE9ETy1UUkFOU0xBVEVcbmNvbnN0IE5PX01BVENISU5HX0lURU1TX1RFWFQgPSAnTm8gbWF0Y2hlcyBmb3VuZCc7XG5cbmV4cG9ydCB0eXBlIEF0dGFjaG1lbnRMb2NhdGlvbiA9ICdsZWZ0JyB8ICdyaWdodCcgfCAnY2VudGVyJztcblxuZXhwb3J0IHR5cGUgUHJvcHMgPSB7XG4gIGFuY2hvckNvbXBvbmVudD86IFJlYWN0LkVsZW1lbnQ8YW55PixcbiAgYnV0dG9uVGV4dDogc3RyaW5nLFxuICBkcm9wZG93bldpZHRoPzogYW55LFxuICBkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbj86IEF0dGFjaG1lbnRMb2NhdGlvbixcbiAgLy8gQFRPRE8gbG9vayBpbnRvIHJlbW92aW5nIHRoaXMgYGlkYCBwcm9wIGFuZCB1cGRhdGluZyBhdXRvbWF0ZWQgcmVncmVzc2lvbiB0ZXN0cyB0byB1c2UgZGF0YVxuICAvLyBhdHRyaWJ1dGVzIG9yIHNvbWUgb3RoZXIgc2VsZWN0b3Igc28gd2UgZWxpbWluYXRlIHRoZSBwb3RlbnRpYWwgZm9yIHBvbGx1dGluZyB0aGUgRE9NXG4gIC8vIHdpdGggZWxlbWVudHMgdGhhdCBoYXZlIHRoZSBzYW1lIElEIHZhbHVlXG4gIGlkPzogc3RyaW5nLFxuICBpdGVtSGVpZ2h0Pzogc3RyaW5nLFxuICBpdGVtczogQXJyYXk8T2JqZWN0PixcbiAgb25CdXR0b25DbGljazogKCkgPT4gdm9pZCxcbiAgb25JdGVtU2VsZWN0OiAoaXRlbTogT2JqZWN0KSA9PiB2b2lkLFxuICBvblNlYXJjaENoYW5nZTogKGNoYW5nZTogT2JqZWN0KSA9PiB2b2lkLFxuICBvcGVuOiBib29sZWFuLFxuICBwb3BvdmVyWkluZGV4Pzogc3RyaW5nLFxuICBzZWFyY2hQbGFjZWhvbGRlcj86IHN0cmluZyxcbiAgc2VhcmNoVmFsdWU/OiBzdHJpbmcsXG4gIHNob3dTZWFyY2g6IGJvb2xlYW4sXG4gIHNpemU6IEJ1dHRvblNpemUsXG4gIHZhbHVlPzogc3RyaW5nLFxuICB2aXNpYmxlSXRlbUNvdW50PzogbnVtYmVyLFxufTtcblxuQFJhZGl1bVxuY2xhc3MgVHhsQnV0dG9uU2VsZWN0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgcHJvcHM6IFByb3BzO1xuXG4gIGNvbXBvbmVudERpZFVwZGF0ZShwcmV2UHJvcHM6IFByb3BzKSB7XG4gICAgY29uc3QgeyBzZWFyY2hCb3ggfSA9IHRoaXMucmVmcztcbiAgICAvLyBvbmx5IGZvY3VzIHRleHQgZmllbGQgaWYgd2UncmUgdHJhbnNpdGlvbmluZyB0byBvcGVuIHN0YXRlIG90aGVyd2lzZSBlYWNoIHJlbmRlciwgZS5nLixcbiAgICAvLyB1c2VyIHR5cGluZyBpbiBzZWFyY2ggYm94LCB3aWxsIFwicmUtZm9jdXNcIiB0ZXh0IGZpZWxkXG4gICAgaWYgKCFwcmV2UHJvcHMub3BlbiAmJiB0aGlzLnByb3BzLm9wZW4gJiYgc2VhcmNoQm94KSB7XG4gICAgICBzZWFyY2hCb3guZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZVNlYXJjaENsZWFyKCkge1xuICAgIHRoaXMucHJvcHMub25TZWFyY2hDaGFuZ2UoeyB2YWx1ZTogJycgfSk7XG4gICAgLy8gcHV0IGN1cnNvciBiYWNrIGluIHRleHQgZmllbGQgYWZ0ZXIgdXNlciBjbGVhcnMgc2VhcmNoIHRlcm1cbiAgICBpZiAodGhpcy5yZWZzLnNlYXJjaEJveCkge1xuICAgICAgdGhpcy5yZWZzLnNlYXJjaEJveC5mb2N1cygpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpOiBSZWFjdC5FbGVtZW50PGFueT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGFuY2hvckNvbXBvbmVudCxcbiAgICAgIGJ1dHRvblRleHQsXG4gICAgICBkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbixcbiAgICAgIGRyb3Bkb3duV2lkdGgsXG4gICAgICBpZCxcbiAgICAgIGl0ZW1IZWlnaHQsXG4gICAgICBpdGVtcyxcbiAgICAgIG9uQnV0dG9uQ2xpY2ssXG4gICAgICBvbkl0ZW1TZWxlY3QsXG4gICAgICBvblNlYXJjaENoYW5nZSxcbiAgICAgIG9wZW4sXG4gICAgICBwb3BvdmVyWkluZGV4LFxuICAgICAgc2VhcmNoUGxhY2Vob2xkZXIsXG4gICAgICBzZWFyY2hWYWx1ZSxcbiAgICAgIHNob3dTZWFyY2gsXG4gICAgICBzaXplLFxuICAgICAgdmFsdWUsXG4gICAgICB2aXNpYmxlSXRlbUNvdW50LFxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgY29uc3QgYnV0dG9uQXJyb3dTdHlsZSA9IG9wZW4gPyBCVVRUT05fQVJST1dfT1BFTiA6IEJVVFRPTl9BUlJPVztcbiAgICBjb25zdCBoYXNJdGVtcyA9ICEhKGl0ZW1zICYmIGl0ZW1zLmxlbmd0aCk7XG4gICAgY29uc3Qgbm9JdGVtc01hdGNoaW5nID0gIWhhc0l0ZW1zICYmIHNlYXJjaFZhbHVlO1xuXG4gICAgY29uc3QgZHJvcGRvd25Db250ZW50ID0gKFxuICAgICAgPENvbnRhaW5lcj5cbiAgICAgICAge3Nob3dTZWFyY2ggJiZcbiAgICAgICAgICA8U2VhcmNoQm94XG4gICAgICAgICAgICBvbkNsZWFyPXt0aGlzLl9oYW5kbGVTZWFyY2hDbGVhcn1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXtvblNlYXJjaENoYW5nZX1cbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtzZWFyY2hQbGFjZWhvbGRlcn1cbiAgICAgICAgICAgIHJlZj1cInNlYXJjaEJveFwiXG4gICAgICAgICAgICB2YWx1ZT17c2VhcmNoVmFsdWV9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuXG4gICAgICAgIHtoYXNJdGVtcyAmJlxuICAgICAgICAgIDxTZWxlY3RhYmxlSXRlbUxpc3RcbiAgICAgICAgICAgIGl0ZW1IZWlnaHQ9e2l0ZW1IZWlnaHR9XG4gICAgICAgICAgICBpdGVtcz17aXRlbXN9XG4gICAgICAgICAgICBvbkNsaWNrPXtvbkl0ZW1TZWxlY3R9XG4gICAgICAgICAgICByZWY9XCJpdGVtTGlzdFwiXG4gICAgICAgICAgICBzZWxlY3RlZFZhbHVlcz17W3ZhbHVlXX1cbiAgICAgICAgICAgIHZpc2libGVJdGVtQ291bnQ9e3Zpc2libGVJdGVtQ291bnR9XG4gICAgICAgICAgLz5cbiAgICAgICAgfVxuXG4gICAgICAgIHtub0l0ZW1zTWF0Y2hpbmcgJiZcbiAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICByZWY9XCJub01hdGNoaW5nSXRlbXNDb250ZW50XCJcbiAgICAgICAgICAgIHN0eWxlPXtOT19NQVRDSElOR19JVEVNU19TVFlMRX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICB7Tk9fTUFUQ0hJTkdfSVRFTVNfVEVYVH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgfVxuXG4gICAgICAgIHshIWFuY2hvckNvbXBvbmVudCAmJlxuICAgICAgICAgIDxkaXYgc3R5bGU9e0FOQ0hPUl9DT01QT05FTlRfU1RZTEV9PlxuICAgICAgICAgICAge2FuY2hvckNvbXBvbmVudH1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgfVxuICAgICAgPC9Db250YWluZXI+XG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8RHJvcGRvd25UYXJnZXRCYXNlXG4gICAgICAgIGF0dGFjaG1lbnRMb2NhdGlvbj17ZHJvcGRvd25BdHRhY2htZW50TG9jYXRpb259XG4gICAgICAgIGNvbXBvbmVudE5hbWU9XCJUeGxCdXR0b25TZWxlY3RcIlxuICAgICAgICBjb250ZW50PXtkcm9wZG93bkNvbnRlbnR9XG4gICAgICAgIGlkPXtpZH1cbiAgICAgICAgcG9wb3ZlclpJbmRleD17cG9wb3ZlclpJbmRleH1cbiAgICAgICAgcmVmPVwiZHJvcGRvd25UYXJnZXRCYXNlXCJcbiAgICAgICAgdmlzaWJsZT17b3Blbn1cbiAgICAgICAgd2lkdGg9e2Ryb3Bkb3duV2lkdGh9XG4gICAgICAgIHlPZmZzZXQ9e2d1UmF3KC0xKX1cbiAgICAgID5cbiAgICAgICAgPEJ1dHRvblxuICAgICAgICAgIF9zdHlsZT17QlVUVE9OX0VYVFJBfVxuICAgICAgICAgIG9uQ2xpY2s9e29uQnV0dG9uQ2xpY2t9XG4gICAgICAgICAgcmVmPVwiYnV0dG9uXCJcbiAgICAgICAgICBzaXplPXtzaXplfVxuICAgICAgICAgIHZhcmlhbnQ9XCJtdXRlZFwiXG4gICAgICAgID5cbiAgICAgICAgICA8c3BhblxuICAgICAgICAgICAgZGF0YS10ZXN0LWJ1dHRvbi1jb250ZW50XG4gICAgICAgICAgICBzdHlsZT17QlVUVE9OX0NPTlRFTlRfV1JBUFBFUn1cbiAgICAgICAgICA+XG4gICAgICAgICAgICA8VHJ1bmNhdGVkVGV4dCB0ZXh0PXtidXR0b25UZXh0fSAvPlxuICAgICAgICAgICAgPHNwYW4gc3R5bGU9e2J1dHRvbkFycm93U3R5bGV9PlxuICAgICAgICAgICAgICA8QXJyb3dEb3duIC8+XG4gICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICA8L0J1dHRvbj5cbiAgICAgIDwvRHJvcGRvd25UYXJnZXRCYXNlPlxuICAgICk7XG4gIH1cbn1cblxuVHhsQnV0dG9uU2VsZWN0LmRlZmF1bHRQcm9wcyA9IHtcbiAgYnV0dG9uVGV4dDogJycsXG4gIG9uQnV0dG9uQ2xpY2s6IE5PT1AsXG4gIG9uSXRlbVNlbGVjdDogTk9PUCxcbiAgb25TZWFyY2hDaGFuZ2U6IE5PT1AsXG4gIG9wZW46IGZhbHNlLFxuICBzZWFyY2hQbGFjZWhvbGRlcjogU2VhcmNoQm94LmRlZmF1bHRQcm9wcy5wbGFjZWhvbGRlcixcbiAgc2hvd1NlYXJjaDogZmFsc2UsXG4gIHNpemU6IEJ1dHRvbi5kZWZhdWx0UHJvcHMuc2l6ZSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFR4bEJ1dHRvblNlbGVjdDtcbiJdfQ==