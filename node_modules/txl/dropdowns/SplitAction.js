'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _clone = require('lodash/clone');

var _clone2 = _interopRequireDefault(_clone);

var _helpers = require('../styles/helpers');

var _ButtonStyleHelpers = require('../buttons/_ButtonStyleHelpers');

var _theme = require('../styles/theme');

var _Base = require('../base/Base');

var _createDropdown = require('./_createDropdown');

var _createDropdown2 = _interopRequireDefault(_createDropdown);

var _Button = require('../buttons/Button');

var _Button2 = _interopRequireDefault(_Button);

var _IconButton = require('../buttons/IconButton');

var _IconButton2 = _interopRequireDefault(_IconButton);

var _More = require('../icons/More');

var _More2 = _interopRequireDefault(_More);

var _LoadingIndicator = require('../progress-indicators/LoadingIndicator');

var _LoadingIndicator2 = _interopRequireDefault(_LoadingIndicator);

var _FlyoutTargetBase = require('./_FlyoutTargetBase');

var _FlyoutTargetBase2 = _interopRequireDefault(_FlyoutTargetBase);

var _Container = require('../containers/Container');

var _Container2 = _interopRequireDefault(_Container);

var _FlatSelectableItemList = require('../lists/_FlatSelectableItemList');

var _FlatSelectableItemList2 = _interopRequireDefault(_FlatSelectableItemList);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var babelPluginFlowReactPropTypes_proptype_ButtonVariant = require('../buttons/Button').babelPluginFlowReactPropTypes_proptype_ButtonVariant || require('react').PropTypes.any;

var babelPluginFlowReactPropTypes_proptype_ButtonSize = require('../buttons/Button').babelPluginFlowReactPropTypes_proptype_ButtonSize || require('react').PropTypes.any;

var WRAPPER_STYLES = {
  position: 'relative'
};

var BUTTONS_WRAP = {
  display: 'inline-flex'
};

var MAIN_BUTTON_EXTRA = {
  borderBottomRightRadius: 0,
  borderTopRightRadius: 0
};

var MORE_BUTTON_EXTRA = {
  borderBottomLeftRadius: 0,
  borderLeft: '1px solid white', // border separator
  borderTopLeftRadius: 0,
  marginLeft: 0 };

var LOADING_BUTTON_EXTRA = (0, _extends3.default)({}, MORE_BUTTON_EXTRA, {
  borderLeft: '1px solid transparent',
  display: 'inline-flex',
  justifyContent: 'center',
  paddingLeft: 0,
  paddingRight: 0
});

var TxlSplitAction = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlSplitAction, _React$Component);

  function TxlSplitAction(props, context) {
    (0, _classCallCheck3.default)(this, TxlSplitAction);

    var _this = (0, _possibleConstructorReturn3.default)(this, (TxlSplitAction.__proto__ || (0, _getPrototypeOf2.default)(TxlSplitAction)).call(this, props, context));

    _this.state = { value: undefined };
    _this._mainAction = {};
    _this._items = [];
    return _this;
  }

  (0, _createClass3.default)(TxlSplitAction, [{
    key: 'componentWillMount',
    value: function componentWillMount() {
      this._updateLists(this.props);
    }
  }, {
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      this._updateLists(nextProps);
    }
  }, {
    key: '_toggleDropdown',
    value: function _toggleDropdown() {
      this.props.updateDropdown && this.props.updateDropdown({ open: !this.props.open });
    }
  }, {
    key: '_updateLists',
    value: function _updateLists(props) {
      this._mainAction = this.props.items.filter(function (item) {
        return item.value === props.mainActionValue;
      })[0];
      this._items = this.props.items.filter(function (item) {
        return item.value !== props.mainActionValue;
      });
    }
  }, {
    key: '_handleAction',
    value: function _handleAction(item) {
      if (this.props.open) {
        this.props.updateDropdown && this.props.updateDropdown({ open: false });
      }
      this.props.onAction && this.props.onAction(item);
    }
  }, {
    key: '_handleMainAction',
    value: function _handleMainAction() {
      /**
       * mainAction must be cloned when calling, while items does not because
       * FlatSelectableItemList onChange callback is called with a clone already
       */
      this._handleAction((0, _clone2.default)(this._mainAction, true));
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          loading = _props.loading,
          open = _props.open,
          size = _props.size,
          variant = _props.variant;


      var loadingButtonColors = void 0;
      if (loading) {
        var loadingStyles = (0, _ButtonStyleHelpers.getButtonStylesFromProps)(this.props, { hovered: true }, this.context.txlAppTheme);
        loadingButtonColors = {
          backgroundColor: loadingStyles.backgroundColor,
          color: loadingStyles.color
        };
      }

      var moreButtonSize = function (val) {
        return {
          height: (0, _helpers.gridUnits)(val),
          width: (0, _helpers.gridUnitsRaw)(val) + 1
        };
      }(size === 'standard' ? 5 : 7);

      var loadingButtonStyles = (0, _helpers.combineStyles)(LOADING_BUTTON_EXTRA, loadingButtonColors, moreButtonSize);

      var mainActionColors = (0, _helpers.combineStyles)(MAIN_BUTTON_EXTRA, loadingButtonColors);

      var moreButtonStyles = (0, _helpers.combineStyles)(MORE_BUTTON_EXTRA, moreButtonSize);

      var buttonProps = {
        size: size,
        variant: variant
      };

      var flyoutContent = _react2.default.createElement(
        _Container2.default,
        null,
        _react2.default.createElement(_FlatSelectableItemList2.default, {
          items: this._items,
          onClick: this._handleAction,
          selectedValues: [this.state.value]
        })
      );

      return _react2.default.createElement(
        'div',
        { style: BUTTONS_WRAP },
        _react2.default.createElement(
          'span',
          { 'data-test-main-action': true },
          _react2.default.createElement(
            _Button2.default,
            (0, _extends3.default)({
              _style: mainActionColors,
              onClick: this._handleMainAction
            }, buttonProps),
            this._mainAction.label
          )
        ),
        _react2.default.createElement(
          _FlyoutTargetBase2.default,
          {
            componentName: 'TxlSplitActionButton',
            style: WRAPPER_STYLES,
            content: flyoutContent,
            visible: open
          },
          loading ? _react2.default.createElement(
            _Button2.default,
            (0, _extends3.default)({
              size: size,
              _style: loadingButtonStyles
            }, buttonProps),
            _react2.default.createElement(_LoadingIndicator2.default, {
              size: 'small',
              color: loadingButtonStyles.color
            })
          ) : _react2.default.createElement(
            'span',
            { 'data-test-more-button': true },
            _react2.default.createElement(_IconButton2.default, (0, _extends3.default)({
              icon: _More2.default,
              _style: moreButtonStyles,
              onClick: this._toggleDropdown
            }, buttonProps))
          )
        )
      );
    }
  }]);
  return TxlSplitAction;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_toggleDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_toggleDropdown'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_updateLists', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_updateLists'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleAction', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleAction'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleMainAction', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleMainAction'), _class2.prototype)), _class2)) || _class;

TxlSplitAction.propTypes = {
  items: require('react').PropTypes.arrayOf(require('react').PropTypes.shape({
    label: require('react').PropTypes.any.isRequired,
    value: require('react').PropTypes.string.isRequired
  })).isRequired,
  loading: require('react').PropTypes.bool,
  mainActionValue: require('react').PropTypes.string.isRequired,
  onAction: require('react').PropTypes.func.isRequired,
  open: require('react').PropTypes.bool,
  size: babelPluginFlowReactPropTypes_proptype_ButtonSize,
  updateDropdown: require('react').PropTypes.func,
  variant: babelPluginFlowReactPropTypes_proptype_ButtonVariant
};


TxlSplitAction.defaultProps = {
  onAction: _Base.NOOP,
  size: _Button2.default.defaultProps.size,
  updateDropdown: _Base.NOOP
};

TxlSplitAction.contextTypes = {
  txlAppTheme: _theme.contextThemePropType
};

var _default = (0, _createDropdown2.default)(TxlSplitAction);

exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(WRAPPER_STYLES, 'WRAPPER_STYLES', 'src/dropdowns/SplitAction.jsx');

  __REACT_HOT_LOADER__.register(BUTTONS_WRAP, 'BUTTONS_WRAP', 'src/dropdowns/SplitAction.jsx');

  __REACT_HOT_LOADER__.register(MAIN_BUTTON_EXTRA, 'MAIN_BUTTON_EXTRA', 'src/dropdowns/SplitAction.jsx');

  __REACT_HOT_LOADER__.register(MORE_BUTTON_EXTRA, 'MORE_BUTTON_EXTRA', 'src/dropdowns/SplitAction.jsx');

  __REACT_HOT_LOADER__.register(LOADING_BUTTON_EXTRA, 'LOADING_BUTTON_EXTRA', 'src/dropdowns/SplitAction.jsx');

  __REACT_HOT_LOADER__.register(TxlSplitAction, 'TxlSplitAction', 'src/dropdowns/SplitAction.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/dropdowns/SplitAction.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kcm9wZG93bnMvU3BsaXRBY3Rpb24uanN4Il0sIm5hbWVzIjpbIldSQVBQRVJfU1RZTEVTIiwicG9zaXRpb24iLCJCVVRUT05TX1dSQVAiLCJkaXNwbGF5IiwiTUFJTl9CVVRUT05fRVhUUkEiLCJib3JkZXJCb3R0b21SaWdodFJhZGl1cyIsImJvcmRlclRvcFJpZ2h0UmFkaXVzIiwiTU9SRV9CVVRUT05fRVhUUkEiLCJib3JkZXJCb3R0b21MZWZ0UmFkaXVzIiwiYm9yZGVyTGVmdCIsImJvcmRlclRvcExlZnRSYWRpdXMiLCJtYXJnaW5MZWZ0IiwiTE9BRElOR19CVVRUT05fRVhUUkEiLCJqdXN0aWZ5Q29udGVudCIsInBhZGRpbmdMZWZ0IiwicGFkZGluZ1JpZ2h0IiwiVHhsU3BsaXRBY3Rpb24iLCJwcm9wcyIsImNvbnRleHQiLCJzdGF0ZSIsInZhbHVlIiwidW5kZWZpbmVkIiwiX21haW5BY3Rpb24iLCJfaXRlbXMiLCJfdXBkYXRlTGlzdHMiLCJuZXh0UHJvcHMiLCJ1cGRhdGVEcm9wZG93biIsIm9wZW4iLCJpdGVtcyIsImZpbHRlciIsIml0ZW0iLCJtYWluQWN0aW9uVmFsdWUiLCJvbkFjdGlvbiIsIl9oYW5kbGVBY3Rpb24iLCJsb2FkaW5nIiwic2l6ZSIsInZhcmlhbnQiLCJsb2FkaW5nQnV0dG9uQ29sb3JzIiwibG9hZGluZ1N0eWxlcyIsImhvdmVyZWQiLCJ0eGxBcHBUaGVtZSIsImJhY2tncm91bmRDb2xvciIsImNvbG9yIiwibW9yZUJ1dHRvblNpemUiLCJoZWlnaHQiLCJ2YWwiLCJ3aWR0aCIsImxvYWRpbmdCdXR0b25TdHlsZXMiLCJtYWluQWN0aW9uQ29sb3JzIiwibW9yZUJ1dHRvblN0eWxlcyIsImJ1dHRvblByb3BzIiwiZmx5b3V0Q29udGVudCIsIl9oYW5kbGVNYWluQWN0aW9uIiwibGFiZWwiLCJfdG9nZ2xlRHJvcGRvd24iLCJDb21wb25lbnQiLCJkZWZhdWx0UHJvcHMiLCJjb250ZXh0VHlwZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOztBQUtBOztBQUNBOztBQUNBOztBQUlBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1BLElBQU1BLGlCQUFpQjtBQUNyQkMsWUFBVTtBQURXLENBQXZCOztBQUlBLElBQU1DLGVBQWU7QUFDbkJDLFdBQVM7QUFEVSxDQUFyQjs7QUFJQSxJQUFNQyxvQkFBb0I7QUFDeEJDLDJCQUF5QixDQUREO0FBRXhCQyx3QkFBc0I7QUFGRSxDQUExQjs7QUFLQSxJQUFNQyxvQkFBb0I7QUFDeEJDLDBCQUF3QixDQURBO0FBRXhCQyxjQUFZLGlCQUZZLEVBRU87QUFDL0JDLHVCQUFxQixDQUhHO0FBSXhCQyxjQUFZLENBSlksRUFBMUI7O0FBT0EsSUFBTUMsa0RBQ0RMLGlCQURDO0FBRUpFLGNBQVksdUJBRlI7QUFHSk4sV0FBUyxhQUhMO0FBSUpVLGtCQUFnQixRQUpaO0FBS0pDLGVBQWEsQ0FMVDtBQU1KQyxnQkFBYztBQU5WLEVBQU47O0lBdUJNQyxjOzs7QUFHSiwwQkFBWUMsS0FBWixFQUEwQkMsT0FBMUIsRUFBMkM7QUFBQTs7QUFBQSxzSkFDbkNELEtBRG1DLEVBQzVCQyxPQUQ0Qjs7QUFFekMsVUFBS0MsS0FBTCxHQUFhLEVBQUVDLE9BQU9DLFNBQVQsRUFBYjtBQUNBLFVBQUtDLFdBQUwsR0FBbUIsRUFBbkI7QUFDQSxVQUFLQyxNQUFMLEdBQWMsRUFBZDtBQUp5QztBQUsxQzs7Ozt5Q0FFb0I7QUFDbkIsV0FBS0MsWUFBTCxDQUFrQixLQUFLUCxLQUF2QjtBQUNEOzs7OENBRXlCUSxTLEVBQVc7QUFDbkMsV0FBS0QsWUFBTCxDQUFrQkMsU0FBbEI7QUFDRDs7O3NDQUdpQjtBQUNoQixXQUFLUixLQUFMLENBQVdTLGNBQVgsSUFBNkIsS0FBS1QsS0FBTCxDQUFXUyxjQUFYLENBQTBCLEVBQUVDLE1BQU0sQ0FBQyxLQUFLVixLQUFMLENBQVdVLElBQXBCLEVBQTFCLENBQTdCO0FBQ0Q7OztpQ0FHWVYsSyxFQUFPO0FBQ2xCLFdBQUtLLFdBQUwsR0FBbUIsS0FBS0wsS0FBTCxDQUFXVyxLQUFYLENBQWlCQyxNQUFqQixDQUF3QjtBQUFBLGVBQVFDLEtBQUtWLEtBQUwsS0FBZUgsTUFBTWMsZUFBN0I7QUFBQSxPQUF4QixFQUFzRSxDQUF0RSxDQUFuQjtBQUNBLFdBQUtSLE1BQUwsR0FBYyxLQUFLTixLQUFMLENBQVdXLEtBQVgsQ0FBaUJDLE1BQWpCLENBQXdCO0FBQUEsZUFBUUMsS0FBS1YsS0FBTCxLQUFlSCxNQUFNYyxlQUE3QjtBQUFBLE9BQXhCLENBQWQ7QUFDRDs7O2tDQUdhRCxJLEVBQU07QUFDbEIsVUFBSSxLQUFLYixLQUFMLENBQVdVLElBQWYsRUFBcUI7QUFDbkIsYUFBS1YsS0FBTCxDQUFXUyxjQUFYLElBQTZCLEtBQUtULEtBQUwsQ0FBV1MsY0FBWCxDQUEwQixFQUFFQyxNQUFNLEtBQVIsRUFBMUIsQ0FBN0I7QUFDRDtBQUNELFdBQUtWLEtBQUwsQ0FBV2UsUUFBWCxJQUF1QixLQUFLZixLQUFMLENBQVdlLFFBQVgsQ0FBb0JGLElBQXBCLENBQXZCO0FBQ0Q7Ozt3Q0FHbUI7QUFDbEI7Ozs7QUFJQSxXQUFLRyxhQUFMLENBQW1CLHFCQUFNLEtBQUtYLFdBQVgsRUFBd0IsSUFBeEIsQ0FBbkI7QUFDRDs7OzZCQUU0QjtBQUFBLG1CQU12QixLQUFLTCxLQU5rQjtBQUFBLFVBRXpCaUIsT0FGeUIsVUFFekJBLE9BRnlCO0FBQUEsVUFHekJQLElBSHlCLFVBR3pCQSxJQUh5QjtBQUFBLFVBSXpCUSxJQUp5QixVQUl6QkEsSUFKeUI7QUFBQSxVQUt6QkMsT0FMeUIsVUFLekJBLE9BTHlCOzs7QUFRM0IsVUFBSUMsNEJBQUo7QUFDQSxVQUFJSCxPQUFKLEVBQWE7QUFDWCxZQUFNSSxnQkFBZ0Isa0RBQ3BCLEtBQUtyQixLQURlLEVBRXBCLEVBQUVzQixTQUFTLElBQVgsRUFGb0IsRUFHcEIsS0FBS3JCLE9BQUwsQ0FBYXNCLFdBSE8sQ0FBdEI7QUFLQUgsOEJBQXNCO0FBQ3BCSSwyQkFBaUJILGNBQWNHLGVBRFg7QUFFcEJDLGlCQUFPSixjQUFjSTtBQUZELFNBQXRCO0FBSUQ7O0FBRUQsVUFBTUMsaUJBQWtCO0FBQUEsZUFBUTtBQUM5QkMsa0JBQVEsd0JBQUdDLEdBQUgsQ0FEc0I7QUFFOUJDLGlCQUFPLDJCQUFNRCxHQUFOLElBQWE7QUFGVSxTQUFSO0FBQUEsT0FBRCxDQUduQlYsU0FBUyxVQUFULEdBQXNCLENBQXRCLEdBQTBCLENBSFAsQ0FBdkI7O0FBS0EsVUFBTVksc0JBQXNCLDRCQUMxQm5DLG9CQUQwQixFQUUxQnlCLG1CQUYwQixFQUcxQk0sY0FIMEIsQ0FBNUI7O0FBTUEsVUFBTUssbUJBQW1CLDRCQUN2QjVDLGlCQUR1QixFQUV2QmlDLG1CQUZ1QixDQUF6Qjs7QUFLQSxVQUFNWSxtQkFBbUIsNEJBQ3ZCMUMsaUJBRHVCLEVBRXZCb0MsY0FGdUIsQ0FBekI7O0FBS0EsVUFBTU8sY0FBYztBQUNsQmYsa0JBRGtCO0FBRWxCQztBQUZrQixPQUFwQjs7QUFLQSxVQUFNZSxnQkFDSjtBQUFBO0FBQUE7QUFDRTtBQUNFLGlCQUFPLEtBQUs1QixNQURkO0FBRUUsbUJBQVMsS0FBS1UsYUFGaEI7QUFHRSwwQkFBZ0IsQ0FBQyxLQUFLZCxLQUFMLENBQVdDLEtBQVo7QUFIbEI7QUFERixPQURGOztBQVVBLGFBQ0U7QUFBQTtBQUFBLFVBQUssT0FBT2xCLFlBQVo7QUFDRTtBQUFBO0FBQUEsWUFBTSw2QkFBTjtBQUNFO0FBQUE7QUFBQTtBQUNFLHNCQUFROEMsZ0JBRFY7QUFFRSx1QkFBUyxLQUFLSTtBQUZoQixlQUdNRixXQUhOO0FBS0csaUJBQUs1QixXQUFMLENBQWlCK0I7QUFMcEI7QUFERixTQURGO0FBVUU7QUFBQTtBQUFBO0FBQ0UsMkJBQWMsc0JBRGhCO0FBRUUsbUJBQU9yRCxjQUZUO0FBR0UscUJBQVNtRCxhQUhYO0FBSUUscUJBQVN4QjtBQUpYO0FBTUdPLG9CQUNDO0FBQUE7QUFBQTtBQUNFLG9CQUFNQyxJQURSO0FBRUUsc0JBQVFZO0FBRlYsZUFHTUcsV0FITjtBQUtFO0FBQ0Usb0JBQUssT0FEUDtBQUVFLHFCQUFPSCxvQkFBb0JMO0FBRjdCO0FBTEYsV0FERCxHQVlDO0FBQUE7QUFBQSxjQUFNLDZCQUFOO0FBQ0U7QUFDRSxrQ0FERjtBQUVFLHNCQUFRTyxnQkFGVjtBQUdFLHVCQUFTLEtBQUtLO0FBSGhCLGVBSU1KLFdBSk47QUFERjtBQWxCSjtBQVZGLE9BREY7QUF5Q0Q7OztFQWhKMEIsZ0JBQU1LLFM7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBbUpuQ3ZDLGVBQWV3QyxZQUFmLEdBQThCO0FBQzVCeEIsc0JBRDRCO0FBRTVCRyxRQUFNLGlCQUFPcUIsWUFBUCxDQUFvQnJCLElBRkU7QUFHNUJUO0FBSDRCLENBQTlCOztBQU1BVixlQUFleUMsWUFBZixHQUE4QjtBQUM1QmpCO0FBRDRCLENBQTlCOztlQUllLDhCQUFleEIsY0FBZixDOzs7Ozs7Ozs7O2dDQXhNVGhCLGM7O2dDQUlBRSxZOztnQ0FJQUUsaUI7O2dDQUtBRyxpQjs7Z0NBT0FLLG9COztnQ0F1QkFJLGMiLCJmaWxlIjoiU3BsaXRBY3Rpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSYWRpdW0gZnJvbSAncmFkaXVtJztcbmltcG9ydCBjbG9uZSBmcm9tICdsb2Rhc2gvY2xvbmUnO1xuXG5pbXBvcnQge1xuICBjb21iaW5lU3R5bGVzLFxuICBncmlkVW5pdHMgYXMgZ3UsXG4gIGdyaWRVbml0c1JhdyBhcyBndVJhdyxcbn0gZnJvbSAnLi4vc3R5bGVzL2hlbHBlcnMnO1xuaW1wb3J0IHsgZ2V0QnV0dG9uU3R5bGVzRnJvbVByb3BzIH0gZnJvbSAnLi4vYnV0dG9ucy9fQnV0dG9uU3R5bGVIZWxwZXJzJztcbmltcG9ydCB7IGNvbnRleHRUaGVtZVByb3BUeXBlIH0gZnJvbSAnLi4vc3R5bGVzL3RoZW1lJztcbmltcG9ydCB7XG4gIGF1dG9iaW5kLFxuICBOT09QLFxufSBmcm9tICcuLi9iYXNlL0Jhc2UnO1xuaW1wb3J0IGNyZWF0ZURyb3Bkb3duIGZyb20gJy4vX2NyZWF0ZURyb3Bkb3duJztcbmltcG9ydCBCdXR0b24gZnJvbSAnLi4vYnV0dG9ucy9CdXR0b24nO1xuaW1wb3J0IEljb25CdXR0b24gZnJvbSAnLi4vYnV0dG9ucy9JY29uQnV0dG9uJztcbmltcG9ydCBNb3JlIGZyb20gJy4uL2ljb25zL01vcmUnO1xuaW1wb3J0IExvYWRpbmdJbmRpY2F0b3IgZnJvbSAnLi4vcHJvZ3Jlc3MtaW5kaWNhdG9ycy9Mb2FkaW5nSW5kaWNhdG9yJztcbmltcG9ydCBGbHlvdXRUYXJnZXRCYXNlIGZyb20gJy4vX0ZseW91dFRhcmdldEJhc2UnO1xuaW1wb3J0IENvbnRhaW5lciBmcm9tICcuLi9jb250YWluZXJzL0NvbnRhaW5lcic7XG5pbXBvcnQgRmxhdFNlbGVjdGFibGVJdGVtTGlzdCBmcm9tICcuLi9saXN0cy9fRmxhdFNlbGVjdGFibGVJdGVtTGlzdCc7XG5pbXBvcnQgdHlwZSB7XG4gIEJ1dHRvblNpemUsXG4gIEJ1dHRvblZhcmlhbnQsXG59IGZyb20gJy4uL2J1dHRvbnMvQnV0dG9uJztcblxuY29uc3QgV1JBUFBFUl9TVFlMRVMgPSB7XG4gIHBvc2l0aW9uOiAncmVsYXRpdmUnLFxufTtcblxuY29uc3QgQlVUVE9OU19XUkFQID0ge1xuICBkaXNwbGF5OiAnaW5saW5lLWZsZXgnLFxufTtcblxuY29uc3QgTUFJTl9CVVRUT05fRVhUUkEgPSB7XG4gIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiAwLFxuICBib3JkZXJUb3BSaWdodFJhZGl1czogMCxcbn07XG5cbmNvbnN0IE1PUkVfQlVUVE9OX0VYVFJBID0ge1xuICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzOiAwLFxuICBib3JkZXJMZWZ0OiAnMXB4IHNvbGlkIHdoaXRlJywgLy8gYm9yZGVyIHNlcGFyYXRvclxuICBib3JkZXJUb3BMZWZ0UmFkaXVzOiAwLFxuICBtYXJnaW5MZWZ0OiAwLCAvLyBvdmVycmlkZXMgbWF0c3R5bGUgYnV0dG9uK2J1dHRvblxufTtcblxuY29uc3QgTE9BRElOR19CVVRUT05fRVhUUkEgPSB7XG4gIC4uLk1PUkVfQlVUVE9OX0VYVFJBLFxuICBib3JkZXJMZWZ0OiAnMXB4IHNvbGlkIHRyYW5zcGFyZW50JyxcbiAgZGlzcGxheTogJ2lubGluZS1mbGV4JyxcbiAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLFxuICBwYWRkaW5nTGVmdDogMCxcbiAgcGFkZGluZ1JpZ2h0OiAwLFxufTtcblxudHlwZSBJdGVtID0ge2xhYmVsOiBSZWFjdC5FbGVtZW50PGFueT4sIHZhbHVlOiBzdHJpbmd9O1xuXG50eXBlIFByb3BzID0ge1xuICBpdGVtczogQXJyYXk8SXRlbT4sXG4gIGxvYWRpbmc/OiBib29sZWFuLFxuICBtYWluQWN0aW9uVmFsdWU6IHN0cmluZyxcbiAgb25BY3Rpb246IChpdGVtOiBJdGVtKSA9PiB2b2lkLFxuICBvcGVuPzogYm9vbGVhbixcbiAgc2l6ZTogQnV0dG9uU2l6ZSxcbiAgdXBkYXRlRHJvcGRvd24/OiAoc3RhdGU6IHsgb3BlbjogYm9vbGVhbiB9KSA9PiB2b2lkLFxuICB2YXJpYW50OiBCdXR0b25WYXJpYW50LFxufTtcblxuQFJhZGl1bVxuY2xhc3MgVHhsU3BsaXRBY3Rpb24gZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBwcm9wczogUHJvcHM7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzLCBjb250ZXh0OiBPYmplY3QpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG4gICAgdGhpcy5zdGF0ZSA9IHsgdmFsdWU6IHVuZGVmaW5lZCB9O1xuICAgIHRoaXMuX21haW5BY3Rpb24gPSB7fTtcbiAgICB0aGlzLl9pdGVtcyA9IFtdO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgIHRoaXMuX3VwZGF0ZUxpc3RzKHRoaXMucHJvcHMpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICB0aGlzLl91cGRhdGVMaXN0cyhuZXh0UHJvcHMpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF90b2dnbGVEcm9wZG93bigpIHtcbiAgICB0aGlzLnByb3BzLnVwZGF0ZURyb3Bkb3duICYmIHRoaXMucHJvcHMudXBkYXRlRHJvcGRvd24oeyBvcGVuOiAhdGhpcy5wcm9wcy5vcGVuIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF91cGRhdGVMaXN0cyhwcm9wcykge1xuICAgIHRoaXMuX21haW5BY3Rpb24gPSB0aGlzLnByb3BzLml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0udmFsdWUgPT09IHByb3BzLm1haW5BY3Rpb25WYWx1ZSlbMF07XG4gICAgdGhpcy5faXRlbXMgPSB0aGlzLnByb3BzLml0ZW1zLmZpbHRlcihpdGVtID0+IGl0ZW0udmFsdWUgIT09IHByb3BzLm1haW5BY3Rpb25WYWx1ZSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZUFjdGlvbihpdGVtKSB7XG4gICAgaWYgKHRoaXMucHJvcHMub3Blbikge1xuICAgICAgdGhpcy5wcm9wcy51cGRhdGVEcm9wZG93biAmJiB0aGlzLnByb3BzLnVwZGF0ZURyb3Bkb3duKHsgb3BlbjogZmFsc2UgfSk7XG4gICAgfVxuICAgIHRoaXMucHJvcHMub25BY3Rpb24gJiYgdGhpcy5wcm9wcy5vbkFjdGlvbihpdGVtKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlTWFpbkFjdGlvbigpIHtcbiAgICAvKipcbiAgICAgKiBtYWluQWN0aW9uIG11c3QgYmUgY2xvbmVkIHdoZW4gY2FsbGluZywgd2hpbGUgaXRlbXMgZG9lcyBub3QgYmVjYXVzZVxuICAgICAqIEZsYXRTZWxlY3RhYmxlSXRlbUxpc3Qgb25DaGFuZ2UgY2FsbGJhY2sgaXMgY2FsbGVkIHdpdGggYSBjbG9uZSBhbHJlYWR5XG4gICAgICovXG4gICAgdGhpcy5faGFuZGxlQWN0aW9uKGNsb25lKHRoaXMuX21haW5BY3Rpb24sIHRydWUpKTtcbiAgfVxuXG4gIHJlbmRlcigpOiBSZWFjdC5FbGVtZW50PGFueT4ge1xuICAgIGNvbnN0IHtcbiAgICAgIGxvYWRpbmcsXG4gICAgICBvcGVuLFxuICAgICAgc2l6ZSxcbiAgICAgIHZhcmlhbnQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBsZXQgbG9hZGluZ0J1dHRvbkNvbG9ycztcbiAgICBpZiAobG9hZGluZykge1xuICAgICAgY29uc3QgbG9hZGluZ1N0eWxlcyA9IGdldEJ1dHRvblN0eWxlc0Zyb21Qcm9wcyhcbiAgICAgICAgdGhpcy5wcm9wcyxcbiAgICAgICAgeyBob3ZlcmVkOiB0cnVlIH0sXG4gICAgICAgIHRoaXMuY29udGV4dC50eGxBcHBUaGVtZVxuICAgICAgKTtcbiAgICAgIGxvYWRpbmdCdXR0b25Db2xvcnMgPSB7XG4gICAgICAgIGJhY2tncm91bmRDb2xvcjogbG9hZGluZ1N0eWxlcy5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgIGNvbG9yOiBsb2FkaW5nU3R5bGVzLmNvbG9yLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBtb3JlQnV0dG9uU2l6ZSA9ICh2YWwgPT4gKHtcbiAgICAgIGhlaWdodDogZ3UodmFsKSxcbiAgICAgIHdpZHRoOiBndVJhdyh2YWwpICsgMSxcbiAgICB9KSkoc2l6ZSA9PT0gJ3N0YW5kYXJkJyA/IDUgOiA3KTtcblxuICAgIGNvbnN0IGxvYWRpbmdCdXR0b25TdHlsZXMgPSBjb21iaW5lU3R5bGVzKFxuICAgICAgTE9BRElOR19CVVRUT05fRVhUUkEsXG4gICAgICBsb2FkaW5nQnV0dG9uQ29sb3JzLFxuICAgICAgbW9yZUJ1dHRvblNpemVcbiAgICApO1xuXG4gICAgY29uc3QgbWFpbkFjdGlvbkNvbG9ycyA9IGNvbWJpbmVTdHlsZXMoXG4gICAgICBNQUlOX0JVVFRPTl9FWFRSQSxcbiAgICAgIGxvYWRpbmdCdXR0b25Db2xvcnNcbiAgICApO1xuXG4gICAgY29uc3QgbW9yZUJ1dHRvblN0eWxlcyA9IGNvbWJpbmVTdHlsZXMoXG4gICAgICBNT1JFX0JVVFRPTl9FWFRSQSxcbiAgICAgIG1vcmVCdXR0b25TaXplXG4gICAgKTtcblxuICAgIGNvbnN0IGJ1dHRvblByb3BzID0ge1xuICAgICAgc2l6ZSxcbiAgICAgIHZhcmlhbnQsXG4gICAgfTtcblxuICAgIGNvbnN0IGZseW91dENvbnRlbnQgPSAoXG4gICAgICA8Q29udGFpbmVyPlxuICAgICAgICA8RmxhdFNlbGVjdGFibGVJdGVtTGlzdFxuICAgICAgICAgIGl0ZW1zPXt0aGlzLl9pdGVtc31cbiAgICAgICAgICBvbkNsaWNrPXt0aGlzLl9oYW5kbGVBY3Rpb259XG4gICAgICAgICAgc2VsZWN0ZWRWYWx1ZXM9e1t0aGlzLnN0YXRlLnZhbHVlXX1cbiAgICAgICAgLz5cbiAgICAgIDwvQ29udGFpbmVyPlxuICAgICk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBzdHlsZT17QlVUVE9OU19XUkFQfT5cbiAgICAgICAgPHNwYW4gZGF0YS10ZXN0LW1haW4tYWN0aW9uPlxuICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgIF9zdHlsZT17bWFpbkFjdGlvbkNvbG9yc31cbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuX2hhbmRsZU1haW5BY3Rpb259XG4gICAgICAgICAgICB7Li4uYnV0dG9uUHJvcHN9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3RoaXMuX21haW5BY3Rpb24ubGFiZWx9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPEZseW91dFRhcmdldEJhc2VcbiAgICAgICAgICBjb21wb25lbnROYW1lPVwiVHhsU3BsaXRBY3Rpb25CdXR0b25cIlxuICAgICAgICAgIHN0eWxlPXtXUkFQUEVSX1NUWUxFU31cbiAgICAgICAgICBjb250ZW50PXtmbHlvdXRDb250ZW50fVxuICAgICAgICAgIHZpc2libGU9e29wZW59XG4gICAgICAgID5cbiAgICAgICAgICB7bG9hZGluZyA/XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIHNpemU9e3NpemV9XG4gICAgICAgICAgICAgIF9zdHlsZT17bG9hZGluZ0J1dHRvblN0eWxlc31cbiAgICAgICAgICAgICAgey4uLmJ1dHRvblByb3BzfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8TG9hZGluZ0luZGljYXRvclxuICAgICAgICAgICAgICAgIHNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICAgICAgY29sb3I9e2xvYWRpbmdCdXR0b25TdHlsZXMuY29sb3J9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA6XG4gICAgICAgICAgICA8c3BhbiBkYXRhLXRlc3QtbW9yZS1idXR0b24+XG4gICAgICAgICAgICAgIDxJY29uQnV0dG9uXG4gICAgICAgICAgICAgICAgaWNvbj17TW9yZX1cbiAgICAgICAgICAgICAgICBfc3R5bGU9e21vcmVCdXR0b25TdHlsZXN9XG4gICAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5fdG9nZ2xlRHJvcGRvd259XG4gICAgICAgICAgICAgICAgey4uLmJ1dHRvblByb3BzfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIH1cbiAgICAgICAgPC9GbHlvdXRUYXJnZXRCYXNlPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5UeGxTcGxpdEFjdGlvbi5kZWZhdWx0UHJvcHMgPSB7XG4gIG9uQWN0aW9uOiBOT09QLFxuICBzaXplOiBCdXR0b24uZGVmYXVsdFByb3BzLnNpemUsXG4gIHVwZGF0ZURyb3Bkb3duOiBOT09QLFxufTtcblxuVHhsU3BsaXRBY3Rpb24uY29udGV4dFR5cGVzID0ge1xuICB0eGxBcHBUaGVtZTogY29udGV4dFRoZW1lUHJvcFR5cGUsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVEcm9wZG93bihUeGxTcGxpdEFjdGlvbik7XG4iXX0=