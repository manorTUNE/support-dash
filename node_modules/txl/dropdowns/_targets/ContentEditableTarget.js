'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _desc, _value, _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Base = require('../../base/Base');

var _helpers = require('../../styles/helpers');

var _FlexBox = require('../../layout/FlexBox');

var _FlexBox2 = _interopRequireDefault(_FlexBox);

var _InputFieldBase = require('../../input-fields/_InputFieldBase');

var _InputFieldBase2 = _interopRequireDefault(_InputFieldBase);

var _ContentEditable = require('../../input-fields/ContentEditable');

var _ContentEditable2 = _interopRequireDefault(_ContentEditable);

var _ArrowUp = require('../../icons/ArrowUp');

var _ArrowUp2 = _interopRequireDefault(_ArrowUp);

var _ArrowDown = require('../../icons/ArrowDown');

var _ArrowDown2 = _interopRequireDefault(_ArrowDown);

var _ReactUtils = require('../../ReactUtils');

var _KeyCodes = require('../../constants/KeyCodes');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var CONTAINER_PROPS = {
  alignItems: 'flex-end',
  flexWrap: 'nowrap',
  justifyContent: 'space-between'
};

// used to fix container div width so that its children can act on overflow.
// 15px padding to allow for the arrow on dropdown target (13px wide).
var VALUE_INPUT_WRAPPER_STYLES = {
  width: 'calc(100% - ' + (0, _helpers.gridUnits)(3) + ')'
};

var MINIMUM_FIELD_HEIGHT = (0, _helpers.gridUnits)(7);

var TxlContentEditableTarget = (_class = function (_React$Component) {
  (0, _inherits3.default)(TxlContentEditableTarget, _React$Component);

  function TxlContentEditableTarget() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlContentEditableTarget);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlContentEditableTarget.__proto__ || (0, _getPrototypeOf2.default)(TxlContentEditableTarget)).call.apply(_ref, [this].concat(args)));

    _this.state = { focused: false };
    return _this;
  }

  (0, _createClass3.default)(TxlContentEditableTarget, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      var editable = this._contentEditable;
      if (nextProps.open && !this.props.open) {
        editable && typeof editable.focus === 'function' && editable.focus();
      } else if (!nextProps.open && this.props.open) {
        editable && typeof editable.blur === 'function' && editable.blur();
      }
    }
  }, {
    key: '_handleKeyDown',
    value: function _handleKeyDown(e) {
      var _props = this.props,
          onKeyDown = _props.onKeyDown,
          search = _props.search,
          selectItem = _props.selectItem,
          value = _props.value;


      onKeyDown && onKeyDown(e, search);
      if (e.keyCode === _KeyCodes.BACKSPACE && !search) {
        if (Array.isArray(value)) {
          selectItem && selectItem({ item: value.slice(-1).pop() });
        } else {
          selectItem && selectItem({ item: null });
        }
      }
    }
  }, {
    key: '_handleClick',
    value: function _handleClick(e) {
      e.stopPropagation();
      var open = this.props.open;
      var focused = this.state.focused;


      if ((0, _ReactUtils.findDOMNode)(this._arrowButton).contains(e.target)) {
        if (open) {
          this.props.closeDropdown();
        } else {
          this.props.openDropdown();
        }
      } else if (!focused && open || !open) {
        this.props.openDropdown();
      } else {
        this.props.closeDropdown();
      }
    }
  }, {
    key: '_handleOpen',
    value: function _handleOpen() {
      var editable = this._contentEditable;
      if (editable && typeof editable.focus === 'function') {
        editable.focus();
      }
    }
  }, {
    key: '_handleFocus',
    value: function _handleFocus() {
      this.setState({
        focused: true
      }, this.props.openDropdown);
    }
  }, {
    key: '_handleBlur',
    value: function _handleBlur() {
      this.setState({ focused: false });
    }
  }, {
    key: '_handleInputClick',
    value: function _handleInputClick(e) {
      var focused = this.state.focused;

      if (focused) {
        // Prevents dropdown toggle
        e.stopPropagation();
      }
    }
  }, {
    key: '_handleArrowRef',
    value: function _handleArrowRef(ref) {
      this._arrowButton = ref;
    }
  }, {
    key: '_handleContentEditableRef',
    value: function _handleContentEditableRef(ref) {
      this._contentEditable = ref;
    }
  }, {
    key: '_renderArrow',
    value: function _renderArrow() {
      var open = this.props.open;

      var ArrowIcon = open ? _ArrowUp2.default : _ArrowDown2.default;
      var arrowIconContainerStyle = {
        alignItems: 'center',
        display: 'flex',
        minHeight: MINIMUM_FIELD_HEIGHT
      };

      return _react2.default.createElement(
        'div',
        { style: arrowIconContainerStyle },
        _react2.default.createElement(ArrowIcon, { ref: this._handleArrowRef })
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props,
          children = _props2.children,
          disabled = _props2.disabled,
          label = _props2.label,
          open = _props2.open,
          placeholder = _props2.placeholder,
          search = _props2.search,
          secondaryText = _props2.secondaryText,
          shouldInputWrap = _props2.shouldInputWrap,
          updateSearch = _props2.updateSearch,
          validationState = _props2.validationState;

      var targetLineWrapping = shouldInputWrap ? 'wrap' : 'nowrap';

      return _react2.default.createElement(
        _InputFieldBase2.default,
        {
          _afterContent: this._renderArrow,
          _containerProps: CONTAINER_PROPS,
          disabled: disabled,
          focused: open,
          label: label,
          onClick: this._handleClick,
          secondaryText: secondaryText,
          validationState: validationState
        },
        _react2.default.createElement(
          _FlexBox2.default,
          {
            alignItems: 'center',
            flexShrink: 1,
            flexWrap: targetLineWrapping,
            style: VALUE_INPUT_WRAPPER_STYLES
          },
          children,
          _react2.default.createElement(_ContentEditable2.default, {
            onBlur: this._handleBlur,
            onChange: updateSearch,
            onFocus: this._handleFocus,
            onClick: this._handleInputClick,
            onKeyDown: this._handleKeyDown,
            placeholder: placeholder,
            ref: this._handleContentEditableRef,
            spellCheck: false,
            value: search
          })
        )
      );
    }
  }]);
  return TxlContentEditableTarget;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class.prototype, 'componentWillReceiveProps', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, 'componentWillReceiveProps'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleKeyDown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleKeyDown'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleClick'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleOpen', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleOpen'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleFocus', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleFocus'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleBlur', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleBlur'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleInputClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleInputClick'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleArrowRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleArrowRef'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleContentEditableRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleContentEditableRef'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_renderArrow', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_renderArrow'), _class.prototype)), _class);


TxlContentEditableTarget.propTypes = {
  children: _react.PropTypes.any,
  clearSearch: _react.PropTypes.func.isRequired,
  closeDropdown: _react.PropTypes.func,
  disabled: _InputFieldBase2.default.propTypes.disabled,
  items: _react.PropTypes.array,
  label: _InputFieldBase2.default.propTypes.label,
  onKeyDown: _react.PropTypes.func,
  open: _react.PropTypes.bool,
  openDropdown: _react.PropTypes.func,
  placeholder: _react.PropTypes.string,
  search: _ContentEditable2.default.propTypes.value,
  secondaryText: _InputFieldBase2.default.propTypes.secondaryText,
  selectItem: _react.PropTypes.func,
  shouldInputWrap: _react.PropTypes.bool,
  updateSearch: _ContentEditable2.default.propTypes.onChange,
  validationState: _InputFieldBase2.default.propTypes.validationState,
  value: _react.PropTypes.oneOfType([_react.PropTypes.object, _react.PropTypes.array, _react.PropTypes.any]),
  valueMapper: _react.PropTypes.func
};
TxlContentEditableTarget.displayName = 'TxlContentEditableTarget';

var _default = TxlContentEditableTarget;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(CONTAINER_PROPS, 'CONTAINER_PROPS', 'src/dropdowns/_targets/ContentEditableTarget.jsx');

  __REACT_HOT_LOADER__.register(VALUE_INPUT_WRAPPER_STYLES, 'VALUE_INPUT_WRAPPER_STYLES', 'src/dropdowns/_targets/ContentEditableTarget.jsx');

  __REACT_HOT_LOADER__.register(MINIMUM_FIELD_HEIGHT, 'MINIMUM_FIELD_HEIGHT', 'src/dropdowns/_targets/ContentEditableTarget.jsx');

  __REACT_HOT_LOADER__.register(TxlContentEditableTarget, 'TxlContentEditableTarget', 'src/dropdowns/_targets/ContentEditableTarget.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/dropdowns/_targets/ContentEditableTarget.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9kcm9wZG93bnMvX3RhcmdldHMvQ29udGVudEVkaXRhYmxlVGFyZ2V0LmpzeCJdLCJuYW1lcyI6WyJDT05UQUlORVJfUFJPUFMiLCJhbGlnbkl0ZW1zIiwiZmxleFdyYXAiLCJqdXN0aWZ5Q29udGVudCIsIlZBTFVFX0lOUFVUX1dSQVBQRVJfU1RZTEVTIiwid2lkdGgiLCJNSU5JTVVNX0ZJRUxEX0hFSUdIVCIsIlR4bENvbnRlbnRFZGl0YWJsZVRhcmdldCIsImFyZ3MiLCJzdGF0ZSIsImZvY3VzZWQiLCJuZXh0UHJvcHMiLCJlZGl0YWJsZSIsIl9jb250ZW50RWRpdGFibGUiLCJvcGVuIiwicHJvcHMiLCJmb2N1cyIsImJsdXIiLCJlIiwib25LZXlEb3duIiwic2VhcmNoIiwic2VsZWN0SXRlbSIsInZhbHVlIiwia2V5Q29kZSIsIkFycmF5IiwiaXNBcnJheSIsIml0ZW0iLCJzbGljZSIsInBvcCIsInN0b3BQcm9wYWdhdGlvbiIsIl9hcnJvd0J1dHRvbiIsImNvbnRhaW5zIiwidGFyZ2V0IiwiY2xvc2VEcm9wZG93biIsIm9wZW5Ecm9wZG93biIsInNldFN0YXRlIiwicmVmIiwiQXJyb3dJY29uIiwiYXJyb3dJY29uQ29udGFpbmVyU3R5bGUiLCJkaXNwbGF5IiwibWluSGVpZ2h0IiwiX2hhbmRsZUFycm93UmVmIiwiY2hpbGRyZW4iLCJkaXNhYmxlZCIsImxhYmVsIiwicGxhY2Vob2xkZXIiLCJzZWNvbmRhcnlUZXh0Iiwic2hvdWxkSW5wdXRXcmFwIiwidXBkYXRlU2VhcmNoIiwidmFsaWRhdGlvblN0YXRlIiwidGFyZ2V0TGluZVdyYXBwaW5nIiwiX3JlbmRlckFycm93IiwiX2hhbmRsZUNsaWNrIiwiX2hhbmRsZUJsdXIiLCJfaGFuZGxlRm9jdXMiLCJfaGFuZGxlSW5wdXRDbGljayIsIl9oYW5kbGVLZXlEb3duIiwiX2hhbmRsZUNvbnRlbnRFZGl0YWJsZVJlZiIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsImFueSIsImNsZWFyU2VhcmNoIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJpdGVtcyIsImFycmF5IiwiYm9vbCIsInN0cmluZyIsIm9uQ2hhbmdlIiwib25lT2ZUeXBlIiwib2JqZWN0IiwidmFsdWVNYXBwZXIiLCJkaXNwbGF5TmFtZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUVBOztBQUNBOztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsa0JBQWtCO0FBQ3RCQyxjQUFZLFVBRFU7QUFFdEJDLFlBQVUsUUFGWTtBQUd0QkMsa0JBQWdCO0FBSE0sQ0FBeEI7O0FBTUE7QUFDQTtBQUNBLElBQU1DLDZCQUE2QjtBQUNqQ0MsMEJBQXNCLHdCQUFHLENBQUgsQ0FBdEI7QUFEaUMsQ0FBbkM7O0FBSUEsSUFBTUMsdUJBQXVCLHdCQUFHLENBQUgsQ0FBN0I7O0lBRU1DLHdCOzs7QUFDSixzQ0FBcUI7QUFBQTs7QUFBQTs7QUFBQSxzQ0FBTkMsSUFBTTtBQUFOQSxVQUFNO0FBQUE7O0FBQUEscU1BQ1ZBLElBRFU7O0FBRW5CLFVBQUtDLEtBQUwsR0FBYSxFQUFFQyxTQUFTLEtBQVgsRUFBYjtBQUZtQjtBQUdwQjs7Ozs4Q0FHeUJDLFMsRUFBVztBQUNuQyxVQUFNQyxXQUFXLEtBQUtDLGdCQUF0QjtBQUNBLFVBQUlGLFVBQVVHLElBQVYsSUFBa0IsQ0FBQyxLQUFLQyxLQUFMLENBQVdELElBQWxDLEVBQXdDO0FBQ3JDRixvQkFBWSxPQUFPQSxTQUFTSSxLQUFoQixLQUEwQixVQUF2QyxJQUFzREosU0FBU0ksS0FBVCxFQUF0RDtBQUNELE9BRkQsTUFFTyxJQUFJLENBQUNMLFVBQVVHLElBQVgsSUFBbUIsS0FBS0MsS0FBTCxDQUFXRCxJQUFsQyxFQUF3QztBQUM1Q0Ysb0JBQVksT0FBT0EsU0FBU0ssSUFBaEIsS0FBeUIsVUFBdEMsSUFBcURMLFNB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QUFlZSxTQUFmLENBQXlCZixLQU5HO0FBT25DekIsYUFBVyxpQkFBVTJDLElBUGM7QUFRbkNoRCxRQUFNLGlCQUFVb0QsSUFSbUI7QUFTbkNoQyxnQkFBYyxpQkFBVTRCLElBVFc7QUFVbkNqQixlQUFhLGlCQUFVc0IsTUFWWTtBQVduQy9DLFVBQVEsMEJBQWdCdUMsU0FBaEIsQ0FBMEJyQyxLQVhDO0FBWW5Dd0IsaUJBQWUseUJBQWVhLFNBQWYsQ0FBeUJiLGFBWkw7QUFhbkN6QixjQUFZLGlCQUFVeUMsSUFiYTtBQWNuQ2YsbUJBQWlCLGlCQUFVbUIsSUFkUTtBQWVuQ2xCLGdCQUFjLDBCQUFnQlcsU0FBaEIsQ0FBMEJTLFFBZkw7QUFnQm5DbkIsbUJBQWlCLHlCQUFlVSxTQUFmLENBQXlCVixlQWhCUDtBQWlCbkMzQixTQUFPLGlCQUFVK0MsU0FBVixDQUFvQixDQUFDLGlCQUFVQyxNQUFYLEVBQW1CLGlCQUFVTCxLQUE3QixFQUFvQyxpQkFBVUwsR0FBOUMsQ0FBcEIsQ0FqQjRCO0FBa0JuQ1csZUFBYSxpQkFBVVQ7QUFsQlksQ0FBckM7QUFvQkF2RCx5QkFBeUJpRSxXQUF6QixHQUF1QywwQkFBdkM7O2VBRWVqRSx3Qjs7Ozs7Ozs7O2dDQXBNVFAsZTs7Z0NBUUFJLDBCOztnQ0FJQUUsb0I7O2dDQUVBQyx3QiIsImZpbGUiOiJDb250ZW50RWRpdGFibGVUYXJnZXQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgUHJvcFR5cGVzIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uLy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQgeyBncmlkVW5pdHMgYXMgZ3UgfSBmcm9tICcuLi8uLi9zdHlsZXMvaGVscGVycyc7XG5pbXBvcnQgRmxleEJveCBmcm9tICcuLi8uLi9sYXlvdXQvRmxleEJveCc7XG5pbXBvcnQgSW5wdXRGaWVsZEJhc2UgZnJvbSAnLi4vLi4vaW5wdXQtZmllbGRzL19JbnB1dEZpZWxkQmFzZSc7XG5pbXBvcnQgQ29udGVudEVkaXRhYmxlIGZyb20gJy4uLy4uL2lucHV0LWZpZWxkcy9Db250ZW50RWRpdGFibGUnO1xuaW1wb3J0IEFycm93VXAgZnJvbSAnLi4vLi4vaWNvbnMvQXJyb3dVcCc7XG5pbXBvcnQgQXJyb3dEb3duIGZyb20gJy4uLy4uL2ljb25zL0Fycm93RG93bic7XG5pbXBvcnQgeyBmaW5kRE9NTm9kZSB9IGZyb20gJy4uLy4uL1JlYWN0VXRpbHMnO1xuaW1wb3J0IHsgQkFDS1NQQUNFIH0gZnJvbSAnLi4vLi4vY29uc3RhbnRzL0tleUNvZGVzJztcblxuY29uc3QgQ09OVEFJTkVSX1BST1BTID0ge1xuICBhbGlnbkl0ZW1zOiAnZmxleC1lbmQnLFxuICBmbGV4V3JhcDogJ25vd3JhcCcsXG4gIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsXG59O1xuXG4vLyB1c2VkIHRvIGZpeCBjb250YWluZXIgZGl2IHdpZHRoIHNvIHRoYXQgaXRzIGNoaWxkcmVuIGNhbiBhY3Qgb24gb3ZlcmZsb3cuXG4vLyAxNXB4IHBhZGRpbmcgdG8gYWxsb3cgZm9yIHRoZSBhcnJvdyBvbiBkcm9wZG93biB0YXJnZXQgKDEzcHggd2lkZSkuXG5jb25zdCBWQUxVRV9JTlBVVF9XUkFQUEVSX1NUWUxFUyA9IHtcbiAgd2lkdGg6IGBjYWxjKDEwMCUgLSAke2d1KDMpfSlgLFxufTtcblxuY29uc3QgTUlOSU1VTV9GSUVMRF9IRUlHSFQgPSBndSg3KTtcblxuY2xhc3MgVHhsQ29udGVudEVkaXRhYmxlVGFyZ2V0IGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgIHRoaXMuc3RhdGUgPSB7IGZvY3VzZWQ6IGZhbHNlIH07XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBjb25zdCBlZGl0YWJsZSA9IHRoaXMuX2NvbnRlbnRFZGl0YWJsZTtcbiAgICBpZiAobmV4dFByb3BzLm9wZW4gJiYgIXRoaXMucHJvcHMub3Blbikge1xuICAgICAgKGVkaXRhYmxlICYmIHR5cGVvZiBlZGl0YWJsZS5mb2N1cyA9PT0gJ2Z1bmN0aW9uJykgJiYgZWRpdGFibGUuZm9jdXMoKTtcbiAgICB9IGVsc2UgaWYgKCFuZXh0UHJvcHMub3BlbiAmJiB0aGlzLnByb3BzLm9wZW4pIHtcbiAgICAgIChlZGl0YWJsZSAmJiB0eXBlb2YgZWRpdGFibGUuYmx1ciA9PT0gJ2Z1bmN0aW9uJykgJiYgZWRpdGFibGUuYmx1cigpO1xuICAgIH1cbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlS2V5RG93bihlKSB7XG4gICAgY29uc3Qge1xuICAgICAgb25LZXlEb3duLFxuICAgICAgc2VhcmNoLFxuICAgICAgc2VsZWN0SXRlbSxcbiAgICAgIHZhbHVlLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgb25LZXlEb3duICYmIG9uS2V5RG93bihlLCBzZWFyY2gpO1xuICAgIGlmIChlLmtleUNvZGUgPT09IEJBQ0tTUEFDRSAmJiAhc2VhcmNoKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICAgICAgc2VsZWN0SXRlbSAmJiBzZWxlY3RJdGVtKHsgaXRlbTogdmFsdWUuc2xpY2UoLTEpLnBvcCgpIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2VsZWN0SXRlbSAmJiBzZWxlY3RJdGVtKHsgaXRlbTogbnVsbCB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZUNsaWNrKGUpIHtcbiAgICBlLnN0b3BQcm9wYWdhdGlvbigpO1xuICAgIGNvbnN0IHsgb3BlbiB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB7IGZvY3VzZWQgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAoZmluZERPTU5vZGUodGhpcy5fYXJyb3dCdXR0b24pLmNvbnRhaW5zKGUudGFyZ2V0KSkge1xuICAgICAgaWYgKG9wZW4pIHtcbiAgICAgICAgdGhpcy5wcm9wcy5jbG9zZURyb3Bkb3duKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnByb3BzLm9wZW5Ecm9wZG93bigpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoKCFmb2N1c2VkICYmIG9wZW4pIHx8ICFvcGVuKSB7XG4gICAgICB0aGlzLnByb3BzLm9wZW5Ecm9wZG93bigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLmNsb3NlRHJvcGRvd24oKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZU9wZW4oKSB7XG4gICAgY29uc3QgZWRpdGFibGUgPSB0aGlzLl9jb250ZW50RWRpdGFibGU7XG4gICAgaWYgKGVkaXRhYmxlICYmIHR5cGVvZiBlZGl0YWJsZS5mb2N1cyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZWRpdGFibGUuZm9jdXMoKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZUZvY3VzKCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgZm9jdXNlZDogdHJ1ZSxcbiAgICB9LCB0aGlzLnByb3BzLm9wZW5Ecm9wZG93bik7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZUJsdXIoKSB7XG4gICAgdGhpcy5zZXRTdGF0ZSh7IGZvY3VzZWQ6IGZhbHNlIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVJbnB1dENsaWNrKGUpIHtcbiAgICBjb25zdCB7IGZvY3VzZWQgfSA9IHRoaXMuc3RhdGU7XG4gICAgaWYgKGZvY3VzZWQpIHtcbiAgICAgIC8vIFByZXZlbnRzIGRyb3Bkb3duIHRvZ2dsZVxuICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZUFycm93UmVmKHJlZikge1xuICAgIHRoaXMuX2Fycm93QnV0dG9uID0gcmVmO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVDb250ZW50RWRpdGFibGVSZWYocmVmKSB7XG4gICAgdGhpcy5fY29udGVudEVkaXRhYmxlID0gcmVmO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9yZW5kZXJBcnJvdygpIHtcbiAgICBjb25zdCB7IG9wZW4gfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgQXJyb3dJY29uID0gb3BlbiA/IEFycm93VXAgOiBBcnJvd0Rvd247XG4gICAgY29uc3QgYXJyb3dJY29uQ29udGFpbmVyU3R5bGUgPSB7XG4gICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJyxcbiAgICAgIGRpc3BsYXk6ICdmbGV4JyxcbiAgICAgIG1pbkhlaWdodDogTUlOSU1VTV9GSUVMRF9IRUlHSFQsXG4gICAgfTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IHN0eWxlPXthcnJvd0ljb25Db250YWluZXJTdHlsZX0+XG4gICAgICAgIDxBcnJvd0ljb24gcmVmPXt0aGlzLl9oYW5kbGVBcnJvd1JlZn0gLz5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3Qge1xuICAgICAgY2hpbGRyZW4sXG4gICAgICBkaXNhYmxlZCxcbiAgICAgIGxhYmVsLFxuICAgICAgb3BlbixcbiAgICAgIHBsYWNlaG9sZGVyLFxuICAgICAgc2VhcmNoLFxuICAgICAgc2Vjb25kYXJ5VGV4dCxcbiAgICAgIHNob3VsZElucHV0V3JhcCxcbiAgICAgIHVwZGF0ZVNlYXJjaCxcbiAgICAgIHZhbGlkYXRpb25TdGF0ZSxcbiAgICB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCB0YXJnZXRMaW5lV3JhcHBpbmcgPSBzaG91bGRJbnB1dFdyYXAgPyAnd3JhcCcgOiAnbm93cmFwJztcblxuICAgIHJldHVybiAoXG4gICAgICA8SW5wdXRGaWVsZEJhc2VcbiAgICAgICAgX2FmdGVyQ29udGVudD17dGhpcy5fcmVuZGVyQXJyb3d9XG4gICAgICAgIF9jb250YWluZXJQcm9wcz17Q09OVEFJTkVSX1BST1BTfVxuICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9XG4gICAgICAgIGZvY3VzZWQ9e29wZW59XG4gICAgICAgIGxhYmVsPXtsYWJlbH1cbiAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlQ2xpY2t9XG4gICAgICAgIHNlY29uZGFyeVRleHQ9e3NlY29uZGFyeVRleHR9XG4gICAgICAgIHZhbGlkYXRpb25TdGF0ZT17dmFsaWRhdGlvblN0YXRlfVxuICAgICAgPlxuICAgICAgICA8RmxleEJveFxuICAgICAgICAgIGFsaWduSXRlbXM9XCJjZW50ZXJcIlxuICAgICAgICAgIGZsZXhTaHJpbms9ezF9XG4gICAgICAgICAgZmxleFdyYXA9e3RhcmdldExpbmVXcmFwcGluZ31cbiAgICAgICAgICBzdHlsZT17VkFMVUVfSU5QVVRfV1JBUFBFUl9TVFlMRVN9XG4gICAgICAgID5cbiAgICAgICAgICB7Y2hpbGRyZW59XG4gICAgICAgICAgPENvbnRlbnRFZGl0YWJsZVxuICAgICAgICAgICAgb25CbHVyPXt0aGlzLl9oYW5kbGVCbHVyfVxuICAgICAgICAgICAgb25DaGFuZ2U9e3VwZGF0ZVNlYXJjaH1cbiAgICAgICAgICAgIG9uRm9jdXM9e3RoaXMuX2hhbmRsZUZvY3VzfVxuICAgICAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlSW5wdXRDbGlja31cbiAgICAgICAgICAgIG9uS2V5RG93bj17dGhpcy5faGFuZGxlS2V5RG93bn1cbiAgICAgICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgICAgIHJlZj17dGhpcy5faGFuZGxlQ29udGVudEVkaXRhYmxlUmVmfVxuICAgICAgICAgICAgc3BlbGxDaGVjaz17ZmFsc2V9XG4gICAgICAgICAgICB2YWx1ZT17c2VhcmNofVxuICAgICAgICAgIC8+XG4gICAgICAgIDwvRmxleEJveD5cbiAgICAgIDwvSW5wdXRGaWVsZEJhc2U+XG4gICAgKTtcbiAgfVxufVxuXG5UeGxDb250ZW50RWRpdGFibGVUYXJnZXQucHJvcFR5cGVzID0ge1xuICBjaGlsZHJlbjogUHJvcFR5cGVzLmFueSxcbiAgY2xlYXJTZWFyY2g6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIGNsb3NlRHJvcGRvd246IFByb3BUeXBlcy5mdW5jLFxuICBkaXNhYmxlZDogSW5wdXRGaWVsZEJhc2UucHJvcFR5cGVzLmRpc2FibGVkLFxuICBpdGVtczogUHJvcFR5cGVzLmFycmF5LFxuICBsYWJlbDogSW5wdXRGaWVsZEJhc2UucHJvcFR5cGVzLmxhYmVsLFxuICBvbktleURvd246IFByb3BUeXBlcy5mdW5jLFxuICBvcGVuOiBQcm9wVHlwZXMuYm9vbCxcbiAgb3BlbkRyb3Bkb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgcGxhY2Vob2xkZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHNlYXJjaDogQ29udGVudEVkaXRhYmxlLnByb3BUeXBlcy52YWx1ZSxcbiAgc2Vjb25kYXJ5VGV4dDogSW5wdXRGaWVsZEJhc2UucHJvcFR5cGVzLnNlY29uZGFyeVRleHQsXG4gIHNlbGVjdEl0ZW06IFByb3BUeXBlcy5mdW5jLFxuICBzaG91bGRJbnB1dFdyYXA6IFByb3BUeXBlcy5ib29sLFxuICB1cGRhdGVTZWFyY2g6IENvbnRlbnRFZGl0YWJsZS5wcm9wVHlwZXMub25DaGFuZ2UsXG4gIHZhbGlkYXRpb25TdGF0ZTogSW5wdXRGaWVsZEJhc2UucHJvcFR5cGVzLnZhbGlkYXRpb25TdGF0ZSxcbiAgdmFsdWU6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5vYmplY3QsIFByb3BUeXBlcy5hcnJheSwgUHJvcFR5cGVzLmFueV0pLFxuICB2YWx1ZU1hcHBlcjogUHJvcFR5cGVzLmZ1bmMsXG59O1xuVHhsQ29udGVudEVkaXRhYmxlVGFyZ2V0LmRpc3BsYXlOYW1lID0gJ1R4bENvbnRlbnRFZGl0YWJsZVRhcmdldCc7XG5cbmV4cG9ydCBkZWZhdWx0IFR4bENvbnRlbnRFZGl0YWJsZVRhcmdldDtcbiJdfQ==