'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _Base = require('../base/Base');

var _createDropdown = require('./_createDropdown');

var _createDropdown2 = _interopRequireDefault(_createDropdown);

var _listHelpers = require('../lists/listHelpers');

var _ButtonSelect = require('./ButtonSelect');

var _ButtonSelect2 = _interopRequireDefault(_ButtonSelect);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var babelPluginFlowReactPropTypes_proptype_AttachmentLocation = require('./ButtonSelect').babelPluginFlowReactPropTypes_proptype_AttachmentLocation || require('react').PropTypes.any;

// @TODO Maybe this should be stored as some sort of global
// value so all lists have the same threshold?
var babelPluginFlowReactPropTypes_proptype_ButtonSize = require('../buttons/Button').babelPluginFlowReactPropTypes_proptype_ButtonSize || require('react').PropTypes.any;

var MAX_VISIBLE_ITEMS = 10;
var ITEM_PLACEHOLDER = 'Select...';

var TxlUncontrolledButtonSelect = (0, _radium2.default)(_class = (_class2 = function (_React$Component) {
  (0, _inherits3.default)(TxlUncontrolledButtonSelect, _React$Component);

  function TxlUncontrolledButtonSelect(props, context) {
    (0, _classCallCheck3.default)(this, TxlUncontrolledButtonSelect);

    var _this = (0, _possibleConstructorReturn3.default)(this, (TxlUncontrolledButtonSelect.__proto__ || (0, _getPrototypeOf2.default)(TxlUncontrolledButtonSelect)).call(this, props, context));

    var _this$props = _this.props,
        defaultValue = _this$props.defaultValue,
        items = _this$props.items;

    // will return undefined if defaultValue is undefined

    var matchedItem = (0, _listHelpers.getItemByValue)(items, defaultValue);
    _this.state = {
      searchValue: '',
      value: matchedItem ? matchedItem.value : ''
    };
    return _this;
  }

  (0, _createClass3.default)(TxlUncontrolledButtonSelect, [{
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(_ref) {
      var open = _ref.open;

      // Clear search text when dropdown closes. Setting here because we don't have a way of
      // subscribing to 'click outside of dropdown' from within this component.
      if (!open) {
        this.setState({ searchValue: '' });
      }
    }
  }, {
    key: '_handleItemSelect',
    value: function _handleItemSelect(obj) {
      var _this2 = this;

      this.setState({ value: obj.value }, function () {
        return _this2.props.onItemSelect(obj);
      });
      this._toggleDropdown();
    }
  }, {
    key: '_handleSearchChange',
    value: function _handleSearchChange(_ref2) {
      var value = _ref2.value;

      this.setState({ searchValue: value });
    }
  }, {
    key: '_toggleDropdown',
    value: function _toggleDropdown() {
      this.props.updateDropdown && this.props.updateDropdown({ open: !this.props.open });
    }
  }, {
    key: 'setValue',
    value: function setValue() {
      var value = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';

      this.setState({ value: value });
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          dropdownAttachmentLocation = _props.dropdownAttachmentLocation,
          dropdownWidth = _props.dropdownWidth,
          items = _props.items,
          open = _props.open,
          placeholder = _props.placeholder,
          size = _props.size;
      var _state = this.state,
          searchValue = _state.searchValue,
          value = _state.value;


      var buttonText = (0, _listHelpers.getItemLabelByValue)(items, value) || placeholder;
      var filteredItems = (0, _listHelpers.getFilteredFlatItemList)(items, searchValue);
      // per UX spec
      var shouldShowSearch = items && items.length > MAX_VISIBLE_ITEMS;

      return _react2.default.createElement(_ButtonSelect2.default, {
        buttonText: buttonText,
        dropdownAttachmentLocation: dropdownAttachmentLocation,
        dropdownWidth: dropdownWidth,
        items: filteredItems,
        onButtonClick: this._toggleDropdown,
        onItemSelect: this._handleItemSelect,
        onSearchChange: this._handleSearchChange,
        open: open,
        ref: 'buttonSelect',
        searchValue: searchValue,
        showSearch: shouldShowSearch,
        size: size,
        value: value,
        visibleItemCount: MAX_VISIBLE_ITEMS
      });
    }
  }]);
  return TxlUncontrolledButtonSelect;
}(_react2.default.Component), (_applyDecoratedDescriptor(_class2.prototype, '_handleItemSelect', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleItemSelect'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleSearchChange', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleSearchChange'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_toggleDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_toggleDropdown'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, 'setValue', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, 'setValue'), _class2.prototype)), _class2)) || _class;

TxlUncontrolledButtonSelect.propTypes = {
  defaultValue: require('react').PropTypes.string,
  dropdownAttachmentLocation: babelPluginFlowReactPropTypes_proptype_AttachmentLocation,
  dropdownWidth: require('react').PropTypes.any,
  items: require('react').PropTypes.arrayOf(require('react').PropTypes.object).isRequired,
  onItemSelect: require('react').PropTypes.func.isRequired,
  open: require('react').PropTypes.bool,
  placeholder: require('react').PropTypes.any,
  size: babelPluginFlowReactPropTypes_proptype_ButtonSize,
  updateDropdown: require('react').PropTypes.func
};


TxlUncontrolledButtonSelect.defaultProps = {
  placeholder: ITEM_PLACEHOLDER
};

var _default = (0, _createDropdown2.default)(TxlUncontrolledButtonSelect);

exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(MAX_VISIBLE_ITEMS, 'MAX_VISIBLE_ITEMS', 'src/dropdowns/UncontrolledButtonSelect.jsx');

  __REACT_HOT_LOADER__.register(ITEM_PLACEHOLDER, 'ITEM_PLACEHOLDER', 'src/dropdowns/UncontrolledButtonSelect.jsx');

  __REACT_HOT_LOADER__.register(TxlUncontrolledButtonSelect, 'TxlUncontrolledButtonSelect', 'src/dropdowns/UncontrolledButtonSelect.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/dropdowns/UncontrolledButtonSelect.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kcm9wZG93bnMvVW5jb250cm9sbGVkQnV0dG9uU2VsZWN0LmpzeCJdLCJuYW1lcyI6WyJNQVhfVklTSUJMRV9JVEVNUyIsIklURU1fUExBQ0VIT0xERVIiLCJUeGxVbmNvbnRyb2xsZWRCdXR0b25TZWxlY3QiLCJwcm9wcyIsImNvbnRleHQiLCJkZWZhdWx0VmFsdWUiLCJpdGVtcyIsIm1hdGNoZWRJdGVtIiwic3RhdGUiLCJzZWFyY2hWYWx1ZSIsInZhbHVlIiwib3BlbiIsInNldFN0YXRlIiwib2JqIiwib25JdGVtU2VsZWN0IiwiX3RvZ2dsZURyb3Bkb3duIiwidXBkYXRlRHJvcGRvd24iLCJkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbiIsImRyb3Bkb3duV2lkdGgiLCJwbGFjZWhvbGRlciIsInNpemUiLCJidXR0b25UZXh0IiwiZmlsdGVyZWRJdGVtcyIsInNob3VsZFNob3dTZWFyY2giLCJsZW5ndGgiLCJfaGFuZGxlSXRlbVNlbGVjdCIsIl9oYW5kbGVTZWFyY2hDaGFuZ2UiLCJDb21wb25lbnQiLCJkZWZhdWx0UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7Ozs7QUFDQTs7OztBQUVBOztBQUNBOzs7O0FBQ0E7O0FBS0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFJQTtBQUNBOzs7QUFDQSxJQUFNQSxvQkFBb0IsRUFBMUI7QUFDQSxJQUFNQyxtQkFBbUIsV0FBekI7O0lBZU1DLDJCOzs7QUFHSix1Q0FBWUMsS0FBWixFQUEwQkMsT0FBMUIsRUFBMkM7QUFBQTs7QUFBQSxnTEFDbkNELEtBRG1DLEVBQzVCQyxPQUQ0Qjs7QUFBQSxzQkFLckMsTUFBS0QsS0FMZ0M7QUFBQSxRQUd2Q0UsWUFIdUMsZUFHdkNBLFlBSHVDO0FBQUEsUUFJdkNDLEtBSnVDLGVBSXZDQSxLQUp1Qzs7QUFPekM7O0FBQ0EsUUFBTUMsY0FBYyxpQ0FBZUQsS0FBZixFQUFzQkQsWUFBdEIsQ0FBcEI7QUFDQSxVQUFLRyxLQUFMLEdBQWE7QUFDWEMsbUJBQWEsRUFERjtBQUVYQyxhQUFPSCxjQUFjQSxZQUFZRyxLQUExQixHQUFrQztBQUY5QixLQUFiO0FBVHlDO0FBYTFDOzs7O29EQUVtQztBQUFBLFVBQVJDLElBQVEsUUFBUkEsSUFBUTs7QUFDbEM7QUFDQTtBQUNBLFVBQUksQ0FBQ0EsSUFBTCxFQUFXO0FBQ1QsYUFBS0MsUUFBTCxDQUFjLEVBQUVILGFBQWEsRUFBZixFQUFkO0FBQ0Q7QUFDRjs7O3NDQUdpQkksRyxFQUFLO0FBQUE7O0FBQ3JCLFdBQUtELFFBQUwsQ0FBYyxFQUFFRixPQUFPRyxJQUFJSCxLQUFiLEVBQWQsRUFBb0M7QUFBQSxlQUFNLE9BQUtQLEtBQUwsQ0FBV1csWUFBWCxDQUF3QkQsR0FBeEIsQ0FBTjtBQUFBLE9BQXBDO0FBQ0EsV0FBS0UsZUFBTDtBQUNEOzs7K0NBRzhCO0FBQUEsVUFBVEwsS0FBUyxTQUFUQSxLQUFTOztBQUM3QixXQUFLRSxRQUFMLENBQWMsRUFBRUgsYUFBYUMsS0FBZixFQUFkO0FBQ0Q7OztzQ0FHaUI7QUFDaEIsV0FBS1AsS0FBTCxDQUFXYSxjQUFYLElBQTZCLEtBQUtiLEtBQUwsQ0FBV2EsY0FBWCxDQUEwQixFQUFFTCxNQUFNLENBQUMsS0FBS1IsS0FBTCxDQUFXUSxJQUFwQixFQUExQixDQUE3QjtBQUNEOzs7K0JBR29CO0FBQUEsVUFBWkQsS0FBWSx1RUFBSixFQUFJOztBQUNuQixXQUFLRSxRQUFMLENBQWMsRUFBRUYsWUFBRixFQUFkO0FBQ0Q7Ozs2QkFFNEI7QUFBQSxtQkFTdkIsS0FBS1AsS0FUa0I7QUFBQSxVQUV6QmMsMEJBRnlCLFVBRXpCQSwwQkFGeUI7QUFBQSxVQUd6QkMsYUFIeUIsVUFHekJBLGFBSHlCO0FBQUEsVUFJekJaLEtBSnlCLFVBSXpCQSxLQUp5QjtBQUFBLFVBTXpCSyxJQU55QixVQU16QkEsSUFOeUI7QUFBQSxVQU96QlEsV0FQeUIsVUFPekJBLFdBUHlCO0FBQUEsVUFRekJDLElBUnlCLFVBUXpCQSxJQVJ5QjtBQUFBLG1CQWF2QixLQUFLWixLQWJrQjtBQUFBLFVBV3pCQyxXQVh5QixVQVd6QkEsV0FYeUI7QUFBQSxVQVl6QkMsS0FaeUIsVUFZekJBLEtBWnlCOzs7QUFlM0IsVUFBTVcsYUFBYSxzQ0FBb0JmLEtBQXBCLEVBQTJCSSxLQUEzQixLQUFxQ1MsV0FBeEQ7QUFDQSxVQUFNRyxnQkFBZ0IsMENBQXdCaEIsS0FBeEIsRUFBK0JHLFdBQS9CLENBQXRCO0FBQ0E7QUFDQSxVQUFNYyxtQkFBbUJqQixTQUFTQSxNQUFNa0IsTUFBTixHQUFleEIsaUJBQWpEOztBQUVBLGFBQ0U7QUFDRSxvQkFBWXFCLFVBRGQ7QUFFRSxvQ0FBNEJKLDBCQUY5QjtBQUdFLHVCQUFlQyxhQUhqQjtBQUlFLGVBQU9JLGFBSlQ7QUFLRSx1QkFBZSxLQUFLUCxlQUx0QjtBQU1FLHNCQUFjLEtBQUtVLGlCQU5yQjtBQU9FLHdCQUFnQixLQUFLQyxtQkFQdkI7QUFRRSxjQUFNZixJQVJSO0FBU0UsYUFBSSxjQVROO0FBVUUscUJBQWFGLFdBVmY7QUFXRSxvQkFBWWMsZ0JBWGQ7QUFZRSxjQUFNSCxJQVpSO0FBYUUsZUFBT1YsS0FiVDtBQWNFLDBCQUFrQlY7QUFkcEIsUUFERjtBQWtCRDs7O0VBckZ1QyxnQkFBTTJCLFM7Ozs7Ozs7Ozs7Ozs7OztBQXdGaER6Qiw0QkFBNEIwQixZQUE1QixHQUEyQztBQUN6Q1QsZUFBYWxCO0FBRDRCLENBQTNDOztlQUllLDhCQUFlQywyQkFBZixDOzs7Ozs7Ozs7O2dDQTVHVEYsaUI7O2dDQUNBQyxnQjs7Z0NBZUFDLDJCIiwiZmlsZSI6IlVuY29udHJvbGxlZEJ1dHRvblNlbGVjdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJhZGl1bSBmcm9tICdyYWRpdW0nO1xuXG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQgY3JlYXRlRHJvcGRvd24gZnJvbSAnLi9fY3JlYXRlRHJvcGRvd24nO1xuaW1wb3J0IHtcbiAgZ2V0RmlsdGVyZWRGbGF0SXRlbUxpc3QsXG4gIGdldEl0ZW1CeVZhbHVlLFxuICBnZXRJdGVtTGFiZWxCeVZhbHVlLFxufSBmcm9tICcuLi9saXN0cy9saXN0SGVscGVycyc7XG5pbXBvcnQgQnV0dG9uU2VsZWN0IGZyb20gJy4vQnV0dG9uU2VsZWN0JztcbmltcG9ydCB0eXBlIHsgQXR0YWNobWVudExvY2F0aW9uIH0gZnJvbSAnLi9CdXR0b25TZWxlY3QnO1xuaW1wb3J0IHR5cGUgeyBCdXR0b25TaXplIH0gZnJvbSAnLi4vYnV0dG9ucy9CdXR0b24nO1xuXG4vLyBAVE9ETyBNYXliZSB0aGlzIHNob3VsZCBiZSBzdG9yZWQgYXMgc29tZSBzb3J0IG9mIGdsb2JhbFxuLy8gdmFsdWUgc28gYWxsIGxpc3RzIGhhdmUgdGhlIHNhbWUgdGhyZXNob2xkP1xuY29uc3QgTUFYX1ZJU0lCTEVfSVRFTVMgPSAxMDtcbmNvbnN0IElURU1fUExBQ0VIT0xERVIgPSAnU2VsZWN0Li4uJztcblxudHlwZSBQcm9wcyA9IHtcbiAgZGVmYXVsdFZhbHVlPzogc3RyaW5nLFxuICBkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbj86IEF0dGFjaG1lbnRMb2NhdGlvbixcbiAgZHJvcGRvd25XaWR0aD86IGFueSxcbiAgaXRlbXM6IEFycmF5PE9iamVjdD4sXG4gIG9uSXRlbVNlbGVjdDogKGl0ZW06IE9iamVjdCkgPT4gdm9pZCxcbiAgb3Blbj86IGJvb2xlYW4sXG4gIHBsYWNlaG9sZGVyPzogUmVhY3QuRWxlbWVudDxhbnk+LFxuICBzaXplOiBCdXR0b25TaXplLFxuICB1cGRhdGVEcm9wZG93bj86IChzdGF0ZTogeyBvcGVuOiBib29sZWFuIH0pID0+IHZvaWQsXG59O1xuXG5AUmFkaXVtXG5jbGFzcyBUeGxVbmNvbnRyb2xsZWRCdXR0b25TZWxlY3QgZXh0ZW5kcyBSZWFjdC5Db21wb25lbnQge1xuICBwcm9wczogUHJvcHM7XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFByb3BzLCBjb250ZXh0OiBPYmplY3QpIHtcbiAgICBzdXBlcihwcm9wcywgY29udGV4dCk7XG4gICAgY29uc3Qge1xuICAgICAgZGVmYXVsdFZhbHVlLFxuICAgICAgaXRlbXMsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICAvLyB3aWxsIHJldHVybiB1bmRlZmluZWQgaWYgZGVmYXVsdFZhbHVlIGlzIHVuZGVmaW5lZFxuICAgIGNvbnN0IG1hdGNoZWRJdGVtID0gZ2V0SXRlbUJ5VmFsdWUoaXRlbXMsIGRlZmF1bHRWYWx1ZSk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIHNlYXJjaFZhbHVlOiAnJyxcbiAgICAgIHZhbHVlOiBtYXRjaGVkSXRlbSA/IG1hdGNoZWRJdGVtLnZhbHVlIDogJycsXG4gICAgfTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoeyBvcGVuIH0pIHtcbiAgICAvLyBDbGVhciBzZWFyY2ggdGV4dCB3aGVuIGRyb3Bkb3duIGNsb3Nlcy4gU2V0dGluZyBoZXJlIGJlY2F1c2Ugd2UgZG9uJ3QgaGF2ZSBhIHdheSBvZlxuICAgIC8vIHN1YnNjcmliaW5nIHRvICdjbGljayBvdXRzaWRlIG9mIGRyb3Bkb3duJyBmcm9tIHdpdGhpbiB0aGlzIGNvbXBvbmVudC5cbiAgICBpZiAoIW9wZW4pIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzZWFyY2hWYWx1ZTogJycgfSk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVJdGVtU2VsZWN0KG9iaikge1xuICAgIHRoaXMuc2V0U3RhdGUoeyB2YWx1ZTogb2JqLnZhbHVlIH0sICgpID0+IHRoaXMucHJvcHMub25JdGVtU2VsZWN0KG9iaikpO1xuICAgIHRoaXMuX3RvZ2dsZURyb3Bkb3duKCk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZVNlYXJjaENoYW5nZSh7IHZhbHVlIH0pIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgc2VhcmNoVmFsdWU6IHZhbHVlIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF90b2dnbGVEcm9wZG93bigpIHtcbiAgICB0aGlzLnByb3BzLnVwZGF0ZURyb3Bkb3duICYmIHRoaXMucHJvcHMudXBkYXRlRHJvcGRvd24oeyBvcGVuOiAhdGhpcy5wcm9wcy5vcGVuIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIHNldFZhbHVlKHZhbHVlID0gJycpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgdmFsdWUgfSk7XG4gIH1cblxuICByZW5kZXIoKTogUmVhY3QuRWxlbWVudDxhbnk+IHtcbiAgICBjb25zdCB7XG4gICAgICBkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbixcbiAgICAgIGRyb3Bkb3duV2lkdGgsXG4gICAgICBpdGVtcyxcbiAgICAgIC8vIG9wZW4gcHJvcCBpbmhlcml0ZWQgZnJvbSBfY3JlYXRlRHJvcGRvd25cbiAgICAgIG9wZW4sXG4gICAgICBwbGFjZWhvbGRlcixcbiAgICAgIHNpemUsXG4gICAgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3Qge1xuICAgICAgc2VhcmNoVmFsdWUsXG4gICAgICB2YWx1ZSxcbiAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGNvbnN0IGJ1dHRvblRleHQgPSBnZXRJdGVtTGFiZWxCeVZhbHVlKGl0ZW1zLCB2YWx1ZSkgfHwgcGxhY2Vob2xkZXI7XG4gICAgY29uc3QgZmlsdGVyZWRJdGVtcyA9IGdldEZpbHRlcmVkRmxhdEl0ZW1MaXN0KGl0ZW1zLCBzZWFyY2hWYWx1ZSk7XG4gICAgLy8gcGVyIFVYIHNwZWNcbiAgICBjb25zdCBzaG91bGRTaG93U2VhcmNoID0gaXRlbXMgJiYgaXRlbXMubGVuZ3RoID4gTUFYX1ZJU0lCTEVfSVRFTVM7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPEJ1dHRvblNlbGVjdFxuICAgICAgICBidXR0b25UZXh0PXtidXR0b25UZXh0fVxuICAgICAgICBkcm9wZG93bkF0dGFjaG1lbnRMb2NhdGlvbj17ZHJvcGRvd25BdHRhY2htZW50TG9jYXRpb259XG4gICAgICAgIGRyb3Bkb3duV2lkdGg9e2Ryb3Bkb3duV2lkdGh9XG4gICAgICAgIGl0ZW1zPXtmaWx0ZXJlZEl0ZW1zfVxuICAgICAgICBvbkJ1dHRvbkNsaWNrPXt0aGlzLl90b2dnbGVEcm9wZG93bn1cbiAgICAgICAgb25JdGVtU2VsZWN0PXt0aGlzLl9oYW5kbGVJdGVtU2VsZWN0fVxuICAgICAgICBvblNlYXJjaENoYW5nZT17dGhpcy5faGFuZGxlU2VhcmNoQ2hhbmdlfVxuICAgICAgICBvcGVuPXtvcGVufVxuICAgICAgICByZWY9XCJidXR0b25TZWxlY3RcIlxuICAgICAgICBzZWFyY2hWYWx1ZT17c2VhcmNoVmFsdWV9XG4gICAgICAgIHNob3dTZWFyY2g9e3Nob3VsZFNob3dTZWFyY2h9XG4gICAgICAgIHNpemU9e3NpemV9XG4gICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgdmlzaWJsZUl0ZW1Db3VudD17TUFYX1ZJU0lCTEVfSVRFTVN9XG4gICAgICAvPlxuICAgICk7XG4gIH1cbn1cblxuVHhsVW5jb250cm9sbGVkQnV0dG9uU2VsZWN0LmRlZmF1bHRQcm9wcyA9IHtcbiAgcGxhY2Vob2xkZXI6IElURU1fUExBQ0VIT0xERVIsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVEcm9wZG93bihUeGxVbmNvbnRyb2xsZWRCdXR0b25TZWxlY3QpO1xuIl19