'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _desc, _value, _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _isEqual = require('lodash/isEqual');

var _isEqual2 = _interopRequireDefault(_isEqual);

var _ReactUtils = require('../ReactUtils');

var _Base = require('../base/Base');

var _helpers = require('../styles/helpers');

var _type = require('../styles/mixins/type');

var _Container = require('../containers/Container');

var _Container2 = _interopRequireDefault(_Container);

var _FilteredItemsWrapper = require('../_selects/FilteredItemsWrapper');

var _FilteredItemsWrapper2 = _interopRequireDefault(_FilteredItemsWrapper);

var _GroupedBufferedListView = require('../lists/_GroupedBufferedListView');

var _GroupedBufferedListView2 = _interopRequireDefault(_GroupedBufferedListView);

var _createSubComponentRenderer = require('../utils/createSubComponentRenderer');

var _createSubComponentRenderer2 = _interopRequireDefault(_createSubComponentRenderer);

var _formatter = require('../utils/formatter');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var getDropdownContainerStyle = function getDropdownContainerStyle(props) {
  return (0, _extends3.default)({}, _type.DEFAULT_FONT_FAMILY, _type.TYPE_BASE, {
    position: 'relative',
    width: props.width
  });
};

function defaultPredicateGetter(_ref) {
  var search = _ref.search;

  var query = new RegExp((0, _formatter.escapeRegularExpression)(search), 'i');
  return function predicate(item) {
    return query.test(item.id) || query.test(item.value);
  };
}

function subComponentRenderer(instance, key) {
  return (0, _createSubComponentRenderer2.default)({
    instance: instance,
    key: key,
    propsGetter: instance._sharedProps
  });
}

function getSearchQuery(props) {
  var state = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (props.search === undefined) {
    return state.search || '';
  }
  return props.search;
}

function getStateFromProps(props, state) {
  var items = props.items,
      showCreateNew = props.showCreateNew;


  var search = getSearchQuery(props, state);
  // If local filtering is disabled, return true for every item so it doesn't filter
  var predicate = props.enableLocalFiltering ? props.predicateGetter({ search: search }) : function () {
    return true;
  };
  var filteredItems = new _FilteredItemsWrapper2.default(items, predicate, search, showCreateNew);

  return {
    filteredItems: filteredItems,
    search: search
  };
}

/**
 * ListDropdownControl is responsible for creating dropdown using BufferedListView.
 *
 * Because of some of limitations (fixed / static heights) of BufferedListView,
 * this component is also responsible handling item filtering and grouping based on search query
 * and grouper function.
 *
 * At the moment, the component only implements filtering.
 *
 * ** This component MUST NOT BE pure rendered.
 */
var TxlListDropdownControl = (_class = function (_Component) {
  (0, _inherits3.default)(TxlListDropdownControl, _Component);

  function TxlListDropdownControl() {
    var _ref2;

    (0, _classCallCheck3.default)(this, TxlListDropdownControl);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref2 = TxlListDropdownControl.__proto__ || (0, _getPrototypeOf2.default)(TxlListDropdownControl)).call.apply(_ref2, [this].concat(args)));

    _this._renderTarget = subComponentRenderer(_this, 'target');
    _this._renderListHeader = subComponentRenderer(_this, 'listProps.header');
    _this._renderListFooter = subComponentRenderer(_this, 'listProps.footer');
    _this.state = getStateFromProps(_this.props);
    return _this;
  }

  (0, _createClass3.default)(TxlListDropdownControl, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      if (window) {
        window.addEventListener('click', this._handleWindowClick);
      }
    }
  }, {
    key: 'componentWillReceiveProps',
    value: function componentWillReceiveProps(nextProps) {
      if (!(0, _isEqual2.default)(nextProps.items, this.props.items) || !(0, _isEqual2.default)(nextProps.search, this.props.search) || !(0, _isEqual2.default)(nextProps.predicateGetter, this.props.predicateGetter) || !(0, _isEqual2.default)(nextProps.showCreateNew, this.props.showCreateNew)) {
        var newState = getStateFromProps(nextProps, this.state);
        this.setState(newState);
      }
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      if (window) {
        window.removeEventListener('click', this._handleWindowClick);
      }
    }
  }, {
    key: 'getFilteredItems',
    value: function getFilteredItems() {
      return this.state.filteredItems;
    }
  }, {
    key: '_handleWindowClick',
    value: function _handleWindowClick(event) {
      var clickIsOutsideContent = this._isClickOutsideElement(event, this);
      var clickIsOutsideHeader = this._isClickOutsideElement(event, this._headerRef);
      var clickIsOutsideFooter = this._isClickOutsideElement(event, this._footerRef);

      if (clickIsOutsideContent && clickIsOutsideHeader && clickIsOutsideFooter) {
        this._handleClose();
      }
    }
  }, {
    key: '_isClickOutsideElement',
    value: function _isClickOutsideElement(clickEvent, elementRef) {
      var domNode = (0, _ReactUtils.findDOMNode)(elementRef);
      return domNode ? !domNode.contains(clickEvent.target) : true;
    }
  }, {
    key: '_closeDropdown',
    value: function _closeDropdown() {
      this._handleClose();
    }
  }, {
    key: '_openDropdown',
    value: function _openDropdown() {
      this.props.openDropdown();
    }
  }, {
    key: '_toggleDropdown',
    value: function _toggleDropdown() {
      var _props$open$open = this.props.open.open,
          open = _props$open$open === undefined ? false : _props$open$open;


      if (open) {
        this._handleClose();
      } else {
        this.props.openDropdown();
      }
    }
  }, {
    key: '_handleClose',
    value: function _handleClose() {
      if (this.props.open) {
        this._clearSearch(this.props.closeDropdown);
      }
    }
  }, {
    key: '_clearSearch',
    value: function _clearSearch(cb) {
      var newState = getStateFromProps(this.props, (0, _extends3.default)({}, this.state, {
        search: ''
      }));
      this.setState(newState, cb);
    }
  }, {
    key: '_updateSearch',
    value: function _updateSearch(_ref3, callback) {
      var _this2 = this;

      var value = _ref3.value;

      var state = getStateFromProps(this.props, (0, _extends3.default)({}, this.state, {
        search: value
      }));
      this.setState(state, function () {
        if (callback) {
          callback();
        }

        _this2.props.onSearchChange(value);
      });
    }
  }, {
    key: '_sharedProps',
    value: function _sharedProps() {
      var search = this.state.search;

      return {
        clearSearch: this._clearSearch,
        search: search,
        updateSearch: this._updateSearch
      };
    }
  }, {
    key: '_renderItem',
    value: function _renderItem() {
      var itemRenderer = this.props.itemRenderer;

      return function (itemProps) {
        var item = itemProps.item;

        return item && itemRenderer((0, _extends3.default)({}, itemProps));
      };
    }
  }, {
    key: '_handleHeaderRef',
    value: function _handleHeaderRef(ref) {
      this._headerRef = ref;
    }
  }, {
    key: '_handleFooterRef',
    value: function _handleFooterRef(ref) {
      this._footerRef = ref;
    }
  }, {
    key: 'render',
    value: function render() {
      var _props = this.props,
          activateItem = _props.activateItem,
          ContainerComponent = _props.container,
          grouper = _props.grouper,
          height = _props.height,
          itemHeight = _props.itemHeight,
          listProps = _props.listProps,
          loading = _props.loading,
          keySelectedItemClear = _props.keySelectedItemClear,
          keySelectedItemIndex = _props.keySelectedItemIndex,
          noContentView = _props.noContentView,
          open = _props.open,
          showSearchToViewMoreMessage = _props.showSearchToViewMoreMessage,
          target = _props.target,
          yOffset = _props.yOffset;
      var filteredItems = this.state.filteredItems;


      var targetProps = (0, _extends3.default)({}, this.props, this._sharedProps(), {
        closeDropdown: this._closeDropdown,
        open: open,
        openDropdown: this._openDropdown,
        toggleDropdown: this._toggleDropdown
      });

      var containerProps = {
        height: height,
        open: open,
        width: listProps.width,
        yOffset: yOffset
      };
      var dropdownContainerStyle = getDropdownContainerStyle(this.props);
      var header = listProps.header && _react2.default.cloneElement(listProps.header, { ref: this._handleHeaderRef });
      var footer = listProps.footer && _react2.default.cloneElement(listProps.footer, { ref: this._handleFooterRef });

      return _react2.default.createElement(
        'div',
        {
          'data-component': 'TxlDropdownControl',
          style: dropdownContainerStyle
        },
        target(targetProps),
        _react2.default.createElement(
          ContainerComponent,
          containerProps,
          _react2.default.createElement(
            _Container2.default,
            { layer: 2 },
            _react2.default.createElement(_GroupedBufferedListView2.default, {
              activateItem: activateItem,
              footer: footer,
              grouper: grouper,
              header: header,
              height: listProps.height,
              itemHeight: itemHeight,
              itemRenderer: this._renderItem(),
              items: filteredItems.getItems(),
              keySelectedItemClear: keySelectedItemClear,
              keySelectedItemIndex: keySelectedItemIndex,
              loading: loading,
              maxHeight: listProps.maxHeight,
              noContentView: noContentView,
              showSearchToViewMoreMessage: showSearchToViewMoreMessage
            })
          )
        )
      );
    }
  }]);
  return TxlListDropdownControl;
}(_react.Component), (_applyDecoratedDescriptor(_class.prototype, 'getFilteredItems', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, 'getFilteredItems'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleWindowClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleWindowClick'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_isClickOutsideElement', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_isClickOutsideElement'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_closeDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_closeDropdown'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_openDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_openDropdown'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_toggleDropdown', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_toggleDropdown'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleClose', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleClose'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_clearSearch', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_clearSearch'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_updateSearch', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_updateSearch'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_sharedProps', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_sharedProps'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_renderItem', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_renderItem'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleHeaderRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleHeaderRef'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleFooterRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleFooterRef'), _class.prototype)), _class);


TxlListDropdownControl.propTypes = {
  activateItem: _react.PropTypes.func,
  closeDropdown: _react.PropTypes.func,
  container: _react.PropTypes.func.isRequired,
  enableLocalFiltering: _react.PropTypes.bool,
  grouper: _react.PropTypes.func,
  height: _react.PropTypes.oneOfType([_react.PropTypes.number, _react.PropTypes.string]),
  itemHeight: _react.PropTypes.number,
  itemRenderer: _react.PropTypes.func.isRequired,
  items: _react.PropTypes.array,
  keyMapper: _react.PropTypes.func.isRequired,
  keySelectedItemClear: _react.PropTypes.func,
  keySelectedItemIndex: _react.PropTypes.number,
  label: _react.PropTypes.string,
  listProps: _react.PropTypes.shape({
    footer: _GroupedBufferedListView2.default.propTypes.footer,
    header: _GroupedBufferedListView2.default.propTypes.header,
    height: _GroupedBufferedListView2.default.propTypes.height,
    maxHeight: _GroupedBufferedListView2.default.propTypes.maxHeight,
    width: _GroupedBufferedListView2.default.propTypes.width
  }),
  loading: _react.PropTypes.bool,
  noContentView: _GroupedBufferedListView2.default.propTypes.noContentView,
  onSearchChange: _react.PropTypes.func,
  open: _react.PropTypes.bool,
  openDropdown: _react.PropTypes.func,
  predicateGetter: _react.PropTypes.func,
  search: _react.PropTypes.string,
  secondaryText: _react.PropTypes.string,
  shouldInputWrap: _react.PropTypes.bool,
  showCreateNew: _react.PropTypes.bool,
  showSearchToViewMoreMessage: _GroupedBufferedListView2.default.propTypes.showSearchToViewMoreMessage,
  target: _react.PropTypes.func.isRequired,
  width: _react.PropTypes.oneOfType([_react.PropTypes.number, _react.PropTypes.string]),
  yOffset: _react.PropTypes.number
};

TxlListDropdownControl.displayName = 'TxlListDropdownControl';

TxlListDropdownControl.defaultProps = {
  enableLocalFiltering: true,
  itemHeight: (0, _helpers.gridUnitsRaw)(7),
  items: [],
  loading: false,
  onSearchChange: Function.prototype,
  predicateGetter: defaultPredicateGetter,
  showCreateNew: false
};

var _default = TxlListDropdownControl;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(getDropdownContainerStyle, 'getDropdownContainerStyle', 'src/dropdowns/_ListDropdownControl.jsx');

  __REACT_HOT_LOADER__.register(defaultPredicateGetter, 'defaultPredicateGetter', 'src/dropdowns/_ListDropdownControl.jsx');

  __REACT_HOT_LOADER__.register(subComponentRenderer, 'subComponentRenderer', 'src/dropdowns/_ListDropdownControl.jsx');

  __REACT_HOT_LOADER__.register(getSearchQuery, 'getSearchQuery', 'src/dropdowns/_ListDropdownControl.jsx');

  __REACT_HOT_LOADER__.register(getStateFromProps, 'getStateFromProps', 'src/dropdowns/_ListDropdownControl.jsx');

  __REACT_HOT_LOADER__.register(TxlListDropdownControl, 'TxlListDropdownControl', 'src/dropdowns/_ListDropdownControl.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/dropdowns/_ListDropdownControl.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kcm9wZG93bnMvX0xpc3REcm9wZG93bkNvbnRyb2wuanN4Il0sIm5hbWVzIjpbImdldERyb3Bkb3duQ29udGFpbmVyU3R5bGUiLCJwb3NpdGlvbiIsIndpZHRoIiwicHJvcHMiLCJkZWZhdWx0UHJlZGljYXRlR2V0dGVyIiwic2VhcmNoIiwicXVlcnkiLCJSZWdFeHAiLCJwcmVkaWNhdGUiLCJpdGVtIiwidGVzdCIsImlkIiwidmFsdWUiLCJzdWJDb21wb25lbnRSZW5kZXJlciIsImluc3RhbmNlIiwia2V5IiwicHJvcHNHZXR0ZXIiLCJfc2hhcmVkUHJvcHMiLCJnZXRTZWFyY2hRdWVyeSIsInN0YXRlIiwidW5kZWZpbmVkIiwiZ2V0U3RhdGVGcm9tUHJvcHMiLCJpdGVtcyIsInNob3dDcmVhdGVOZXciLCJlbmFibGVMb2NhbEZpbHRlcmluZyIsInByZWRpY2F0ZUdldHRlciIsImZpbHRlcmVkSXRlbXMiLCJUeGxMaXN0RHJvcGRvd25Db250cm9sIiwiYXJncyIsIl9yZW5kZXJUYXJnZXQiLCJfcmVuZGVyTGlzdEhlYWRlciIsIl9yZW5kZXJMaXN0Rm9vdGVyIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9oYW5kbGVXaW5kb3dDbGljayIsIm5leHRQcm9wcyIsIm5ld1N0YXRlIiwic2V0U3RhdGUiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJjbGlja0lzT3V0c2lkZUNvbnRlbnQiLCJfaXNDbGlja091dHNpZGVFbGVtZW50IiwiY2xpY2tJc091dHNpZGVIZWFkZXIiLCJfaGVhZGVyUmVmIiwiY2xpY2tJc091dHNpZGVGb290ZXIiLCJfZm9vdGVyUmVmIiwiX2hhbmRsZUNsb3NlIiwiY2xpY2tFdmVudCIsImVsZW1lbnRSZWYiLCJkb21Ob2RlIiwiY29udGFpbnMiLCJ0YXJnZXQiLCJvcGVuRHJvcGRvd24iLCJvcGVuIiwiX2NsZWFyU2VhcmNoIiwiY2xvc2VEcm9wZG93biIsImNiIiwiY2FsbGJhY2siLCJvblNlYXJjaENoYW5nZSIsImNsZWFyU2VhcmNoIiwidXBkYXRlU2VhcmNoIiwiX3VwZGF0ZVNlYXJjaCIsIml0ZW1SZW5kZXJlciIsIml0ZW1Qcm9wcyIsInJlZiIsImFjdGl2YXRlSXRlbSIsIkNvbnRhaW5lckNvbXBvbmVudCIsImNvbnRhaW5lciIsImdyb3VwZXIiLCJoZWlnaHQiLCJpdGVtSGVpZ2h0IiwibGlzdFByb3BzIiwibG9hZGluZyIsImtleVNlbGVjdGVkSXRlbUNsZWFyIiwia2V5U2VsZWN0ZWRJdGVtSW5kZXgiLCJub0NvbnRlbnRWaWV3Iiwic2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlIiwieU9mZnNldCIsInRhcmdldFByb3BzIiwiX2Nsb3NlRHJvcGRvd24iLCJfb3BlbkRyb3Bkb3duIiwidG9nZ2xlRHJvcGRvd24iLCJfdG9nZ2xlRHJvcGRvd24iLCJjb250YWluZXJQcm9wcyIsImRyb3Bkb3duQ29udGFpbmVyU3R5bGUiLCJoZWFkZXIiLCJjbG9uZUVsZW1lbnQiLCJfaGFuZGxlSGVhZGVyUmVmIiwiZm9vdGVyIiwiX2hhbmRsZUZvb3RlclJlZiIsIl9yZW5kZXJJdGVtIiwiZ2V0SXRlbXMiLCJtYXhIZWlnaHQiLCJwcm9wVHlwZXMiLCJmdW5jIiwiaXNSZXF1aXJlZCIsImJvb2wiLCJvbmVPZlR5cGUiLCJudW1iZXIiLCJzdHJpbmciLCJhcnJheSIsImtleU1hcHBlciIsImxhYmVsIiwic2hhcGUiLCJzZWNvbmRhcnlUZXh0Iiwic2hvdWxkSW5wdXRXcmFwIiwiZGlzcGxheU5hbWUiLCJkZWZhdWx0UHJvcHMiLCJGdW5jdGlvbiIsInByb3RvdHlwZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7Ozs7QUFJQTs7OztBQUVBOztBQUNBOztBQUNBOztBQUdBOztBQUlBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBLElBQU1BLDRCQUE0QixTQUE1QkEs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QUF2QixHQUFzQztBQUNwQ25GLHdCQUFzQixJQURjO0FBRXBDOEMsY0FBWSwyQkFBTSxDQUFOLENBRndCO0FBR3BDaEQsU0FBTyxFQUg2QjtBQUlwQ2tELFdBQVMsS0FKMkI7QUFLcENkLGtCQUFnQmtELFNBQVNDLFNBTFc7QUFNcENwRixtQkFBaUJyQixzQkFObUI7QUFPcENtQixpQkFBZTtBQVBxQixDQUF0Qzs7ZUFVZUksc0I7Ozs7Ozs7OztnQ0FsVVQzQix5Qjs7Z0NBU0dJLHNCOztnQ0FVQVMsb0I7O2dDQVFBSyxjOztnQ0FPQUcsaUI7O2dDQTRCSE0sc0IiLCJmaWxlIjoiX0xpc3REcm9wZG93bkNvbnRyb2wuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgQ29tcG9uZW50LFxuICBQcm9wVHlwZXMsXG59IGZyb20gJ3JlYWN0JztcbmltcG9ydCBpc0VxdWFsIGZyb20gJ2xvZGFzaC9pc0VxdWFsJztcblxuaW1wb3J0IHsgZmluZERPTU5vZGUgfSBmcm9tICcuLi9SZWFjdFV0aWxzJztcbmltcG9ydCB7IGF1dG9iaW5kIH0gZnJvbSAnLi4vYmFzZS9CYXNlJztcbmltcG9ydCB7XG4gIGdyaWRVbml0c1JhdyBhcyBndVJhdyxcbn0gZnJvbSAnLi4vc3R5bGVzL2hlbHBlcnMnO1xuaW1wb3J0IHtcbiAgREVGQVVMVF9GT05UX0ZBTUlMWSxcbiAgVFlQRV9CQVNFLFxufSBmcm9tICcuLi9zdHlsZXMvbWl4aW5zL3R5cGUnO1xuaW1wb3J0IENvbnRhaW5lciBmcm9tICcuLi9jb250YWluZXJzL0NvbnRhaW5lcic7XG5pbXBvcnQgRmlsdGVyZWRJdGVtc1dyYXBwZXIgZnJvbSAnLi4vX3NlbGVjdHMvRmlsdGVyZWRJdGVtc1dyYXBwZXInO1xuaW1wb3J0IEdyb3VwZWRCdWZmZXJlZExpc3RWaWV3IGZyb20gJy4uL2xpc3RzL19Hcm91cGVkQnVmZmVyZWRMaXN0Vmlldyc7XG5pbXBvcnQgY3JlYXRlU3ViQ29tcG9uZW50UmVuZGVyZXIgZnJvbSAnLi4vdXRpbHMvY3JlYXRlU3ViQ29tcG9uZW50UmVuZGVyZXInO1xuaW1wb3J0IHsgZXNjYXBlUmVndWxhckV4cHJlc3Npb24gfSBmcm9tICcuLi91dGlscy9mb3JtYXR0ZXInO1xuXG5jb25zdCBnZXREcm9wZG93bkNvbnRhaW5lclN0eWxlID0gcHJvcHMgPT4gKFxuICB7XG4gICAgLi4uREVGQVVMVF9GT05UX0ZBTUlMWSxcbiAgICAuLi5UWVBFX0JBU0UsXG4gICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgd2lkdGg6IHByb3BzLndpZHRoLFxuICB9XG4pO1xuXG5mdW5jdGlvbiBkZWZhdWx0UHJlZGljYXRlR2V0dGVyKHsgc2VhcmNoIH0pIHtcbiAgY29uc3QgcXVlcnkgPSBuZXcgUmVnRXhwKGVzY2FwZVJlZ3VsYXJFeHByZXNzaW9uKHNlYXJjaCksICdpJyk7XG4gIHJldHVybiBmdW5jdGlvbiBwcmVkaWNhdGUoaXRlbSkge1xuICAgIHJldHVybiAoXG4gICAgICBxdWVyeS50ZXN0KGl0ZW0uaWQpXG4gICAgICB8fCBxdWVyeS50ZXN0KGl0ZW0udmFsdWUpXG4gICAgKTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gc3ViQ29tcG9uZW50UmVuZGVyZXIoaW5zdGFuY2UsIGtleSkge1xuICByZXR1cm4gY3JlYXRlU3ViQ29tcG9uZW50UmVuZGVyZXIoe1xuICAgIGluc3RhbmNlLFxuICAgIGtleSxcbiAgICBwcm9wc0dldHRlcjogaW5zdGFuY2UuX3NoYXJlZFByb3BzLFxuICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0U2VhcmNoUXVlcnkocHJvcHMsIHN0YXRlID0ge30pIHtcbiAgaWYgKHByb3BzLnNlYXJjaCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIHN0YXRlLnNlYXJjaCB8fCAnJztcbiAgfVxuICByZXR1cm4gcHJvcHMuc2VhcmNoO1xufVxuXG5mdW5jdGlvbiBnZXRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHtcbiAgY29uc3Qge1xuICAgIGl0ZW1zLFxuICAgIHNob3dDcmVhdGVOZXcsXG4gIH0gPSBwcm9wcztcblxuICBjb25zdCBzZWFyY2ggPSBnZXRTZWFyY2hRdWVyeShwcm9wcywgc3RhdGUpO1xuICAvLyBJZiBsb2NhbCBmaWx0ZXJpbmcgaXMgZGlzYWJsZWQsIHJldHVybiB0cnVlIGZvciBldmVyeSBpdGVtIHNvIGl0IGRvZXNuJ3QgZmlsdGVyXG4gIGNvbnN0IHByZWRpY2F0ZSA9IHByb3BzLmVuYWJsZUxvY2FsRmlsdGVyaW5nID8gcHJvcHMucHJlZGljYXRlR2V0dGVyKHsgc2VhcmNoIH0pIDogKCkgPT4gdHJ1ZTtcbiAgY29uc3QgZmlsdGVyZWRJdGVtcyA9IG5ldyBGaWx0ZXJlZEl0ZW1zV3JhcHBlcihpdGVtcywgcHJlZGljYXRlLCBzZWFyY2gsIHNob3dDcmVhdGVOZXcpO1xuXG4gIHJldHVybiB7XG4gICAgZmlsdGVyZWRJdGVtcyxcbiAgICBzZWFyY2gsXG4gIH07XG59XG5cbi8qKlxuICogTGlzdERyb3Bkb3duQ29udHJvbCBpcyByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgZHJvcGRvd24gdXNpbmcgQnVmZmVyZWRMaXN0Vmlldy5cbiAqXG4gKiBCZWNhdXNlIG9mIHNvbWUgb2YgbGltaXRhdGlvbnMgKGZpeGVkIC8gc3RhdGljIGhlaWdodHMpIG9mIEJ1ZmZlcmVkTGlzdFZpZXcsXG4gKiB0aGlzIGNvbXBvbmVudCBpcyBhbHNvIHJlc3BvbnNpYmxlIGhhbmRsaW5nIGl0ZW0gZmlsdGVyaW5nIGFuZCBncm91cGluZyBiYXNlZCBvbiBzZWFyY2ggcXVlcnlcbiAqIGFuZCBncm91cGVyIGZ1bmN0aW9uLlxuICpcbiAqIEF0IHRoZSBtb21lbnQsIHRoZSBjb21wb25lbnQgb25seSBpbXBsZW1lbnRzIGZpbHRlcmluZy5cbiAqXG4gKiAqKiBUaGlzIGNvbXBvbmVudCBNVVNUIE5PVCBCRSBwdXJlIHJlbmRlcmVkLlxuICovXG5jbGFzcyBUeGxMaXN0RHJvcGRvd25Db250cm9sIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgIHN1cGVyKC4uLmFyZ3MpO1xuICAgIHRoaXMuX3JlbmRlclRhcmdldCA9IHN1YkNvbXBvbmVudFJlbmRlcmVyKHRoaXMsICd0YXJnZXQnKTtcbiAgICB0aGlzLl9yZW5kZXJMaXN0SGVhZGVyID0gc3ViQ29tcG9uZW50UmVuZGVyZXIodGhpcywgJ2xpc3RQcm9wcy5oZWFkZXInKTtcbiAgICB0aGlzLl9yZW5kZXJMaXN0Rm9vdGVyID0gc3ViQ29tcG9uZW50UmVuZGVyZXIodGhpcywgJ2xpc3RQcm9wcy5mb290ZXInKTtcbiAgICB0aGlzLnN0YXRlID0gZ2V0U3RhdGVGcm9tUHJvcHModGhpcy5wcm9wcyk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICBpZiAod2luZG93KSB7XG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9oYW5kbGVXaW5kb3dDbGljayk7XG4gICAgfVxuICB9XG5cbiAgY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhuZXh0UHJvcHMpIHtcbiAgICBpZiAoIWlzRXF1YWwobmV4dFByb3BzLml0ZW1zLCB0aGlzLnByb3BzLml0ZW1zKSB8fCAhaXNFcXVhbChuZXh0UHJvcHMuc2VhcmNoLCB0aGlzLnByb3BzLnNlYXJjaClcbiAgICAgICAgfHwgIWlzRXF1YWwobmV4dFByb3BzLnByZWRpY2F0ZUdldHRlciwgdGhpcy5wcm9wcy5wcmVkaWNhdGVHZXR0ZXIpXG4gICAgICAgIHx8ICFpc0VxdWFsKG5leHRQcm9wcy5zaG93Q3JlYXRlTmV3LCB0aGlzLnByb3BzLnNob3dDcmVhdGVOZXcpKSB7XG4gICAgICBjb25zdCBuZXdTdGF0ZSA9IGdldFN0YXRlRnJvbVByb3BzKG5leHRQcm9wcywgdGhpcy5zdGF0ZSk7XG4gICAgICB0aGlzLnNldFN0YXRlKG5ld1N0YXRlKTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBpZiAod2luZG93KSB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9oYW5kbGVXaW5kb3dDbGljayk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIGdldEZpbHRlcmVkSXRlbXMoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdGUuZmlsdGVyZWRJdGVtcztcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlV2luZG93Q2xpY2soZXZlbnQpIHtcbiAgICBjb25zdCBjbGlja0lzT3V0c2lkZUNvbnRlbnQgPSB0aGlzLl9pc0NsaWNrT3V0c2lkZUVsZW1lbnQoZXZlbnQsIHRoaXMpO1xuICAgIGNvbnN0IGNsaWNrSXNPdXRzaWRlSGVhZGVyID0gdGhpcy5faXNDbGlja091dHNpZGVFbGVtZW50KGV2ZW50LCB0aGlzLl9oZWFkZXJSZWYpO1xuICAgIGNvbnN0IGNsaWNrSXNPdXRzaWRlRm9vdGVyID0gdGhpcy5faXNDbGlja091dHNpZGVFbGVtZW50KGV2ZW50LCB0aGlzLl9mb290ZXJSZWYpO1xuXG4gICAgaWYgKGNsaWNrSXNPdXRzaWRlQ29udGVudCAmJiBjbGlja0lzT3V0c2lkZUhlYWRlciAmJiBjbGlja0lzT3V0c2lkZUZvb3Rlcikge1xuICAgICAgdGhpcy5faGFuZGxlQ2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2lzQ2xpY2tPdXRzaWRlRWxlbWVudChjbGlja0V2ZW50LCBlbGVtZW50UmVmKSB7XG4gICAgY29uc3QgZG9tTm9kZSA9IGZpbmRET01Ob2RlKGVsZW1lbnRSZWYpO1xuICAgIHJldHVybiBkb21Ob2RlID8gIWRvbU5vZGUuY29udGFpbnMoY2xpY2tFdmVudC50YXJnZXQpIDogdHJ1ZTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfY2xvc2VEcm9wZG93bigpIHtcbiAgICB0aGlzLl9oYW5kbGVDbG9zZSgpO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9vcGVuRHJvcGRvd24oKSB7XG4gICAgdGhpcy5wcm9wcy5vcGVuRHJvcGRvd24oKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfdG9nZ2xlRHJvcGRvd24oKSB7XG4gICAgY29uc3QgeyBvcGVuID0gZmFsc2UgfSA9IHRoaXMucHJvcHMub3BlbjtcblxuICAgIGlmIChvcGVuKSB7XG4gICAgICB0aGlzLl9oYW5kbGVDbG9zZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnByb3BzLm9wZW5Ecm9wZG93bigpO1xuICAgIH1cbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlQ2xvc2UoKSB7XG4gICAgaWYgKHRoaXMucHJvcHMub3Blbikge1xuICAgICAgdGhpcy5fY2xlYXJTZWFyY2godGhpcy5wcm9wcy5jbG9zZURyb3Bkb3duKTtcbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2NsZWFyU2VhcmNoKGNiKSB7XG4gICAgY29uc3QgbmV3U3RhdGUgPSBnZXRTdGF0ZUZyb21Qcm9wcyh0aGlzLnByb3BzLCB7XG4gICAgICAuLi50aGlzLnN0YXRlLFxuICAgICAgc2VhcmNoOiAnJyxcbiAgICB9KTtcbiAgICB0aGlzLnNldFN0YXRlKG5ld1N0YXRlLCBjYik7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3VwZGF0ZVNlYXJjaCh7IHZhbHVlIH0sIGNhbGxiYWNrKSB7XG4gICAgY29uc3Qgc3RhdGUgPSBnZXRTdGF0ZUZyb21Qcm9wcyh0aGlzLnByb3BzLFxuICAgICAge1xuICAgICAgICAuLi50aGlzLnN0YXRlLFxuICAgICAgICBzZWFyY2g6IHZhbHVlLFxuICAgICAgfVxuICAgICk7XG4gICAgdGhpcy5zZXRTdGF0ZShzdGF0ZSwgKCkgPT4ge1xuICAgICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucHJvcHMub25TZWFyY2hDaGFuZ2UodmFsdWUpO1xuICAgIH0pO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9zaGFyZWRQcm9wcygpIHtcbiAgICBjb25zdCB7IHNlYXJjaCB9ID0gdGhpcy5zdGF0ZTtcbiAgICByZXR1cm4ge1xuICAgICAgY2xlYXJTZWFyY2g6IHRoaXMuX2NsZWFyU2VhcmNoLFxuICAgICAgc2VhcmNoLFxuICAgICAgdXBkYXRlU2VhcmNoOiB0aGlzLl91cGRhdGVTZWFyY2gsXG4gICAgfTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfcmVuZGVySXRlbSgpIHtcbiAgICBjb25zdCB7IGl0ZW1SZW5kZXJlciB9ID0gdGhpcy5wcm9wcztcbiAgICByZXR1cm4gKGl0ZW1Qcm9wcykgPT4ge1xuICAgICAgY29uc3QgeyBpdGVtIH0gPSBpdGVtUHJvcHM7XG4gICAgICByZXR1cm4gaXRlbSAmJiBpdGVtUmVuZGVyZXIoe1xuICAgICAgICAuLi5pdGVtUHJvcHMsXG4gICAgICB9KTtcbiAgICB9O1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVIZWFkZXJSZWYocmVmKSB7XG4gICAgdGhpcy5faGVhZGVyUmVmID0gcmVmO1xuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVGb290ZXJSZWYocmVmKSB7XG4gICAgdGhpcy5fZm9vdGVyUmVmID0gcmVmO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGFjdGl2YXRlSXRlbSxcbiAgICAgIGNvbnRhaW5lcjogQ29udGFpbmVyQ29tcG9uZW50LFxuICAgICAgZ3JvdXBlcixcbiAgICAgIGhlaWdodCxcbiAgICAgIGl0ZW1IZWlnaHQsXG4gICAgICBsaXN0UHJvcHMsXG4gICAgICBsb2FkaW5nLFxuICAgICAga2V5U2VsZWN0ZWRJdGVtQ2xlYXIsXG4gICAgICBrZXlTZWxlY3RlZEl0ZW1JbmRleCxcbiAgICAgIG5vQ29udGVudFZpZXcsXG4gICAgICBvcGVuLFxuICAgICAgc2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlLFxuICAgICAgdGFyZ2V0LFxuICAgICAgeU9mZnNldCxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGNvbnN0IHsgZmlsdGVyZWRJdGVtcyB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGNvbnN0IHRhcmdldFByb3BzID0ge1xuICAgICAgLi4udGhpcy5wcm9wcyxcbiAgICAgIC4uLnRoaXMuX3NoYXJlZFByb3BzKCksXG4gICAgICBjbG9zZURyb3Bkb3duOiB0aGlzLl9jbG9zZURyb3Bkb3duLFxuICAgICAgb3BlbixcbiAgICAgIG9wZW5Ecm9wZG93bjogdGhpcy5fb3BlbkRyb3Bkb3duLFxuICAgICAgdG9nZ2xlRHJvcGRvd246IHRoaXMuX3RvZ2dsZURyb3Bkb3duLFxuICAgIH07XG5cbiAgICBjb25zdCBjb250YWluZXJQcm9wcyA9IHtcbiAgICAgIGhlaWdodCxcbiAgICAgIG9wZW4sXG4gICAgICB3aWR0aDogbGlzdFByb3BzLndpZHRoLFxuICAgICAgeU9mZnNldCxcbiAgICB9O1xuICAgIGNvbnN0IGRyb3Bkb3duQ29udGFpbmVyU3R5bGUgPSBnZXREcm9wZG93bkNvbnRhaW5lclN0eWxlKHRoaXMucHJvcHMpO1xuICAgIGNvbnN0IGhlYWRlciA9IGxpc3RQcm9wcy5oZWFkZXIgJiZcbiAgICAgIFJlYWN0LmNsb25lRWxlbWVudChsaXN0UHJvcHMuaGVhZGVyLCB7IHJlZjogdGhpcy5faGFuZGxlSGVhZGVyUmVmIH0pO1xuICAgIGNvbnN0IGZvb3RlciA9IGxpc3RQcm9wcy5mb290ZXIgJiZcbiAgICAgIFJlYWN0LmNsb25lRWxlbWVudChsaXN0UHJvcHMuZm9vdGVyLCB7IHJlZjogdGhpcy5faGFuZGxlRm9vdGVyUmVmIH0pO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgZGF0YS1jb21wb25lbnQ9XCJUeGxEcm9wZG93bkNvbnRyb2xcIlxuICAgICAgICBzdHlsZT17ZHJvcGRvd25Db250YWluZXJTdHlsZX1cbiAgICAgID5cbiAgICAgICAgeyB0YXJnZXQodGFyZ2V0UHJvcHMpIH1cbiAgICAgICAgPENvbnRhaW5lckNvbXBvbmVudFxuICAgICAgICAgIHsuLi5jb250YWluZXJQcm9wc31cbiAgICAgICAgPlxuICAgICAgICAgIDxDb250YWluZXIgbGF5ZXI9ezJ9PlxuICAgICAgICAgICAgPEdyb3VwZWRCdWZmZXJlZExpc3RWaWV3XG4gICAgICAgICAgICAgIGFjdGl2YXRlSXRlbT17YWN0aXZhdGVJdGVtfVxuICAgICAgICAgICAgICBmb290ZXI9e2Zvb3Rlcn1cbiAgICAgICAgICAgICAgZ3JvdXBlcj17Z3JvdXBlcn1cbiAgICAgICAgICAgICAgaGVhZGVyPXtoZWFkZXJ9XG4gICAgICAgICAgICAgIGhlaWdodD17bGlzdFByb3BzLmhlaWdodH1cbiAgICAgICAgICAgICAgaXRlbUhlaWdodD17aXRlbUhlaWdodH1cbiAgICAgICAgICAgICAgaXRlbVJlbmRlcmVyPXt0aGlzLl9yZW5kZXJJdGVtKCl9XG4gICAgICAgICAgICAgIGl0ZW1zPXtmaWx0ZXJlZEl0ZW1zLmdldEl0ZW1zKCl9XG4gICAgICAgICAgICAgIGtleVNlbGVjdGVkSXRlbUNsZWFyPXtrZXlTZWxlY3RlZEl0ZW1DbGVhcn1cbiAgICAgICAgICAgICAga2V5U2VsZWN0ZWRJdGVtSW5kZXg9e2tleVNlbGVjdGVkSXRlbUluZGV4fVxuICAgICAgICAgICAgICBsb2FkaW5nPXtsb2FkaW5nfVxuICAgICAgICAgICAgICBtYXhIZWlnaHQ9e2xpc3RQcm9wcy5tYXhIZWlnaHR9XG4gICAgICAgICAgICAgIG5vQ29udGVudFZpZXc9e25vQ29udGVudFZpZXd9XG4gICAgICAgICAgICAgIHNob3dTZWFyY2hUb1ZpZXdNb3JlTWVzc2FnZT17c2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L0NvbnRhaW5lcj5cbiAgICAgICAgPC9Db250YWluZXJDb21wb25lbnQ+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG59XG5cblR4bExpc3REcm9wZG93bkNvbnRyb2wucHJvcFR5cGVzID0ge1xuICBhY3RpdmF0ZUl0ZW06IFByb3BUeXBlcy5mdW5jLFxuICBjbG9zZURyb3Bkb3duOiBQcm9wVHlwZXMuZnVuYyxcbiAgY29udGFpbmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBlbmFibGVMb2NhbEZpbHRlcmluZzogUHJvcFR5cGVzLmJvb2wsXG4gIGdyb3VwZXI6IFByb3BUeXBlcy5mdW5jLFxuICBoZWlnaHQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5udW1iZXIsIFByb3BUeXBlcy5zdHJpbmddKSxcbiAgaXRlbUhlaWdodDogUHJvcFR5cGVzLm51bWJlcixcbiAgaXRlbVJlbmRlcmVyOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICBpdGVtczogUHJvcFR5cGVzLmFycmF5LFxuICBrZXlNYXBwZXI6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gIGtleVNlbGVjdGVkSXRlbUNsZWFyOiBQcm9wVHlwZXMuZnVuYyxcbiAga2V5U2VsZWN0ZWRJdGVtSW5kZXg6IFByb3BUeXBlcy5udW1iZXIsXG4gIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBsaXN0UHJvcHM6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgZm9vdGVyOiBHcm91cGVkQnVmZmVyZWRMaXN0Vmlldy5wcm9wVHlwZXMuZm9vdGVyLFxuICAgIGhlYWRlcjogR3JvdXBlZEJ1ZmZlcmVkTGlzdFZpZXcucHJvcFR5cGVzLmhlYWRlcixcbiAgICBoZWlnaHQ6IEdyb3VwZWRCdWZmZXJlZExpc3RWaWV3LnByb3BUeXBlcy5oZWlnaHQsXG4gICAgbWF4SGVpZ2h0OiBHcm91cGVkQnVmZmVyZWRMaXN0Vmlldy5wcm9wVHlwZXMubWF4SGVpZ2h0LFxuICAgIHdpZHRoOiBHcm91cGVkQnVmZmVyZWRMaXN0Vmlldy5wcm9wVHlwZXMud2lkdGgsXG4gIH0pLFxuICBsb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCxcbiAgbm9Db250ZW50VmlldzogR3JvdXBlZEJ1ZmZlcmVkTGlzdFZpZXcucHJvcFR5cGVzLm5vQ29udGVudFZpZXcsXG4gIG9uU2VhcmNoQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgb3BlbjogUHJvcFR5cGVzLmJvb2wsXG4gIG9wZW5Ecm9wZG93bjogUHJvcFR5cGVzLmZ1bmMsXG4gIHByZWRpY2F0ZUdldHRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gIHNlYXJjaDogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2Vjb25kYXJ5VGV4dDogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2hvdWxkSW5wdXRXcmFwOiBQcm9wVHlwZXMuYm9vbCxcbiAgc2hvd0NyZWF0ZU5ldzogUHJvcFR5cGVzLmJvb2wsXG4gIHNob3dTZWFyY2hUb1ZpZXdNb3JlTWVzc2FnZTogR3JvdXBlZEJ1ZmZlcmVkTGlzdFZpZXcucHJvcFR5cGVzLnNob3dTZWFyY2hUb1ZpZXdNb3JlTWVzc2FnZSxcbiAgdGFyZ2V0OiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICB3aWR0aDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm51bWJlciwgUHJvcFR5cGVzLnN0cmluZ10pLFxuICB5T2Zmc2V0OiBQcm9wVHlwZXMubnVtYmVyLFxufTtcblxuVHhsTGlzdERyb3Bkb3duQ29udHJvbC5kaXNwbGF5TmFtZSA9ICdUeGxMaXN0RHJvcGRvd25Db250cm9sJztcblxuVHhsTGlzdERyb3Bkb3duQ29udHJvbC5kZWZhdWx0UHJvcHMgPSB7XG4gIGVuYWJsZUxvY2FsRmlsdGVyaW5nOiB0cnVlLFxuICBpdGVtSGVpZ2h0OiBndVJhdyg3KSxcbiAgaXRlbXM6IFtdLFxuICBsb2FkaW5nOiBmYWxzZSxcbiAgb25TZWFyY2hDaGFuZ2U6IEZ1bmN0aW9uLnByb3RvdHlwZSxcbiAgcHJlZGljYXRlR2V0dGVyOiBkZWZhdWx0UHJlZGljYXRlR2V0dGVyLFxuICBzaG93Q3JlYXRlTmV3OiBmYWxzZSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFR4bExpc3REcm9wZG93bkNvbnRyb2w7XG4iXX0=