'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _toConsumableArray2 = require('babel-runtime/helpers/toConsumableArray');

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Private class representing regular item
 * The class records index from the orignal array for easy lookup
 */
var GroupItem = function () {
  function GroupItem(index, item) {
    (0, _classCallCheck3.default)(this, GroupItem);

    this._index = index;
    this._item = item;
  }

  (0, _createClass3.default)(GroupItem, [{
    key: 'getIndex',
    value: function getIndex() {
      return this._index;
    }
  }, {
    key: 'getItem',
    value: function getItem() {
      return this._item;
    }
  }, {
    key: 'isDisabled',
    value: function isDisabled() {
      return this._item.disabled;
    }
  }]);
  return GroupItem;
}();

/**
 * Private class representing group header
 */


var GroupHeaderItem = function () {
  function GroupHeaderItem(groupKey) {
    (0, _classCallCheck3.default)(this, GroupHeaderItem);

    this._groupKey = groupKey;
  }

  (0, _createClass3.default)(GroupHeaderItem, [{
    key: 'toObject',
    value: function toObject() {
      return {
        groupKey: this._groupKey
      };
    }
  }]);
  return GroupHeaderItem;
}();

/**
 * Private class representing each group node.
 */


var GroupNode = function () {
  function GroupNode(groupKey) {
    (0, _classCallCheck3.default)(this, GroupNode);

    this.groupKey = groupKey;
    this.items = [];
  }

  (0, _createClass3.default)(GroupNode, [{
    key: 'push',
    value: function push(item) {
      this.items.push(item);
    }
  }, {
    key: 'getItems',
    value: function getItems(indexOffset) {
      return this.items.map(function (item, index) {
        return new GroupItem(index + indexOffset, item);
      });
    }
  }]);
  return GroupNode;
}();

function groupBy(items, grouper) {
  var groupedItems = {};
  var groups = [];

  items.forEach(function (item) {
    var groupKey = String(grouper(item));
    if (!groupedItems[groupKey]) {
      var groupNode = new GroupNode(groupKey);
      groups.push(groupKey);
      groupedItems[groupKey] = groupNode;
    }

    groupedItems[groupKey].push(item);
  });

  return {
    groupedItems: groupedItems,
    groups: groups
  };
}

function flattenGroupedItems() {
  var groups = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];
  var groupedItems = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var flatItems = [];
  var indexOffset = 0;
  groups.forEach(function (groupKey) {
    var items = groupedItems[groupKey].getItems(indexOffset);
    var groupHeader = new GroupHeaderItem(groupKey);
    flatItems = [].concat((0, _toConsumableArray3.default)(flatItems), [groupHeader], (0, _toConsumableArray3.default)(items));
    indexOffset += items.length;
  });
  return flatItems;
}

var GroupedItemsWrapper = function () {
  function GroupedItemsWrapper(props) {
    (0, _classCallCheck3.default)(this, GroupedItemsWrapper);

    this.isGrouped = this.isGrouped.bind(this);
    this.render = this.render.bind(this);
    this.getSize = this.getSize.bind(this);
    this.renderItem = this.renderItem.bind(this);
    this.renderGroupHeader = this.renderGroupHeader.bind(this);

    this._items = [].concat((0, _toConsumableArray3.default)(props.items || []));
    this._grouper = props.grouper;
    this._itemRenderer = props.itemRenderer;
    this._groupRenderer = props.groupRenderer;
    this._isGrouped = typeof this._grouper === 'function';
    if (this._isGrouped) {
      var _groupBy = groupBy(this._items, this._grouper),
          groups = _groupBy.groups,
          groupedItems = _groupBy.groupedItems;

      this._groups = groups;
      this._groupedItems = groupedItems;
      this._flatItems = flattenGroupedItems(this._groups, this._groupedItems);
    }
  }

  (0, _createClass3.default)(GroupedItemsWrapper, [{
    key: 'isGroupHeader',
    value: function isGroupHeader(item) {
      return item instanceof GroupHeaderItem;
    }
  }, {
    key: 'isItem',
    value: function isItem(item) {
      return item instanceof GroupItem;
    }
  }, {
    key: 'isGrouped',
    value: function isGrouped() {
      return this._isGrouped;
    }
  }, {
    key: 'getSize',
    value: function getSize() {
      return this._isGrouped ? this._flatItems.length : this._items.length;
    }
  }, {
    key: 'getItem',
    value: function getItem(index) {
      if (!this._isGrouped) {
        var item = this._items[index];
        return new GroupItem(index, item);
      }
      return this._flatItems[index];
    }
  }, {
    key: 'renderItem',
    value: function renderItem(props) {
      var item = props.item,
          others = (0, _objectWithoutProperties3.default)(props, ['item']);

      return this._itemRenderer((0, _extends3.default)({}, others, {
        disabled: item.isDisabled(),
        index: item.getIndex(),
        item: item.getItem()
      }));
    }
  }, {
    key: 'renderGroupHeader',
    value: function renderGroupHeader(props) {
      var item = props.item,
          others = (0, _objectWithoutProperties3.default)(props, ['item']);

      return this._groupRenderer((0, _extends3.default)({}, others, {
        item: item.toObject()
      }));
    }
  }, {
    key: 'render',
    value: function render(props) {
      var item = this.getItem(props.index);
      var rendererProps = (0, _extends3.default)({}, props, {
        item: item
      });
      var renderer = item instanceof GroupHeaderItem ? this.renderGroupHeader : this.renderItem;
      return renderer(rendererProps);
    }
  }]);
  return GroupedItemsWrapper;
}();

var _default = GroupedItemsWrapper;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(GroupItem, 'GroupItem', 'src/lists/GroupedItemsWrapper.js');

  __REACT_HOT_LOADER__.register(GroupHeaderItem, 'GroupHeaderItem', 'src/lists/GroupedItemsWrapper.js');

  __REACT_HOT_LOADER__.register(GroupNode, 'GroupNode', 'src/lists/GroupedItemsWrapper.js');

  __REACT_HOT_LOADER__.register(groupBy, 'groupBy', 'src/lists/GroupedItemsWrapper.js');

  __REACT_HOT_LOADER__.register(flattenGroupedItems, 'flattenGroupedItems', 'src/lists/GroupedItemsWrapper.js');

  __REACT_HOT_LOADER__.register(GroupedItemsWrapper, 'GroupedItemsWrapper', 'src/lists/GroupedItemsWrapper.js');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/lists/GroupedItemsWrapper.js');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saXN0cy9Hcm91cGVkSXRlbXNXcmFwcGVyLmpzIl0sIm5hbWVzIjpbIkdyb3VwSXRlbSIsImluZGV4IiwiaXRlbSIsIl9pbmRleCIsIl9pdGVtIiwiZGlzYWJsZWQiLCJHcm91cEhlYWRlckl0ZW0iLCJncm91cEtleSIsIl9ncm91cEtleSIsIkdyb3VwTm9kZSIsIml0ZW1zIiwicHVzaCIsImluZGV4T2Zmc2V0IiwibWFwIiwiZ3JvdXBCeSIsImdyb3VwZXIiLCJncm91cGVkSXRlbXMiLCJncm91cHMiLCJmb3JFYWNoIiwiU3RyaW5nIiwiZ3JvdXBOb2RlIiwiZmxhdHRlbkdyb3VwZWRJdGVtcyIsImZsYXRJdGVtcyIsImdldEl0ZW1zIiwiZ3JvdXBIZWFkZXIiLCJsZW5ndGgiLCJHcm91cGVkSXRlbXNXcmFwcGVyIiwicHJvcHMiLCJpc0dyb3VwZWQiLCJiaW5kIiwicmVuZGVyIiwiZ2V0U2l6ZSIsInJlbmRlckl0ZW0iLCJyZW5kZXJHcm91cEhlYWRlciIsIl9pdGVtcyIsIl9ncm91cGVyIiwiX2l0ZW1SZW5kZXJlciIsIml0ZW1SZW5kZXJlciIsIl9ncm91cFJlbmRlcmVyIiwiZ3JvdXBSZW5kZXJlciIsIl9pc0dyb3VwZWQiLCJfZ3JvdXBzIiwiX2dyb3VwZWRJdGVtcyIsIl9mbGF0SXRlbXMiLCJvdGhlcnMiLCJpc0Rpc2FibGVkIiwiZ2V0SW5kZXgiLCJnZXRJdGVtIiwidG9PYmplY3QiLCJyZW5kZXJlclByb3BzIiwicmVuZGVyZXIiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztJQUlNQSxTO0FBQ0oscUJBQVlDLEtBQVosRUFBbUJDLElBQW5CLEVBQXlCO0FBQUE7O0FBQ3ZCLFNBQUtDLE1BQUwsR0FBY0YsS0FBZDtBQUNBLFNBQUtHLEtBQUwsR0FBYUYsSUFBYjtBQUNEOzs7OytCQUVVO0FBQ1QsYUFBTyxLQUFLQyxNQUFaO0FBQ0Q7Ozs4QkFFUztBQUNSLGFBQU8sS0FBS0MsS0FB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RlEsTUFERTtBQUVMdkMsa0JBQVVILEtBQUsyQyxVQUFMLEVBRkw7QUFHTDVDLGVBQU9DLEtBQUs0QyxRQUFMLEVBSEY7QUFJTDVDLGNBQU1BLEtBQUs2QyxPQUFMO0FBSkQsU0FBUDtBQU1EOzs7c0NBRWlCcEIsSyxFQUFPO0FBQUEsVUFFckJ6QixJQUZxQixHQUluQnlCLEtBSm1CLENBRXJCekIsSUFGcUI7QUFBQSxVQUdsQjBDLE1BSGtCLDBDQUluQmpCLEtBSm1COztBQUt2QixhQUFPLEtBQUtXLGNBQUwsNEJBQ0ZNLE1BREU7QUFFTDFDLGNBQU1BLEtBQUs4QyxRQUFMO0FBRkQsU0FBUDtBQUlEOzs7MkJBRU1yQixLLEVBQU87QUFDWixVQUFNekIsT0FBTyxLQUFLNkMsT0FBTCxDQUFhcEIsTUFBTTFCLEtBQW5CLENBQWI7QUFDQSxVQUFNZ0QsMkNBQ0R0QixLQURDO0FBRUp6QjtBQUZJLFFBQU47QUFJQSxVQUFNZ0QsV0FBV2hELGdCQUFnQkksZUFBaEIsR0FDYixLQUFLMkIsaUJBRFEsR0FFYixLQUFLRCxVQUZUO0FBR0EsYUFBT2tCLFNBQVNELGFBQVQsQ0FBUDtBQUNEOzs7OztlQUdZdkIsbUI7Ozs7Ozs7OztnQ0E3S1QxQixTOztnQ0FzQkFNLGU7O2dDQWVBRyxTOztnQ0FnQkdLLE87O2dDQXFCQU8sbUI7O2dDQVlISyxtQiIsImZpbGUiOiJHcm91cGVkSXRlbXNXcmFwcGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcml2YXRlIGNsYXNzIHJlcHJlc2VudGluZyByZWd1bGFyIGl0ZW1cbiAqIFRoZSBjbGFzcyByZWNvcmRzIGluZGV4IGZyb20gdGhlIG9yaWduYWwgYXJyYXkgZm9yIGVhc3kgbG9va3VwXG4gKi9cbmNsYXNzIEdyb3VwSXRlbSB7XG4gIGNvbnN0cnVjdG9yKGluZGV4LCBpdGVtKSB7XG4gICAgdGhpcy5faW5kZXggPSBpbmRleDtcbiAgICB0aGlzLl9pdGVtID0gaXRlbTtcbiAgfVxuXG4gIGdldEluZGV4KCkge1xuICAgIHJldHVybiB0aGlzLl9pbmRleDtcbiAgfVxuXG4gIGdldEl0ZW0oKSB7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW07XG4gIH1cblxuICBpc0Rpc2FibGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9pdGVtLmRpc2FibGVkO1xuICB9XG59XG5cbi8qKlxuICogUHJpdmF0ZSBjbGFzcyByZXByZXNlbnRpbmcgZ3JvdXAgaGVhZGVyXG4gKi9cbmNsYXNzIEdyb3VwSGVhZGVySXRlbSB7XG4gIGNvbnN0cnVjdG9yKGdyb3VwS2V5KSB7XG4gICAgdGhpcy5fZ3JvdXBLZXkgPSBncm91cEtleTtcbiAgfVxuXG4gIHRvT2JqZWN0KCkge1xuICAgIHJldHVybiB7XG4gICAgICBncm91cEtleTogdGhpcy5fZ3JvdXBLZXksXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFByaXZhdGUgY2xhc3MgcmVwcmVzZW50aW5nIGVhY2ggZ3JvdXAgbm9kZS5cbiAqL1xuY2xhc3MgR3JvdXBOb2RlIHtcbiAgY29uc3RydWN0b3IoZ3JvdXBLZXkpIHtcbiAgICB0aGlzLmdyb3VwS2V5ID0gZ3JvdXBLZXk7XG4gICAgdGhpcy5pdGVtcyA9IFtdO1xuICB9XG5cbiAgcHVzaChpdGVtKSB7XG4gICAgdGhpcy5pdGVtcy5wdXNoKGl0ZW0pO1xuICB9XG5cbiAgZ2V0SXRlbXMoaW5kZXhPZmZzZXQpIHtcbiAgICByZXR1cm4gdGhpcy5pdGVtcy5tYXAoKGl0ZW0sIGluZGV4KSA9PlxuICAgICAgbmV3IEdyb3VwSXRlbShpbmRleCArIGluZGV4T2Zmc2V0LCBpdGVtKSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ3JvdXBCeShpdGVtcywgZ3JvdXBlcikge1xuICBjb25zdCBncm91cGVkSXRlbXMgPSB7fTtcbiAgY29uc3QgZ3JvdXBzID0gW107XG5cbiAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgIGNvbnN0IGdyb3VwS2V5ID0gU3RyaW5nKGdyb3VwZXIoaXRlbSkpO1xuICAgIGlmICghZ3JvdXBlZEl0ZW1zW2dyb3VwS2V5XSkge1xuICAgICAgY29uc3QgZ3JvdXBOb2RlID0gbmV3IEdyb3VwTm9kZShncm91cEtleSk7XG4gICAgICBncm91cHMucHVzaChncm91cEtleSk7XG4gICAgICBncm91cGVkSXRlbXNbZ3JvdXBLZXldID0gZ3JvdXBOb2RlO1xuICAgIH1cblxuICAgIGdyb3VwZWRJdGVtc1tncm91cEtleV0ucHVzaChpdGVtKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBncm91cGVkSXRlbXMsXG4gICAgZ3JvdXBzLFxuICB9O1xufVxuXG5mdW5jdGlvbiBmbGF0dGVuR3JvdXBlZEl0ZW1zKGdyb3VwcyA9IFtdLCBncm91cGVkSXRlbXMgPSB7fSkge1xuICBsZXQgZmxhdEl0ZW1zID0gW107XG4gIGxldCBpbmRleE9mZnNldCA9IDA7XG4gIGdyb3Vwcy5mb3JFYWNoKChncm91cEtleSkgPT4ge1xuICAgIGNvbnN0IGl0ZW1zID0gZ3JvdXBlZEl0ZW1zW2dyb3VwS2V5XS5nZXRJdGVtcyhpbmRleE9mZnNldCk7XG4gICAgY29uc3QgZ3JvdXBIZWFkZXIgPSBuZXcgR3JvdXBIZWFkZXJJdGVtKGdyb3VwS2V5KTtcbiAgICBmbGF0SXRlbXMgPSBbLi4uZmxhdEl0ZW1zLCBncm91cEhlYWRlciwgLi4uaXRlbXNdO1xuICAgIGluZGV4T2Zmc2V0ICs9IGl0ZW1zLmxlbmd0aDtcbiAgfSk7XG4gIHJldHVybiBmbGF0SXRlbXM7XG59XG5cbmNsYXNzIEdyb3VwZWRJdGVtc1dyYXBwZXIge1xuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHRoaXMuaXNHcm91cGVkID0gdGhpcy5pc0dyb3VwZWQuYmluZCh0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IHRoaXMucmVuZGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5nZXRTaXplID0gdGhpcy5nZXRTaXplLmJpbmQodGhpcyk7XG4gICAgdGhpcy5yZW5kZXJJdGVtID0gdGhpcy5yZW5kZXJJdGVtLmJpbmQodGhpcyk7XG4gICAgdGhpcy5yZW5kZXJHcm91cEhlYWRlciA9IHRoaXMucmVuZGVyR3JvdXBIZWFkZXIuYmluZCh0aGlzKTtcblxuICAgIHRoaXMuX2l0ZW1zID0gWy4uLihwcm9wcy5pdGVtcyB8fCBbXSldO1xuICAgIHRoaXMuX2dyb3VwZXIgPSBwcm9wcy5ncm91cGVyO1xuICAgIHRoaXMuX2l0ZW1SZW5kZXJlciA9IHByb3BzLml0ZW1SZW5kZXJlcjtcbiAgICB0aGlzLl9ncm91cFJlbmRlcmVyID0gcHJvcHMuZ3JvdXBSZW5kZXJlcjtcbiAgICB0aGlzLl9pc0dyb3VwZWQgPSB0eXBlb2YgdGhpcy5fZ3JvdXBlciA9PT0gJ2Z1bmN0aW9uJztcbiAgICBpZiAodGhpcy5faXNHcm91cGVkKSB7XG4gICAgICBjb25zdCB7XG4gICAgICAgIGdyb3VwcyxcbiAgICAgICAgZ3JvdXBlZEl0ZW1zLFxuICAgICAgfSA9IGdyb3VwQnkodGhpcy5faXRlbXMsIHRoaXMuX2dyb3VwZXIpO1xuICAgICAgdGhpcy5fZ3JvdXBzID0gZ3JvdXBzO1xuICAgICAgdGhpcy5fZ3JvdXBlZEl0ZW1zID0gZ3JvdXBlZEl0ZW1zO1xuICAgICAgdGhpcy5fZmxhdEl0ZW1zID0gZmxhdHRlbkdyb3VwZWRJdGVtcyh0aGlzLl9ncm91cHMsIHRoaXMuX2dyb3VwZWRJdGVtcyk7XG4gICAgfVxuICB9XG5cbiAgaXNHcm91cEhlYWRlcihpdGVtKSB7XG4gICAgcmV0dXJuIGl0ZW0gaW5zdGFuY2VvZiBHcm91cEhlYWRlckl0ZW07XG4gIH1cblxuICBpc0l0ZW0oaXRlbSkge1xuICAgIHJldHVybiBpdGVtIGluc3RhbmNlb2YgR3JvdXBJdGVtO1xuICB9XG5cbiAgaXNHcm91cGVkKCkge1xuICAgIHJldHVybiB0aGlzLl9pc0dyb3VwZWQ7XG4gIH1cblxuICBnZXRTaXplKCkge1xuICAgIHJldHVybiB0aGlzLl9pc0dyb3VwZWRcbiAgICAgID8gdGhpcy5fZmxhdEl0ZW1zLmxlbmd0aFxuICAgICAgOiB0aGlzLl9pdGVtcy5sZW5ndGg7XG4gIH1cblxuICBnZXRJdGVtKGluZGV4KSB7XG4gICAgaWYgKCF0aGlzLl9pc0dyb3VwZWQpIHtcbiAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLl9pdGVtc1tpbmRleF07XG4gICAgICByZXR1cm4gbmV3IEdyb3VwSXRlbShpbmRleCwgaXRlbSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9mbGF0SXRlbXNbaW5kZXhdO1xuICB9XG5cbiAgcmVuZGVySXRlbShwcm9wcykge1xuICAgIGNvbnN0IHtcbiAgICAgIGl0ZW0sXG4gICAgICAuLi5vdGhlcnNcbiAgICB9ID0gcHJvcHM7XG4gICAgcmV0dXJuIHRoaXMuX2l0ZW1SZW5kZXJlcih7XG4gICAgICAuLi5vdGhlcnMsXG4gICAgICBkaXNhYmxlZDogaXRlbS5pc0Rpc2FibGVkKCksXG4gICAgICBpbmRleDogaXRlbS5nZXRJbmRleCgpLFxuICAgICAgaXRlbTogaXRlbS5nZXRJdGVtKCksXG4gICAgfSk7XG4gIH1cblxuICByZW5kZXJHcm91cEhlYWRlcihwcm9wcykge1xuICAgIGNvbnN0IHtcbiAgICAgIGl0ZW0sXG4gICAgICAuLi5vdGhlcnNcbiAgICB9ID0gcHJvcHM7XG4gICAgcmV0dXJuIHRoaXMuX2dyb3VwUmVuZGVyZXIoe1xuICAgICAgLi4ub3RoZXJzLFxuICAgICAgaXRlbTogaXRlbS50b09iamVjdCgpLFxuICAgIH0pO1xuICB9XG5cbiAgcmVuZGVyKHByb3BzKSB7XG4gICAgY29uc3QgaXRlbSA9IHRoaXMuZ2V0SXRlbShwcm9wcy5pbmRleCk7XG4gICAgY29uc3QgcmVuZGVyZXJQcm9wcyA9IHtcbiAgICAgIC4uLnByb3BzLFxuICAgICAgaXRlbSxcbiAgICB9O1xuICAgIGNvbnN0IHJlbmRlcmVyID0gaXRlbSBpbnN0YW5jZW9mIEdyb3VwSGVhZGVySXRlbVxuICAgICAgPyB0aGlzLnJlbmRlckdyb3VwSGVhZGVyXG4gICAgICA6IHRoaXMucmVuZGVySXRlbTtcbiAgICByZXR1cm4gcmVuZGVyZXIocmVuZGVyZXJQcm9wcyk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgR3JvdXBlZEl0ZW1zV3JhcHBlcjtcbiJdfQ==