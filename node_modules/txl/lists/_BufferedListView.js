'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _class, _desc, _value, _class2;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _raf = require('raf');

var _raf2 = _interopRequireDefault(_raf);

var _isFunction = require('lodash/isFunction');

var _isFunction2 = _interopRequireDefault(_isFunction);

var _Base = require('../base/Base');

var _BufferedListItems = require('./_BufferedListItems');

var _BufferedListItems2 = _interopRequireDefault(_BufferedListItems);

var _theme = require('../styles/theme');

var _type = require('../styles/mixins/type');

var _FlexContainer = require('../layout/FlexContainer');

var _FlexContainer2 = _interopRequireDefault(_FlexContainer);

var _LoadingIndicator = require('../progress-indicators/LoadingIndicator');

var _LoadingIndicator2 = _interopRequireDefault(_LoadingIndicator);

var _SearchToViewMoreItem = require('../_selects/SearchToViewMoreItem');

var _SearchToViewMoreItem2 = _interopRequireDefault(_SearchToViewMoreItem);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var DEFAULT_NO_CONTENT_STYLE = (0, _extends3.default)({}, _type.DEFAULT_FONT_FAMILY, _type.TYPE_BASE, {
  color: _theme.COLOR_NEUTRAL['200'],
  padding: 10,
  position: 'relative'
});

function getStyle(props) {
  return {
    backgroundColor: props.backgroundColor,
    overflow: 'hidden',
    width: '100%'
  };
}

function getScrollStyle(props) {
  return {
    height: props.height,
    maxHeight: props.maxHeight,
    overflow: 'auto',
    position: 'relative',
    /**
     * This hard coded zIndex is to place the scroll view on top of each item view
     * Failed to specify this zIndex will result scroll bar to be rendered behind each
     * item
     */
    zIndex: 1
  };
}

/**
 * BufferedListView uses BufferedListItems to render N number of items.
 *
 * This component is useful for components that requires fast render / mount time.
 *
 * ** DO NOT USE pure renderer
 */

var TxlBufferedListView = (0, _radium2.default)(_class = (_class2 = function (_Component) {
  (0, _inherits3.default)(TxlBufferedListView, _Component);

  function TxlBufferedListView() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlBufferedListView);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlBufferedListView.__proto__ || (0, _getPrototypeOf2.default)(TxlBufferedListView)).call.apply(_ref, [this].concat(args)));

    _this.scrollTop = 0;
    _this.keySelectedItemIndex = null;
    _this.state = {
      firstItemIndex: 0,
      firstItemOffset: 0,
      scrollTop: 0
    };
    return _this;
  }

  (0, _createClass3.default)(TxlBufferedListView, [{
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      var _props = this.props,
          itemHeight = _props.itemHeight,
          keySelectedItemIndex = _props.keySelectedItemIndex;


      if (keySelectedItemIndex != null) {
        var bufferedListBodyElement = _reactDom2.default.findDOMNode(this._bufferedListBody);
        if (bufferedListBodyElement) {
          bufferedListBodyElement.scrollTop = itemHeight * keySelectedItemIndex;
        }
      }
    }
  }, {
    key: '_setScrollState',
    value: function _setScrollState() {
      if (this.scrollTop === this.state.scrollTop) {
        return;
      }

      var scrollTop = this.scrollTop;
      var itemHeight = this.props.itemHeight;

      var firstItemIndex = Math.floor(scrollTop / itemHeight);
      var firstItemOffset = firstItemIndex * itemHeight - scrollTop;
      this.setState({
        firstItemIndex: firstItemIndex,
        firstItemOffset: firstItemOffset,
        scrollTop: scrollTop
      });
    }
  }, {
    key: '_handleScroll',
    value: function _handleScroll(e) {
      var _props2 = this.props,
          itemHeight = _props2.itemHeight,
          keySelectedItemClear = _props2.keySelectedItemClear,
          keySelectedItemIndex = _props2.keySelectedItemIndex;


      if (keySelectedItemIndex != null && keySelectedItemClear) {
        var scrollDifference = Math.abs(this.scrollTop - e.target.scrollTop);
        // CHECK TO SEE IF THE USER IS JUST SCROLLING SO keySelectedItemIndex IS CLEARED
        if (scrollDifference !== itemHeight && keySelectedItemIndex === this.keySelectedItemIndex) {
          // CLEAR THE KEY INDEX
          keySelectedItemClear();
        }
      }

      this.scrollTop = e.target.scrollTop;
      this.keySelectedItemIndex = keySelectedItemIndex;
      (0, _raf2.default)(this._setScrollState);
    }
  }, {
    key: '_handleOnMouseLeave',
    value: function _handleOnMouseLeave() {
      var activateItem = this.props.activateItem;

      if (activateItem) {
        activateItem(0);
      }
    }
  }, {
    key: '_handleBufferedListBodyRef',
    value: function _handleBufferedListBodyRef(ref) {
      this._bufferedListBody = ref;
    }
  }, {
    key: '_renderNode',
    value: function _renderNode(key) {
      var props = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

      var node = this.props[key];
      if (!node) {
        return null;
      }

      if ((0, _isFunction2.default)(node)) {
        return node(props);
      }

      return node;
    }
  }, {
    key: '_renderHeader',
    value: function _renderHeader() {
      return this._renderNode('header', this.props);
    }
  }, {
    key: '_renderLoadingContent',
    value: function _renderLoadingContent() {
      var _props3 = this.props,
          height = _props3.height,
          loading = _props3.loading,
          maxHeight = _props3.maxHeight;


      if (!loading) {
        return null;
      }

      var loadingContent = this._renderNode('loadingContent', this.props);
      if (loadingContent) {
        return loadingContent;
      }

      var style = {
        height: (maxHeight || height) + 'px'
      };

      // Default Loading Content
      return _react2.default.createElement(
        _FlexContainer2.default,
        {
          alignItems: 'center',
          justifyContent: 'center',
          key: 'body',
          style: style
        },
        _react2.default.createElement(_LoadingIndicator2.default, { size: 'medium' })
      );
    }
  }, {
    key: '_renderNoContent',
    value: function _renderNoContent() {
      var _props4 = this.props,
          loading = _props4.loading,
          itemsCount = _props4.itemsCount;


      if (loading || itemsCount > 0) {
        return null;
      }

      var noContent = this._renderNode('noContent', this.props);
      if (noContent) {
        return noContent;
      }

      // Default noContent
      return _react2.default.createElement(
        'div',
        {
          key: 'body',
          style: DEFAULT_NO_CONTENT_STYLE
        },
        'No matches found'
      );
    }
  }, {
    key: '_renderBody',
    value: function _renderBody() {
      var _props5 = this.props,
          activateItem = _props5.activateItem,
          itemHeight = _props5.itemHeight,
          itemRenderer = _props5.itemRenderer,
          itemsCount = _props5.itemsCount,
          keySelectedItemClear = _props5.keySelectedItemClear,
          keySelectedItemIndex = _props5.keySelectedItemIndex,
          loading = _props5.loading,
          showSearchToViewMoreMessage = _props5.showSearchToViewMoreMessage;


      if (loading || itemsCount === 0) {
        return null;
      }

      var _state = this.state,
          firstItemIndex = _state.firstItemIndex,
          firstItemOffset = _state.firstItemOffset;


      var viewportHeight = this.props.maxHeight || this.props.height;
      var scrollHeight = itemHeight * itemsCount;

      return _react2.default.createElement(
        'div',
        {
          ref: this._handleBufferedListBodyRef,
          'data-component': 'TxlBufferedListView',
          key: 'body',
          style: getScrollStyle(this.props),
          onMouseLeave: this._handleOnMouseLeave
        },
        _react2.default.createElement(_BufferedListItems2.default, {
          activateItem: activateItem,
          firstItemIndex: firstItemIndex,
          firstItemOffset: firstItemOffset,
          itemRenderer: itemRenderer,
          viewportHeight: viewportHeight,
          itemHeight: itemHeight,
          itemsCount: itemsCount,
          keySelectedItemClear: keySelectedItemClear,
          keySelectedItemIndex: keySelectedItemIndex,
          scrollHeight: scrollHeight,
          offsetTop: 0
        }),
        showSearchToViewMoreMessage && _react2.default.createElement(_SearchToViewMoreItem2.default, null)
      );
    }
  }, {
    key: '_renderFooter',
    value: function _renderFooter() {
      return this._renderNode('footer');
    }
  }, {
    key: 'render',
    value: function render() {
      var loadingContent = this._renderLoadingContent();
      if (loadingContent) {
        return loadingContent;
      }

      var header = this._renderHeader();
      var noContent = this._renderNoContent();
      var body = this._renderBody();
      var footer = this._renderFooter();
      return _react2.default.createElement(
        'div',
        {
          onScroll: this._handleScroll,
          style: getStyle(this.props)
        },
        header,
        noContent,
        body,
        footer
      );
    }
  }]);
  return TxlBufferedListView;
}(_react.Component), (_applyDecoratedDescriptor(_class2.prototype, '_setScrollState', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_setScrollState'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleScroll', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleScroll'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleOnMouseLeave', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleOnMouseLeave'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_handleBufferedListBodyRef', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_handleBufferedListBodyRef'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderNode', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderNode'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderHeader', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderHeader'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderLoadingContent', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderLoadingContent'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderNoContent', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderNoContent'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderBody', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderBody'), _class2.prototype), _applyDecoratedDescriptor(_class2.prototype, '_renderFooter', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class2.prototype, '_renderFooter'), _class2.prototype)), _class2)) || _class;

TxlBufferedListView.displayName = 'TxlBufferedListView';
TxlBufferedListView.propTypes = {
  activateItem: _react.PropTypes.func,
  backgroundColor: _react.PropTypes.string,
  footer: _react.PropTypes.oneOfType([_react.PropTypes.node, _react.PropTypes.func]),
  header: _react.PropTypes.oneOfType([_react.PropTypes.node, _react.PropTypes.func]),
  height: _react.PropTypes.oneOfType([_react.PropTypes.string, _react.PropTypes.number]),
  itemHeight: _react.PropTypes.number.isRequired,
  itemRenderer: _react.PropTypes.func.isRequired,
  itemsCount: _react.PropTypes.number.isRequired,
  keySelectedItemClear: _react.PropTypes.func,
  keySelectedItemIndex: _react.PropTypes.number,
  loading: _react.PropTypes.bool,
  loadingContent: _react.PropTypes.oneOfType([_react.PropTypes.node, _react.PropTypes.func]),
  maxHeight: _react.PropTypes.number,
  noContent: _react.PropTypes.oneOfType([_react.PropTypes.node, _react.PropTypes.func]),
  showCreateNew: _react.PropTypes.bool,
  showSearchToViewMoreMessage: _react.PropTypes.bool
};

TxlBufferedListView.defaultProps = {
  backgroundColor: 'white',
  footer: _Base.NOOP,
  header: _Base.NOOP,
  loading: false,
  showCreateNew: false,
  showSearchToViewMoreMessage: false
};

var _default = TxlBufferedListView;
exports.default = _default;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(DEFAULT_NO_CONTENT_STYLE, 'DEFAULT_NO_CONTENT_STYLE', 'src/lists/_BufferedListView.jsx');

  __REACT_HOT_LOADER__.register(getStyle, 'getStyle', 'src/lists/_BufferedListView.jsx');

  __REACT_HOT_LOADER__.register(getScrollStyle, 'getScrollStyle', 'src/lists/_BufferedListView.jsx');

  __REACT_HOT_LOADER__.register(TxlBufferedListView, 'TxlBufferedListView', 'src/lists/_BufferedListView.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/lists/_BufferedListView.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9saXN0cy9fQnVmZmVyZWRMaXN0Vmlldy5qc3giXSwibmFtZXMiOlsiREVGQVVMVF9OT19DT05URU5UX1NUWUxFIiwiY29sb3IiLCJwYWRkaW5nIiwicG9zaXRpb24iLCJnZXRTdHlsZSIsInByb3BzIiwiYmFja2dyb3VuZENvbG9yIiwib3ZlcmZsb3ciLCJ3aWR0aCIsImdldFNjcm9sbFN0eWxlIiwiaGVpZ2h0IiwibWF4SGVpZ2h0IiwiekluZGV4IiwiVHhsQnVmZmVyZWRMaXN0VmlldyIsImFyZ3MiLCJzY3JvbGxUb3AiLCJrZXlTZWxlY3RlZEl0ZW1JbmRleCIsInN0YXRlIiwiZmlyc3RJdGVtSW5kZXgiLCJmaXJzdEl0ZW1PZmZzZXQiLCJpdGVtSGVpZ2h0IiwiYnVmZmVyZWRMaXN0Qm9keUVsZW1lbnQiLCJmaW5kRE9NTm9kZSIsIl9idWZmZXJlZExpc3RCb2R5IiwiTWF0aCIsImZsb29yIiwic2V0U3RhdGUiLCJlIiwia2V5U2VsZWN0ZWRJdGVtQ2xlYXIiLCJzY3JvbGxEaWZmZXJlbmNlIiwiYWJzIiwidGFyZ2V0IiwiX3NldFNjcm9sbFN0YXRlIiwiYWN0aXZhdGVJdGVtIiwicmVmIiwia2V5Iiwibm9kZSIsIl9yZW5kZXJOb2RlIiwibG9hZGluZyIsImxvYWRpbmdDb250ZW50Iiwic3R5bGUiLCJpdGVtc0NvdW50Iiwibm9Db250ZW50IiwiaXRlbVJlbmRlcmVyIiwic2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlIiwidmlld3BvcnRIZWlnaHQiLCJzY3JvbGxIZWlnaHQiLCJfaGFuZGxlQnVmZmVyZWRMaXN0Qm9keVJlZiIsIl9oYW5kbGVPbk1vdXNlTGVhdmUiLCJfcmVuZGVyTG9hZGluZ0NvbnRlbnQiLCJoZWFkZXIiLCJfcmVuZGVySGVhZGVyIiwiX3JlbmRlck5vQ29udGVudCIsImJvZHkiLCJfcmVuZGVyQm9keSIsImZvb3RlciIsIl9yZW5kZXJGb290ZXIiLCJfaGFuZGxlU2Nyb2xsIiwiZGlzcGxheU5hbWUiLCJwcm9wVHlwZXMiLCJmdW5jIiwic3RyaW5nIiwib25lT2ZUeXBlIiwibnVtYmVyIiwiaXNSZXF1aXJlZCIsImJvb2wiLCJzaG93Q3JlYXRlTmV3IiwiZGVmYXVsdFByb3BzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7OztBQUlBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUE7O0FBSUE7Ozs7QUFDQTs7QUFDQTs7QUFJQTs7OztBQUNBOzs7O0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUE7QUFHSkMsU0FBTyxxQkFBYyxLQUFkLENBSEg7QUFJSkMsV0FBUyxFQUpMO0FBS0pDLFlBQVU7QUFMTixFQUFOOztBQVFBLFNBQVNDLFFBQVQsQ0FBa0JDLEtBQWxCLEVBQXlCO0FBQ3ZCLFNBQU87QUFDTEMscUJBQWlCRCxNQUFNQyxlQURsQjtBQUVMQyxjQUFVLFFBRkw7QUFHTEMsV0FBTztBQUhGLEdBQVA7QUFLRDs7QUFFRCxTQUFTQyxjQUFULENBQXdCSixLQUF4QixFQUErQjtBQUM3QixTQUFPO0FBQ0xLLFlBQVFMLE1BQU1LLE1BRFQ7QUFFTEMsZUFBV04sTUFBTU0sU0FGWjtBQUdMSixjQUFVLE1BSEw7QUFJTEosY0FBVSxVQUpMO0FBS0w7Ozs7O0FBS0FTLFlBQVE7QUFWSCxHQUFQO0FBWUQ7O0FBRUQ7Ozs7Ozs7O0lBUU1DLG1COzs7QUFDSixpQ0FBcUI7QUFBQTs7QUFBQTs7QUFBQSxzQ0FBTkMsSUFBTTtBQUFOQSxVQUFNO0FBQUE7O0FBQUEsMkxBQ1ZBLElBRFU7O0FBRW5CLFVBQUtDLFNBQUwsR0FBaUIsQ0FBakI7QUFDQSxVQUFLQyxvQkFBTCxHQUE0QixJQUE1QjtBQUNBLFVBQUtDLEtBQUwsR0FBYTtBQUNYQyxzQkFBZ0IsQ0FETDtBQUVYQyx1QkFBaUIsQ0FGTjtBQUdYSixpQkFBVztBQUhBLEtBQWI7QUFKbUI7QUFTcEI7Ozs7eUNBRW9CO0FBQUEsbUJBSWYsS0FBS1YsS0FKVTtB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QU5JLENBQW5DOztlQVNlL0IsbUI7Ozs7Ozs7OztnQ0FwVFRiLHdCOztnQ0FRR0ksUTs7Z0NBUUFLLGM7O2dDQXVCSEksbUIiLCJmaWxlIjoiX0J1ZmZlcmVkTGlzdFZpZXcuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHtcbiAgQ29tcG9uZW50LFxuICBQcm9wVHlwZXMsXG59IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IFJhZGl1bSBmcm9tICdyYWRpdW0nO1xuaW1wb3J0IHJhZiBmcm9tICdyYWYnO1xuaW1wb3J0IGlzRnVuY3Rpb24gZnJvbSAnbG9kYXNoL2lzRnVuY3Rpb24nO1xuXG5pbXBvcnQge1xuICBhdXRvYmluZCxcbiAgTk9PUCxcbn0gZnJvbSAnLi4vYmFzZS9CYXNlJztcbmltcG9ydCBCdWZmZXJlZExpc3RJdGVtcyBmcm9tICcuL19CdWZmZXJlZExpc3RJdGVtcyc7XG5pbXBvcnQgeyBDT0xPUl9ORVVUUkFMIH0gZnJvbSAnLi4vc3R5bGVzL3RoZW1lJztcbmltcG9ydCB7XG4gIERFRkFVTFRfRk9OVF9GQU1JTFksXG4gIFRZUEVfQkFTRSxcbn0gZnJvbSAnLi4vc3R5bGVzL21peGlucy90eXBlJztcbmltcG9ydCBGbGV4Q29udGFpbmVyIGZyb20gJy4uL2xheW91dC9GbGV4Q29udGFpbmVyJztcbmltcG9ydCBMb2FkaW5nSW5kaWNhdG9yIGZyb20gJy4uL3Byb2dyZXNzLWluZGljYXRvcnMvTG9hZGluZ0luZGljYXRvcic7XG5pbXBvcnQgU2VhcmNoVG9WaWV3TW9yZUl0ZW0gZnJvbSAnLi4vX3NlbGVjdHMvU2VhcmNoVG9WaWV3TW9yZUl0ZW0nO1xuXG5jb25zdCBERUZBVUxUX05PX0NPTlRFTlRfU1RZTEUgPSB7XG4gIC4uLkRFRkFVTFRfRk9OVF9GQU1JTFksXG4gIC4uLlRZUEVfQkFTRSxcbiAgY29sb3I6IENPTE9SX05FVVRSQUxbJzIwMCddLFxuICBwYWRkaW5nOiAxMCxcbiAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG59O1xuXG5mdW5jdGlvbiBnZXRTdHlsZShwcm9wcykge1xuICByZXR1cm4ge1xuICAgIGJhY2tncm91bmRDb2xvcjogcHJvcHMuYmFja2dyb3VuZENvbG9yLFxuICAgIG92ZXJmbG93OiAnaGlkZGVuJyxcbiAgICB3aWR0aDogJzEwMCUnLFxuICB9O1xufVxuXG5mdW5jdGlvbiBnZXRTY3JvbGxTdHlsZShwcm9wcykge1xuICByZXR1cm4ge1xuICAgIGhlaWdodDogcHJvcHMuaGVpZ2h0LFxuICAgIG1heEhlaWdodDogcHJvcHMubWF4SGVpZ2h0LFxuICAgIG92ZXJmbG93OiAnYXV0bycsXG4gICAgcG9zaXRpb246ICdyZWxhdGl2ZScsXG4gICAgLyoqXG4gICAgICogVGhpcyBoYXJkIGNvZGVkIHpJbmRleCBpcyB0byBwbGFjZSB0aGUgc2Nyb2xsIHZpZXcgb24gdG9wIG9mIGVhY2ggaXRlbSB2aWV3XG4gICAgICogRmFpbGVkIHRvIHNwZWNpZnkgdGhpcyB6SW5kZXggd2lsbCByZXN1bHQgc2Nyb2xsIGJhciB0byBiZSByZW5kZXJlZCBiZWhpbmQgZWFjaFxuICAgICAqIGl0ZW1cbiAgICAgKi9cbiAgICB6SW5kZXg6IDEsXG4gIH07XG59XG5cbi8qKlxuICogQnVmZmVyZWRMaXN0VmlldyB1c2VzIEJ1ZmZlcmVkTGlzdEl0ZW1zIHRvIHJlbmRlciBOIG51bWJlciBvZiBpdGVtcy5cbiAqXG4gKiBUaGlzIGNvbXBvbmVudCBpcyB1c2VmdWwgZm9yIGNvbXBvbmVudHMgdGhhdCByZXF1aXJlcyBmYXN0IHJlbmRlciAvIG1vdW50IHRpbWUuXG4gKlxuICogKiogRE8gTk9UIFVTRSBwdXJlIHJlbmRlcmVyXG4gKi9cbkBSYWRpdW1cbmNsYXNzIFR4bEJ1ZmZlcmVkTGlzdFZpZXcgZXh0ZW5kcyBDb21wb25lbnQge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5zY3JvbGxUb3AgPSAwO1xuICAgIHRoaXMua2V5U2VsZWN0ZWRJdGVtSW5kZXggPSBudWxsO1xuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBmaXJzdEl0ZW1JbmRleDogMCxcbiAgICAgIGZpcnN0SXRlbU9mZnNldDogMCxcbiAgICAgIHNjcm9sbFRvcDogMCxcbiAgICB9O1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGl0ZW1IZWlnaHQsXG4gICAgICBrZXlTZWxlY3RlZEl0ZW1JbmRleCxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChrZXlTZWxlY3RlZEl0ZW1JbmRleCAhPSBudWxsKSB7XG4gICAgICBjb25zdCBidWZmZXJlZExpc3RCb2R5RWxlbWVudCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMuX2J1ZmZlcmVkTGlzdEJvZHkpO1xuICAgICAgaWYgKGJ1ZmZlcmVkTGlzdEJvZHlFbGVtZW50KSB7XG4gICAgICAgIGJ1ZmZlcmVkTGlzdEJvZHlFbGVtZW50LnNjcm9sbFRvcCA9IGl0ZW1IZWlnaHQgKiBrZXlTZWxlY3RlZEl0ZW1JbmRleDtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3NldFNjcm9sbFN0YXRlKCkge1xuICAgIGlmICh0aGlzLnNjcm9sbFRvcCA9PT0gdGhpcy5zdGF0ZS5zY3JvbGxUb3ApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB7IHNjcm9sbFRvcCB9ID0gdGhpcztcbiAgICBjb25zdCB7IGl0ZW1IZWlnaHQgfSA9IHRoaXMucHJvcHM7XG4gICAgY29uc3QgZmlyc3RJdGVtSW5kZXggPSBNYXRoLmZsb29yKHNjcm9sbFRvcCAvIGl0ZW1IZWlnaHQpO1xuICAgIGNvbnN0IGZpcnN0SXRlbU9mZnNldCA9IChmaXJzdEl0ZW1JbmRleCAqIGl0ZW1IZWlnaHQpIC0gc2Nyb2xsVG9wO1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgZmlyc3RJdGVtSW5kZXgsXG4gICAgICBmaXJzdEl0ZW1PZmZzZXQsXG4gICAgICBzY3JvbGxUb3AsXG4gICAgfSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZVNjcm9sbChlKSB7XG4gICAgY29uc3Qge1xuICAgICAgaXRlbUhlaWdodCxcbiAgICAgIGtleVNlbGVjdGVkSXRlbUNsZWFyLFxuICAgICAga2V5U2VsZWN0ZWRJdGVtSW5kZXgsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoa2V5U2VsZWN0ZWRJdGVtSW5kZXggIT0gbnVsbCAmJiBrZXlTZWxlY3RlZEl0ZW1DbGVhcikge1xuICAgICAgY29uc3Qgc2Nyb2xsRGlmZmVyZW5jZSA9IE1hdGguYWJzKHRoaXMuc2Nyb2xsVG9wIC0gZS50YXJnZXQuc2Nyb2xsVG9wKTtcbiAgICAgIC8vIENIRUNLIFRPIFNFRSBJRiBUSEUgVVNFUiBJUyBKVVNUIFNDUk9MTElORyBTTyBrZXlTZWxlY3RlZEl0ZW1JbmRleCBJUyBDTEVBUkVEXG4gICAgICBpZiAoc2Nyb2xsRGlmZmVyZW5jZSAhPT0gaXRlbUhlaWdodCAmJiBrZXlTZWxlY3RlZEl0ZW1JbmRleCA9PT0gdGhpcy5rZXlTZWxlY3RlZEl0ZW1JbmRleCkge1xuICAgICAgICAvLyBDTEVBUiBUSEUgS0VZIElOREVYXG4gICAgICAgIGtleVNlbGVjdGVkSXRlbUNsZWFyKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5zY3JvbGxUb3AgPSBlLnRhcmdldC5zY3JvbGxUb3A7XG4gICAgdGhpcy5rZXlTZWxlY3RlZEl0ZW1JbmRleCA9IGtleVNlbGVjdGVkSXRlbUluZGV4O1xuICAgIHJhZih0aGlzLl9zZXRTY3JvbGxTdGF0ZSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZU9uTW91c2VMZWF2ZSgpIHtcbiAgICBjb25zdCB7IGFjdGl2YXRlSXRlbSB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoYWN0aXZhdGVJdGVtKSB7XG4gICAgICBhY3RpdmF0ZUl0ZW0oMCk7XG4gICAgfVxuICB9XG5cbiAgQGF1dG9iaW5kXG4gIF9oYW5kbGVCdWZmZXJlZExpc3RCb2R5UmVmKHJlZikge1xuICAgIHRoaXMuX2J1ZmZlcmVkTGlzdEJvZHkgPSByZWY7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlck5vZGUoa2V5LCBwcm9wcyA9IHt9KSB7XG4gICAgY29uc3Qgbm9kZSA9IHRoaXMucHJvcHNba2V5XTtcbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGlmIChpc0Z1bmN0aW9uKG5vZGUpKSB7XG4gICAgICByZXR1cm4gbm9kZShwcm9wcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlckhlYWRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVuZGVyTm9kZSgnaGVhZGVyJywgdGhpcy5wcm9wcyk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlckxvYWRpbmdDb250ZW50KCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGhlaWdodCxcbiAgICAgIGxvYWRpbmcsXG4gICAgICBtYXhIZWlnaHQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBpZiAoIWxvYWRpbmcpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGxvYWRpbmdDb250ZW50ID0gdGhpcy5fcmVuZGVyTm9kZSgnbG9hZGluZ0NvbnRlbnQnLCB0aGlzLnByb3BzKTtcbiAgICBpZiAobG9hZGluZ0NvbnRlbnQpIHtcbiAgICAgIHJldHVybiBsb2FkaW5nQ29udGVudDtcbiAgICB9XG5cbiAgICBjb25zdCBzdHlsZSA9IHtcbiAgICAgIGhlaWdodDogYCR7bWF4SGVpZ2h0IHx8IGhlaWdodH1weGAsXG4gICAgfTtcblxuICAgIC8vIERlZmF1bHQgTG9hZGluZyBDb250ZW50XG4gICAgcmV0dXJuIChcbiAgICAgIDxGbGV4Q29udGFpbmVyXG4gICAgICAgIGFsaWduSXRlbXM9XCJjZW50ZXJcIlxuICAgICAgICBqdXN0aWZ5Q29udGVudD1cImNlbnRlclwiXG4gICAgICAgIGtleT1cImJvZHlcIlxuICAgICAgICBzdHlsZT17c3R5bGV9XG4gICAgICA+XG4gICAgICAgIDxMb2FkaW5nSW5kaWNhdG9yIHNpemU9XCJtZWRpdW1cIiAvPlxuICAgICAgPC9GbGV4Q29udGFpbmVyPlxuICAgICk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlck5vQ29udGVudCgpIHtcbiAgICBjb25zdCB7XG4gICAgICBsb2FkaW5nLFxuICAgICAgaXRlbXNDb3VudCxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChsb2FkaW5nIHx8IGl0ZW1zQ291bnQgPiAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBub0NvbnRlbnQgPSB0aGlzLl9yZW5kZXJOb2RlKCdub0NvbnRlbnQnLCB0aGlzLnByb3BzKTtcbiAgICBpZiAobm9Db250ZW50KSB7XG4gICAgICByZXR1cm4gbm9Db250ZW50O1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgbm9Db250ZW50XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAga2V5PVwiYm9keVwiXG4gICAgICAgIHN0eWxlPXtERUZBVUxUX05PX0NPTlRFTlRfU1RZTEV9XG4gICAgICA+XG4gICAgICAgIE5vIG1hdGNoZXMgZm91bmRcbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlckJvZHkoKSB7XG4gICAgY29uc3Qge1xuICAgICAgYWN0aXZhdGVJdGVtLFxuICAgICAgaXRlbUhlaWdodCxcbiAgICAgIGl0ZW1SZW5kZXJlcixcbiAgICAgIGl0ZW1zQ291bnQsXG4gICAgICBrZXlTZWxlY3RlZEl0ZW1DbGVhcixcbiAgICAgIGtleVNlbGVjdGVkSXRlbUluZGV4LFxuICAgICAgbG9hZGluZyxcbiAgICAgIHNob3dTZWFyY2hUb1ZpZXdNb3JlTWVzc2FnZSxcbiAgICB9ID0gdGhpcy5wcm9wcztcblxuICAgIGlmIChsb2FkaW5nIHx8IGl0ZW1zQ291bnQgPT09IDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IHtcbiAgICAgIGZpcnN0SXRlbUluZGV4LFxuICAgICAgZmlyc3RJdGVtT2Zmc2V0LFxuICAgIH0gPSB0aGlzLnN0YXRlO1xuXG4gICAgY29uc3Qgdmlld3BvcnRIZWlnaHQgPSB0aGlzLnByb3BzLm1heEhlaWdodCB8fCB0aGlzLnByb3BzLmhlaWdodDtcbiAgICBjb25zdCBzY3JvbGxIZWlnaHQgPSBpdGVtSGVpZ2h0ICogaXRlbXNDb3VudDtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIHJlZj17dGhpcy5faGFuZGxlQnVmZmVyZWRMaXN0Qm9keVJlZn1cbiAgICAgICAgZGF0YS1jb21wb25lbnQ9XCJUeGxCdWZmZXJlZExpc3RWaWV3XCJcbiAgICAgICAga2V5PVwiYm9keVwiXG4gICAgICAgIHN0eWxlPXtnZXRTY3JvbGxTdHlsZSh0aGlzLnByb3BzKX1cbiAgICAgICAgb25Nb3VzZUxlYXZlPXt0aGlzLl9oYW5kbGVPbk1vdXNlTGVhdmV9XG4gICAgICA+XG4gICAgICAgIDxCdWZmZXJlZExpc3RJdGVtc1xuICAgICAgICAgIGFjdGl2YXRlSXRlbT17YWN0aXZhdGVJdGVtfVxuICAgICAgICAgIGZpcnN0SXRlbUluZGV4PXtmaXJzdEl0ZW1JbmRleH1cbiAgICAgICAgICBmaXJzdEl0ZW1PZmZzZXQ9e2ZpcnN0SXRlbU9mZnNldH1cbiAgICAgICAgICBpdGVtUmVuZGVyZXI9e2l0ZW1SZW5kZXJlcn1cbiAgICAgICAgICB2aWV3cG9ydEhlaWdodD17dmlld3BvcnRIZWlnaHR9XG4gICAgICAgICAgaXRlbUhlaWdodD17aXRlbUhlaWdodH1cbiAgICAgICAgICBpdGVtc0NvdW50PXtpdGVtc0NvdW50fVxuICAgICAgICAgIGtleVNlbGVjdGVkSXRlbUNsZWFyPXtrZXlTZWxlY3RlZEl0ZW1DbGVhcn1cbiAgICAgICAgICBrZXlTZWxlY3RlZEl0ZW1JbmRleD17a2V5U2VsZWN0ZWRJdGVtSW5kZXh9XG4gICAgICAgICAgc2Nyb2xsSGVpZ2h0PXtzY3JvbGxIZWlnaHR9XG4gICAgICAgICAgb2Zmc2V0VG9wPXswfVxuICAgICAgICAvPlxuICAgICAgICB7c2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlICYmXG4gICAgICAgICAgPFNlYXJjaFRvVmlld01vcmVJdGVtIC8+XG4gICAgICAgIH1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX3JlbmRlckZvb3RlcigpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVuZGVyTm9kZSgnZm9vdGVyJyk7XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgbG9hZGluZ0NvbnRlbnQgPSB0aGlzLl9yZW5kZXJMb2FkaW5nQ29udGVudCgpO1xuICAgIGlmIChsb2FkaW5nQ29udGVudCkge1xuICAgICAgcmV0dXJuIGxvYWRpbmdDb250ZW50O1xuICAgIH1cblxuICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuX3JlbmRlckhlYWRlcigpO1xuICAgIGNvbnN0IG5vQ29udGVudCA9IHRoaXMuX3JlbmRlck5vQ29udGVudCgpO1xuICAgIGNvbnN0IGJvZHkgPSB0aGlzLl9yZW5kZXJCb2R5KCk7XG4gICAgY29uc3QgZm9vdGVyID0gdGhpcy5fcmVuZGVyRm9vdGVyKCk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgb25TY3JvbGw9e3RoaXMuX2hhbmRsZVNjcm9sbH1cbiAgICAgICAgc3R5bGU9e2dldFN0eWxlKHRoaXMucHJvcHMpfVxuICAgICAgPlxuICAgICAgICB7aGVhZGVyfVxuICAgICAgICB7bm9Db250ZW50fVxuICAgICAgICB7Ym9keX1cbiAgICAgICAge2Zvb3Rlcn1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cbn1cblxuVHhsQnVmZmVyZWRMaXN0Vmlldy5kaXNwbGF5TmFtZSA9ICdUeGxCdWZmZXJlZExpc3RWaWV3JztcblR4bEJ1ZmZlcmVkTGlzdFZpZXcucHJvcFR5cGVzID0ge1xuICBhY3RpdmF0ZUl0ZW06IFByb3BUeXBlcy5mdW5jLFxuICBiYWNrZ3JvdW5kQ29sb3I6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGZvb3RlcjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm5vZGUsIFByb3BUeXBlcy5mdW5jXSksXG4gIGhlYWRlcjogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm5vZGUsIFByb3BUeXBlcy5mdW5jXSksXG4gIGhlaWdodDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLnN0cmluZywgUHJvcFR5cGVzLm51bWJlcl0pLFxuICBpdGVtSGVpZ2h0OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gIGl0ZW1SZW5kZXJlcjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgaXRlbXNDb3VudDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICBrZXlTZWxlY3RlZEl0ZW1DbGVhcjogUHJvcFR5cGVzLmZ1bmMsXG4gIGtleVNlbGVjdGVkSXRlbUluZGV4OiBQcm9wVHlwZXMubnVtYmVyLFxuICBsb2FkaW5nOiBQcm9wVHlwZXMuYm9vbCxcbiAgbG9hZGluZ0NvbnRlbnQ6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5ub2RlLCBQcm9wVHlwZXMuZnVuY10pLFxuICBtYXhIZWlnaHQ6IFByb3BUeXBlcy5udW1iZXIsXG4gIG5vQ29udGVudDogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLm5vZGUsIFByb3BUeXBlcy5mdW5jXSksXG4gIHNob3dDcmVhdGVOZXc6IFByb3BUeXBlcy5ib29sLFxuICBzaG93U2VhcmNoVG9WaWV3TW9yZU1lc3NhZ2U6IFByb3BUeXBlcy5ib29sLFxufTtcblxuVHhsQnVmZmVyZWRMaXN0Vmlldy5kZWZhdWx0UHJvcHMgPSB7XG4gIGJhY2tncm91bmRDb2xvcjogJ3doaXRlJyxcbiAgZm9vdGVyOiBOT09QLFxuICBoZWFkZXI6IE5PT1AsXG4gIGxvYWRpbmc6IGZhbHNlLFxuICBzaG93Q3JlYXRlTmV3OiBmYWxzZSxcbiAgc2hvd1NlYXJjaFRvVmlld01vcmVNZXNzYWdlOiBmYWxzZSxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IFR4bEJ1ZmZlcmVkTGlzdFZpZXc7XG4iXX0=