'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Group = require('./records/Group');

var _Group2 = _interopRequireDefault(_Group);

var _Item = require('./records/Item');

var _Item2 = _interopRequireDefault(_Item);

var _Navigation = require('./Navigation.style');

var _helpers = require('../styles/helpers');

var _theme = require('../styles/theme');

var _ArrowDown = require('../icons/ArrowDown');

var _ArrowDown2 = _interopRequireDefault(_ArrowDown);

var _NavigationItem = require('./NavigationItem');

var _NavigationItem2 = _interopRequireDefault(_NavigationItem);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var ITEM_HOVER = _Navigation.STYLES.itemMain.hover;

var NavigationGroup = function (_Component) {
  (0, _inherits3.default)(NavigationGroup, _Component);

  function NavigationGroup() {
    var _ref;

    var _temp, _this, _ret;

    (0, _classCallCheck3.default)(this, NavigationGroup);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    return _ret = (_temp = (_this = (0, _possibleConstructorReturn3.default)(this, (_ref = NavigationGroup.__proto__ || (0, _getPrototypeOf2.default)(NavigationGroup)).call.apply(_ref, [this].concat(args))), _this), _this._onMouseEnter = function () {
      var _this2;

      return (_this2 = _this).___onMouseEnter__REACT_HOT_LOADER__.apply(_this2, arguments);
    }, _this._onMouseLeave = function () {
      var _this3;

      return (_this3 = _this).___onMouseLeave__REACT_HOT_LOADER__.apply(_this3, arguments);
    }, _this._onClick = function () {
      var _this4;

      return (_this4 = _this).___onClick__REACT_HOT_LOADER__.apply(_this4, arguments);
    }, _this._onUpdate = function () {
      var _this5;

      return (_this5 = _this).___onUpdate__REACT_HOT_LOADER__.apply(_this5, arguments);
    }, _temp), (0, _possibleConstructorReturn3.default)(_this, _ret);
  }

  (0, _createClass3.default)(NavigationGroup, [{
    key: '___onMouseEnter__REACT_HOT_LOADER__',
    value: function ___onMouseEnter__REACT_HOT_LOADER__() {
      return this.___onMouseEnter__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___onMouseEnter__REACT_HOT_LOADER__',
    value: function ___onMouseEnter__REACT_HOT_LOADER__() {
      var _props = this.props,
          onUpdate = _props.onUpdate,
          data = _props.data;

      onUpdate(function (group) {
        return !group.hovered && group.id === data.id;
      }, function (group) {
        return group.set('hovered', true);
      });
    }
  }, {
    key: '___onMouseLeave__REACT_HOT_LOADER__',
    value: function ___onMouseLeave__REACT_HOT_LOADER__() {
      return this.___onMouseLeave__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___onMouseLeave__REACT_HOT_LOADER__',
    value: function ___onMouseLeave__REACT_HOT_LOADER__() {
      var _props2 = this.props,
          onUpdate = _props2.onUpdate,
          data = _props2.data;

      onUpdate(function (group) {
        return group.hovered && group.id === data.id;
      }, function (group) {
        return group.set('hovered', false);
      });
    }
  }, {
    key: '___onClick__REACT_HOT_LOADER__',
    value: function ___onClick__REACT_HOT_LOADER__() {
      return this.___onClick__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___onClick__REACT_HOT_LOADER__',
    value: function ___onClick__REACT_HOT_LOADER__() {
      var _props3 = this.props,
          onUpdate = _props3.onUpdate,
          data = _props3.data;

      onUpdate(function (group) {
        return group.id === data.id;
      }, function (group) {
        return group.set('expanded', !group.expanded);
      });
    }
  }, {
    key: '_renderArrow',
    value: function _renderArrow(activeLinkColor) {
      var _props$data = this.props.data,
          items = _props$data.items,
          expanded = _props$data.expanded,
          active = _props$data.active;


      if (!items.size) {
        return null;
      }

      var arrowStyle = (0, _helpers.combineStyles)(_Navigation.STYLES.arrowWrap, expanded && _Navigation.FLIP_ARROW);

      return _react2.default.createElement(
        'div',
        { style: arrowStyle },
        _react2.default.createElement(_ArrowDown2.default, { color: active ? activeLinkColor : _Navigation.LINK_COLOR })
      );
    }
  }, {
    key: '_renderIcon',
    value: function _renderIcon(activeLinkColor) {
      var _props$data2 = this.props.data,
          active = _props$data2.active,
          Icon = _props$data2.icon;


      if (Icon == null) {
        return null;
      }

      return _react2.default.createElement(
        'div',
        { style: _Navigation.STYLES.iconWrap },
        _react2.default.createElement(Icon, { color: active ? activeLinkColor : _Navigation.LINK_COLOR })
      );
    }
  }, {
    key: '___onUpdate__REACT_HOT_LOADER__',
    value: function ___onUpdate__REACT_HOT_LOADER__() {
      return this.___onUpdate__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___onUpdate__REACT_HOT_LOADER__',
    value: function ___onUpdate__REACT_HOT_LOADER__(predicate, update) {
      var _props4 = this.props,
          data = _props4.data,
          onUpdate = _props4.onUpdate;

      onUpdate(function (group) {
        return group.id === data.id;
      }, function (group) {
        return group.update(predicate, update);
      });
    }
  }, {
    key: '_renderItems',
    value: function _renderItems() {
      var _this6 = this;

      var data = this.props.data;

      if (!data.items.size || !data.expanded) {
        return null;
      }

      var style = (0, _helpers.combineStyles)(_Navigation.STYLES.itemSubContainer, data.expanded && { height: (0, _helpers.gridUnits)(data.items.size * _Navigation.NAV_ITEM_GU_HEIGHT) });

      var items = data.items.toArray().map(function (item) {
        return _react2.default.createElement(_NavigationItem2.default, {
          key: item.id,
          data: item,
          onUpdate: _this6._onUpdate
        });
      });

      return _react2.default.createElement(
        'div',
        { style: style },
        items
      );
    }
  }, {
    key: '_renderTemplate',
    value: function _renderTemplate(itemActive) {
      var _props$data3 = this.props.data,
          active = _props$data3.active,
          display = _props$data3.display,
          hovered = _props$data3.hovered,
          meta = _props$data3.meta,
          name = _props$data3.name,
          Template = _props$data3.template,
          templateProps = _props$data3.templateProps;


      var style = (0, _helpers.combineStyles)(_Navigation.STYLES.itemTemplate.base, active && itemActive);

      var props = (0, _extends3.default)({}, templateProps, {
        active: active,
        display: display,
        hovered: hovered,
        meta: meta,
        name: name,
        style: style
      });

      return _react2.default.createElement(
        Template,
        props,
        display
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var data = this.props.data;

      var COLOR_APP_THEME = (0, _theme.determineColorAppTheme)(this.context.txlAppTheme);
      var activeLinkColor = COLOR_APP_THEME['500c'];
      var itemActive = {
        backgroundColor: COLOR_APP_THEME['500'],
        color: activeLinkColor
      };
      var style = (0, _helpers.combineStyles)(_Navigation.STYLES.itemMain.base, data.active && itemActive, data.hovered && !data.expanded && ITEM_HOVER);

      return _react2.default.createElement(
        'div',
        {
          style: data.expanded ? _Navigation.STYLES.navSectionExpanded : {},
          onMouseEnter: this._onMouseEnter,
          onMouseLeave: this._onMouseLeave,
          onClick: this._onClick
        },
        _react2.default.createElement(
          'div',
          {
            style: style
          },
          this._renderIcon(activeLinkColor),
          this._renderTemplate(itemActive),
          this._renderArrow(activeLinkColor)
        ),
        this._renderItems()
      );
    }
  }]);
  return NavigationGroup;
}(_react.Component);

NavigationGroup.propTypes = {
  data: require('react').PropTypes.any.isRequired,
  onUpdate: require('react').PropTypes.func.isRequired
};


NavigationGroup.contextTypes = {
  txlAppTheme: _theme.contextThemePropType
};

var _default = NavigationGroup;
exports.default = _default;
;

var _temp2 = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(ITEM_HOVER, 'ITEM_HOVER', 'src/navigation/NavigationGroup.jsx');

  __REACT_HOT_LOADER__.register(NavigationGroup, 'NavigationGroup', 'src/navigation/NavigationGroup.jsx');

  __REACT_HOT_LOADER__.register(_default, 'default', 'src/navigation/NavigationGroup.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9uYXZpZ2F0aW9uL05hdmlnYXRpb25Hcm91cC5qc3giXSwibmFtZXMiOlsiSVRFTV9IT1ZFUiIsIml0ZW1NYWluIiwiaG92ZXIiLCJOYXZpZ2F0aW9uR3JvdXAiLCJfb25Nb3VzZUVudGVyIiwiX29uTW91c2VMZWF2ZSIsIl9vbkNsaWNrIiwiX29uVXBkYXRlIiwicHJvcHMiLCJvblVwZGF0ZSIsImRhdGEiLCJncm91cCIsImhvdmVyZWQiLCJpZCIsInNldCIsImV4cGFuZGVkIiwiYWN0aXZlTGlua0NvbG9yIiwiaXRlbXMiLCJhY3RpdmUiLCJzaXplIiwiYXJyb3dTdHlsZSIsImFycm93V3JhcCIsIkljb24iLCJpY29uIiwiaWNvbldyYXAiLCJwcmVkaWNhdGUiLCJ1cGRhdGUiLCJzdHlsZSIsIml0ZW1TdWJDb250YWluZXIiLCJoZWlnaHQiLCJ0b0FycmF5IiwibWFwIiwiaXRlbSIsIml0ZW1BY3RpdmUiLCJkaXNwbGF5IiwibWV0YSIsIm5hbWUiLCJUZW1wbGF0ZSIsInRlbXBsYXRlIiwidGVtcGxhdGVQcm9wcyIsIml0ZW1UZW1wbGF0ZSIsImJhc2UiLCJDT0xPUl9BUFBfVEhFTUUiLCJjb250ZXh0IiwidHhsQXBwVGhlbWUiLCJiYWNrZ3JvdW5kQ29sb3IiLCJjb2xvciIsIm5hdlNlY3Rpb25FeHBhbmRlZCIsIl9yZW5kZXJJY29uIiwiX3JlbmRlclRlbXBsYXRlIiwiX3JlbmRlckFycm93IiwiX3JlbmRlckl0ZW1zIiwiY29udGV4dFR5cGVzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFDQTs7OztBQUVBOzs7O0FBQ0E7Ozs7QUFDQTs7QUFNQTs7QUFDQTs7QUFDQTs7OztBQUNBOzs7Ozs7QUFPQSxJQUFNQSxhQUFhLG1CQUFPQyxRQUFQLENBQWdCQyxLQUFuQzs7SUFFTUMsZTs7Ozs7Ozs7Ozs7Ozs7OE5BR0pDLGE7Ozs7YUFLQUMsYTs7OzthQUtBQyxROzs7O2FBc0NBQyxTOzs7Ozs7Ozs7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NUIsa0JBQWtCMEIsZ0JBQWdCLE1BQWhCLENBQXhCO0FBQ0EsVUFBTVQsYUFBYTtBQUNqQlkseUJBQWlCSCxnQkFBZ0IsS0FBaEIsQ0FEQTtBQUVqQkksZUFBTzlCO0FBRlUsT0FBbkI7QUFJQSxVQUFNVyxRQUFRLDRCQUNaLG1CQUFPMUIsUUFBUCxDQUFnQndDLElBREosRUFFWi9CLEtBQUtRLE1BQUwsSUFBZWUsVUFGSCxFQUdadkIsS0FBS0UsT0FBTCxJQUFnQixDQUFDRixLQUFLSyxRQUF0QixJQUFrQ2YsVUFIdEIsQ0FBZDs7QUFNQSxhQUNFO0FBQUE7QUFBQTtBQUNFLGlCQUFPVSxLQUFLSyxRQUFMLEdBQWdCLG1CQUFPZ0Msa0JBQXZCLEdBQTRDLEVBRHJEO0FBRUUsd0JBQWMsS0FBSzNDLGFBRnJCO0FBR0Usd0JBQWMsS0FBS0MsYUFIckI7QUFJRSxtQkFBUyxLQUFLQztBQUpoQjtBQU1FO0FBQUE7QUFBQTtBQUNFLG1CQUFPcUI7QUFEVDtBQUdHLGVBQUtxQixXQUFMLENBQWlCaEMsZUFBakIsQ0FISDtBQUlHLGVBQUtpQyxlQUFMLENBQXFCaEIsVUFBckIsQ0FKSDtBQUtHLGVBQUtpQixZQUFMLENBQWtCbEMsZUFBbEI7QUFMSCxTQU5GO0FBYUcsYUFBS21DLFlBQUw7QUFiSCxPQURGO0FBaUJEOzs7Ozs7Ozs7OztBQUdIaEQsZ0JBQWdCaUQsWUFBaEIsR0FBK0I7QUFDN0JSO0FBRDZCLENBQS9COztlQUllekMsZTs7Ozs7Ozs7O2dDQXZKVEgsVTs7Z0NBRUFHLGUiLCJmaWxlIjoiTmF2aWdhdGlvbkdyb3VwLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQGZsb3dcbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5cbmltcG9ydCBHcm91cCBmcm9tICcuL3JlY29yZHMvR3JvdXAnO1xuaW1wb3J0IEl0ZW0gZnJvbSAnLi9yZWNvcmRzL0l0ZW0nO1xuaW1wb3J0IHtcbiAgRkxJUF9BUlJPVyxcbiAgU1RZTEVTLFxuICBOQVZfSVRFTV9HVV9IRUlHSFQsXG4gIExJTktfQ09MT1IsXG59IGZyb20gJy4vTmF2aWdhdGlvbi5zdHlsZSc7XG5pbXBvcnQgeyBncmlkVW5pdHMgYXMgZ3UsIGNvbWJpbmVTdHlsZXMgfSBmcm9tICcuLi9zdHlsZXMvaGVscGVycyc7XG5pbXBvcnQgeyBjb250ZXh0VGhlbWVQcm9wVHlwZSwgZGV0ZXJtaW5lQ29sb3JBcHBUaGVtZSB9IGZyb20gJy4uL3N0eWxlcy90aGVtZSc7XG5pbXBvcnQgQXJyb3dEb3duIGZyb20gJy4uL2ljb25zL0Fycm93RG93bic7XG5pbXBvcnQgTmF2aWdhdGlvbkl0ZW0gZnJvbSAnLi9OYXZpZ2F0aW9uSXRlbSc7XG5cbnR5cGUgUHJvcHMgPSB7XG4gIGRhdGE6IEdyb3VwO1xuICBvblVwZGF0ZTogKHByZWRpY2F0ZTogKGdyb3VwOiBHcm91cCkgPT4gYm9vbGVhbiwgdXBkYXRlOiAoZ3JvdXA6IEdyb3VwKSA9PiBHcm91cCkgPT4gdm9pZDtcbn07XG5cbmNvbnN0IElURU1fSE9WRVIgPSBTVFlMRVMuaXRlbU1haW4uaG92ZXI7XG5cbmNsYXNzIE5hdmlnYXRpb25Hcm91cCBleHRlbmRzIENvbXBvbmVudCB7XG4gIHByb3BzOiBQcm9wcztcblxuICBfb25Nb3VzZUVudGVyID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgb25VcGRhdGUsIGRhdGEgfSA9IHRoaXMucHJvcHM7XG4gICAgb25VcGRhdGUoZ3JvdXAgPT4gIWdyb3VwLmhvdmVyZWQgJiYgZ3JvdXAuaWQgPT09IGRhdGEuaWQsIGdyb3VwID0+IGdyb3VwLnNldCgnaG92ZXJlZCcsIHRydWUpKTtcbiAgfTtcblxuICBfb25Nb3VzZUxlYXZlID0gKCkgPT4ge1xuICAgIGNvbnN0IHsgb25VcGRhdGUsIGRhdGEgfSA9IHRoaXMucHJvcHM7XG4gICAgb25VcGRhdGUoZ3JvdXAgPT4gZ3JvdXAuaG92ZXJlZCAmJiBncm91cC5pZCA9PT0gZGF0YS5pZCwgZ3JvdXAgPT4gZ3JvdXAuc2V0KCdob3ZlcmVkJywgZmFsc2UpKTtcbiAgfTtcblxuICBfb25DbGljayA9ICgpID0+IHtcbiAgICBjb25zdCB7IG9uVXBkYXRlLCBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgIG9uVXBkYXRlKGdyb3VwID0+IGdyb3VwLmlkID09PSBkYXRhLmlkLCBncm91cCA9PiBncm91cC5zZXQoJ2V4cGFuZGVkJywgIWdyb3VwLmV4cGFuZGVkKSk7XG4gIH07XG5cbiAgX3JlbmRlckFycm93KGFjdGl2ZUxpbmtDb2xvcik6ID9SZWFjdC5FbGVtZW50PCo+IHtcbiAgICBjb25zdCB7IGl0ZW1zLCBleHBhbmRlZCwgYWN0aXZlIH0gPSB0aGlzLnByb3BzLmRhdGE7XG5cbiAgICBpZiAoIWl0ZW1zLnNpemUpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGNvbnN0IGFycm93U3R5bGUgPSBjb21iaW5lU3R5bGVzKFxuICAgICAgU1RZTEVTLmFycm93V3JhcCxcbiAgICAgIGV4cGFuZGVkICYmIEZMSVBfQVJST1dcbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgc3R5bGU9e2Fycm93U3R5bGV9PlxuICAgICAgICA8QXJyb3dEb3duIGNvbG9yPXthY3RpdmUgPyBhY3RpdmVMaW5rQ29sb3IgOiBMSU5LX0NPTE9SfSAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIF9yZW5kZXJJY29uKGFjdGl2ZUxpbmtDb2xvcikge1xuICAgIGNvbnN0IHsgYWN0aXZlLCBpY29uOiBJY29uIH0gPSB0aGlzLnByb3BzLmRhdGE7XG5cbiAgICBpZiAoSWNvbiA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBzdHlsZT17U1RZTEVTLmljb25XcmFwfT5cbiAgICAgICAgPEljb24gY29sb3I9e2FjdGl2ZSA/IGFjdGl2ZUxpbmtDb2xvciA6IExJTktfQ09MT1J9IC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgX29uVXBkYXRlID0gKHByZWRpY2F0ZTogKGl0ZW06IEl0ZW0pID0+IGJvb2xlYW4sIHVwZGF0ZTogKGl0ZW06IEl0ZW0pID0+IEl0ZW0pID0+IHtcbiAgICBjb25zdCB7IGRhdGEsIG9uVXBkYXRlIH0gPSB0aGlzLnByb3BzO1xuICAgIG9uVXBkYXRlKGdyb3VwID0+IGdyb3VwLmlkID09PSBkYXRhLmlkLCBncm91cCA9PiBncm91cC51cGRhdGUocHJlZGljYXRlLCB1cGRhdGUpKTtcbiAgfTtcblxuICBfcmVuZGVySXRlbXMoKSB7XG4gICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghZGF0YS5pdGVtcy5zaXplIHx8ICFkYXRhLmV4cGFuZGVkKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBjb25zdCBzdHlsZSA9IGNvbWJpbmVTdHlsZXMoXG4gICAgICBTVFlMRVMuaXRlbVN1YkNvbnRhaW5lcixcbiAgICAgIGRhdGEuZXhwYW5kZWQgJiYgeyBoZWlnaHQ6IGd1KGRhdGEuaXRlbXMuc2l6ZSAqIE5BVl9JVEVNX0dVX0hFSUdIVCkgfVxuICAgICk7XG5cbiAgICBjb25zdCBpdGVtcyA9IGRhdGEuaXRlbXMudG9BcnJheSgpLm1hcChpdGVtID0+IChcbiAgICAgIDxOYXZpZ2F0aW9uSXRlbVxuICAgICAgICBrZXk9e2l0ZW0uaWR9XG4gICAgICAgIGRhdGE9e2l0ZW19XG4gICAgICAgIG9uVXBkYXRlPXt0aGlzLl9vblVwZGF0ZX1cbiAgICAgIC8+XG4gICAgKSk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBzdHlsZT17c3R5bGV9PlxuICAgICAgICB7aXRlbXN9XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgX3JlbmRlclRlbXBsYXRlKGl0ZW1BY3RpdmUpIHtcbiAgICBjb25zdCB7XG4gICAgICBhY3RpdmUsXG4gICAgICBkaXNwbGF5LFxuICAgICAgaG92ZXJlZCxcbiAgICAgIG1ldGEsXG4gICAgICBuYW1lLFxuICAgICAgdGVtcGxhdGU6IFRlbXBsYXRlLFxuICAgICAgdGVtcGxhdGVQcm9wcyxcbiAgICB9ID0gdGhpcy5wcm9wcy5kYXRhO1xuXG4gICAgY29uc3Qgc3R5bGUgPSBjb21iaW5lU3R5bGVzKFxuICAgICAgU1RZTEVTLml0ZW1UZW1wbGF0ZS5iYXNlLFxuICAgICAgYWN0aXZlICYmIGl0ZW1BY3RpdmVcbiAgICApO1xuXG4gICAgY29uc3QgcHJvcHMgPSB7XG4gICAgICAuLi50ZW1wbGF0ZVByb3BzLFxuICAgICAgYWN0aXZlLFxuICAgICAgZGlzcGxheSxcbiAgICAgIGhvdmVyZWQsXG4gICAgICBtZXRhLFxuICAgICAgbmFtZSxcbiAgICAgIHN0eWxlLFxuICAgIH07XG5cbiAgICByZXR1cm4gPFRlbXBsYXRlIHsuLi5wcm9wc30+e2Rpc3BsYXl9PC9UZW1wbGF0ZT47XG4gIH1cblxuICByZW5kZXIoKSB7XG4gICAgY29uc3QgeyBkYXRhIH0gPSB0aGlzLnByb3BzO1xuICAgIGNvbnN0IENPTE9SX0FQUF9USEVNRSA9IGRldGVybWluZUNvbG9yQXBwVGhlbWUodGhpcy5jb250ZXh0LnR4bEFwcFRoZW1lKTtcbiAgICBjb25zdCBhY3RpdmVMaW5rQ29sb3IgPSBDT0xPUl9BUFBfVEhFTUVbJzUwMGMnXTtcbiAgICBjb25zdCBpdGVtQWN0aXZlID0ge1xuICAgICAgYmFja2dyb3VuZENvbG9yOiBDT0xPUl9BUFBfVEhFTUVbJzUwMCddLFxuICAgICAgY29sb3I6IGFjdGl2ZUxpbmtDb2xvcixcbiAgICB9O1xuICAgIGNvbnN0IHN0eWxlID0gY29tYmluZVN0eWxlcyhcbiAgICAgIFNUWUxFUy5pdGVtTWFpbi5iYXNlLFxuICAgICAgZGF0YS5hY3RpdmUgJiYgaXRlbUFjdGl2ZSxcbiAgICAgIGRhdGEuaG92ZXJlZCAmJiAhZGF0YS5leHBhbmRlZCAmJiBJVEVNX0hPVkVSXG4gICAgKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8ZGl2XG4gICAgICAgIHN0eWxlPXtkYXRhLmV4cGFuZGVkID8gU1RZTEVTLm5hdlNlY3Rpb25FeHBhbmRlZCA6IHt9fVxuICAgICAgICBvbk1vdXNlRW50ZXI9e3RoaXMuX29uTW91c2VFbnRlcn1cbiAgICAgICAgb25Nb3VzZUxlYXZlPXt0aGlzLl9vbk1vdXNlTGVhdmV9XG4gICAgICAgIG9uQ2xpY2s9e3RoaXMuX29uQ2xpY2t9XG4gICAgICA+XG4gICAgICAgIDxkaXZcbiAgICAgICAgICBzdHlsZT17c3R5bGV9XG4gICAgICAgID5cbiAgICAgICAgICB7dGhpcy5fcmVuZGVySWNvbihhY3RpdmVMaW5rQ29sb3IpfVxuICAgICAgICAgIHt0aGlzLl9yZW5kZXJUZW1wbGF0ZShpdGVtQWN0aXZlKX1cbiAgICAgICAgICB7dGhpcy5fcmVuZGVyQXJyb3coYWN0aXZlTGlua0NvbG9yKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIHt0aGlzLl9yZW5kZXJJdGVtcygpfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5OYXZpZ2F0aW9uR3JvdXAuY29udGV4dFR5cGVzID0ge1xuICB0eGxBcHBUaGVtZTogY29udGV4dFRoZW1lUHJvcFR5cGUsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBOYXZpZ2F0aW9uR3JvdXA7XG4iXX0=