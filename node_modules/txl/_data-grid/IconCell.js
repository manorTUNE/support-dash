'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _getOwnPropertyDescriptor = require('babel-runtime/core-js/object/get-own-property-descriptor');

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _desc, _value, _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _Base = require('../base/Base');

var _More = require('../icons/More');

var _More2 = _interopRequireDefault(_More);

var _SelectableItemList = require('../lists/_SelectableItemList');

var _SelectableItemList2 = _interopRequireDefault(_SelectableItemList);

var _Container = require('../containers/Container');

var _Container2 = _interopRequireDefault(_Container);

var _FlyoutTargetBase = require('../dropdowns/_FlyoutTargetBase');

var _FlyoutTargetBase2 = _interopRequireDefault(_FlyoutTargetBase);

var _FixedTooltipTarget = require('../_tooltips/FixedTooltipTarget');

var _FixedTooltipTarget2 = _interopRequireDefault(_FixedTooltipTarget);

var _IconCell = require('./IconCell.style');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _applyDecoratedDescriptor(target, property, decorators, descriptor, context) {
  var desc = {};
  Object['ke' + 'ys'](descriptor).forEach(function (key) {
    desc[key] = descriptor[key];
  });
  desc.enumerable = !!desc.enumerable;
  desc.configurable = !!desc.configurable;

  if ('value' in desc || desc.initializer) {
    desc.writable = true;
  }

  desc = decorators.slice().reverse().reduce(function (desc, decorator) {
    return decorator(target, property, desc) || desc;
  }, desc);

  if (context && desc.initializer !== void 0) {
    desc.value = desc.initializer ? desc.initializer.call(context) : void 0;
    desc.initializer = undefined;
  }

  if (desc.initializer === void 0) {
    Object['define' + 'Property'](target, property, desc);
    desc = null;
  }

  return desc;
}

var TxlIconCell = (_class = function (_Component) {
  (0, _inherits3.default)(TxlIconCell, _Component);

  function TxlIconCell() {
    var _ref;

    (0, _classCallCheck3.default)(this, TxlIconCell);

    for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    var _this = (0, _possibleConstructorReturn3.default)(this, (_ref = TxlIconCell.__proto__ || (0, _getPrototypeOf2.default)(TxlIconCell)).call.apply(_ref, [this].concat(args)));

    _this.state = {
      isHovering: false,
      open: false
    };
    return _this;
  }

  (0, _createClass3.default)(TxlIconCell, [{
    key: '_handleMouseEnter',
    value: function _handleMouseEnter() {
      this.setState({ isHovering: true });
    }
  }, {
    key: '_handleMouseLeave',
    value: function _handleMouseLeave() {
      this.setState({ isHovering: !!this.state.open });
    }
  }, {
    key: '_handleMoreClick',
    value: function _handleMoreClick() {
      this.setState({ open: !this.state.open });
    }
  }, {
    key: '_handleItemClick',
    value: function _handleItemClick(obj) {
      this.setState({
        isHovering: false,
        open: false
      }, this.props.hoverMenuItems[obj.value].onClick(obj));
    }
  }, {
    key: 'prepareIcons',
    value: function prepareIcons() {
      var _props = this.props,
          items = _props.hoverMenuItems,
          truncateThreshold = _props.truncateThreshold;
      var _state = this.state,
          open = _state.open,
          isHovering = _state.isHovering;


      var icons = void 0;

      var ulStyles = (0, _extends3.default)({}, _IconCell.LIST_STYLES, {
        visibility: isHovering ? 'visible' : 'hidden'
      });

      if (items.length > truncateThreshold) {
        var visibleItems = items.slice(0, truncateThreshold);
        var truncatedItems = items.slice(truncateThreshold, items.length);
        var visibleIcons = visibleItems.map(function (item, index) {
          return _react2.default.createElement(
            'li',
            {
              key: index,
              style: _IconCell.LIST_ITEM_STYLES,
              onClick: item.onClick
            },
            _react2.default.createElement(
              _FixedTooltipTarget2.default,
              {
                message: item.label,
                key: index
              },
              item.node
            )
          );
        });

        var dropdownItems = truncatedItems.map(function (item, i) {
          return {
            label: item.label,
            value: '' + (i + truncateThreshold)
          };
        });

        var flyoutContent = _react2.default.createElement(
          _Container2.default,
          null,
          _react2.default.createElement(_SelectableItemList2.default, {
            items: dropdownItems,
            onClick: this._handleItemClick
          })
        );

        icons = _react2.default.createElement(
          'ul',
          { style: ulStyles },
          visibleIcons,
          _react2.default.createElement(
            'li',
            { style: _IconCell.LIST_ITEM_STYLES },
            _react2.default.createElement(
              _FlyoutTargetBase2.default,
              {
                onClick: this._handleMoreClick,
                visible: open,
                content: flyoutContent,
                componentName: 'TxlDataGrid_IconCellMoreFlyout'
              },
              _react2.default.createElement(
                _FixedTooltipTarget2.default,
                {
                  message: 'More...'
                },
                _react2.default.createElement(_More2.default, { color: 'grey' })
              )
            )
          )
        );
      } else {
        icons = _react2.default.createElement(
          'ul',
          { style: ulStyles },
          items.map(function (item, index) {
            return _react2.default.createElement(
              _FixedTooltipTarget2.default,
              {
                message: item.label,
                key: index
              },
              _react2.default.createElement(
                'li',
                {
                  style: _IconCell.LIST_ITEM_STYLES,
                  onClick: item.onClick
                },
                item.node
              )
            );
          })
        );
      }
      return icons;
    }
  }, {
    key: 'render',
    value: function render() {
      var icons = this.prepareIcons();
      var text = this.props.text;


      return _react2.default.createElement(
        'div',
        {
          style: _IconCell.CONTAINER_STYLES,
          onMouseEnter: this._handleMouseEnter,
          onMouseLeave: this._handleMouseLeave
        },
        _react2.default.createElement(
          'div',
          { style: _IconCell.TEXT_STYLES },
          text
        ),
        icons
      );
    }
  }]);
  return TxlIconCell;
}(_react.Component), (_applyDecoratedDescriptor(_class.prototype, '_handleMouseEnter', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleMouseEnter'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleMouseLeave', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleMouseLeave'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleMoreClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleMoreClick'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, '_handleItemClick', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, '_handleItemClick'), _class.prototype), _applyDecoratedDescriptor(_class.prototype, 'prepareIcons', [_Base.autobind], (0, _getOwnPropertyDescriptor2.default)(_class.prototype, 'prepareIcons'), _class.prototype)), _class);
exports.default = TxlIconCell;


TxlIconCell.propTypes = {
  hoverMenuItems: _react.PropTypes.arrayOf(_react.PropTypes.shape({
    label: _react.PropTypes.string.isRequired,
    node: _react.PropTypes.node.isRequired,
    onClick: _react.PropTypes.func.isRequired
  })).isRequired,
  text: _react.PropTypes.node,
  truncateThreshold: _react.PropTypes.number
};

TxlIconCell.defaultProps = {
  hoverMenuItems: [],
  truncateThreshold: 3
};
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(TxlIconCell, 'TxlIconCell', 'src/_data-grid/IconCell.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9fZGF0YS1ncmlkL0ljb25DZWxsLmpzeCJdLCJuYW1lcyI6WyJUeGxJY29uQ2VsbCIsImFyZ3MiLCJzdGF0ZSIsImlzSG92ZXJpbmciLCJvcGVuIiwic2V0U3RhdGUiLCJvYmoiLCJwcm9wcyIsImhvdmVyTWVudUl0ZW1zIiwidmFsdWUiLCJvbkNsaWNrIiwiaXRlbXMiLCJ0cnVuY2F0ZVRocmVzaG9sZCIsImljb25zIiwidWxTdHlsZXMiLCJ2aXNpYmlsaXR5IiwibGVuZ3RoIiwidmlzaWJsZUl0ZW1zIiwic2xpY2UiLCJ0cnVuY2F0ZWRJdGVtcyIsInZpc2libGVJY29ucyIsIm1hcCIsIml0ZW0iLCJpbmRleCIsImxhYmVsIiwibm9kZSIsImRyb3Bkb3duSXRlbXMiLCJpIiwiZmx5b3V0Q29udGVudCIsIl9oYW5kbGVJdGVtQ2xpY2siLCJfaGFuZGxlTW9yZUNsaWNrIiwicHJlcGFyZUljb25zIiwidGV4dCIsIl9oYW5kbGVNb3VzZUVudGVyIiwiX2hhbmRsZU1vdXNlTGVhdmUiLCJwcm9wVHlwZXMiLCJhcnJheU9mIiwic2hhcGUiLCJzdHJpbmciLCJpc1JlcXVpcmVkIiwiZnVuYyIsIm51bWJlciIsImRlZmF1bHRQcm9wcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBRUE7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7O0FBQ0E7Ozs7QUFDQTs7OztBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFPcUJBLFc7OztBQUNuQix5QkFBcUI7QUFBQTs7QUFBQTs7QUFBQSxzQ0FBTkMsSUFBTTtBQUFOQSxVQUFNO0FBQUE7O0FBQUEsMktBQ1ZBLElBRFU7O0FBRW5CLFVBQUtDLEtBQUwsR0FBYTtBQUNYQyxrQkFBWSxLQUREO0FBRVhDLFlBQU07QUFGSyxLQUFiO0FBRm1CO0FBTXBCOzs7O3dDQUdtQjtBQUNsQixXQUFLQyxRQUFMLENBQWMsRUFBRUYsWUFB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LEtBQUt6QixLQUZmLENBRUN5QixJQUZEOzs7QUFJUCxhQUNFO0FBQUE7QUFBQTtBQUNFLDJDQURGO0FBRUUsd0JBQWMsS0FBS0MsaUJBRnJCO0FBR0Usd0JBQWMsS0FBS0M7QUFIckI7QUFLRTtBQUFBO0FBQUEsWUFBSyw0QkFBTDtBQUNHRjtBQURILFNBTEY7QUFTR25CO0FBVEgsT0FERjtBQWVEOzs7O2tCQXRKa0JiLFc7OztBQXlKckJBLFlBQVltQyxTQUFaLEdBQXdCO0FBQ3RCM0Isa0JBQWdCLGlCQUFVNEIsT0FBVixDQUFrQixpQkFBVUMsS0FBVixDQUFnQjtBQUNoRGIsV0FBTyxpQkFBVWMsTUFBVixDQUFpQkMsVUFEd0I7QUFFaERkLFVBQU0saUJBQVVBLElBQVYsQ0FBZWMsVUFGMkI7QUFHaEQ3QixhQUFTLGlCQUFVOEIsSUFBVixDQUFlRDtBQUh3QixHQUFoQixDQUFsQixFQUlaQSxVQUxrQjtBQU10QlAsUUFBTSxpQkFBVVAsSUFOTTtBQU90QmIscUJBQW1CLGlCQUFVNkI7QUFQUCxDQUF4Qjs7QUFVQXpDLFlBQVkwQyxZQUFaLEdBQTJCO0FBQ3pCbEMsa0JBQWdCLEVBRFM7QUFFekJJLHFCQUFtQjtBQUZNLENBQTNCOzs7Ozs7OztnQ0FuS3FCWixXIiwiZmlsZSI6Ikljb25DZWxsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUHJvcFR5cGVzIH0gZnJvbSAncmVhY3QnO1xuXG5pbXBvcnQgeyBhdXRvYmluZCB9IGZyb20gJy4uL2Jhc2UvQmFzZSc7XG5pbXBvcnQgTW9yZSBmcm9tICcuLi9pY29ucy9Nb3JlJztcbmltcG9ydCBTZWxlY3RhYmxlSXRlbUxpc3QgZnJvbSAnLi4vbGlzdHMvX1NlbGVjdGFibGVJdGVtTGlzdCc7XG5pbXBvcnQgQ29udGFpbmVyIGZyb20gJy4uL2NvbnRhaW5lcnMvQ29udGFpbmVyJztcbmltcG9ydCBGbHlvdXRUYXJnZXRCYXNlIGZyb20gJy4uL2Ryb3Bkb3ducy9fRmx5b3V0VGFyZ2V0QmFzZSc7XG5pbXBvcnQgRml4ZWRUb29sdGlwVGFyZ2V0IGZyb20gJy4uL190b29sdGlwcy9GaXhlZFRvb2x0aXBUYXJnZXQnO1xuaW1wb3J0IHtcbiAgTElTVF9TVFlMRVMsXG4gIExJU1RfSVRFTV9TVFlMRVMsXG4gIENPTlRBSU5FUl9TVFlMRVMsXG4gIFRFWFRfU1RZTEVTLFxufSBmcm9tICcuL0ljb25DZWxsLnN0eWxlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgVHhsSWNvbkNlbGwgZXh0ZW5kcyBDb21wb25lbnQge1xuICBjb25zdHJ1Y3RvciguLi5hcmdzKSB7XG4gICAgc3VwZXIoLi4uYXJncyk7XG4gICAgdGhpcy5zdGF0ZSA9IHtcbiAgICAgIGlzSG92ZXJpbmc6IGZhbHNlLFxuICAgICAgb3BlbjogZmFsc2UsXG4gICAgfTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlTW91c2VFbnRlcigpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgaXNIb3ZlcmluZzogdHJ1ZSB9KTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlTW91c2VMZWF2ZSgpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgaXNIb3ZlcmluZzogISF0aGlzLnN0YXRlLm9wZW4gfSk7XG4gIH1cblxuICBAYXV0b2JpbmRcbiAgX2hhbmRsZU1vcmVDbGljaygpIHtcbiAgICB0aGlzLnNldFN0YXRlKHsgb3BlbjogIXRoaXMuc3RhdGUub3BlbiB9KTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBfaGFuZGxlSXRlbUNsaWNrKG9iaikge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgaXNIb3ZlcmluZzogZmFsc2UsXG4gICAgICBvcGVuOiBmYWxzZSxcbiAgICB9LCB0aGlzLnByb3BzLmhvdmVyTWVudUl0ZW1zW29iai52YWx1ZV0ub25DbGljayhvYmopKTtcbiAgfVxuXG4gIEBhdXRvYmluZFxuICBwcmVwYXJlSWNvbnMoKSB7XG4gICAgY29uc3Qge1xuICAgICAgaG92ZXJNZW51SXRlbXM6IGl0ZW1zLFxuICAgICAgdHJ1bmNhdGVUaHJlc2hvbGQsXG4gICAgfSA9IHRoaXMucHJvcHM7XG5cbiAgICBjb25zdCB7XG4gICAgICBvcGVuLFxuICAgICAgaXNIb3ZlcmluZyxcbiAgICB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIGxldCBpY29ucztcblxuICAgIGNvbnN0IHVsU3R5bGVzID0ge1xuICAgICAgLi4uTElTVF9TVFlMRVMsXG4gICAgICB2aXNpYmlsaXR5OiBpc0hvdmVyaW5nID8gJ3Zpc2libGUnIDogJ2hpZGRlbicsXG4gICAgfTtcblxuICAgIGlmIChpdGVtcy5sZW5ndGggPiB0cnVuY2F0ZVRocmVzaG9sZCkge1xuICAgICAgY29uc3QgdmlzaWJsZUl0ZW1zID0gaXRlbXMuc2xpY2UoMCwgdHJ1bmNhdGVUaHJlc2hvbGQpO1xuICAgICAgY29uc3QgdHJ1bmNhdGVkSXRlbXMgPSBpdGVtcy5zbGljZSh0cnVuY2F0ZVRocmVzaG9sZCwgaXRlbXMubGVuZ3RoKTtcbiAgICAgIGNvbnN0IHZpc2libGVJY29ucyA9IHZpc2libGVJdGVtc1xuICAgICAgICAubWFwKChpdGVtLCBpbmRleCkgPT4gKFxuICAgICAgICAgIDxsaVxuICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgIHN0eWxlPXtMSVNUX0lURU1fU1RZTEVTfVxuICAgICAgICAgICAgb25DbGljaz17aXRlbS5vbkNsaWNrfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIDxGaXhlZFRvb2x0aXBUYXJnZXRcbiAgICAgICAgICAgICAgbWVzc2FnZT17aXRlbS5sYWJlbH1cbiAgICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2l0ZW0ubm9kZX1cbiAgICAgICAgICAgIDwvRml4ZWRUb29sdGlwVGFyZ2V0PlxuICAgICAgICAgIDwvbGk+XG5cbiAgICAgICAgKVxuICAgICAgKTtcblxuICAgICAgY29uc3QgZHJvcGRvd25JdGVtcyA9IHRydW5jYXRlZEl0ZW1zXG4gICAgICAgIC5tYXAoKGl0ZW0sIGkpID0+ICh7XG4gICAgICAgICAgbGFiZWw6IGl0ZW0ubGFiZWwsXG4gICAgICAgICAgdmFsdWU6IGAke2kgKyB0cnVuY2F0ZVRocmVzaG9sZH1gLFxuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgY29uc3QgZmx5b3V0Q29udGVudCA9IChcbiAgICAgICAgPENvbnRhaW5lcj5cbiAgICAgICAgICA8U2VsZWN0YWJsZUl0ZW1MaXN0XG4gICAgICAgICAgICBpdGVtcz17ZHJvcGRvd25JdGVtc31cbiAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMuX2hhbmRsZUl0ZW1DbGlja31cbiAgICAgICAgICAvPlxuICAgICAgICA8L0NvbnRhaW5lcj5cbiAgICAgICk7XG5cbiAgICAgIGljb25zID0gKFxuICAgICAgICA8dWwgc3R5bGU9e3VsU3R5bGVzfT5cblxuICAgICAgICAgIHt2aXNpYmxlSWNvbnN9XG5cbiAgICAgICAgICA8bGkgc3R5bGU9e0xJU1RfSVRFTV9TVFlMRVN9PlxuICAgICAgICAgICAgPEZseW91dFRhcmdldEJhc2VcbiAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5faGFuZGxlTW9yZUNsaWNrfVxuICAgICAgICAgICAgICB2aXNpYmxlPXtvcGVufVxuICAgICAgICAgICAgICBjb250ZW50PXtmbHlvdXRDb250ZW50fVxuICAgICAgICAgICAgICBjb21wb25lbnROYW1lPVwiVHhsRGF0YUdyaWRfSWNvbkNlbGxNb3JlRmx5b3V0XCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPEZpeGVkVG9vbHRpcFRhcmdldFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U9eydNb3JlLi4uJ31cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxNb3JlIGNvbG9yPVwiZ3JleVwiIC8+XG4gICAgICAgICAgICAgIDwvRml4ZWRUb29sdGlwVGFyZ2V0PlxuICAgICAgICAgICAgPC9GbHlvdXRUYXJnZXRCYXNlPlxuICAgICAgICAgIDwvbGk+XG4gICAgICAgIDwvdWw+XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBpY29ucyA9IChcbiAgICAgICAgPHVsIHN0eWxlPXt1bFN0eWxlc30+XG4gICAgICAgICAge2l0ZW1zLm1hcCgoaXRlbSwgaW5kZXgpID0+IChcbiAgICAgICAgICAgIDxGaXhlZFRvb2x0aXBUYXJnZXRcbiAgICAgICAgICAgICAgbWVzc2FnZT17aXRlbS5sYWJlbH1cbiAgICAgICAgICAgICAga2V5PXtpbmRleH1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGxpXG4gICAgICAgICAgICAgICAgc3R5bGU9e0xJU1RfSVRFTV9TVFlMRVN9XG4gICAgICAgICAgICAgICAgb25DbGljaz17aXRlbS5vbkNsaWNrfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge2l0ZW0ubm9kZX1cbiAgICAgICAgICAgICAgPC9saT5cbiAgICAgICAgICAgIDwvRml4ZWRUb29sdGlwVGFyZ2V0PlxuICAgICAgICAgICkpfVxuICAgICAgICA8L3VsPlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGljb25zO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IGljb25zID0gdGhpcy5wcmVwYXJlSWNvbnMoKTtcbiAgICBjb25zdCB7IHRleHQgfSA9IHRoaXMucHJvcHM7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBzdHlsZT17Q09OVEFJTkVSX1NUWUxFU31cbiAgICAgICAgb25Nb3VzZUVudGVyPXt0aGlzLl9oYW5kbGVNb3VzZUVudGVyfVxuICAgICAgICBvbk1vdXNlTGVhdmU9e3RoaXMuX2hhbmRsZU1vdXNlTGVhdmV9XG4gICAgICA+XG4gICAgICAgIDxkaXYgc3R5bGU9e1RFWFRfU1RZTEVTfT5cbiAgICAgICAgICB7dGV4dH1cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAge2ljb25zfVxuXG4gICAgICA8L2Rpdj5cblxuICAgICk7XG4gIH1cbn1cblxuVHhsSWNvbkNlbGwucHJvcFR5cGVzID0ge1xuICBob3Zlck1lbnVJdGVtczogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLnNoYXBlKHtcbiAgICBsYWJlbDogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxuICAgIG5vZGU6IFByb3BUeXBlcy5ub2RlLmlzUmVxdWlyZWQsXG4gICAgb25DbGljazogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgfSkpLmlzUmVxdWlyZWQsXG4gIHRleHQ6IFByb3BUeXBlcy5ub2RlLFxuICB0cnVuY2F0ZVRocmVzaG9sZDogUHJvcFR5cGVzLm51bWJlcixcbn07XG5cblR4bEljb25DZWxsLmRlZmF1bHRQcm9wcyA9IHtcbiAgaG92ZXJNZW51SXRlbXM6IFtdLFxuICB0cnVuY2F0ZVRocmVzaG9sZDogMyxcbn07XG4iXX0=