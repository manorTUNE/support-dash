'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _class;

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _radium = require('radium');

var _radium2 = _interopRequireDefault(_radium);

var _ = require('./');

var _ScrollingTable = require('./ScrollingTable.style');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var babelPluginFlowReactPropTypes_proptype_SyntheticMouseEvent = require('react').babelPluginFlowReactPropTypes_proptype_SyntheticMouseEvent || require('react').PropTypes.any;

var babelPluginFlowReactPropTypes_proptype_SyntheticDragEvent = require('react').babelPluginFlowReactPropTypes_proptype_SyntheticDragEvent || require('react').PropTypes.any;

var babelPluginFlowReactPropTypes_proptype_Headers = require('./').babelPluginFlowReactPropTypes_proptype_Headers || require('react').PropTypes.any;

function clearDragOptions(event) {
  var dataTransfer = event.dataTransfer;

  dataTransfer.effectAllowed = 'none';
  dataTransfer.dropEffect = 'none';
}

var ScrollingTableHeader = (0, _radium2.default)(_class = function (_Component) {
  (0, _inherits3.default)(ScrollingTableHeader, _Component);

  function ScrollingTableHeader(props, context) {
    (0, _classCallCheck3.default)(this, ScrollingTableHeader);

    var _this = (0, _possibleConstructorReturn3.default)(this, (ScrollingTableHeader.__proto__ || (0, _getPrototypeOf2.default)(ScrollingTableHeader)).call(this, props, context));

    _this._mouseMoveHandler = function () {
      return _this.___mouseMoveHandler__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._resizingHandler = function () {
      return _this.___resizingHandler__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._startResizing = function () {
      return _this.___startResizing__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._stopResizing = function () {
      return _this.___stopResizing__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._onDragOver = function () {
      return _this.___onDragOver__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._startDragging = function () {
      return _this.___startDragging__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this._stopDragging = function () {
      return _this.___stopDragging__REACT_HOT_LOADER__.apply(_this, arguments);
    };

    _this.state = {
      dragging: false,
      resizing: false
    };

    _this._ticking = false;
    return _this;
  }

  (0, _createClass3.default)(ScrollingTableHeader, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      window.addEventListener('mouseup', this._stopResizing, false);
      window.addEventListener('mousemove', this._mouseMoveHandler, false);
    }
  }, {
    key: 'shouldComponentUpdate',
    value: function shouldComponentUpdate(nextProps, nextState) {
      if (this.props.header !== nextProps.header) {
        return true;
      }

      if (this.state.dragging !== nextState.dragging) {
        return true;
      }

      return this.state.resizing !== nextState.resizing;
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      window.removeEventListener('mouseup', this._stopResizing);
      window.removeEventListener('mousemove', this._mouseMoveHandler);
    }
  }, {
    key: '___mouseMoveHandler__REACT_HOT_LOADER__',
    value: function ___mouseMoveHandler__REACT_HOT_LOADER__() {
      return this.___mouseMoveHandler__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___mouseMoveHandler__REACT_HOT_LOADER__',
    value: function ___mouseMoveHandler__REACT_HOT_LOADER__() {
      return this.___mouseMoveHandler__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___mouseMoveHandler__REACT_HOT_LOADER__',
    value: function ___mouseMoveHandler__REACT_HOT_LOADER__(event) {
      if (this.state.resizing && this.props.header.resizable) {
        this._resizingHandler(event);
      }
    }
  }, {
    key: '___resizingHandler__REACT_HOT_LOADER__',
    value: function ___resizingHandler__REACT_HOT_LOADER__() {
      return this.___resizingHandler__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___resizingHandler__REACT_HOT_LOADER__',
    value: function ___resizingHandler__REACT_HOT_LOADER__() {
      return this.___resizingHandler__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___resizingHandler__REACT_HOT_LOADER__',
    value: function ___resizingHandler__REACT_HOT_LOADER__(event) {
      var _this2 = this;

      if (this._resizeHandle != null && !this._ticking) {
        (function () {
          var mouseX = event.clientX;
          /**
           * Find the offsetLeft relative to the resizeHandle
           * then add half the width so that the delta is calculated
           * from the middle of the resize handle
           */
          var offsetCenter = _this2._resizeHandle.offsetWidth / 2;
          var offsetLeft = _this2._resizeHandle.getBoundingClientRect().left;
          var resizeFn = function resizeFn() {
            _this2.props.onResize(offsetLeft + offsetCenter - mouseX);

            _this2._ticking = false;
          };
          window.requestAnimationFrame(function () {
            resizeFn();
          });
        })();
      }

      this._ticking = true;
    }
  }, {
    key: '___startResizing__REACT_HOT_LOADER__',
    value: function ___startResizing__REACT_HOT_LOADER__() {
      return this.___startResizing__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___startResizing__REACT_HOT_LOADER__',
    value: function ___startResizing__REACT_HOT_LOADER__() {
      return this.___startResizing__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___startResizing__REACT_HOT_LOADER__',
    value: function ___startResizing__REACT_HOT_LOADER__(event) {
      // only start resizing if left button mouse down
      if (event.button === 0 && this.props.header.resizable) {
        event.preventDefault();
        event.stopPropagation();
        document.body.style.cursor = 'col-resize';
        this.setState({ resizing: true });
      }
    }
  }, {
    key: '___stopResizing__REACT_HOT_LOADER__',
    value: function ___stopResizing__REACT_HOT_LOADER__() {
      return this.___stopResizing__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___stopResizing__REACT_HOT_LOADER__',
    value: function ___stopResizing__REACT_HOT_LOADER__() {
      return this.___stopResizing__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___stopResizing__REACT_HOT_LOADER__',
    value: function ___stopResizing__REACT_HOT_LOADER__() {
      if (this.props.header.resizable) {
        document.body.style.cursor = null;
        this.setState({ resizing: false });
      }
    }
  }, {
    key: '___onDragOver__REACT_HOT_LOADER__',
    value: function ___onDragOver__REACT_HOT_LOADER__() {
      return this.___onDragOver__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___onDragOver__REACT_HOT_LOADER__',
    value: function ___onDragOver__REACT_HOT_LOADER__() {
      return this.___onDragOver__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___onDragOver__REACT_HOT_LOADER__',
    value: function ___onDragOver__REACT_HOT_LOADER__(event) {
      if (this.props.header.draggable) {
        // By default elements cannot be dropped in other elements.
        // To allow a drop we must prevent the default handling of the element.
        event.preventDefault();
        this.props.onDragOver(this.props.header);
      }
    }
  }, {
    key: '___startDragging__REACT_HOT_LOADER__',
    value: function ___startDragging__REACT_HOT_LOADER__() {
      return this.___startDragging__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___startDragging__REACT_HOT_LOADER__',
    value: function ___startDragging__REACT_HOT_LOADER__() {
      return this.___startDragging__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___startDragging__REACT_HOT_LOADER__',
    value: function ___startDragging__REACT_HOT_LOADER__(event) {
      if (this.props.header.draggable) {
        clearDragOptions(event);
        this.props.onDragStart(this.props.header);
        this.setState({ dragging: true });
      }
    }
  }, {
    key: '___stopDragging__REACT_HOT_LOADER__',
    value: function ___stopDragging__REACT_HOT_LOADER__() {
      return this.___stopDragging__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___stopDragging__REACT_HOT_LOADER__',
    value: function ___stopDragging__REACT_HOT_LOADER__() {
      return this.___stopDragging__REACT_HOT_LOADER__.apply(this, arguments);
    }
  }, {
    key: '___stopDragging__REACT_HOT_LOADER__',
    value: function ___stopDragging__REACT_HOT_LOADER__() {
      if (this.props.header.draggable) {
        this.props.onDragEnd(this.props.header);
        this.setState({ dragging: false });
      }
    }
  }, {
    key: '_isLastHeader',
    value: function _isLastHeader() {
      return this.props.headers.size - 1 === this.props.header.order;
    }
  }, {
    key: '_renderResizeHandle',
    value: function _renderResizeHandle() {
      var _this3 = this;

      if (this._isLastHeader()) {
        return null;
      }

      return _react2.default.createElement(
        'div',
        {
          ref: function ref(resizeHandle) {
            _this3._resizeHandle = resizeHandle;
          },
          onMouseDown: this._startResizing,
          style: _ScrollingTable.HEADER_RESIZING_HANDLE_STYLES
        },
        _react2.default.createElement('div', { style: _ScrollingTable.HEADER_RESIZING_HANDLE_BAR_STYLES })
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var _this4 = this;

      var header = this.props.header;

      var HeaderTemplate = header.template;
      var width = header.width;

      var style = (0, _extends3.default)({}, _ScrollingTable.HEADER_CELL_CONTAINER_STYLES);

      style.minWidth = header.minWidth;
      if (width != null) {
        style.width = width;
      }

      return _react2.default.createElement(
        'div',
        {
          draggable: 'true',
          onDragStart: this._startDragging,
          onDragEnd: this._stopDragging,
          onDragEnter: clearDragOptions,
          onDragOver: this._onDragOver,
          ref: function ref(root) {
            _this4._root = root;
          },
          style: _ScrollingTable.HEADER_CELL_STYLES
        },
        _react2.default.createElement(
          'div',
          { style: style },
          _react2.default.createElement(HeaderTemplate, (0, _extends3.default)({ onSort: function onSort() {
              return _this4.props.onSort(header);
            } }, header.toJS())),
          this._renderResizeHandle()
        )
      );
    }
  }]);
  return ScrollingTableHeader;
}(_react.Component)) || _class;

ScrollingTableHeader.propTypes = {
  header: require('react').PropTypes.any.isRequired,
  headers: babelPluginFlowReactPropTypes_proptype_Headers,
  onSort: require('react').PropTypes.func.isRequired,
  onDragStart: require('react').PropTypes.func.isRequired,
  onDragOver: require('react').PropTypes.func.isRequired,
  onDragEnd: require('react').PropTypes.func.isRequired,
  onResize: require('react').PropTypes.func.isRequired
};
exports.default = ScrollingTableHeader;
;

var _temp = function () {
  if (typeof __REACT_HOT_LOADER__ === 'undefined') {
    return;
  }

  __REACT_HOT_LOADER__.register(clearDragOptions, 'clearDragOptions', 'src/scrolling-table/ScrollingTableHeader.jsx');

  __REACT_HOT_LOADER__.register(ScrollingTableHeader, 'ScrollingTableHeader', 'src/scrolling-table/ScrollingTableHeader.jsx');
}();

;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JvbGxpbmctdGFibGUvU2Nyb2xsaW5nVGFibGVIZWFkZXIuanN4Il0sIm5hbWVzIjpbImNsZWFyRHJhZ09wdGlvbnMiLCJldmVudCIsImRhdGFUcmFuc2ZlciIsImVmZmVjdEFsbG93ZWQiLCJkcm9wRWZmZWN0IiwiU2Nyb2xsaW5nVGFibGVIZWFkZXIiLCJwcm9wcyIsImNvbnRleHQiLCJfbW91c2VNb3ZlSGFuZGxlciIsIl9yZXNpemluZ0hhbmRsZXIiLCJfc3RhcnRSZXNpemluZyIsIl9zdG9wUmVzaXppbmciLCJfb25EcmFnT3ZlciIsIl9zdGFydERyYWdnaW5nIiwiX3N0b3BEcmFnZ2luZyIsInN0YXRlIiwiZHJhZ2dpbmciLCJyZXNpemluZyIsIl90aWNraW5nIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIm5leHRQcm9wcyIsIm5leHRTdGF0ZSIsImhlYWRlciIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZXNpemFibGUiLCJfcmVzaXplSGFuZGxlIiwibW91c2VYIiwiY2xpZW50WCIsIm9mZnNldENlbnRlciIsIm9mZnNldFdpZHRoIiwib2Zmc2V0TGVmdCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsImxlZnQiLCJyZXNpemVGbiIsIm9uUmVzaXplIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwiYnV0dG9uIiwicHJldmVudERlZmF1bHQiLCJzdG9wUHJvcGFnYXRpb24iLCJkb2N1bWVudCIsImJvZHkiLCJzdHlsZSIsImN1cnNvciIsInNldFN0YXRlIiwiZHJhZ2dhYmxlIiwib25EcmFnT3ZlciIsIm9uRHJhZ1N0YXJ0Iiwib25EcmFnRW5kIiwiaGVhZGVycyIsInNpemUiLCJvcmRlciIsIl9pc0xhc3RIZWFkZXIiLCJyZXNpemVIYW5kbGUiLCJIZWFkZXJUZW1wbGF0ZSIsInRlbXBsYXRlIiwid2lkdGgiLCJtaW5XaWR0aCIsInJvb3QiLCJfcm9vdCIsIm9uU29ydCIsInRvSlMiLCJfcmVuZGVyUmVzaXplSGFu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O0FBQUE7QUFBQSxZQUFLLE9BQU9oQixLQUFaO0FBQ0Msd0NBQUMsY0FBRCwyQkFBZ0IsUUFBUTtBQUFBLHFCQUFNLE9BQUtwQyxLQUFMLENBQVdzRCxNQUFYLENBQWtCckMsTUFBbEIsQ0FBTjtBQUFBLGFBQXhCLElBQTZEQSxPQUFPc0MsSUFBUCxFQUE3RCxFQUREO0FBRUUsZUFBS0MsbUJBQUw7QUFGRjtBQVJELE9BREY7QUFjRDs7Ozs7Ozs7Ozs7Ozs7a0JBN0prQnpELG9COzs7Ozs7OztnQ0FQWkwsZ0I7O2dDQU9ZSyxvQiIsImZpbGUiOiJTY3JvbGxpbmdUYWJsZUhlYWRlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8vIEBmbG93XG5cbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgUmFkaXVtIGZyb20gJ3JhZGl1bSc7XG5pbXBvcnQgdHlwZSB7IFN5bnRoZXRpY0RyYWdFdmVudCwgU3ludGhldGljTW91c2VFdmVudCB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgSGVhZGVyIH0gZnJvbSAnLi8nO1xuaW1wb3J0IHtcbiAgSEVBREVSX1JFU0laSU5HX0hBTkRMRV9TVFlMRVMsXG4gIEhFQURFUl9SRVNJWklOR19IQU5ETEVfQkFSX1NUWUxFUyxcbiAgSEVBREVSX0NFTExfU1RZTEVTLFxuICBIRUFERVJfQ0VMTF9DT05UQUlORVJfU1RZTEVTLFxufSBmcm9tICcuL1Njcm9sbGluZ1RhYmxlLnN0eWxlJztcbmltcG9ydCB0eXBlIHsgSGVhZGVycyB9IGZyb20gJy4vJztcblxudHlwZSBQcm9wcyA9IHtcbiAgaGVhZGVyOiBIZWFkZXIsXG4gIGhlYWRlcnM6IEhlYWRlcnMsXG5cbiAgb25Tb3J0OiAoaGVhZGVyOiBIZWFkZXIpID0+IEhlYWRlcixcbiAgb25EcmFnU3RhcnQ6IChoZWFkZXI6IEhlYWRlcikgPT4gdm9pZCxcbiAgb25EcmFnT3ZlcjogKGhlYWRlcjogSGVhZGVyKSA9PiB2b2lkLFxuICBvbkRyYWdFbmQ6IChoZWFkZXI6IEhlYWRlcikgPT4gdm9pZCxcbiAgb25SZXNpemU6IChkZWx0YTogbnVtYmVyKSA9PiB2b2lkLFxufTtcblxudHlwZSBTdGF0ZSA9IHtcbiAgcmVzaXppbmc6IGJvb2xlYW4sXG4gIGRyYWdnaW5nOiBib29sZWFuLFxufVxuXG5mdW5jdGlvbiBjbGVhckRyYWdPcHRpb25zKGV2ZW50OiBTeW50aGV0aWNEcmFnRXZlbnQpIHtcbiAgY29uc3QgeyBkYXRhVHJhbnNmZXIgfSA9IGV2ZW50O1xuICBkYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICdub25lJztcbiAgZGF0YVRyYW5zZmVyLmRyb3BFZmZlY3QgPSAnbm9uZSc7XG59XG5cbkBSYWRpdW1cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFNjcm9sbGluZ1RhYmxlSGVhZGVyIGV4dGVuZHMgQ29tcG9uZW50IHtcbiAgcHJvcHM6IFByb3BzO1xuICBzdGF0ZTogU3RhdGU7XG5cbiAgX3RpY2tpbmc6IGJvb2xlYW47XG4gIF9yZXNpemVIYW5kbGU6ID9IVE1MRWxlbWVudDtcbiAgX3Jvb3Q6ID9IVE1MRWxlbWVudDtcblxuICBjb25zdHJ1Y3Rvcihwcm9wczogUHJvcHMsIGNvbnRleHQ6IE9iamVjdCkge1xuICAgIHN1cGVyKHByb3BzLCBjb250ZXh0KTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICBkcmFnZ2luZzogZmFsc2UsXG4gICAgICByZXNpemluZzogZmFsc2UsXG4gICAgfTtcblxuICAgIHRoaXMuX3RpY2tpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fc3RvcFJlc2l6aW5nLCBmYWxzZSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX21vdXNlTW92ZUhhbmRsZXIsIGZhbHNlKTtcbiAgfVxuXG4gIHNob3VsZENvbXBvbmVudFVwZGF0ZShuZXh0UHJvcHM6IFByb3BzLCBuZXh0U3RhdGU6IFN0YXRlKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMucHJvcHMuaGVhZGVyICE9PSBuZXh0UHJvcHMuaGVhZGVyKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdGF0ZS5kcmFnZ2luZyAhPT0gbmV4dFN0YXRlLmRyYWdnaW5nKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5yZXNpemluZyAhPT0gbmV4dFN0YXRlLnJlc2l6aW5nO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9zdG9wUmVzaXppbmcpO1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9tb3VzZU1vdmVIYW5kbGVyKTtcbiAgfVxuXG4gIF9tb3VzZU1vdmVIYW5kbGVyID0gKGV2ZW50OiBTeW50aGV0aWNNb3VzZUV2ZW50KSA9PiB7XG4gICAgaWYgKHRoaXMuc3RhdGUucmVzaXppbmcgJiYgdGhpcy5wcm9wcy5oZWFkZXIucmVzaXphYmxlKSB7XG4gICAgICB0aGlzLl9yZXNpemluZ0hhbmRsZXIoZXZlbnQpO1xuICAgIH1cbiAgfVxuXG4gIF9yZXNpemluZ0hhbmRsZXIgPSAoZXZlbnQ6IFN5bnRoZXRpY01vdXNlRXZlbnQpID0+IHtcbiAgICBpZiAodGhpcy5fcmVzaXplSGFuZGxlICE9IG51bGwgJiYgIXRoaXMuX3RpY2tpbmcpIHtcbiAgICAgIGNvbnN0IG1vdXNlWCA9IGV2ZW50LmNsaWVudFg7XG4gICAgICAvKipcbiAgICAgICAqIEZpbmQgdGhlIG9mZnNldExlZnQgcmVsYXRpdmUgdG8gdGhlIHJlc2l6ZUhhbmRsZVxuICAgICAgICogdGhlbiBhZGQgaGFsZiB0aGUgd2lkdGggc28gdGhhdCB0aGUgZGVsdGEgaXMgY2FsY3VsYXRlZFxuICAgICAgICogZnJvbSB0aGUgbWlkZGxlIG9mIHRoZSByZXNpemUgaGFuZGxlXG4gICAgICAgKi9cbiAgICAgIGNvbnN0IG9mZnNldENlbnRlciA9ICh0aGlzLl9yZXNpemVIYW5kbGUub2Zmc2V0V2lkdGggLyAyKTtcbiAgICAgIGNvbnN0IG9mZnNldExlZnQgPSB0aGlzLl9yZXNpemVIYW5kbGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdDtcbiAgICAgIGNvbnN0IHJlc2l6ZUZuID0gKCkgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uUmVzaXplKG9mZnNldExlZnQgKyBvZmZzZXRDZW50ZXIgLSBtb3VzZVgpO1xuXG4gICAgICAgIHRoaXMuX3RpY2tpbmcgPSBmYWxzZTtcbiAgICAgIH07XG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHsgcmVzaXplRm4oKTsgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5fdGlja2luZyA9IHRydWU7XG4gIH1cblxuICBfc3RhcnRSZXNpemluZyA9IChldmVudDogU3ludGhldGljTW91c2VFdmVudCkgPT4ge1xuICAgIC8vIG9ubHkgc3RhcnQgcmVzaXppbmcgaWYgbGVmdCBidXR0b24gbW91c2UgZG93blxuICAgIGlmIChldmVudC5idXR0b24gPT09IDAgJiYgdGhpcy5wcm9wcy5oZWFkZXIucmVzaXphYmxlKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9ICdjb2wtcmVzaXplJztcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyByZXNpemluZzogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxuICBfc3RvcFJlc2l6aW5nID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLmhlYWRlci5yZXNpemFibGUpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gbnVsbDtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyByZXNpemluZzogZmFsc2UgfSk7XG4gICAgfVxuICB9XG5cbiAgX29uRHJhZ092ZXIgPSAoZXZlbnQ6IFN5bnRoZXRpY0RyYWdFdmVudCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLmhlYWRlci5kcmFnZ2FibGUpIHtcbiAgICAgIC8vIEJ5IGRlZmF1bHQgZWxlbWVudHMgY2Fubm90IGJlIGRyb3BwZWQgaW4gb3RoZXIgZWxlbWVudHMuXG4gICAgICAvLyBUbyBhbGxvdyBhIGRyb3Agd2UgbXVzdCBwcmV2ZW50IHRoZSBkZWZhdWx0IGhhbmRsaW5nIG9mIHRoZSBlbGVtZW50LlxuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMucHJvcHMub25EcmFnT3Zlcih0aGlzLnByb3BzLmhlYWRlcik7XG4gICAgfVxuICB9XG5cbiAgX3N0YXJ0RHJhZ2dpbmcgPSAoZXZlbnQ6IFN5bnRoZXRpY0RyYWdFdmVudCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLmhlYWRlci5kcmFnZ2FibGUpIHtcbiAgICAgIGNsZWFyRHJhZ09wdGlvbnMoZXZlbnQpO1xuICAgICAgdGhpcy5wcm9wcy5vbkRyYWdTdGFydCh0aGlzLnByb3BzLmhlYWRlcik7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgZHJhZ2dpbmc6IHRydWUgfSk7XG4gICAgfVxuICB9XG5cbiAgX3N0b3BEcmFnZ2luZyA9ICgpID0+IHtcbiAgICBpZiAodGhpcy5wcm9wcy5oZWFkZXIuZHJhZ2dhYmxlKSB7XG4gICAgICB0aGlzLnByb3BzLm9uRHJhZ0VuZCh0aGlzLnByb3BzLmhlYWRlcik7XG4gICAgICB0aGlzLnNldFN0YXRlKHsgZHJhZ2dpbmc6IGZhbHNlIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9pc0xhc3RIZWFkZXIoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICh0aGlzLnByb3BzLmhlYWRlcnMuc2l6ZSAtIDEpID09PSB0aGlzLnByb3BzLmhlYWRlci5vcmRlcjtcbiAgfVxuXG4gIF9yZW5kZXJSZXNpemVIYW5kbGUoKTogP1JlYWN0LkVsZW1lbnQ8Kj4ge1xuICAgIGlmICh0aGlzLl9pc0xhc3RIZWFkZXIoKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgcmVmPXsocmVzaXplSGFuZGxlOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgICAgIHRoaXMuX3Jlc2l6ZUhhbmRsZSA9IHJlc2l6ZUhhbmRsZTtcbiAgICAgICAgfX1cbiAgICAgICAgb25Nb3VzZURvd249e3RoaXMuX3N0YXJ0UmVzaXppbmd9XG4gICAgICAgIHN0eWxlPXtIRUFERVJfUkVTSVpJTkdfSEFORExFX1NUWUxFU31cbiAgICAgID5cbiAgICAgICAgPGRpdiBzdHlsZT17SEVBREVSX1JFU0laSU5HX0hBTkRMRV9CQVJfU1RZTEVTfSAvPlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpOiBSZWFjdC5FbGVtZW50PCo+IHtcbiAgICBjb25zdCB7IGhlYWRlciB9ID0gdGhpcy5wcm9wcztcbiAgICBjb25zdCBIZWFkZXJUZW1wbGF0ZSA9IGhlYWRlci50ZW1wbGF0ZTtcbiAgICBjb25zdCB3aWR0aCA9IGhlYWRlci53aWR0aDtcblxuICAgIGNvbnN0IHN0eWxlID0geyAuLi5IRUFERVJfQ0VMTF9DT05UQUlORVJfU1RZTEVTIH07XG5cbiAgICBzdHlsZS5taW5XaWR0aCA9IGhlYWRlci5taW5XaWR0aDtcbiAgICBpZiAod2lkdGggIT0gbnVsbCkge1xuICAgICAgc3R5bGUud2lkdGggPSB3aWR0aDtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICBkcmFnZ2FibGU9XCJ0cnVlXCJcbiAgICAgICAgb25EcmFnU3RhcnQ9e3RoaXMuX3N0YXJ0RHJhZ2dpbmd9XG4gICAgICAgIG9uRHJhZ0VuZD17dGhpcy5fc3RvcERyYWdnaW5nfVxuICAgICAgICBvbkRyYWdFbnRlcj17Y2xlYXJEcmFnT3B0aW9uc31cbiAgICAgICAgb25EcmFnT3Zlcj17dGhpcy5fb25EcmFnT3Zlcn1cbiAgICAgICAgcmVmPXsocm9vdDogSFRNTEVsZW1lbnQpID0+IHsgdGhpcy5fcm9vdCA9IHJvb3Q7IH19XG4gICAgICAgIHN0eWxlPXtIRUFERVJfQ0VMTF9TVFlMRVN9XG4gICAgICA+PGRpdiBzdHlsZT17c3R5bGV9PlxuICAgICAgICA8SGVhZGVyVGVtcGxhdGUgb25Tb3J0PXsoKSA9PiB0aGlzLnByb3BzLm9uU29ydChoZWFkZXIpfSB7Li4uaGVhZGVyLnRvSlMoKX0gLz5cbiAgICAgICAge3RoaXMuX3JlbmRlclJlc2l6ZUhhbmRsZSgpfVxuICAgICAgPC9kaXY+PC9kaXY+XG4gICAgKTtcbiAgfVxufVxuIl19